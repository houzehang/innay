var _Mathfloor=Math.floor,_Mathmax=Math.max;(function H(W,K,z){function q(X,Z){if(!K[X]){if(!W[X]){var ee="function"==typeof require&&require;if(!Z&&ee)return ee(X,!0);if(J)return J(X,!0);throw new Error("Cannot find module '"+X+"'")}var te=K[X]={exports:{}};W[X][0].call(te.exports,function(ie){var ne=W[X][1][ie];return q(ne?ne:ie)},te,te.exports,H,W,K,z)}return K[X].exports}for(var J="function"==typeof require&&require,Y=0;Y<z.length;Y++)q(z[Y]);return q})({1:[function(H,W){W.exports={AGORA_APPID:"d75fe75ab0404a90b2ed7e5bab216f80",AGORA_CHANNEL_KEY:"7c9b6ed9bba54dc59471cfa09e9f23ea",VIDEO_QUALITY:"480P_4",CELL_COUNT:4,VIDEO_DEVICE_ID:"422bbdb68bec0dcbd49a04aee9b4088fd5a50b6536f99ab330dd606bdbdbe09d",AUDIO_DEVICE_ID:"3ee753f849656cd89dcd2bf6e154c5ac123c94372d147f91b72f1f23101e3d04",LOGIN_E_NET:201,LOGOUT_E_NET:102,GENERAL_E_NOT_LOGIN:1003,JS_READY:"jsready",INIT_ROOM:"initroom",MEMBER_ADD:"member_add",MEMBER_LEAVE:"member_leave",DRAWLINE:"drawline",ROLLBACK:"rollback",REVERTROLL:"revertroll",CLEARLINES:"clearlines",NEXT_PAGE:"nextpage",SYNC:"sync",VIDEO_SHOW:"showvideo",VIDEO_PLAY:"videoplay",VIDEO_PAUSE:"videopause",VIDEO_DRAG:"videodrag",VIDEO_STOP:"videostop",OPEN_RACE:"openrace",CLOSE_RACE:"closerace",START_TEST:"starttest",STOP_TEST:"stoptest",OPEN_MIC:"openmic",CLOSE_MIC:"closemic",OPEN_GIFT:"opengift",CLOSE_GIFT:"closegift"}},{}],2:[function(H,W,K){!function(z,q){"object"==typeof K&&"object"==typeof W?W.exports=q():"function"==typeof define&&define.amd?define("AgoraRTC",[],q):"object"==typeof K?K.AgoraRTC=q():z.AgoraRTC=q()}(this,function(){return function(z){function q(Y){if(J[Y])return J[Y].exports;var X=J[Y]={i:Y,l:!1,exports:{}};return z[Y].call(X.exports,X,X.exports,q),X.l=!0,X.exports}var J={};return q.m=z,q.c=J,q.d=function(Y,X,Z){q.o(Y,X)||Object.defineProperty(Y,X,{configurable:!1,enumerable:!0,get:Z})},q.n=function(Y){var X=Y&&Y.__esModule?function(){return Y.default}:function(){return Y};return q.d(X,"a",X),X},q.o=function(Y,X){return Object.prototype.hasOwnProperty.call(Y,X)},q.p="",q(q.s=34)}([function(z,q,J){"use strict";Object.defineProperty(q,"__esModule",{value:!0});var Y=J(13),X=function(){var ae=0,Z,ee,te,ie,ne,se;return Z=function(oe){4<oe?oe=4:0>oe&&(oe=0),ae=oe},ee=function(){var oe=arguments[0],re=arguments;if(!(oe<ae))switch(oe){case 0:re[0]=(0,Y.getTimestamp)()+" DEBUG:",console.log.apply(console,re);break;case 1:re[0]=(0,Y.getTimestamp)()+" INFO:",console.log.apply(console,re);break;case 2:re[0]=(0,Y.getTimestamp)()+" WARN:",console.warn.apply(console,re);break;case 3:re[0]=(0,Y.getTimestamp)()+" ERROR:",console.error.apply(console,re);break;default:return re[0]=(0,Y.getTimestamp)()+" DEFAULT:",void console.log.apply(console,re);}},te=function(){for(var oe=[0],re=0;re<arguments.length;re++)oe.push(arguments[re]);ee.apply(this,oe)},ie=function(){for(var oe=[1],re=0;re<arguments.length;re++)oe.push(arguments[re]);ee.apply(this,oe)},ne=function(){for(var oe=[2],re=0;re<arguments.length;re++)oe.push(arguments[re]);ee.apply(this,oe)},se=function(){for(var oe=[3],re=0;re<arguments.length;re++)oe.push(arguments[re]);ee.apply(this,oe)},{DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4,setLogLevel:Z,log:ee,debug:te,info:ie,warning:ne,error:se}}();q.default=X},function(z,q){"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.GIT_VERSION="release_20180410_01-2-g5dcca91",q.VERSION="2.2.0",q.WEBCS_DOMAIN=["webcs-1.agora.io","webcs-2.agora.io"],q.WEBCS_DOMAIN_BACKUP_LIST=["webcs-3.agora.io","webcs-4.agora.io"],q.EVENT_REPORT_DOMAIN="webcollector-1.agora.io",q.EVENT_REPORT_BACKUP_DOMAIN="webcollector-2.agora.io",q.WEBCS_BACKUP_CONNECT_TIMEOUT=6e3,q.HTTP_CONNECT_TIMEOUT=5e3,q.SUPPORT_RESOLUTION_LIST={"90p_1":[160,90],"120p_1":[160,120],"120p_3":[120,120],"120p_4":[212,120],"180p_1":[320,180],"180p_3":[180,180],"180p_4":[240,180],"240p_1":[320,240],"240p_3":[240,240],"240p_4":[424,240],"360p_1":[640,360],"360p_3":[360,360],"360p_4":[640,360],"360p_6":[360,360],"360p_7":[480,360],"360p_8":[480,360],"360p_9":[640,360],"360p_10":[640,360],"360p_11":[640,360],"480p_1":[640,480],"480p_2":[640,480],"480p_3":[480,480],"480p_4":[640,480],"480p_6":[480,480],"480p_8":[848,480],"480p_9":[848,480],"480p_10":[640,480],"720p_1":[1280,720],"720p_2":[1280,720],"720p_3":[1280,720],"720p_5":[960,720],"720p_6":[960,720],"1080p_1":[1920,1080],"1080p_2":[1920,1080],"1080p_3":[1920,1080],"1080p_5":[1920,1080],"1440p_1":[2560,1440],"1440p_2":[2560,1440],"4k_1":[3840,2160],"4k_3":[3840,2160]}},function(z,q,J){"use strict";function Y(he){return he&&he.__esModule?he:{default:he}}Object.defineProperty(q,"__esModule",{value:!0}),q.random=q.safeCall=q.is32Uint=q.vsResHack=q.CSCrashRecord=q.audioLevelHelper=q.generateSessionId=q.isLiveTranscodingValid=q.checkSystemRequirements=void 0;var Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(he){return typeof he}:function(he){return he&&"function"==typeof Symbol&&he.constructor===Symbol&&he!==Symbol.prototype?"symbol":typeof he},ee=J(3),te=function(he){if(he&&he.__esModule)return he;var ve={};if(null!=he)for(var Se in he)Object.prototype.hasOwnProperty.call(he,Se)&&(ve[Se]=he[Se]);return ve.default=he,ve}(ee),ie=J(0),ne=Y(ie),se=J(14),ae=Y(se),de=window.AudioContext||window.webkitAudioContext,ce=de?new de:null,_e=function(he){for(var ve=0;ve<he.length;ve++)for(var Se in he[ve])if("number"!=typeof he[ve][Se])throw new Error("Param user["+ve+"] - ["+Se+"] is inVaild");return!0};q.checkSystemRequirements=function(){var he=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,ve=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,Se=window.WebSocket,Ee=!!he&&!!ve&&!!Se,be=!1;return ne.default.debug(te.getBrowserInfo(),"isAPISupport:"+Ee),te.isChrome()&&58<=te.getBrowserVersion()&&"iOS"!==te.getBrowserOS()&&(be=!0),te.isFireFox()&&56<=te.getBrowserVersion()&&(be=!0),te.isOpera()&&45<=te.getBrowserVersion()&&(be=!0),te.isSafari()&&11<=te.getBrowserVersion()&&(be=!0),(te.isWeChatBrowser()||te.isQQBrowser())&&"iOS"!==te.getBrowserOS()&&(be=!0),te.isSupportedPC()||te.isSupportedMobile()||(be=!1),Ee&&be},q.isLiveTranscodingValid=function(he){var ve=["lowLatency","userConfigExtraInfo","transcodingUsers"];for(var Se in he)if("lowLatency"===Se&&"boolean"!=typeof he[Se]||"userConfigExtraInfo"===Se&&"object"!==Z(he[Se])||"transcodingUsers"===Se&&!_e(he[Se])||!~ve.indexOf(Se)&&"number"!=typeof he[Se])throw new Error("Param ["+Se+"] is inVaild");return!0},q.generateSessionId=function(){return(0,ae.default)().replace(/-/g,"").toUpperCase()},q.audioLevelHelper=function(he){if(ce)return this.audioContext=ce,this.sourceNode=he.otWebkitAudioSource||this.audioContext.createMediaStreamSource(he),this.analyser=this.audioContext.createAnalyser(),this.timeDomainData=new Uint8Array(this.analyser.frequencyBinCount),this.sourceNode.connect(this.analyser),this.getAudioLevel=function(){if(this.analyser){this.analyser.getByteTimeDomainData(this.timeDomainData);for(var ve=0,Se=0;Se<this.timeDomainData.length;Se++)ve=_Mathmax(ve,Math.abs(this.timeDomainData[Se]-128));return ve/128}return ne.default.warning("can't find analyser in audioLevelHelper"),0},this},q.CSCrashRecord={shouldBlock:function(){if(localStorage){var he=JSON.parse(localStorage.getItem("agoraCSCrashRecord"));return!!(he&&6<he.length)&&0>new Date().getTime()-he[he.length-6]-1e4}return!1},record:function(he){if(localStorage){var ve=JSON.parse(localStorage.getItem("agoraCSCrashRecord"));ve=!ve||50<ve.length?[]:ve,ve.push(he),localStorage.setItem("agoraCSCrashRecord",JSON.stringify(ve))}}},q.vsResHack=function(he,ve,Se){try{var Ee=document.createElement("video");Ee.setAttribute("autoplay",""),Ee.setAttribute("muted",""),Ee.setAttribute("playsinline",""),Ee.setAttribute("style","position: absolute; top: 0; left: 0; width:1px; high:1px;"),document.body.appendChild(Ee),Ee.addEventListener("playing",function(){te.isFireFox()?Ee.videoWidth&&(ve(Ee.videoWidth,Ee.videoHeight),document.body.removeChild(Ee)):(ve(Ee.videoWidth,Ee.videoHeight),document.body.removeChild(Ee))}),Ee.srcObject=he}catch(be){Se(be)}},q.is32Uint=function(he){return!!(0<=he&&4294967295>=he)},q.safeCall=function(){var he=arguments[0];if("function"==typeof he){var ve=Array.prototype.slice.call(arguments,1);he.apply(null,ve)}},q.random=function(he){isNaN(he)&&(he=1e3);var ve=+new Date;ve=(9301*ve+49297)%233280;var Se=ve/233280;return Math.ceil(Se*he)}},function(z,q){"use strict";Object.defineProperty(q,"__esModule",{value:!0});var oe=function(){return de().os},re=function(){var le=navigator.userAgent,pe=le.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],ce;"Chrome"===pe[1]&&null!=(ce=le.match(/(OPR(?=\/))\/?(\d+)/i))&&(pe=ce),"Safari"===pe[1]&&null!=(ce=le.match(/version\/(\d+)/i))&&(pe[2]=ce[1]),~le.toLowerCase().indexOf("qqbrowser")&&null!=(ce=le.match(/(qqbrowser(?=\/))\/?(\d+)/i))&&(pe=ce),~le.toLowerCase().indexOf("micromessenger")&&null!=(ce=le.match(/(micromessenger(?=\/))\/?(\d+)/i))&&(pe=ce),~le.toLowerCase().indexOf("edge")&&null!=(ce=le.match(/(edge(?=\/))\/?(\d+)/i))&&(pe=ce),~le.toLowerCase().indexOf("trident")&&null!=(ce=/\brv[ :]+(\d+)/g.exec(le)||[])&&(pe=[null,"IE",ce[1]]);var ue,me=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var ge in me){var _e=me[ge];if(_e.r.test(navigator.userAgent)){ue=_e.s;break}}return{name:pe[1],version:pe[2],os:ue}},de=function(){var ce=re();return function(){return ce}}();q.getBrowserInfo=de,q.getBrowserVersion=function(){return de().version},q.getBrowserOS=oe,q.isChrome=function(){var ce=de();return ce.name&&"Chrome"===ce.name},q.isSafari=function(){var ce=de();return ce.name&&"Safari"===ce.name},q.isFireFox=function(){var ce=de();return ce.name&&"Firefox"===ce.name},q.isOpera=function(){var ce=de();return ce.name&&"OPR"===ce.name},q.isQQBrowser=function(){var ce=de();return ce.name&&"QQBrowser"===ce.name},q.isWeChatBrowser=function(){var ce=de();return ce.name&&"MicroMessenger"===ce.name},q.isSupportedPC=function(){var ce=oe();return"Linux"===ce||"Mac OS X"===ce||"Mac OS"===ce||-1!==ce.indexOf("Windows")},q.isSupportedMobile=function(){var ce=oe();return"Android"===ce||"iOS"===ce}},function(z,q){"use strict";Object.defineProperty(q,"__esModule",{value:!0});var X=function(ne){var se={};return se.type=ne.type,se};q.EventDispatcher=function(){var ne={};return ne.dispatcher={},ne.dispatcher.eventListeners={},ne.addEventListener=function(se,ae){void 0===ne.dispatcher.eventListeners[se]&&(ne.dispatcher.eventListeners[se]=[]),ne.dispatcher.eventListeners[se].push(ae)},ne.on=ne.addEventListener,ne.removeEventListener=function(se,ae){var oe;-1!==(oe=ne.dispatcher.eventListeners[se].indexOf(ae))&&ne.dispatcher.eventListeners[se].splice(oe,1)},ne.dispatchEvent=function(se){for(var ae in ne.dispatcher.eventListeners[se.type])ne.dispatcher.eventListeners[se.type].hasOwnProperty(ae)&&"function"==typeof ne.dispatcher.eventListeners[se.type][ae]&&ne.dispatcher.eventListeners[se.type][ae](se)},ne.dispatchSocketEvent=function(se){for(var ae in ne.dispatcher.eventListeners[se.type])ne.dispatcher.eventListeners[se.type].hasOwnProperty(ae)&&"function"==typeof ne.dispatcher.eventListeners[se.type][ae]&&ne.dispatcher.eventListeners[se.type][ae](se.msg)},ne},q.StreamEvent=function(ne){var se=X(ne);return se.stream=ne.stream,se.reason=ne.reason,se.msg=ne.msg,se},q.ClientEvent=function(ne){var se=X(ne);return se.uid=ne.uid,se.attr=ne.attr,se.stream=ne.stream,se},q.MediaEvent=function(ne){var se=X(ne);return se.msg=ne.msg,se},q.LiveStreamingEvent=function(ne){var se=X(ne);return se.url=ne.url,se.reason=ne.reason,se}},function(z,q,J){"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.SUBSCRIBE=q.PUBLISH=q.JOIN_GATEWAY=q.JOIN_CHOOSE_SERVER=q.SESSION_INIT=q.report=void 0;var Y=J(1),X=function(ne){if(ne&&ne.__esModule)return ne;var se={};if(null!=ne)for(var ae in ne)Object.prototype.hasOwnProperty.call(ne,ae)&&(se[ae]=ne[ae]);return se.default=ne,se}(Y),Z=J(0),ee=(function(ne){ne&&ne.__esModule}(Z),J(9)),te={type:null,sid:null,lts:null,succ:null,cname:null,uid:null,peerid:null,cid:null,elaps:null,extend:null,vid:0},ie=function(){var ne={};return ne.list={},ne.url=(0,ee.shouldUseHttps)()?"https://"+X.EVENT_REPORT_DOMAIN+":6443/events/report":"http://"+X.EVENT_REPORT_DOMAIN+":6080/events/report",ne.urlBackup=(0,ee.shouldUseHttps)()?"https://"+X.EVENT_REPORT_BACKUP_DOMAIN+":6443/events/report":"http://"+X.EVENT_REPORT_BACKUP_DOMAIN+"\":6080/events/report",ne.sessionInit=function(se,ae){ae.sid=se;var oe=Object.assign(te,ae);ne.list[se]||(oe.startTime=+new Date);var re=Object.assign({},oe);delete oe.appid,delete oe.mode,ne.list[se]=oe,re.extend=null,re.ver=X.VERSION,re.type="session_init",re.browser=navigator.userAgent,re.lts=+new Date,re.elaps=re.lts-re.startTime,ne.send(re)},ne.joinChooseServer=function(se,ae,oe){var re;re=oe?Object.assign(ne.list[se],ae):Object.assign({},ne.list[se],ae),re.type="join_choose_server";var de=+new Date;re.ev_elaps=de-re.lts,re.elaps=de-re.startTime,re.lts=de,re.serverList=JSON.stringify(re.serverList),ne.send(re)},ne.joinGateway=function(se,ae){var oe=Object.assign(ne.list[se],ae);oe.type="join_gateway";var re=+new Date;oe.ev_elaps=re-oe.lts,oe.elaps=re-oe.startTime,oe.lts=re,ne.send(oe)},ne.publish=function(se,ae){var oe=Object.assign({},ne.list[se],ae);oe.type="publish";var re=+new Date;oe.ev_elaps=re-oe.lts,oe.elaps=re-oe.startTime,oe.lts=re,ne.send(oe)},ne.subscribe=function(se,ae){var oe=Object.assign({},ne.list[se],ae);oe.type="subscribe";var re=+new Date;oe.ev_elaps=re-oe.lts,oe.elaps=re-oe.startTime,oe.lts=re,ne.send(oe)},ne.firstRemoteFrame=function(se,ae){var oe=Object.assign({},ne.list[se],ae);oe.type="first_remote_frame",oe.lts=+new Date,oe.elaps=oe.lts-oe.startTime,ne.send(oe)},ne.streamSwitch=function(se,ae){var oe=Object.assign({},ne.list[se],ae);oe.type="stream_switch",oe.isdual=ae.isdual,oe.lts=+new Date,oe.elaps=oe.lts-oe.startTime,ne.send(oe)},ne.audioSendingStopped=function(se,ae){var oe=Object.assign({},ne.list[se],ae);oe.type="audio_sending_stopped",oe.lts=+new Date,oe.elaps=oe.lts-oe.startTime,ne.send(oe)},ne.videoSendingStopped=function(se,ae){var oe=Object.assign({},ne.list[se],ae);oe.type="video_sending_stopped",oe.lts=+new Date,oe.elaps=oe.lts-oe.startTime,ne.send(oe)},ne.send=function(se){try{(0,ee.post)(ne.url,se,null,function(){(0,ee.post)(ne.urlBackup,se,null,function(){},{timeout:1e4})},{timeout:1e4})}catch(ae){}},ne}();q.report=ie,q.SESSION_INIT="session_init",q.JOIN_CHOOSE_SERVER="join_choose_server",q.JOIN_GATEWAY="join_gateway",q.PUBLISH="publish",q.SUBSCRIBE="subscribe"},function(z,q){"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.default={FAILED:"FAILED",INVALID_KEY:"INVALID_KEY",INVALID_OPERATION:"INVALID_OPERATION",INVALID_PARAMETER:"INVALID_PARAMETER",INVALID_LOCAL_STREAM:"INVALID_LOCAL_STREAM",INVALID_REMOTE_STREAM:"INVALID_REMOTE_STREAM",INVALID_DYNAMIC_KEY:"INVALID_DYNAMIC_KEY",DYNAMIC_KEY_TIMEOUT:"DYNAMIC_KEY_TIMEOUT",NO_VOCS_AVAILABLE:"NO_VOCS_AVAILABLE",NO_VOS_AVAILABLE:"ERR_NO_VOS_AVAILABLE",JOIN_CHANNEL_TIMEOUT:"ERR_JOIN_CHANNEL_TIMEOUT",NO_AVAILABLE_CHANNEL:"NO_AVAILABLE_CHANNEL",LOOKUP_CHANNEL_TIMEOUT:"LOOKUP_CHANNEL_TIMEOUT",LOOKUP_CHANNEL_REJECTED:"LOOKUP_CHANNEL_REJECTED",OPEN_CHANNEL_TIMEOUT:"OPEN_CHANNEL_TIMEOUT",OPEN_CHANNEL_REJECTED:"OPEN_CHANNEL_REJECTED",REQUEST_DEFERRED:"REQUEST_DEFERRED",STREAM_ALREADY_PUBLISHED:"STREAM_ALREADY_PUBLISHED",STREAM_NOT_YET_PUBLISHED:"STREAM_NOT_YET_PUBLISHED",JOIN_TOO_FREQUENT:"JOIN_TOO_FREQUENT",SOCKET_ERROR:"SOCKET_ERROR",SOCKET_DISCONNECTED:"SOCKET_DISCONNECTED",PEERCONNECTION_FAILED:"PEERCONNECTION_FAILED",CONNECT_GATEWAY_ERROR:"CONNECT_GATEWAY_ERROR",SERVICE_NOT_AVAILABLE:"SERVICE_NOT_AVAILABLE",JOIN_CHANNEL_FAILED:"JOIN_CHANNEL_FAILED",PUBLISH_STREAM_FAILED:"PUBLISH_STREAM_FAILED",UNPUBLISH_STREAM_FAILED:"UNPUBLISH_STREAM_FAILED",SUBSCRIBE_STREAM_FAILED:"SUBSCRIBE_STREAM_FAILED",UNSUBSCRIBE_STREAM_FAILED:"UNSUBSCRIBE_STREAM_FAILED",NO_SUCH_REMOTE_STREAM:"NO_SUCH_REMOTE_STREAM",ERR_FAILED:"1",ERR_INVALID_VENDOR_KEY:"101",ERR_INVALID_CHANNEL_NAME:"102",WARN_NO_AVAILABLE_CHANNEL:"103",WARN_LOOKUP_CHANNEL_TIMEOUT:"104",WARN_LOOKUP_CHANNEL_REJECTED:"105",WARN_OPEN_CHANNEL_TIMEOUT:"106",WARN_OPEN_CHANNEL_REJECTED:"107",WARN_REQUEST_DEFERRED:"108",ERR_DYNAMIC_KEY_TIMEOUT:"109",ERR_INVALID_DYNAMIC_KEY:"110",ERR_NO_VOCS_AVAILABLE:"2000",ERR_NO_VOS_AVAILABLE:"2001",ERR_JOIN_CHANNEL_TIMEOUT:"2002",IOS_NOT_SUPPORT:"IOS_NOT_SUPPORT",WECHAT_NOT_SUPPORT:"WECHAT_NOT_SUPPORT",SHARING_SCREEN_NOT_SUPPORT:"SHARING_SCREEN_NOT_SUPPORT",STILL_ON_PUBLISHING:"STILL_ON_PUBLISHING",LOW_STREAM_ALREADY_PUBLISHED:"LOW_STREAM_ALREADY_PUBLISHED",LOW_STREAM_NOT_YET_PUBLISHED:"LOW_STREAM_ALREADY_PUBLISHED",HIGH_STREAM_NOT_VIDEO_TRACE:"HIGH_STREAM_NOT_VIDEO_TRACE",NOT_FIND_DEVICE_BY_LABEL:"NOT_FIND_DEVICE_BY_LABEL",ENABLE_DUALSTREAM_FAILED:"ENABLE_DUALSTREAM_FAILED",DISABLE_DUALSTREAM_FAILED:"DISABLE_DUALSTREAM_FAILED",ELECTRON_NOT_SUPPORT_SHARING_SCREEN:"ELECTRON_NOT_SUPPORT_SHARING_SCREEN"},q.GatewayErrorCode={2:"K_TIMESTAMP_EXPIRED",3:"K_CHANNEL_PERMISSION_INVALID",4:"K_CERTIFICATE_INVALID",5:"K_CHANNEL_NAME_EMPTY",6:"K_CHANNEL_NOT_FOUND",7:"K_TICKET_INVALID",8:"K_CHANNEL_CONFLICTED",9:"K_SERVICE_NOT_READY",10:"K_SERVICE_TOO_HEAVY",14:"K_UID_BANNED",15:"K_IP_BANNED",16:"K_CHANNEL_BANNED",101:"ERR_INVALID_VENDOR_KEY",102:"ERR_INVALID_CHANNEL_NAME",103:"WARN_NO_AVAILABLE_CHANNEL",104:"WARN_LOOKUP_CHANNEL_TIMEOUT",105:"WARN_LOOKUP_CHANNEL_REJECTED",106:"WARN_OPEN_CHANNEL_TIMEOUT",107:"WARN_OPEN_CHANNEL_REJECTED",108:"WARN_REQUEST_DEFERRED",109:"ERR_DYNAMIC_KEY_TIMEOUT",110:"ERR_NO_AUTHORIZED",111:"ERR_VOM_SERVICE_UNAVAILABLE",112:"ERR_NO_CHANNEL_AVAILABLE_CODE",113:"ERR_TOO_MANY_USERS",114:"ERR_MASTER_VOCS_UNAVAILABLE",115:"ERR_INTERNAL_ERROR",116:"ERR_NO_ACTIVE_STATUS",117:"ERR_INVALID_UID",118:"ERR_DYNAMIC_KEY_EXPIRED",119:"ERR_STATIC_USE_DYANMIC_KE",120:"ERR_DYNAMIC_USE_STATIC_KE",2000:"ERR_NO_VOCS_AVAILABLE",2001:"ERR_NO_VOS_AVAILABLE",2002:"ERR_JOIN_CHANNEL_TIMEOUT"}},function(z,q,J){"use strict";function Y(ue){return ue&&ue.__esModule?ue:{default:ue}}Object.defineProperty(q,"__esModule",{value:!0}),q.getDevices=q.createStream=q.Stream=void 0;var X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ue){return typeof ue}:function(ue){return ue&&"function"==typeof Symbol&&ue.constructor===Symbol&&ue!==Symbol.prototype?"symbol":typeof ue},Z=J(18),ee=Y(Z),te=J(8),ie=J(4),ne=J(0),se=Y(ne),ae=J(3),oe=J(27),re=J(2),de=J(5),ce=function(ue){function me(){return null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&35>=window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]}function ge(){return null!==window.navigator.userAgent.match("Firefox")}function _e(ve,Se){return{width:{ideal:ve},height:{ideal:Se},deviceId:ue.cameraId?{exact:ue.cameraId}:void 0}}var fe=(0,ie.EventDispatcher)();if(fe.params=Object.assign({},ue),fe.stream=ue.stream,fe.aux_stream=void 0,fe.url=ue.url,fe.onClose=void 0,fe.local=!1,fe.video=!!ue.video,fe.audio=!!ue.audio,fe.screen=!!ue.screen,fe.screenAttributes={width:1920,height:1080,maxFr:5,minFr:1},fe.videoSize=ue.videoSize,fe.player=void 0,fe.audioLevelHelper=null,ue.attributes=ue.attributes||{},fe.videoEnabled=!0,fe.audioEnabled=!0,fe.lowStream=null,fe.videoWidth=0,fe.videoHeight=0,fe.streamId=null,fe.streamId=ue.streamID,fe.mirror=!1!==ue.mirror,!(void 0===fe.videoSize||fe.videoSize instanceof Array&&4===fe.videoSize.length))throw Error("Invalid Video Size");fe.videoSize=[640,480,640,480],void 0!==ue.local&&!0!==ue.local||(fe.local=!0),fe.initialized=!fe.local;var he={true:!0,unspecified:!0,"90p_1":_e(160,90),"120p_1":_e(160,120),"120p_3":_e(120,120),"120p_4":_e(212,120),"180p_1":_e(320,180),"180p_3":_e(180,180),"180p_4":_e(240,180),"240p_1":_e(320,240),"240p_3":_e(240,240),"240p_4":_e(424,240),"360p_1":_e(640,360),"360p_3":_e(360,360),"360p_4":_e(640,360),"360p_6":_e(360,360),"360p_7":_e(480,360),"360p_8":_e(480,360),"360p_9":_e(640,360),"360p_10":_e(640,360),"360p_11":_e(640,360),"480p_1":_e(640,480),"480p_2":_e(640,480),"480p_3":_e(480,480),"480p_4":_e(640,480),"480p_6":_e(480,480),"480p_8":_e(848,480),"480p_9":_e(848,480),"480p_10":_e(640,480),"720p_1":_e(1280,720),"720p_2":_e(1280,720),"720p_3":_e(1280,720),"720p_5":_e(960,720),"720p_6":_e(960,720),"1080p_1":_e(1920,1080),"1080p_2":_e(1920,1080),"1080p_3":_e(1920,1080),"1080p_5":_e(1920,1080),"1440p_1":_e(2560,1440),"1440p_2":_e(2560,1440),"4k_1":_e(3840,2160),"4k_3":_e(3840,2160)};return fe.unmuteAudio=void 0,fe.muteAudio=void 0,fe.unmuteVideo=void 0,fe.muteVideo=void 0,fe.setVideoResolution=function(ve){return ve+="",void 0!==he[ve]&&(ue.video=he[ve],ue.attributes=ue.attributes||{},ue.attributes.resolution=ve,!0)},fe.setVideoFrameRate=function(ve){return!(0,ae.isFireFox)()&&"object"===(void 0===ve?"undefined":X(ve))&&ve instanceof Array&&1<ve.length&&(ue.attributes=ue.attributes||{},ue.attributes.minFrameRate=ve[0],ue.attributes.maxFrameRate=ve[1],!0)},fe.setVideoBitRate=function(ve){return"object"===(void 0===ve?"undefined":X(ve))&&ve instanceof Array&&1<ve.length&&(ue.attributes=ue.attributes||{},ue.attributes.minVideoBW=ve[0],ue.attributes.maxVideoBW=ve[1],!0)},fe.setScreenProfile=function(ve){return"string"==typeof ve&&fe.screen&&("480p_1"===ve?(fe.screenAttributes.width=640,fe.screenAttributes.height=480,fe.screenAttributes.maxFr=5,fe.screenAttributes.minFr=1):"480p_2"===ve?(fe.screenAttributes.width=640,fe.screenAttributes.height=480,fe.screenAttributes.maxFr=30,fe.screenAttributes.minFr=25):"720p_1"===ve?(fe.screenAttributes.width=1280,fe.screenAttributes.height=720,fe.screenAttributes.maxFr=5,fe.screenAttributes.minFr=1):"720p_2"===ve?(fe.screenAttributes.width=1280,fe.screenAttributes.height=720,fe.screenAttributes.maxFr=30,fe.screenAttributes.minFr=25):"1080p_1"===ve?(fe.screenAttributes.width=1920,fe.screenAttributes.height=1080,fe.screenAttributes.maxFr=5,fe.screenAttributes.minFr=1):"1080p_2"===ve?(fe.screenAttributes.width=1920,fe.screenAttributes.height=1080,fe.screenAttributes.maxFr=30,fe.screenAttributes.minFr=25):void 0,!0)},fe.setVideoProfileCustom=function(ve){fe.setVideoResolution(ve[0]),fe.setVideoFrameRate([ve[1],ve[1]]),fe.setVideoBitRate([ve[2],ve[2]])},fe.setVideoProfileCustomPlus=function(ve){console.log(ve),ue.video=_e(ve.width,ve.height),ue.attributes=ue.attributes||{},ue.attributes.resolution=ve.width+"x"+ve.height,fe.setVideoFrameRate([ve.framerate,ve.framerate]),fe.setVideoBitRate([ve.bitrate,ve.bitrate])},fe.setVideoProfile=function(ve){return!(fe.profile=ve,!("string"==typeof ve&&fe.video))&&("120p"===ve||"120P"===ve||"120p_1"===ve||"120P_1"===ve?(fe.setVideoResolution("120p_1"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([10,65])):"120p_3"===ve||"120P_3"===ve?(fe.setVideoResolution("120p_3"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([10,50])):"180p"===ve||"180P"===ve||"180p_1"===ve||"180P_1"===ve?(fe.setVideoResolution("180p_1"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([10,140])):"180p_3"===ve||"180P_3"===ve?(fe.setVideoResolution("180p_3"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([10,100])):"180p_4"===ve||"180P_4"===ve?(fe.setVideoResolution("180p_4"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([10,120])):"240p"===ve||"240P"===ve||"240p_1"===ve||"240P_1"===ve?(fe.setVideoResolution("240p_1"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([10,200])):"240p_3"===ve||"240P_3"===ve?(fe.setVideoResolution("240p_3"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([10,140])):"240p_4"===ve||"240P_4"===ve?(fe.setVideoResolution("240p_4"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([10,220])):"360p"===ve||"360P"===ve||"360p_1"===ve||"360P_1"===ve?(fe.setVideoResolution("360p_1"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([20,400])):"360p_3"===ve||"360P_3"===ve?(fe.setVideoResolution("360p_3"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([20,260])):"360p_4"===ve||"360P_4"===ve?(fe.setVideoResolution("360p_4"),fe.setVideoFrameRate([30,30]),fe.setVideoBitRate([20,600])):"360p_6"===ve||"360P_6"===ve?(fe.setVideoResolution("360p_6"),fe.setVideoFrameRate([30,30]),fe.setVideoBitRate([20,400])):"360p_7"===ve||"360P_7"===ve?(fe.setVideoResolution("360p_7"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([20,320])):"360p_8"===ve||"360P_8"===ve?(fe.setVideoResolution("360p_8"),fe.setVideoFrameRate([30,30]),fe.setVideoBitRate([20,490])):"360p_9"===ve||"360P_9"===ve?(fe.setVideoResolution("360p_9"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([20,800])):"360p_10"===ve||"360P_10"===ve?(fe.setVideoResolution("360p_10"),fe.setVideoFrameRate([24,24]),fe.setVideoBitRate([20,800])):"360p_11"===ve||"360P_11"===ve?(fe.setVideoResolution("360p_11"),fe.setVideoFrameRate([24,24]),fe.setVideoBitRate([20,1000])):"480p"===ve||"480P"===ve||"480p_1"===ve||"480P_1"===ve?(fe.setVideoResolution("480p_1"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([20,500])):"480p_2"===ve||"480P_2"===ve?(fe.setVideoResolution("480p_2"),fe.setVideoFrameRate([30,30]),fe.setVideoBitRate([20,1000])):"480p_3"===ve||"480P_3"===ve?(fe.setVideoResolution("480p_3"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([20,400])):"480p_4"===ve||"480P_4"===ve?(fe.setVideoResolution("480p_4"),fe.setVideoFrameRate([30,30]),fe.setVideoBitRate([20,750])):"480p_6"===ve||"480P_6"===ve?(fe.setVideoResolution("480p_6"),fe.setVideoFrameRate([30,30]),fe.setVideoBitRate([20,600])):"480p_8"===ve||"480P_8"===ve?(fe.setVideoResolution("480p_8"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([20,610])):"480p_9"===ve||"480P_9"===ve?(fe.setVideoResolution("480p_9"),fe.setVideoFrameRate([30,30]),fe.setVideoBitRate([20,930])):"480p_10"===ve||"480P_10"===ve?(fe.setVideoResolution("480p_10"),fe.setVideoFrameRate([10,10]),fe.setVideoBitRate([20,400])):"720p"===ve||"720P"===ve||"720p_1"===ve||"720P_1"===ve?(fe.setVideoResolution("720p_1"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([30,1130])):"720p_2"===ve||"720P_2"===ve?(fe.setVideoResolution("720p_2"),fe.setVideoFrameRate([30,30]),fe.setVideoBitRate([30,2000])):"720p_3"===ve||"720P_3"===ve?(fe.setVideoResolution("720p_3"),fe.setVideoFrameRate([30,30]),fe.setVideoBitRate([30,1710])):"720p_5"===ve||"720P_5"===ve?(fe.setVideoResolution("720p_5"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([30,910])):"720p_6"===ve||"720P_6"===ve?(fe.setVideoResolution("720p_6"),fe.setVideoFrameRate([30,30]),fe.setVideoBitRate([30,1380])):"1080p"===ve||"1080P"===ve||"1080p_1"===ve||"1080P_1"===ve?(fe.setVideoResolution("1080p_1"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([50,2080])):"1080p_2"===ve||"1080P_2"===ve?(fe.setVideoResolution("1080p_2"),fe.setVideoFrameRate([30,30]),fe.setVideoBitRate([50,3000])):"1080p_3"===ve||"1080P_3"===ve?(fe.setVideoResolution("1080p_3"),fe.setVideoFrameRate([30,30]),fe.setVideoBitRate([50,3150])):"1080p_5"===ve||"1080P_5"===ve?(fe.setVideoResolution("1080p_5"),fe.setVideoFrameRate([60,60]),fe.setVideoBitRate([50,4780])):"1440p"===ve||"1440P"===ve||"1440p_1"===ve||"1440P_1"===ve?(fe.setVideoResolution("1440p_1"),fe.setVideoFrameRate([30,30]),fe.setVideoBitRate([50,4850])):"1440p_2"===ve||"1440P_2"===ve?(fe.setVideoResolution("1440p_2"),fe.setVideoFrameRate([60,60]),fe.setVideoBitRate([50,7350])):"4k"===ve||"4K"===ve||"4k_1"===ve||"4K_1"===ve?(fe.setVideoResolution("4k_1"),fe.setVideoFrameRate([30,30]),fe.setVideoBitRate([50,8910])):"4k_3"===ve||"4K_3"===ve?(fe.setVideoResolution("4k_3"),fe.setVideoFrameRate([60,60]),fe.setVideoBitRate([50,13500])):(fe.setVideoResolution("480p_1"),fe.setVideoFrameRate([15,15]),fe.setVideoBitRate([20,500])),!0)},fe.getId=function(){return fe.streamId},fe.getAttributes=function(){return ue.screen?fe.screenAttributes:ue.attributes},fe.hasAudio=function(){return fe.audio},fe.hasVideo=function(){return fe.video},fe.hasScreen=function(){return fe.screen},fe.isVideoOn=function(){return(fe.hasVideo()||fe.hasScreen())&&fe.videoEnabled},fe.isAudioOn=function(){return fe.hasAudio()&&fe.audioEnabled},fe.init=function(ve,Se){var Ee=(new Date().getTime(),arguments[2]);if(void 0===Ee&&(Ee=2),!0===fe.initialized)return void("function"==typeof Se&&Se({type:"warning",msg:"STREAM_ALREADY_INITIALIZED"}));if(!0!==fe.local)return void("function"==typeof Se&&Se({type:"warning",msg:"STREAM_NOT_LOCAL"}));try{if((ue.audio||ue.video||ue.screen)&&void 0===ue.url){se.default.debug("Requested access to local media");var be=ue.video;if(ue.screen)var ye={video:be,audio:ue.audio,screen:!0,data:!0,extensionId:ue.extensionId,attributes:fe.screenAttributes,fake:ue.fake,mediaSource:ue.mediaSource};else{var ye={video:be,audio:ue.audio,fake:ue.fake};if(!me()){var Re=30,Ie=30;void 0!==ue.attributes.minFrameRate&&(Re=ue.attributes.minFrameRate),void 0!==ue.attributes.maxFrameRate&&(Ie=ue.attributes.maxFrameRate),ge()?!0===ye.video?(ye.video={width:{ideal:fe.videoSize[0]},height:{ideal:fe.videoSize[1]},frameRate:{ideal:Re,max:Ie}},fe.setVideoBitRate([500,500])):"object"===X(ye.video)&&(ye.video.frameRate={ideal:Re,max:Ie}):(!0===ye.audio&&(ye.audio=!ue.microphoneId||{deviceId:{exact:ue.microphoneId}}),!0===ye.video?(ye.video={width:{ideal:fe.videoSize[0]},height:{ideal:fe.videoSize[1]},frameRate:{ideal:Re,max:Ie}},fe.setVideoBitRate([500,500])):"object"===X(ye.video)&&(ye.video.frameRate={ideal:Re,max:Ie}))}}se.default.debug(ye);var Ce=Object.assign({},ye);if((0,te.GetUserMedia)(Ce,function(Te){se.default.debug("User has granted access to local media"),fe.dispatchEvent({type:"accessAllowed"}),fe.stream=Te,fe.initialized=!0,ve&&ve(),fe.hasVideo()&&(0,re.vsResHack)(Te,function(Oe,Ne){fe.videoWidth=Oe,fe.videoHeight=Ne},function(Oe){se.default.warning("vsResHack failed:"+Oe)}),ue.screen&&(0,ae.isChrome)()&&fe.stream&&fe.stream.getVideoTracks()[0]&&(fe.stream.getVideoTracks()[0].onended=function(){fe.dispatchEvent({type:"stopScreenSharing"})})},function(Te){var Oe={type:"error",msg:Te.name||Te};switch(Oe.msg){case"Starting video failed":case"TrackStartError":if(fe.videoSize=void 0,0<Ee)return void setTimeout(function(){fe.init(ve,Se,Ee-1)},1);Oe.msg="MEDIA_OPTION_INVALID";break;case"DevicesNotFoundError":Oe.msg="DEVICES_NOT_FOUND";break;case"NotSupportedError":Oe.msg="NOT_SUPPORTED";break;case"PermissionDeniedError":Oe.msg="PERMISSION_DENIED",fe.dispatchEvent({type:"accessDenied"});break;case"PERMISSION_DENIED":fe.dispatchEvent({type:"accessDenied"});break;case"InvalidStateError":Oe.msg="PERMISSION_DENIED",fe.dispatchEvent({type:"accessDenied"});break;case"NotAllowedError":fe.dispatchEvent({type:"accessDenied"});break;case"ConstraintNotSatisfiedError":Oe.msg="CONSTRAINT_NOT_SATISFIED";break;default:Oe.msg||(Oe.msg="UNDEFINED");}se.default.error("Media access:",Oe.msg),"function"==typeof Se&&Se(Oe)}),ue.screen&&ue.audio){var Ae={video:!1,audio:ye.audio};se.default.debug(Ae),(0,te.GetUserMedia)(Ae,function(Te){se.default.info("User has granted access to auxiliary local media."),fe.dispatchEvent({type:"accessAllowed"}),fe.aux_stream=Te},function(Te){var Oe={type:"error",msg:Te.name||Te};switch(Oe.msg){case"Starting video failed":case"TrackStartError":if(fe.videoSize=void 0,0<Ee)return void setTimeout(function(){fe.init(ve,Se,Ee-1)},1);Oe.msg="MEDIA_OPTION_INVALID";break;case"DevicesNotFoundError":Oe.msg="DEVICES_NOT_FOUND";break;case"NotSupportedError":Oe.msg="NOT_SUPPORTED";break;case"PermissionDeniedError":case"InvalidStateError":Oe.msg="PERMISSION_DENIED",fe.dispatchEvent({type:"accessDenied"});break;case"PERMISSION_DENIED":case"NotAllowedError":fe.dispatchEvent({type:"accessDenied"});break;case"ConstraintNotSatisfiedError":Oe.msg="CONSTRAINT_NOT_SATISFIED";break;default:Oe.msg||(Oe.msg="UNDEFINED");}se.default.error("Media access:",Oe.msg),"function"==typeof Se&&Se(Oe)})}}else"function"==typeof Se&&Se({type:"warning",msg:"STREAM_HAS_NO_MEDIA_ATTRIBUTES"})}catch(Te){se.default.error("Stream init:",Te),"function"==typeof Se&&Se({type:"error",msg:Te.message||Te})}},fe.close=function(){if(se.default.debug("Close stream with id",fe.streamId),void 0!==fe.stream){var ve=fe.stream.getTracks();for(var Se in ve)ve.hasOwnProperty(Se)&&ve[Se].stop();fe.stream=void 0}fe.initialized=!1,fe.unmuteAudio=void 0,fe.muteAudio=void 0,fe.unmuteVideo=void 0,fe.muteVideo=void 0,fe.lowStream&&fe.lowStream.close()},fe.enableAudio=function(){return se.default.debug("Enable audio stream with id",fe.streamId),fe.hasAudio()&&fe.initialized&&void 0!==fe.stream&&!0!==fe.stream.getAudioTracks()[0].enabled&&(void 0!==fe.unmuteAudio&&fe.unmuteAudio(),fe.audioEnabled=!0,fe.stream.getAudioTracks()[0].enabled=!0,!0)},fe.disableAudio=function(){return se.default.debug("Disable audio stream with id",fe.streamId),!!(fe.hasAudio()&&fe.initialized&&void 0!==fe.stream&&fe.stream.getAudioTracks()[0].enabled)&&(void 0!==fe.muteAudio&&fe.muteAudio(),fe.audioEnabled=!1,fe.stream.getAudioTracks()[0].enabled=!1,fe.sid&&de.report.audioSendingStopped(fe.sid,{succ:!0,reason:"muteAudio"}),!0)},fe.enableVideo=function(){return se.default.debug("Enable video stream with id",fe.streamId),fe.initialized&&void 0!==fe.stream&&fe.stream.getVideoTracks().length&&!0!==fe.stream.getVideoTracks()[0].enabled&&(void 0!==fe.unmuteVideo&&fe.unmuteVideo(),fe.videoEnabled=!0,fe.stream.getVideoTracks()[0].enabled=!0,fe.lowStream&&fe.lowStream.enableVideo(),!0)},fe.disableVideo=function(){return se.default.debug("Disable video stream with id",fe.streamId),!!(fe.initialized&&void 0!==fe.stream&&fe.stream.getVideoTracks().length&&fe.stream.getVideoTracks()[0].enabled)&&(void 0!==fe.muteVideo&&fe.muteVideo(),fe.videoEnabled=!1,fe.stream.getVideoTracks()[0].enabled=!1,fe.lowStream&&fe.lowStream.disableVideo(),fe.sid&&de.report.videoSendingStopped(fe.sid,{succ:!0,reason:"muteVideo"}),!0)},fe.play=function(ve,Se){fe.showing=!1,!fe.local||fe.video||fe.screen?void 0!==ve&&(fe.player=new ee.default({id:fe.getId(),stream:fe,elementID:ve,options:void 0,url:Se}),fe.showing=!0):fe.hasAudio()&&(fe.player=new ee.default({id:fe.getId(),stream:fe,elementID:ve,options:void 0,url:Se}),fe.showing=!0)},fe.stop=function(){se.default.debug("Stop stream player with id",fe.streamId),void 0!==fe.player&&fe.player.destroy()},fe.getStats=function(ve){fe.pc&&fe.pc.getStats?fe.pc.getStats(function(Se){if(fe.pc.isSubscriber){var Ee=(0,oe.subscribeStatsFilter)(Se);(0,ae.isFireFox)()&&(Ee.videoReceivedResolutionHeight=fe.videoHeight+"",Ee.videoReceivedResolutionWidth=fe.videoWidth+""),ve&&ve((0,oe.subscribeStatsFilter)(Se))}else{var Ee=(0,oe.publishStatsFilter)(Se);((0,ae.isSafari)()||(0,ae.isFireFox)())&&(Ee.videoSendResolutionHeight=fe.videoHeight+"",Ee.videoSendResolutionWidth=fe.videoWidth+""),((0,ae.isSafari)()||(0,ae.isFireFox)())&&fe.uplinkStats&&(Ee.videoSendBandwidth=fe.uplinkStats.uplink_available_bandwidth+"",Ee.videoSendPacketsLost=fe.uplinkStats.uplink_cumulative_lost+""),ve&&ve(Ee)}}):se.default.warning("use getStats after peerConnection established")},fe.getAudioLevel=function(){return fe.audioLevelHelper?fe.audioLevelHelper.getAudioLevel():fe.stream?0===fe.stream.getAudioTracks().length?void se.default.warning("can't get audioLevel beacuse no audio trace in stream"):(fe.audioLevelHelper=new re.audioLevelHelper(fe.stream),fe.audioLevelHelper.getAudioLevel()):(se.default.warning("can't get audioLevel beacuse no stream exist"),0)},fe};q.Stream=ce,q.createStream=function(ue){return se.default.debug("Create stream"),ce(ue)},q.getDevices=function(ue,me){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices||(se.default.warning("enumerateDevices() not supported."),me&&me("enumerateDevices() not supported")),navigator.mediaDevices.enumerateDevices().then(function(ge){return ue(ge)}).catch(function(ge){return me&&me(ge.name+": "+ge.message)})}},function(z,q,J){"use strict";function Y(_e){return _e&&_e.__esModule?_e:{default:_e}}Object.defineProperty(q,"__esModule",{value:!0}),q.GetUserMedia=q.Connection=void 0;var X=J(22),Z=Y(X),ee=J(23),te=Y(ee),ie=J(24),ne=Y(ie),se=J(25),ae=Y(se),oe=J(26),re=Y(oe),de=J(0),ce=Y(de),le=J(6),pe=103,me=function(_e,fe,he){var ve={};return ve.callback=fe,ve.config=_e,ve.error=he,ve.selectSource=function(Se,Ee,be){var ye=document.createElement("div");ye.setAttribute("style","position: absolute; z-index: 99999999; width: 65%; height: 70%; top:50%; left:50%; -webkit-transform:translate(-50%,-50%); transform:translate(-50%,-50%); border: #333333 1px solid; background: #ffffff; overflow: scroll;display: flex; justify-content: space-around; flex-wrap: wrap;padding: 50px 20px 5px 20px;box-shadow: 10px #333333;"),document.body.appendChild(ye),Se.map(function(Ie){if(Ie.id){var Ce=document.createElement("div");Ce.setAttribute("style","width: 30%;text-align: center;");var Ae=document.createElement("div");Ae.innerHTML=Ie.name,Ae.setAttribute("style","display: inline-block;width: 70%;word-break: keep-all;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;");var Te=document.createElement("div");Te.setAttribute("style","width: 100%;height: 70%");var Oe=document.createElement("img");Oe.setAttribute("style","height: 100%;"),Oe.src=Ie.thumbnail.toDataURL(),Ce.onclick=function(){document.body.removeChild(ye),Ee&&Ee(Ie.id)},Te.appendChild(Oe),Ce.appendChild(Te),Ce.appendChild(Ae),ye.appendChild(Ce)}});var Re=document.createElement("button");Re.innerHTML="Back",Re.setAttribute("style"," width: 100%; padding:10px 0; background-color: #fff; font-size: 20px; color: #333;border: none;"),Re.onclick=function(){document.body.removeChild(ye),be&&be("NotAllowedError")},ye.appendChild(Re)},ve.share=function(Se){Se.desktopCapturer.getSources({types:["window","screen"]},function(Ee,be){if(Ee)throw Ee;ve.selectSource(be,function(ye){var Re=ve.config.attributes.width,Ie=ve.config.attributes.height,Ce=ve.config.attributes.maxFr,Ae=ve.config.attributes.minFr;navigator.webkitGetUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:ye,maxHeight:Ie,maxWidth:Re,maxFrameRate:Ce,minFrameRate:Ae}}},ve.callback,ve.error)},ve.error)})},ve};q.Connection=function(_e){var fe={};if(!(_e.session_id=pe+=1,"undefined"!=typeof window&&window.navigator))ce.default.error("Publish/subscribe video/audio streams not supported yet"),fe=(0,ae.default)(_e);else if(null!==window.navigator.userAgent.match("Firefox"))fe.browser="mozilla",fe=(0,re.default)(_e);else if(-1<window.navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome"))ce.default.debug("Safari"),fe=(0,ne.default)(_e),fe.browser="safari";else if(window.navigator.userAgent.indexOf("MSIE "))fe=(0,te.default)(_e),fe.browser="ie";else if(26<=window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1])fe=(0,te.default)(_e),fe.browser="chrome-stable";else{if(!(40<=window.navigator.userAgent.toLowerCase().indexOf("chrome")))throw fe.browser="none","WebRTC stack not available";fe=(0,Z.default)(_e),fe.browser="chrome-canary"}return fe},q.GetUserMedia=function(_e,fe,he){if(navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,_e.screen){var ve=null;try{ve=window.require("electron")}catch(ye){}if(ve)return void(ve.desktopCapturer?me(_e,fe,he).share(ve):he(le.ErrorCodes.ELECTRON_NOT_SUPPORT_SHARING_SCREEN));if(ce.default.debug("Screen access requested"),null!==window.navigator.userAgent.match("Firefox")){if(!~["screen","window","application"].indexOf(_e.mediaSource))return he&&he("Invalid mediaSource, mediaSource should be one of [screen, window, application]");var Se={};void 0==_e.video.mandatory?Se={video:{mediaSource:_e.mediaSource}}:(Se.video=_e.video,Se.video.mediaSource=_e.mediaSource),navigator.getMedia(Se,fe,he)}else if(null!==window.navigator.userAgent.match("Chrome")){if(34>window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1])return void he({code:"This browser does not support screen sharing"});var Ee="okeephmleflklcdebijnponpabbmmgeo";_e.extensionId&&(ce.default.debug("extensionId supplied, using "+_e.extensionId),Ee=_e.extensionId),ce.default.debug("Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(Ee,{getStream:!0},function(ye){if(void 0===ye)return ce.default.debug("Access to screen denied"),void he({code:"Access to screen denied"});var Re=ye.streamId,Ie=_e.attributes.width,Ce=_e.attributes.height,Ae=_e.attributes.maxFr,Te=_e.attributes.minFr;Se={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:Re,maxHeight:Ce,maxWidth:Ie,maxFrameRate:Ae,minFrameRate:Te}}},navigator.getMedia(Se,fe,he)})}catch(ye){ce.default.debug("AgoraRTC screensharing plugin is not accessible");return void he({code:"no_plugin_present"})}}else ce.default.debug("This browser does not support screenSharing")}else-1<window.navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")?navigator.mediaDevices.getUserMedia(_e).then(fe).catch(he):"undefined"!=typeof navigator&&navigator.getMedia?navigator.getMedia(_e,fe,he):ce.default.error("Video/audio streams not supported yet")}},function(z,q,J){"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.shouldUseHttps=q.post=void 0;var Y=J(1),X=function(te){if(te&&te.__esModule)return te;var ie={};if(null!=te)for(var ne in te)Object.prototype.hasOwnProperty.call(te,ne)&&(ie[ne]=te[ne]);return ie.default=te,ie}(Y);q.post=function(te,ie,ne,se){var ae=new XMLHttpRequest;ae.timeout=ie.timeout||X.HTTP_CONNECT_TIMEOUT,ae.open("POST",te,!0),ae.setRequestHeader("Content-type","application/json; charset=utf-8"),ae.onload=function(){ne&&ne(ae.responseText)},ae.onerror=function(oe){se&&se(oe,te)},ae.ontimeout=function(oe){se&&se(oe,te)},ae.send(JSON.stringify(ie))},q.shouldUseHttps=function(){return"https:"==document.location.protocol}},function(z,q){"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.default=function(X){X&&X.apply(this,[].slice.call(arguments,1))}},function(z,q,J){"use strict";function Y(le){return le&&le.__esModule?le:{default:le}}Object.defineProperty(q,"__esModule",{value:!0}),q.getGatewayList=void 0;var X=J(1),Z=function(le){if(le&&le.__esModule)return le;var pe={};if(null!=le)for(var ue in le)Object.prototype.hasOwnProperty.call(le,ue)&&(pe[ue]=le[ue]);return pe.default=le,pe}(X),ee=J(0),te=Y(ee),ie=J(9),ne=J(5),se=J(2),ae=J(6),oe=Y(ae),re=function(le,pe,ue,me){var ge=new Date().getTime(),_e={key:pe.appId,cname:pe.cname,uid:pe.uid};(0,ie.post)(le,_e,function(fe){var he=JSON.parse(fe),ve=he.error;void 0==ve?ue(he,le):(ne.report.joinChooseServer(pe.sid,{lts:ge,succ:!1,csAddr:le,serverList:null,ec:ve}),me("Get server node failed ["+ve+"]",le))},function(fe,he){"timeout"===fe.type?(ne.report.joinChooseServer(pe.sid,{lts:ge,succ:!1,csAddr:he,serverList:null,ec:"timeout"}),me("Connect choose server timeout",he)):ne.report.joinChooseServer(pe.sid,{lts:ge,succ:!1,csAddr:he,serverList:null,ec:"server_wrong"})})},de=function(le,pe,ue){var me=new Date().getTime(),ge=!1;se.CSCrashRecord.record(me);for(var _e=function(be,ye){ge?ne.report.joinChooseServer(le.sid,{lts:me,succ:!0,csAddr:ye,serverList:be.gateway_addr,cid:be.cid+"",uid:be.uid+"",ec:null},!1):(clearTimeout(Ee),ge=!0,te.default.debug("Get gateway address:",be.gateway_addr),pe(be),ne.report.joinChooseServer(le.sid,{lts:me,succ:!0,csAddr:ye,serverList:be.gateway_addr,cid:be.cid+"",uid:be.uid+"",ec:null},!0))},fe=function(be,ye){te.default.error(be,ye)},he=Z.WEBCS_DOMAIN,ve=0;ve<he.length;++ve){var Se;Se=(0,ie.shouldUseHttps)()?"https://"+he[ve]+":5668/getwebgw/jsonp":"http://"+he[ve]+":5669/getwebgw/jsonp",re(Se,le,_e,fe)}var Ee=setTimeout(function(){if(!ge)for(var be=Z.WEBCS_DOMAIN_BACKUP_LIST,ye=0;ye<be.length;++ye){var Re;Re=(0,ie.shouldUseHttps)()?"https://"+be[ye]+":5668/getwebgw/jsonp":"http://"+be[ye]+":5669/getwebgw/jsonp",re(Re,le,_e,fe)}},1e3);setTimeout(function(){ge||ue()},Z.WEBCS_BACKUP_CONNECT_TIMEOUT)};q.getGatewayList=function(le,pe,ue){var me=!1,ge=null,_e=1;!function fe(){return se.CSCrashRecord.shouldBlock()?(te.default.warning("CS connetion crash too many times in 10s"),ue&&ue(oe.default.JOIN_TOO_FREQUENT)):void(me||de(le,function(he){me=!0,clearTimeout(ge),pe(he)},function(){te.default.debug("Request gateway list will be restart in "+_e+"s"),ge=setTimeout(function(){fe()},1e3*_e),_e=3600<=_e?3600:2*_e}))}()}},function(z,q){"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.AUDIO_SAMPLE_RATE_32000=32e3,q.AUDIO_SAMPLE_RATE_44100=44100,q.AUDIO_SAMPLE_RATE_48000=48e3,q.VIDEO_CODEC_PROFILE_BASELINE=66,q.VIDEO_CODEC_PROFILE_MAIN=77,q.VIDEO_CODEC_PROFILE_HIGH=100,q.REMOTE_VIDEO_STREAM_HIGH=0,q.REMOTE_VIDEO_STREAM_LOW=1,q.REMOTE_VIDEO_STREAM_MEDIUM=2},function(z,q){"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.getTimestamp=function(){var X=new Date;return X.toTimeString().split(" ")[0]+":"+X.getMilliseconds()}},function(z,q,J){var X=J(15),Z=J(17);z.exports=function(ee,te,ie){var ne=te&&ie||0;"string"==typeof ee&&(te="binary"==ee?Array(16):null,ee=null),ee=ee||{};var se=ee.random||(ee.rng||X)();if(se[6]=64|15&se[6],se[8]=128|63&se[8],te)for(var ae=0;16>ae;++ae)te[ne+ae]=se[ae];return te||Z(se)}},function(z,q,J){(function(Y){var Z=Y.crypto||Y.msCrypto,X;if(Z&&Z.getRandomValues){var ee=new Uint8Array(16);X=function(){return Z.getRandomValues(ee),ee}}if(!X){var te=Array(16);X=function(){for(var ne=0,ie;16>ne;ne++)0==(3&ne)&&(ie=4294967296*Math.random()),te[ne]=255&ie>>>((3&ne)<<3);return te}}z.exports=X}).call(q,J(16))},function(z){var J=function(){return this}();try{J=J||Function("return this")()||(0,eval)("this")}catch(Y){"object"==typeof window&&(J=window)}z.exports=J},function(z){for(var Y=[],X=0;256>X;++X)Y[X]=(X+256).toString(16).substr(1);z.exports=function(Z,ee){var te=ee||0,ie=Y;return ie[Z[te++]]+ie[Z[te++]]+ie[Z[te++]]+ie[Z[te++]]+"-"+ie[Z[te++]]+ie[Z[te++]]+"-"+ie[Z[te++]]+ie[Z[te++]]+"-"+ie[Z[te++]]+ie[Z[te++]]+"-"+ie[Z[te++]]+ie[Z[te++]]+ie[Z[te++]]+ie[Z[te++]]+ie[Z[te++]]+ie[Z[te++]]}},function(z,q,J){"use strict";function Y(oe){return oe&&oe.__esModule?oe:{default:oe}}Object.defineProperty(q,"__esModule",{value:!0});var X=J(19),Z=Y(X),ee=J(20),te=Y(ee),ie=J(0),ne=Y(ie),se=J(21);q.default=function(oe){var re=(0,Z.default)({});if(re.id=oe.id,re.url=oe.url,re.stream=oe.stream.stream,re.elementID=oe.elementID,re.destroy=function(){re.video.srcObject=null,re.audio.srcObject=null,re.video.pause(),delete re.resizer,document.getElementById(re.div.id)&&re.parentNode.removeChild(re.div)},re.resize=function(){var ce=re.container.offsetWidth,le=re.container.offsetHeight;oe.stream.screen?.75*ce<le?(re.video.style.width=ce+"px",re.video.style.height=.75*ce+"px",re.video.style.top=-(.75*ce/2-le/2)+"px",re.video.style.left="0px"):(re.video.style.height=le+"px",re.video.style.width=4/3*le+"px",re.video.style.left=-(4/3*le/2-ce/2)+"px",re.video.style.top="0px"):ce===re.containerWidth&&le===re.containerHeight||(.75*ce>le?(re.video.style.width=ce+"px",re.video.style.height=.75*ce+"px",re.video.style.top=-(.75*ce/2-le/2)+"px",re.video.style.left="0px"):(re.video.style.height=le+"px",re.video.style.width=4/3*le+"px",re.video.style.left=-(4/3*le/2-ce/2)+"px",re.video.style.top="0px")),re.containerWidth=ce,re.containerHeight=le},re.div=document.createElement("div"),re.div.setAttribute("id","player_"+re.id),oe.stream.video?re.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"):re.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),re.video=document.createElement("video"),re.video.setAttribute("id","video"+re.id),oe.stream.local&&!oe.stream.screen?oe.stream.mirror?re.video.setAttribute("style","width: 100%; height: 100%; position: absolute; transform: rotateY(180deg);"):re.video.setAttribute("style","width: 100%; height: 100%; position: absolute; "):oe.stream.video?(re.video.setAttribute("style","width: 100%; height: 100%; position: absolute;"),-1<window.navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")&&re.video.setAttribute("controls","")):oe.stream.screen?re.video.setAttribute("style","width: 100%; height: 100%; position: absolute;"):re.video.setAttribute("style","width: 100%; height: 100%; position: absolute; display: none;"),re.video.setAttribute("autoplay",""),re.video.setAttribute("muted",""),re.video.setAttribute("playsinline",""),oe.stream.local&&(re.video.volume=0,re.video.setAttribute("muted","")),re.audio=document.createElement("audio"),re.audio.setAttribute("id","audio"+re.id),re.audio.setAttribute("autoplay",""),oe.stream.local&&(re.audio.volume=0,re.audio.setAttribute("muted","")),void 0===re.elementID?(document.body.appendChild(re.div),re.container=document.body):(document.getElementById(re.elementID).appendChild(re.div),re.container=document.getElementById(re.elementID)),re.parentNode=re.div.parentNode,re.video.addEventListener("playing",function(){!function le(){return 4<re.video.videoWidth*re.video.videoHeight?void ne.default.debug("video dimensions:",re.video.videoWidth,re.video.videoHeight):void setTimeout(le,50)}()}),re.containerWidth=0,re.containerHeight=0,re.resizer=new te.default(re.container,re.resize),re.resize(),oe.stream.hasVideo()||oe.stream.hasScreen())re.div.appendChild(re.video),re.div.appendChild(re.audio),(0,se.attachMediaStream)(re.video,oe.stream.stream),(0,se.attachMediaStream)(re.audio,oe.stream.stream);else if(!oe.stream.local&&re.video.removeAttribute("muted"),re.div.appendChild(re.video),window.MediaStream){var de=new MediaStream(oe.stream.stream.getAudioTracks());re.video.srcObject=de}else re.video.srcObject=oe.stream.stream;return re}},function(z,q,J){"use strict";Object.defineProperty(q,"__esModule",{value:!0});var Y=J(4);q.default=function(Z){var ee=(0,Y.EventDispatcher)(Z);return ee.url=".",ee}},function(z,q,J){var Y,X;!function(Z,ee){Y=ee,void 0!==(X="function"==typeof Y?Y.call(q,J,q,z):Y)&&(z.exports=X)}(0,function(){function Z(ie,ne){var se=Object.prototype.toString.call(ie),ae="[object Array]"===se||"[object NodeList]"===se||"[object HTMLCollection]"===se||"[object Object]"===se||"undefined"!=typeof jQuery&&ie instanceof jQuery||"undefined"!=typeof Elements&&ie instanceof Elements,oe=0,re=ie.length;if(ae)for(;oe<re;oe++)ne(ie[oe]);else ne(ie)}if("undefined"==typeof window)return null;var ee=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(ie){return window.setTimeout(ie,20)},te=function(ie,ne){function se(){var re=[];this.add=function(le){re.push(le)};var de,ce;this.call=function(){for(de=0,ce=re.length;de<ce;de++)re[de].call()},this.remove=function(le){var pe=[];for(de=0,ce=re.length;de<ce;de++)re[de]!==le&&pe.push(re[de]);re=pe},this.length=function(){return re.length}}function ae(re,de){return re.currentStyle?re.currentStyle[de]:window.getComputedStyle?window.getComputedStyle(re,null).getPropertyValue(de):re.style[de]}function oe(re,de){if(!re.resizedAttached)re.resizedAttached=new se,re.resizedAttached.add(de);else if(re.resizedAttached)return void re.resizedAttached.add(de);re.resizeSensor=document.createElement("div"),re.resizeSensor.className="resize-sensor";var ce="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;",le="position: absolute; left: 0; top: 0; transition: 0s;";re.resizeSensor.style.cssText=ce,re.resizeSensor.innerHTML="<div class=\"resize-sensor-expand\" style=\""+ce+"\"><div style=\""+le+"\"></div></div><div class=\"resize-sensor-shrink\" style=\""+ce+"\"><div style=\""+le+" width: 200%; height: 200%\"></div></div>",re.appendChild(re.resizeSensor),"static"==ae(re,"position")&&(re.style.position="relative");var _e=re.resizeSensor.childNodes[0],fe=_e.childNodes[0],he=re.resizeSensor.childNodes[1],ve=re.offsetWidth,Se=re.offsetHeight,Ee=function(){fe.style.width="100000px",fe.style.height="100000px",_e.scrollLeft=1e5,_e.scrollTop=1e5,he.scrollLeft=1e5,he.scrollTop=1e5},pe,ue,me,ge;Ee();var be=function(){ue=0,pe&&(ve=me,Se=ge,re.resizedAttached&&re.resizedAttached.call())},ye=function(){me=re.offsetWidth,ge=re.offsetHeight,pe=me!=ve||ge!=Se,pe&&!ue&&(ue=ee(be)),Ee()},Re=function(Ie,Ce,Ae){Ie.attachEvent?Ie.attachEvent("on"+Ce,Ae):Ie.addEventListener(Ce,Ae)};Re(_e,"scroll",ye),Re(he,"scroll",ye)}Z(ie,function(re){oe(re,ne)}),this.detach=function(re){te.detach(ie,re)}};return te.detach=function(ie,ne){Z(ie,function(se){se.resizedAttached&&"function"==typeof ne&&(se.resizedAttached.remove(ne),se.resizedAttached.length())||se.resizeSensor&&(se.contains(se.resizeSensor)&&se.removeChild(se.resizeSensor),delete se.resizeSensor,delete se.resizedAttached)})},te})},function(z){"use strict";function Y(pe){return new Promise(function(ue,me){Z(pe,ue,me)})}var X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(pe){return typeof pe}:function(pe){return pe&&"function"==typeof Symbol&&pe.constructor===Symbol&&pe!==Symbol.prototype?"symbol":typeof pe},Z=null,ee=null,te=null,ie=null,ne=null,se=null,ae={log:function(){},extractVersion:function(pe,ue,me){var ge=pe.match(ue);return ge&&ge.length>=me&&parseInt(ge[me])}};if(!("object"===("undefined"==typeof window?"undefined":X(window))&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return"mozSrcObject"in this?this.mozSrcObject:this._srcObject},set:function(pe){"mozSrcObject"in this?this.mozSrcObject=pe:(this._srcObject=pe,this.src=URL.createObjectURL(pe))}}),Z=window.navigator&&window.navigator.getUserMedia),ee=function(pe,ue){pe.srcObject=ue},te=function(pe,ue){pe.srcObject=ue.srcObject},"undefined"!=typeof window&&window.navigator))ae.log("This does not appear to be a browser"),ie="not a browser";else if(navigator.mozGetUserMedia&&window.mozRTCPeerConnection){if(ae.log("This appears to be Firefox"),ie="firefox",ne=ae.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),se=31,window.RTCPeerConnection=function(pe,ue){if(38>ne&&pe&&pe.iceServers){for(var me=[],ge=0,_e;ge<pe.iceServers.length;ge++)if(_e=pe.iceServers[ge],_e.hasOwnProperty("urls"))for(var fe=0,he;fe<_e.urls.length;fe++)he={url:_e.urls[fe]},0===_e.urls[fe].indexOf("turn")&&(he.username=_e.username,he.credential=_e.credential),me.push(he);else me.push(pe.iceServers[ge]);pe.iceServers=me}return new mozRTCPeerConnection(pe,ue)},window.RTCSessionDescription||(window.RTCSessionDescription=mozRTCSessionDescription),window.RTCIceCandidate||(window.RTCIceCandidate=mozRTCIceCandidate),Z=function(pe,ue,me){var ge=function(_e){if("object"!==(void 0===_e?"undefined":X(_e))||_e.require)return _e;var fe=[];return Object.keys(_e).forEach(function(he){if("require"!==he&&"advanced"!==he&&"mediaSource"!==he){var ve=_e[he]="object"===X(_e[he])?_e[he]:{ideal:_e[he]};if(void 0===ve.min&&void 0===ve.max&&void 0===ve.exact||fe.push(he),void 0!==ve.exact&&("number"==typeof ve.exact?ve.min=ve.max=ve.exact:_e[he]=ve.exact,delete ve.exact),void 0!==ve.ideal){_e.advanced=_e.advanced||[];var Se={};Se[he]="number"==typeof ve.ideal?{min:ve.ideal,max:ve.ideal}:ve.ideal,_e.advanced.push(Se),delete ve.ideal,Object.keys(ve).length||delete _e[he]}}}),fe.length&&(_e.require=fe),_e};return 38>ne&&(ae.log("spec: "+JSON.stringify(pe)),pe.audio&&(pe.audio=ge(pe.audio)),pe.video&&(pe.video=ge(pe.video)),ae.log("ff37: "+JSON.stringify(pe))),navigator.mozGetUserMedia(pe,ue,me)},navigator.getUserMedia=Z,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:Y,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(pe){pe([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},41>ne){var oe=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return oe().then(void 0,function(pe){if("NotFoundError"===pe.name)return[];throw pe})}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){ae.log("This appears to be Chrome"),ie="chrome",ne=ae.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),se=38,window.RTCPeerConnection=function(pe,ue){pe&&pe.iceTransportPolicy&&(pe.iceTransports=pe.iceTransportPolicy);var me=new webkitRTCPeerConnection(pe,ue),ge=me.getStats.bind(me);return me.getStats=function(_e,fe){var ve=this,Se=arguments;if(0<arguments.length&&"function"==typeof _e)return ge(_e,fe);var Ee=function(ye){var Re={};return ye.result().forEach(function(Ie){var Ce={id:Ie.id,timestamp:Ie.timestamp,type:Ie.type};Ie.names().forEach(function(Ae){Ce[Ae]=Ie.stat(Ae)}),Re[Ce.id]=Ce}),Re};if(2<=arguments.length){var be=function(ye){Se[1](Ee(ye))};return ge.apply(this,[be,arguments[0]])}return new Promise(function(ye,Re){1===Se.length&&null===_e?ge.apply(ve,[function(Ie){ye.apply(null,[Ee(Ie)])},Re]):ge.apply(ve,[ye,Re])})},me},["createOffer","createAnswer"].forEach(function(pe){var ue=webkitRTCPeerConnection.prototype[pe];webkitRTCPeerConnection.prototype[pe]=function(){var me=this;if(1>arguments.length||1===arguments.length&&"object"===X(arguments[0])){var ge=1===arguments.length?arguments[0]:void 0;return new Promise(function(_e,fe){ue.apply(me,[_e,fe,ge])})}return ue.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(pe){var ue=webkitRTCPeerConnection.prototype[pe];webkitRTCPeerConnection.prototype[pe]=function(){var me=arguments,ge=this;return new Promise(function(_e,fe){ue.apply(ge,[me[0],function(){_e(),2<=me.length&&me[1].apply(null,[])},function(he){fe(he),3<=me.length&&me[2].apply(null,[he])}])})}});var re=function(pe){if("object"!==(void 0===pe?"undefined":X(pe))||pe.mandatory||pe.optional)return pe;var ue={};return Object.keys(pe).forEach(function(me){if("require"!==me&&"advanced"!==me&&"mediaSource"!==me){var ge="object"===X(pe[me])?pe[me]:{ideal:pe[me]};void 0!==ge.exact&&"number"==typeof ge.exact&&(ge.min=ge.max=ge.exact);var _e=function(he,ve){return he?he+ve.charAt(0).toUpperCase()+ve.slice(1):"deviceId"===ve?"sourceId":ve};if(void 0!==ge.ideal){ue.optional=ue.optional||[];var fe={};"number"==typeof ge.ideal?(fe[_e("min",me)]=ge.ideal,ue.optional.push(fe),fe={},fe[_e("max",me)]=ge.ideal,ue.optional.push(fe)):(fe[_e("",me)]=ge.ideal,ue.optional.push(fe))}void 0!==ge.exact&&"number"!=typeof ge.exact?(ue.mandatory=ue.mandatory||{},ue.mandatory[_e("",me)]=ge.exact):["min","max"].forEach(function(he){void 0!==ge[he]&&(ue.mandatory=ue.mandatory||{},ue.mandatory[_e(he,me)]=ge[he])})}}),pe.advanced&&(ue.optional=(ue.optional||[]).concat(pe.advanced)),ue};if(Z=function(pe,ue,me){return pe.audio&&(pe.audio=re(pe.audio)),pe.video&&(pe.video=re(pe.video)),ae.log("chrome: "+JSON.stringify(pe)),navigator.webkitGetUserMedia(pe,ue,me)},navigator.getUserMedia=Z,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:Y,enumerateDevices:function(){return new Promise(function(pe){var ue={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(me){pe(me.map(function(ge){return{label:ge.label,kind:ue[ge.kind],deviceId:ge.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var de=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(pe){return ae.log("spec:   "+JSON.stringify(pe)),pe.audio=re(pe.audio),pe.video=re(pe.video),ae.log("chrome: "+JSON.stringify(pe)),de(pe)}}else navigator.mediaDevices.getUserMedia=function(pe){return Y(pe)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){ae.log("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){ae.log("Dummy mediaDevices.removeEventListener called.")}),ee=function(pe,ue){43<=ne?pe.srcObject=ue:void 0===pe.src?ae.log("Error attaching stream to element."):pe.src=URL.createObjectURL(ue)},te=function(pe,ue){43<=ne?pe.srcObject=ue.srcObject:pe.src=ue.src}}else navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(ae.log("This appears to be Edge"),ie="edge",ne=ae.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),se=12):ae.log("Browser does not appear to be WebRTC-capable");var ce={};try{Object.defineProperty(ce,"version",{set:function(pe){ne=pe}})}catch(pe){}var le;"undefined"!=typeof window&&(le=window.RTCPeerConnection),z.exports={RTCPeerConnection:le,getUserMedia:Z,attachMediaStream:ee,reattachMediaStream:te,webrtcDetectedBrowser:ie,webrtcDetectedVersion:ne,webrtcMinimumVersion:se,webrtcTesting:ce,webrtcUtils:ae}},function(z,q,J){"use strict";Object.defineProperty(q,"__esModule",{value:!0});var Y=J(0),X=function(ee){return ee&&ee.__esModule?ee:{default:ee}}(Y);q.default=function(ee){var te={},ie=webkitRTCPeerConnection;te.pc_config={iceServers:[]},te.con={optional:[{DtlsSrtpKeyAgreement:!0}]},ee.iceServers instanceof Array?te.pc_config.iceServers=ee.iceServers:(ee.stunServerUrl&&(ee.stunServerUrl instanceof Array?ee.stunServerUrl.map(function(se){"string"==typeof se&&""!==se&&te.pc_config.iceServers.push({url:se})}):"string"==typeof ee.stunServerUrl&&""!==ee.stunServerUrl&&te.pc_config.iceServers.push({url:ee.stunServerUrl})),ee.turnServer&&(ee.turnServer instanceof Array?ee.turnServer.map(function(se){"string"==typeof se.url&&""!==se.url&&te.pc_config.iceServers.push({username:se.username,credential:se.password,url:se.url})}):"string"==typeof ee.turnServer.url&&""!==ee.turnServer.url&&te.pc_config.iceServers.push({username:ee.turnServer.username,credential:ee.turnServer.password,url:ee.turnServer.url}))),void 0===ee.audio&&(ee.audio=!0),void 0===ee.video&&(ee.video=!0),te.mediaConstraints={mandatory:{OfferToReceiveVideo:ee.video,OfferToReceiveAudio:ee.audio}},te.roapSessionId=103,te.peerConnection=new ie(te.pc_config,te.con),te.peerConnection.onicecandidate=function(se){se.candidate?te.iceCandidateCount+=1:(X.default.debug("PeerConnection State: "+te.peerConnection.iceGatheringState),void 0===te.ices&&(te.ices=0),++te.ices,1<=te.ices&&te.moreIceComing&&(te.moreIceComing=!1,te.markActionNeeded()))};var ne=function(se){var ae,oe;return ee.minVideoBW&&ee.maxVideoBW&&(ae=se.match(/m=video.*\r\n/),oe=ae[0]+"b=AS:"+ee.maxVideoBW+"\r\n",se=se.replace(ae[0],oe),X.default.debug("Set Video Bitrate - min:"+ee.minVideoBW+" max:"+ee.maxVideoBW)),ee.maxAudioBW&&(ae=se.match(/m=audio.*\r\n/),oe=ae[0]+"b=AS:"+ee.maxAudioBW+"\r\n",se=se.replace(ae[0],oe)),se};return te.processSignalingMessage=function(se){var oe=JSON.parse(se),ae;te.incomingMessage=oe,"new"===te.state?"OFFER"===oe.messageType?(ae={sdp:oe.sdp,type:"offer"},te.peerConnection.setRemoteDescription(new RTCSessionDescription(ae)),te.state="offer-received",te.markActionNeeded()):te.error("Illegal message for this state: "+oe.messageType+" in state "+te.state):"offer-sent"===te.state?"ANSWER"===oe.messageType?(ae={sdp:oe.sdp,type:"answer"},ae.sdp=ne(ae.sdp),te.peerConnection.setRemoteDescription(new RTCSessionDescription(ae)),te.sendOK(),te.state="established"):"pr-answer"===oe.messageType?(ae={sdp:oe.sdp,type:"pr-answer"},te.peerConnection.setRemoteDescription(new RTCSessionDescription(ae))):"offer"===oe.messageType?te.error("Not written yet"):te.error("Illegal message for this state: "+oe.messageType+" in state "+te.state):"established"===te.state&&("OFFER"===oe.messageType?(ae={sdp:oe.sdp,type:"offer"},te.peerConnection.setRemoteDescription(new RTCSessionDescription(ae)),te.state="offer-received",te.markActionNeeded()):te.error("Illegal message for this state: "+oe.messageType+" in state "+te.state))},te.addStream=function(se){te.peerConnection.addStream(se),te.markActionNeeded()},te.removeStream=function(){te.markActionNeeded()},te.close=function(){te.state="closed",te.peerConnection.close()},te.markActionNeeded=function(){te.actionNeeded=!0,te.doLater(function(){te.onstablestate()})},te.doLater=function(se){window.setTimeout(se,1)},te.onstablestate=function(){var se;if(te.actionNeeded){if("new"===te.state||"established"===te.state)te.peerConnection.createOffer(function(ae){return(ae.sdp=ne(ae.sdp),X.default.debug("Changed",ae.sdp),ae.sdp!==te.prevOffer)?(te.peerConnection.setLocalDescription(ae),te.state="preparing-offer",void te.markActionNeeded()):void X.default.debug("Not sending a new offer")},function(ae){X.default.debug("peer connection create offer failed ",ae)},te.mediaConstraints);else if("preparing-offer"===te.state){if(te.moreIceComing)return;te.prevOffer=te.peerConnection.localDescription.sdp,te.sendMessage("OFFER",te.prevOffer),te.state="offer-sent"}else if("offer-received"===te.state)te.peerConnection.createAnswer(function(ae){if(te.peerConnection.setLocalDescription(ae),te.state="offer-received-preparing-answer",te.iceStarted)return void te.markActionNeeded();var oe=new Date;X.default.debug(oe.getTime()+": Starting ICE in responder"),te.iceStarted=!0},function(ae){X.default.debug("peer connection create answer failed ",ae)},te.mediaConstraints);else if("offer-received-preparing-answer"===te.state){if(te.moreIceComing)return;se=te.peerConnection.localDescription.sdp,te.sendMessage("ANSWER",se),te.state="established"}else te.error("Dazed and confused in state "+te.state+", stopping here");te.actionNeeded=!1}},te.sendOK=function(){te.sendMessage("OK")},te.sendMessage=function(se,ae){var oe={};oe.messageType=se,oe.sdp=ae,"OFFER"===se?(oe.offererSessionId=te.sessionId,oe.answererSessionId=te.otherSessionId,oe.seq=te.sequenceNumber+=1,oe.tiebreaker=_Mathfloor(429496723*Math.random()+1)):(oe.offererSessionId=te.incomingMessage.offererSessionId,oe.answererSessionId=te.sessionId,oe.seq=te.incomingMessage.seq),te.onsignalingmessage(JSON.stringify(oe))},te.error=function(se){throw"Error in RoapOnJsep: "+se},te.sessionId=te.roapSessionId+=1,te.sequenceNumber=0,te.actionNeeded=!1,te.iceStarted=!1,te.moreIceComing=!0,te.iceCandidateCount=0,te.onsignalingmessage=ee.callback,te.peerConnection.onopen=function(){te.onopen&&te.onopen()},te.peerConnection.onaddstream=function(se){te.onaddstream&&te.onaddstream(se)},te.peerConnection.onremovestream=function(se){te.onremovestream&&te.onremovestream(se)},te.peerConnection.oniceconnectionstatechange=function(se){te.oniceconnectionstatechange&&te.oniceconnectionstatechange(se.currentTarget.iceConnectionState)},te.onaddstream=null,te.onremovestream=null,te.state="new",te.markActionNeeded(),te}},function(z,q,J){"use strict";Object.defineProperty(q,"__esModule",{value:!0});var Y=J(0),X=function(ee){return ee&&ee.__esModule?ee:{default:ee}}(Y);q.default=function(ee){var te={},ie=RTCPeerConnection;te.isSubscriber=ee.isSubscriber,te.pc_config={iceServers:[]},te.con={optional:[{DtlsSrtpKeyAgreement:!0}]},ee.iceServers instanceof Array?te.pc_config.iceServers=ee.iceServers:(ee.stunServerUrl&&(ee.stunServerUrl instanceof Array?ee.stunServerUrl.map(function(ae){"string"==typeof ae&&""!==ae&&te.pc_config.iceServers.push({url:ae})}):"string"==typeof ee.stunServerUrl&&""!==ee.stunServerUrl&&te.pc_config.iceServers.push({url:ee.stunServerUrl})),ee.turnServer&&(ee.turnServer instanceof Array?ee.turnServer.map(function(ae){"string"==typeof ae.url&&""!==ae.url&&te.pc_config.iceServers.push({username:ae.username,credential:ae.password,url:ae.url})}):"string"==typeof ee.turnServer.url&&""!==ee.turnServer.url&&te.pc_config.iceServers.push({username:ee.turnServer.username,credential:ee.turnServer.password,url:ee.turnServer.url}))),void 0===ee.audio&&(ee.audio=!0),void 0===ee.video&&(ee.video=!0),te.mediaConstraints={mandatory:{OfferToReceiveVideo:ee.video,OfferToReceiveAudio:ee.audio}},te.roapSessionId=103,te.peerConnection=new ie({iceServers:[{urls:["stun:webcs.agora.io:3478"]}]},te.con),te.peerConnection.onicecandidate=function(){var oe,re,de;oe=te.peerConnection.localDescription.sdp,re=oe.match(/a=candidate:.+typ\ssrflx.+\r\n/),de=oe.match(/a=candidate:.+typ\shost.+\r\n/),0===te.iceCandidateCount&&(te.timeout=setTimeout(function(){te.moreIceComing&&(te.moreIceComing=!1,te.markActionNeeded())},1e3)),null===re&&null===de||void 0!==te.ice||(X.default.debug("srflx candidate : "+re+" host candidate : "+de),clearTimeout(te.timeout),te.ice=0,te.moreIceComing=!1,te.markActionNeeded()),++te.iceCandidateCount};var ne=function(ae){return ee.screen&&(ae=ae.replace("a=x-google-flag:conference\r\n","")),ae},se=function(ae){var oe,re;return ee.minVideoBW&&ee.maxVideoBW&&(oe=ae.match(/m=video.*\r\n/),re=oe[0]+"b=AS:"+ee.maxVideoBW+"\r\n",ae=ae.replace(oe[0],re),X.default.debug("Set Video Bitrate - min:"+ee.minVideoBW+" max:"+ee.maxVideoBW)),ee.maxAudioBW&&(oe=ae.match(/m=audio.*\r\n/),re=oe[0]+"b=AS:"+ee.maxAudioBW+"\r\n",ae=ae.replace(oe[0],re)),ae};return te.processSignalingMessage=function(ae){var re=JSON.parse(ae),oe;te.incomingMessage=re,"new"===te.state?"OFFER"===re.messageType?(oe={sdp:re.sdp,type:"offer"},te.peerConnection.setRemoteDescription(new RTCSessionDescription(oe)),te.state="offer-received",te.markActionNeeded()):te.error("Illegal message for this state: "+re.messageType+" in state "+te.state):"offer-sent"===te.state?"ANSWER"===re.messageType?(oe={sdp:re.sdp,type:"answer"},oe.sdp=ne(oe.sdp),oe.sdp=se(oe.sdp),te.peerConnection.setRemoteDescription(new RTCSessionDescription(oe)),te.sendOK(),te.state="established"):"pr-answer"===re.messageType?(oe={sdp:re.sdp,type:"pr-answer"},te.peerConnection.setRemoteDescription(new RTCSessionDescription(oe))):"offer"===re.messageType?te.error("Not written yet"):te.error("Illegal message for this state: "+re.messageType+" in state "+te.state):"established"===te.state&&("OFFER"===re.messageType?(oe={sdp:re.sdp,type:"offer"},te.peerConnection.setRemoteDescription(new RTCSessionDescription(oe)),te.state="offer-received",te.markActionNeeded()):te.error("Illegal message for this state: "+re.messageType+" in state "+te.state))},te.getStatsRate=function(ae){te.getStats(function(oe){ae(oe)})},te.getStats=function(ae){te.peerConnection.getStats(null,function(oe){var re=[],de=[],ce=null;Object.keys(oe).forEach(function(le){var pe=oe[le];de.push(pe),"ssrc"!==pe.type&&"VideoBwe"!==pe.type||(ce=pe.timestamp,re.push(pe))}),re.push({id:"time",startTime:te.connectedTime,timestamp:ce||new Date}),ae(re,de)})},te.addStream=function(ae){te.peerConnection.addStream(ae),te.markActionNeeded()},te.removeStream=function(){te.markActionNeeded()},te.close=function(){te.state="closed",te.peerConnection.close()},te.markActionNeeded=function(){te.actionNeeded=!0,te.doLater(function(){te.onstablestate()})},te.doLater=function(ae){window.setTimeout(ae,1)},te.onstablestate=function(){var ae;if(te.actionNeeded){if("new"===te.state||"established"===te.state)te.peerConnection.createOffer(function(oe){return(oe.sdp=se(oe.sdp),oe.sdp!==te.prevOffer)?(te.peerConnection.setLocalDescription(oe),te.state="preparing-offer",void te.markActionNeeded()):void X.default.debug("Not sending a new offer")},function(oe){X.default.debug("peer connection create offer failed ",oe)},te.mediaConstraints);else if("preparing-offer"===te.state){if(te.moreIceComing)return;te.prevOffer=te.peerConnection.localDescription.sdp,te.prevOffer=te.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),te.sendMessage("OFFER",te.prevOffer),te.state="offer-sent"}else if("offer-received"===te.state)te.peerConnection.createAnswer(function(oe){if(te.peerConnection.setLocalDescription(oe),te.state="offer-received-preparing-answer",te.iceStarted)return void te.markActionNeeded();var re=new Date;X.default.debug(re.getTime()+": Starting ICE in responder"),te.iceStarted=!0},function(oe){X.default.debug("peer connection create answer failed ",oe)},te.mediaConstraints);else if("offer-received-preparing-answer"===te.state){if(te.moreIceComing)return;ae=te.peerConnection.localDescription.sdp,te.sendMessage("ANSWER",ae),te.state="established"}else te.error("Dazed and confused in state "+te.state+", stopping here");te.actionNeeded=!1}},te.sendOK=function(){te.sendMessage("OK")},te.sendMessage=function(ae,oe){var re={};re.messageType=ae,re.sdp=oe,"OFFER"===ae?(re.offererSessionId=te.sessionId,re.answererSessionId=te.otherSessionId,re.seq=te.sequenceNumber+=1,re.tiebreaker=_Mathfloor(429496723*Math.random()+1)):(re.offererSessionId=te.incomingMessage.offererSessionId,re.answererSessionId=te.sessionId,re.seq=te.incomingMessage.seq),te.onsignalingmessage(JSON.stringify(re))},te.error=function(ae){throw"Error in RoapOnJsep: "+ae},te.sessionId=te.roapSessionId+=1,te.sequenceNumber=0,te.actionNeeded=!1,te.iceStarted=!1,te.moreIceComing=!0,te.iceCandidateCount=0,te.onsignalingmessage=ee.callback,te.peerConnection.ontrack=function(ae){te.onaddstream&&(te.onaddstream(ae,"ontrack"),te.peerConnection.onaddstream=null)},te.peerConnection.onaddstream=function(ae){te.onaddstream&&(te.onaddstream(ae,"onaddstream"),te.peerConnection.ontrack=null)},te.peerConnection.onremovestream=function(ae){te.onremovestream&&te.onremovestream(ae)},te.peerConnection.oniceconnectionstatechange=function(ae){"connected"===ae.currentTarget.iceConnectionState&&(te.connectedTime=new Date),te.oniceconnectionstatechange&&te.oniceconnectionstatechange(ae.currentTarget.iceConnectionState)},te.onaddstream=null,te.onremovestream=null,te.state="new",te.markActionNeeded(),te}},function(z,q,J){"use strict";Object.defineProperty(q,"__esModule",{value:!0});var Y=J(0),X=function(ee){return ee&&ee.__esModule?ee:{default:ee}}(Y);q.default=function(ee){var te={};RTCPeerConnection,te.isSubscriber=ee.isSubscriber,te.pc_config={iceServers:[{urls:["stun:72.251.224.27:3478"]}],bundlePolicy:"max-bundle"},te.con={optional:[{DtlsSrtpKeyAgreement:!0}]},ee.iceServers instanceof Array?te.pc_config.iceServers=ee.iceServers:(ee.stunServerUrl&&(ee.stunServerUrl instanceof Array?ee.stunServerUrl.map(function(ue){"string"==typeof ue&&""!==ue&&te.pc_config.iceServers.push({url:ue})}):"string"==typeof ee.stunServerUrl&&""!==ee.stunServerUrl&&te.pc_config.iceServers.push({url:ee.stunServerUrl})),ee.turnServer&&(ee.turnServer instanceof Array?ee.turnServer.map(function(ue){"string"==typeof ue.url&&""!==ue.url&&te.pc_config.iceServers.push({username:ue.username,credential:ue.password,url:ue.url})}):"string"==typeof ee.turnServer.url&&""!==ee.turnServer.url&&te.pc_config.iceServers.push({username:ee.turnServer.username,credential:ee.turnServer.password,url:ee.turnServer.url}))),void 0===ee.audio&&(ee.audio=!0),void 0===ee.video&&(ee.video=!0),te.mediaConstraints={mandatory:{OfferToReceiveVideo:ee.video,OfferToReceiveAudio:ee.audio}},te.roapSessionId=103,te.peerConnection=new RTCPeerConnection({iceServers:[{urls:["stun:webcs.agora.io:3478","stun:stun.l.google.com:19302"]}],bundlePolicy:"max-bundle"}),te.peerConnection.onicecandidate=function(ue){X.default.debug("PeerConnection: ",ee.session_id,ue),ue.candidate?(0===te.iceCandidateCount&&(te.timeout=setTimeout(function(){te.moreIceComing&&(te.moreIceComing=!1,te.markActionNeeded())},1e3)),++te.iceCandidateCount):(X.default.debug("PeerConnection State: "+te.peerConnection.iceGatheringState),clearTimeout(te.timeout),void 0===te.ices&&(te.ices=0),++te.ices,1<=te.ices&&te.moreIceComing&&(te.moreIceComing=!1,te.markActionNeeded()))};var ie=function(ue){return ee.screen&&(ue=ue.replace("a=x-google-flag:conference\r\n","")),ue},ne=function(ue){var me,ge;return ee.minVideoBW&&ee.maxVideoBW&&(me=ue.match(/m=video.*\r\n/),ge=me[0]+"b=AS:"+ee.maxVideoBW+"\r\n",ue=ue.replace(me[0],ge),X.default.debug("Set Video Bitrate - min:"+ee.minVideoBW+" max:"+ee.maxVideoBW)),ee.maxAudioBW&&(me=ue.match(/m=audio.*\r\n/),ge=me[0]+"b=AS:"+ee.maxAudioBW+"\r\n",ue=ue.replace(me[0],ge)),ue};te.processSignalingMessage=function(ue){var ge=JSON.parse(ue),me;te.incomingMessage=ge,"new"===te.state?"OFFER"===ge.messageType?(me={sdp:ge.sdp,type:"offer"},te.peerConnection.setRemoteDescription(new RTCSessionDescription(me)),te.state="offer-received",te.markActionNeeded()):te.error("Illegal message for this state: "+ge.messageType+" in state "+te.state):"offer-sent"===te.state?"ANSWER"===ge.messageType?(me={sdp:ge.sdp,type:"answer"},me.sdp=ie(me.sdp),me.sdp=ne(me.sdp),me.sdp=me.sdp.replace(/a=x-google-flag:conference\r\n/g,""),te.peerConnection.setRemoteDescription(new RTCSessionDescription(me)),te.sendOK(),te.state="established"):"pr-answer"===ge.messageType?(me={sdp:ge.sdp,type:"pr-answer"},te.peerConnection.setRemoteDescription(new RTCSessionDescription(me))):"offer"===ge.messageType?te.error("Not written yet"):te.error("Illegal message for this state: "+ge.messageType+" in state "+te.state):"established"===te.state&&("OFFER"===ge.messageType?(me={sdp:ge.sdp,type:"offer"},te.peerConnection.setRemoteDescription(new RTCSessionDescription(me)),te.state="offer-received",te.markActionNeeded()):te.error("Illegal message for this state: "+ge.messageType+" in state "+te.state))};var se={id:"",type:"",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},ae={id:"",type:"",mediaType:"",googCodecName:"h264"===ee.codec?"H264":"VP8",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0",googFramesEncoded:"0"},oe={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},re={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googFramesDecoded:"0",googFrameReceived:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0"},de={id:"bweforvideo",type:"VideoBwe",googAvailableSendBandwidth:"0",googAvailableReceiveBandwidth:"0",googActualEncBitrate:"0",googRetransmitBitrate:"0",googTargetEncBitrate:"0",googBucketDelay:"0",googTransmitBitrate:"0"},ce=0,le=0,pe=0;return te.getStatsRate=function(ue){te.getStats(function(me){me.forEach(function(ge){"outbound-rtp"===ge.type&&"video"===ge.mediaType&&ge.googFramesEncoded&&(ge.googFrameRateSent=((ge.googFramesEncoded-ce)/3).toString(),ce=ge.googFramesEncoded),"inbound-rtp"===ge.type&&-1!=ge.id.indexOf("55543")&&(ge.googFrameRateReceived&&(ge.googFrameRateReceived=((ge.googFrameReceived-pe)/3).toString(),pe=ge.googFrameReceived),ge.googFrameRateDecoded&&(ge.googFrameRateDecoded=((ge.googFramesDecoded-le)/3).toString(),le=ge.googFramesDecoded))}),ue(me)})},te.getStats=function(ue){var me=[];te.peerConnection.getStats().then(function(ge){ge.forEach(function(fe){me.push(fe),"outbound-rtp"===fe.type&&"audio"===fe.mediaType&&(se.id=fe.id,se.type=fe.type,se.mediaType=fe.mediaType,se.bytesSent=fe.bytesSent?fe.bytesSent+"":"0",se.packetsSent=fe.packetsSent?fe.packetsSent+"":"0"),"outbound-rtp"===fe.type&&"video"===fe.mediaType&&(ae.id=fe.id,ae.type=fe.type,ae.mediaType=fe.mediaType,ae.bytesSent=fe.bytesSent?fe.bytesSent+"":"0",ae.packetsSent=fe.packetsSent?fe.packetsSent+"":"0",ae.googPlisReceived=fe.pliCount?fe.pliCount+"":"0",ae.googNacksReceived=fe.nackCount?fe.nackCount+"":"0",ae.googFirsReceived=fe.firCount?fe.firCount+"":"0",ae.googFramesEncoded=fe.framesEncoded?fe.framesEncoded+"":"0"),"inbound-rtp"===fe.type&&-1!=fe.id.indexOf("44444")&&(oe.id=fe.id,oe.type=fe.type,oe.mediaType="audio",oe.packetsReceived=fe.packetsReceived?fe.packetsReceived+"":"0",oe.bytesReceived=fe.bytesReceived?fe.bytesReceived+"":"0",oe.packetsLost=fe.packetsLost?fe.packetsLost+"":"0",oe.packetsReceived=fe.packetsReceived?fe.packetsReceived+"":"0",oe.googJitterReceived=fe.jitter?fe.jitter+"":"0"),"inbound-rtp"===fe.type&&-1!=fe.id.indexOf("55543")&&(re.id=fe.id,re.type=fe.type,re.mediaType="video",re.packetsReceived=fe.packetsReceived?fe.packetsReceived+"":"0",re.bytesReceived=fe.bytesReceived?fe.bytesReceived+"":"0",re.packetsLost=fe.packetsLost?fe.packetsLost+"":"0",re.googJitterBufferMs=fe.jitter?fe.jitter+"":"0",re.googNacksSent=fe.nackCount?fe.nackCount+"":"0",re.googPlisSent=fe.pliCount?fe.pliCount+"":"0",re.googFirsSent=fe.firCount?fe.firCount+"":"0"),"track"===fe.type&&-1!=fe.id.indexOf("55543")&&(re.googFrameWidthReceived=fe.frameWidth?fe.frameWidth+"":"0",re.googFrameHeightReceived=fe.frameHeight?fe.frameHeight+"":"0",re.googFrameReceived=fe.framesReceived?fe.framesReceived+"":"0",re.googFramesDecoded=fe.framesDecoded?fe.framesDecoded+"":"0"),"track"===fe.type&&-1!=fe.id.indexOf("44444")&&(oe.audioOutputLevel=fe.audioLevel+"",se.audioInputLevel=fe.audioLevel+""),"candidate-pair"===fe.type&&(0==fe.availableIncomingBitrate?de.googAvailableSendBandwidth=fe.availableOutgoingBitrate+"":de.googAvailableReceiveBandwidth=fe.availableIncomingBitrate+"")});var _e=[de,se,ae,oe,re];_e.push({id:"time",startTime:te.connectedTime,timestamp:new Date}),ue(_e,me)}).catch(function(ge){console.error(ge)})},te.addStream=function(ue){-1<window.navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")?ue.getTracks().forEach(function(me){return te.peerConnection.addTrack(me,ue)}):te.peerConnection.addStream(ue),te.markActionNeeded()},te.removeStream=function(){te.markActionNeeded()},te.close=function(){te.state="closed",te.peerConnection.close()},te.markActionNeeded=function(){te.actionNeeded=!0,te.doLater(function(){te.onstablestate()})},te.doLater=function(ue){window.setTimeout(ue,1)},te.onstablestate=function(){var ue;if(te.actionNeeded){if("new"===te.state||"established"===te.state){if(ee.isSubscriber&&-1<window.navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")){var me=te.peerConnection.addTransceiver("audio"),ge=te.peerConnection.addTransceiver("video");me.setDirection("recvonly"),ge.setDirection("recvonly")}te.peerConnection.createOffer(te.mediaConstraints).then(function(_e){return(_e.sdp=ne(_e.sdp),ee.isSubscriber||(_e.sdp=_e.sdp.replace(/a=extmap:4 urn:3gpp:video-orientation\r\n/g,"")),_e.sdp!==te.prevOffer)?(te.peerConnection.setLocalDescription(_e),te.state="preparing-offer",void te.markActionNeeded()):void X.default.debug("Not sending a new offer")}).catch(function(_e){X.default.debug("peer connection create offer failed ",_e)})}else if("preparing-offer"===te.state){if(te.moreIceComing)return;te.prevOffer=te.peerConnection.localDescription.sdp,te.sendMessage("OFFER",te.prevOffer),te.state="offer-sent"}else if("offer-received"===te.state)te.peerConnection.createAnswer(function(_e){if(te.peerConnection.setLocalDescription(_e),te.state="offer-received-preparing-answer",te.iceStarted)return void te.markActionNeeded();var fe=new Date;X.default.debug(fe.getTime()+": Starting ICE in responder"),te.iceStarted=!0},function(_e){X.default.debug("peer connection create answer failed ",_e)},te.mediaConstraints);else if("offer-received-preparing-answer"===te.state){if(te.moreIceComing)return;ue=te.peerConnection.localDescription.sdp,te.sendMessage("ANSWER",ue),te.state="established"}else te.error("Dazed and confused in state "+te.state+", stopping here");te.actionNeeded=!1}},te.sendOK=function(){te.sendMessage("OK")},te.sendMessage=function(ue,me){var ge={};ge.messageType=ue,ge.sdp=me,"OFFER"===ue?(ge.offererSessionId=te.sessionId,ge.answererSessionId=te.otherSessionId,ge.seq=te.sequenceNumber+=1,ge.tiebreaker=_Mathfloor(429496723*Math.random()+1)):(ge.offererSessionId=te.incomingMessage.offererSessionId,ge.answererSessionId=te.sessionId,ge.seq=te.incomingMessage.seq),te.onsignalingmessage(JSON.stringify(ge))},te.error=function(ue){throw"Error in RoapOnJsep: "+ue},te.sessionId=te.roapSessionId+=1,te.sequenceNumber=0,te.actionNeeded=!1,te.iceStarted=!1,te.moreIceComing=!0,te.iceCandidateCount=0,te.onsignalingmessage=ee.callback,te.peerConnection.ontrack=function(ue){te.onaddstream&&te.onaddstream(ue,"ontrack")},te.peerConnection.onremovestream=function(ue){te.onremovestream&&te.onremovestream(ue)},te.peerConnection.oniceconnectionstatechange=function(ue){"connected"===ue.currentTarget.iceConnectionState&&(te.connectedTime=new Date),te.oniceconnectionstatechange&&te.oniceconnectionstatechange(ue.currentTarget.iceConnectionState)},te.onaddstream=null,te.onremovestream=null,te.state="new",te.markActionNeeded(),te}},function(z,q){"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.default=function(){var X={};return X.addStream=function(){},X}},function(z,q,J){"use strict";Object.defineProperty(q,"__esModule",{value:!0});var Y=J(0),X=function(ee){return ee&&ee.__esModule?ee:{default:ee}}(Y);q.default=function(ee){var te={},ie=(mozRTCPeerConnection,mozRTCSessionDescription),ne=!1;te.isSubscriber=ee.isSubscriber,te.pc_config={iceServers:[]},ee.iceServers instanceof Array?ee.iceServers.map(function(le){0===le.url.indexOf("stun:")&&te.pc_config.iceServers.push({url:le.url})}):ee.stunServerUrl&&(ee.stunServerUrl instanceof Array?ee.stunServerUrl.map(function(le){"string"==typeof le&&""!==le&&te.pc_config.iceServers.push({url:le})}):"string"==typeof ee.stunServerUrl&&""!==ee.stunServerUrl&&te.pc_config.iceServers.push({url:ee.stunServerUrl})),void 0===ee.audio&&(ee.audio=!0),void 0===ee.video&&(ee.video=!0),te.mediaConstraints={offerToReceiveAudio:ee.audio,offerToReceiveVideo:ee.video,mozDontOfferDataChannel:!0},te.roapSessionId=103,te.peerConnection=new RTCPeerConnection(te.pc_config),te.peerConnection.onicecandidate=function(le){le.candidate?te.iceCandidateCount+=1:(X.default.debug("PeerConnection State: "+te.peerConnection.iceGatheringState),void 0===te.ices&&(te.ices=0),++te.ices,1<=te.ices&&te.moreIceComing&&(te.moreIceComing=!1,te.markActionNeeded()))},te.checkMLineReverseInSDP=function(le){return~le.indexOf("m=audio")&&~le.indexOf("m=video")&&le.indexOf("m=audio")>le.indexOf("m=video")},te.reverseMLineInSDP=function(le){var pe=le.split("m=audio"),ue=pe[1].split("m=video"),me="m=video"+ue[1],ge="m=audio"+ue[0];return le=pe[0]+me+ge},te.processSignalingMessage=function(le){var ue=JSON.parse(le),pe;te.incomingMessage=ue,"new"===te.state?"OFFER"===ue.messageType?(ue.sdp=ce(ue.sdp),pe={sdp:ue.sdp,type:"offer"},te.peerConnection.setRemoteDescription(new ie(pe),function(){X.default.debug("setRemoteDescription succeeded")},function(me){X.default.info("setRemoteDescription failed: "+me.name)}),te.state="offer-received",te.markActionNeeded()):te.error("Illegal message for this state: "+ue.messageType+" in state "+te.state):"offer-sent"===te.state?"ANSWER"===ue.messageType?(ue.sdp=ce(ue.sdp),ue.sdp=ue.sdp.replace(/ generation 0/g,""),ue.sdp=ue.sdp.replace(/ udp /g," UDP "),ue.sdp=ue.sdp.replace(/a=group:BUNDLE audio video/,"a=group:BUNDLE sdparta_0 sdparta_1"),ue.sdp=ue.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),ue.sdp=ue.sdp.replace(/a=mid:video/,"a=mid:sdparta_1"),te.isMLineReverseInSDP&&(ue.sdp=te.reverseMLineInSDP(ue.sdp)),pe={sdp:ue.sdp,type:"answer"},te.peerConnection.setRemoteDescription(new ie(pe),function(){X.default.debug("setRemoteDescription succeeded")},function(me){X.default.info("setRemoteDescription failed: "+me)}),te.sendOK(),te.state="established"):"pr-answer"===ue.messageType?(pe={sdp:ue.sdp,type:"pr-answer"},te.peerConnection.setRemoteDescription(new ie(pe),function(){X.default.debug("setRemoteDescription succeeded")},function(me){X.default.info("setRemoteDescription failed: "+me.name)})):"offer"===ue.messageType?te.error("Not written yet"):te.error("Illegal message for this state: "+ue.messageType+" in state "+te.state):"established"===te.state&&("OFFER"===ue.messageType?(pe={sdp:ue.sdp,type:"offer"},te.peerConnection.setRemoteDescription(new ie(pe),function(){X.default.debug("setRemoteDescription succeeded")},function(me){X.default.info("setRemoteDescription failed: "+me.name)}),te.state="offer-received",te.markActionNeeded()):te.error("Illegal message for this state: "+ue.messageType+" in state "+te.state))};var se={id:"",type:"",mediaType:"opus",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},ae={id:"",type:"",mediaType:"",googCodecName:"h264"===ee.codec?"H264":"VP8",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0"},oe={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},re={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0",googFramesDecoded:"0"},de=0;te.getStatsRate=function(le){te.getStats(function(pe){pe.forEach(function(ue){"inboundrtp"===ue.type&&"video"===ue.mediaType&&ue.googFrameRateDecoded&&(ue.googFrameRateDecoded=((ue.googFramesDecoded-de)/3).toString(),de=ue.googFramesDecoded)}),le(pe)})},te.getStats=function(le){te.peerConnection.getStats().then(function(pe){var ue=[];Object.keys(pe).forEach(function(ge){var _e=pe[ge];ue.push(_e),"outboundrtp"===_e.type&&"video"===_e.mediaType&&(ae.id=_e.id,ae.type=_e.type,ae.mediaType=_e.mediaType,ae.bytesSent=_e.bytesSent?_e.bytesSent+"":"0",ae.packetsSent=_e.packetsSent?_e.packetsSent+"":"0",ae.googPlisReceived=_e.pliCount?_e.pliCount+"":"0",ae.googNacksReceived=_e.nackCount?_e.nackCount+"":"0",ae.googFirsReceived=_e.firCount?_e.firCount+"":"0",ae.googFrameRateSent=_e.framerateMean?_e.framerateMean+"":"0"),"outboundrtp"===_e.type&&"audio"===_e.mediaType&&(se.id=_e.id,se.type=_e.type,se.mediaType=_e.mediaType,se.bytesSent=_e.bytesSent?_e.bytesSent+"":"0",se.packetsSent=_e.packetsSent?_e.packetsSent+"":"0"),"inboundrtp"!==_e.type||"audio"!==_e.mediaType||_e.isRemote||(oe.id=_e.id,oe.type=_e.type,oe.mediaType=_e.mediaType,oe.bytesReceived=_e.bytesReceived?_e.bytesReceived+"":"0",oe.packetsLost=_e.packetsLost?_e.packetsLost+"":"0",oe.packetsReceived=_e.packetsReceived?_e.packetsReceived+"":"0",oe.googJitterReceived=_e.jitter?_e.jitter+"":"0"),"inboundrtp"!==_e.type||"video"!==_e.mediaType||_e.isRemote||(re.id=_e.id,re.type=_e.type,re.mediaType=_e.mediaType,re.bytesReceived=_e.bytesReceived?_e.bytesReceived+"":"0",re.googFrameRateReceived=_e.framerateMean?_e.framerateMean+"":"0",re.googFramesDecoded=_e.framesDecoded?_e.framesDecoded+"":"0",re.packetsLost=_e.packetsLost?_e.packetsLost+"":"0",re.packetsReceived=_e.packetsReceived?_e.packetsReceived+"":"0",re.googJitterBufferMs=_e.jitter?_e.jitter+"":"0",re.googNacksSent=_e.nackCount?_e.nackCount+"":"0",re.googPlisSent=_e.pliCount?_e.pliCount+"":"0",re.googFirsSent=_e.firCount?_e.firCount+"":"0"),-1!==_e.id.indexOf("outbound_rtcp_video")&&(ae.packetsLost=_e.packetsLost?_e.packetsLost+"":"0")});var me=[ae,se,oe,re];me.push({id:"time",startTime:te.connectedTime,timestamp:new Date}),le(me,ue)},function(pe){X.default.error(pe)})},te.addStream=function(le){ne=!0,te.peerConnection.addStream(le),te.markActionNeeded()},te.removeStream=function(){te.markActionNeeded()},te.close=function(){te.state="closed",te.peerConnection.close()},te.markActionNeeded=function(){te.actionNeeded=!0,te.doLater(function(){te.onstablestate()})},te.doLater=function(le){window.setTimeout(le,1)},te.onstablestate=function(){if(te.actionNeeded){if("new"===te.state||"established"===te.state)ne&&(te.mediaConstraints=void 0),function(){te.peerConnection.createOffer(function(pe){return(pe.sdp=ce(pe.sdp),pe.sdp=pe.sdp.replace(/a=extmap:1 http:\/\/www.webrtc.org\/experiments\/rtp-hdrext\/abs-send-time/,"a=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"),pe.sdp!==te.prevOffer)?(te.peerConnection.setLocalDescription(pe),te.isMLineReverseInSDP=te.checkMLineReverseInSDP(pe.sdp),te.state="preparing-offer",void te.markActionNeeded()):void X.default.debug("Not sending a new offer")},function(pe){X.default.debug("Ups! create offer failed ",pe)},te.mediaConstraints)}();else if("preparing-offer"===te.state){if(te.moreIceComing)return;te.prevOffer=te.peerConnection.localDescription.sdp,te.sendMessage("OFFER",te.prevOffer),te.state="offer-sent"}else if("offer-received"===te.state)te.peerConnection.createAnswer(function(pe){if(te.peerConnection.setLocalDescription(pe),te.state="offer-received-preparing-answer",te.iceStarted)return void te.markActionNeeded();var ue=new Date;X.default.debug(ue.getTime()+": Starting ICE in responder"),te.iceStarted=!0},function(){X.default.debug("Ups! Something went wrong")});else if("offer-received-preparing-answer"===te.state){if(te.moreIceComing)return;var le=te.peerConnection.localDescription.sdp;te.sendMessage("ANSWER",le),te.state="established"}else te.error("Dazed and confused in state "+te.state+", stopping here");te.actionNeeded=!1}},te.sendOK=function(){te.sendMessage("OK")},te.sendMessage=function(le,pe){var ue={};ue.messageType=le,ue.sdp=pe,"OFFER"===le?(ue.offererSessionId=te.sessionId,ue.answererSessionId=te.otherSessionId,ue.seq=te.sequenceNumber+=1,ue.tiebreaker=_Mathfloor(429496723*Math.random()+1)):(ue.offererSessionId=te.incomingMessage.offererSessionId,ue.answererSessionId=te.sessionId,ue.seq=te.incomingMessage.seq),te.onsignalingmessage(JSON.stringify(ue))},te.error=function(le){throw"Error in RoapOnJsep: "+le},te.sessionId=te.roapSessionId+=1,te.sequenceNumber=0,te.actionNeeded=!1,te.iceStarted=!1,te.moreIceComing=!0,te.iceCandidateCount=0,te.onsignalingmessage=ee.callback,te.peerConnection.ontrack=function(le){te.onaddstream&&te.onaddstream(le,"ontrack")},te.peerConnection.onremovestream=function(le){te.onremovestream&&te.onremovestream(le)},te.peerConnection.oniceconnectionstatechange=function(le){"connected"===le.currentTarget.iceConnectionState&&(te.connectedTime=new Date),te.oniceconnectionstatechange&&te.oniceconnectionstatechange(le.currentTarget.iceConnectionState)};var ce=function(le){if(ee.video&&ee.maxVideoBW){var pe=le.match(/m=video.*\r\n/);if(null==pe&&(pe=le.match(/m=video.*\n/)),pe&&0<pe.length){var ue=pe[0]+"b=TIAS:"+1e3*ee.maxVideoBW+"\r\n";le=le.replace(pe[0],ue)}}if(ee.audio&&ee.maxAudioBW){var pe=le.match(/m=audio.*\r\n/);if(null==pe&&(pe=le.match(/m=audio.*\n/)),pe&&0<pe.length){var ue=pe[0]+"b=TIAS:"+1e3*ee.maxAudioBW+"\r\n";le=le.replace(pe[0],ue)}}return le};return te.onaddstream=null,te.onremovestream=null,te.state="new",te.markActionNeeded(),te}},function(z,q){"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.publishStatsFilter=function(Z){var ee={audioSendBytes:"0",audioSendPackets:"0",videoSendBytes:"0",videoSendPackets:"0",videoSendPacketsLost:"0",videoSendFrameRate:"0",videoSendBandwidth:"0",videoSendResolutionWidth:"0",videoSendResolutionHeight:"0",audioCodecName:"",videoCodecName:"",timestamp:"",startTime:"",duration:"0"};return Z.forEach(function(te){"VideoBwe"===te.type?ee.videoSendBandwidth=te.googAvailableSendBandwidth:-1!==te.id.indexOf("send")||-1!==te.id.indexOf("outbound_rtp")||-1!==te.id.indexOf("OutboundRTP")?"audio"===te.mediaType?(ee.audioSendBytes=te.bytesSent,ee.audioSendPackets=te.packetsSent,ee.audioCodecName=te.googCodecName):(ee.videoSendBytes=te.bytesSent,ee.videoSendPackets=te.packetsSent,ee.videoSendPacketsLost=te.packetsLost,ee.videoSendFrameRate=te.googFrameRateSent,ee.videoSendResolutionWidth=te.googFrameWidthSent,ee.videoSendResolutionHeight=te.googFrameHeightSent,ee.videoCodecName=te.googCodecName):"time"===te.id&&(ee.timestamp=te.timestamp,ee.startTime=te.startTime)}),ee.timestamp instanceof Date&&ee.startTime instanceof Date&&(ee.duration=_Mathfloor((ee.timestamp.getTime()-ee.startTime.getTime())/1e3)+""),ee},q.subscribeStatsFilter=function(Z){var ee={audioReceiveBytes:"0",audioReceivePackets:"0",audioReceivePacketsLost:"0",videoReceiveBytes:"0",videoReceivePackets:"0",videoReceivePacketsLost:"0",videoReceiveFrameRate:"0",videoReceiveDecodeFrameRate:"0",videoReceiveBandwidth:"0",videoReceivedResolutionWidth:"0",videoReceivedResolutionHeight:"0",timestamp:"",startTime:"",duration:"0"};return Z.forEach(function(te){"VideoBwe"===te.type?ee.videoReceiveBandwidth=te.googAvailableReceiveBandwidth:-1!==te.id.indexOf("recv")||-1!==te.id.indexOf("inbound_rtp")||-1!==te.id.indexOf("InboundRTP")?"audio"===te.mediaType?(ee.audioReceiveBytes=te.bytesReceived,ee.audioReceivePackets=te.packetsReceived,ee.audioReceivePacketsLost=te.packetsLost):(ee.videoReceiveBytes=te.bytesReceived,ee.videoReceivePacketsLost=te.packetsLost,ee.videoReceivePackets=te.packetsReceived,ee.videoReceiveFrameRate=te.googFrameRateReceived,ee.videoReceiveDecodeFrameRate=te.googFrameRateDecoded,ee.videoReceivedResolutionWidth=te.googFrameWidthReceived,ee.videoReceivedResolutionHeight=te.googFrameHeightReceived):"time"===te.id&&(ee.timestamp=te.timestamp,ee.startTime=te.startTime)}),ee.timestamp instanceof Date&&ee.startTime instanceof Date&&(ee.duration=_Mathfloor((ee.timestamp.getTime()-ee.startTime.getTime())/1e3)+""),ee}},function(z,q,J){"use strict";function Y(Se){return Se&&Se.__esModule?Se:{default:Se}}Object.defineProperty(q,"__esModule",{value:!0}),q.LiveTranscoding=q.TranscodingUser=q.createLiveClient=q.createRtcClient=q.createClient=void 0;var X=J(29),Z=Y(X),ee=J(0),te=Y(ee),ie=J(6),ne=Y(ie),se=J(2),ae=J(11),oe=J(5),re=J(3),de=J(32),ce=J(7),le=J(12),pe=J(1),ue=function(Se){if(Se&&Se.__esModule)return Se;var Ee={};if(null!=Se)for(var be in Se)Object.prototype.hasOwnProperty.call(Se,be)&&(Ee[be]=Se[be]);return Ee.default=Se,Ee}(pe),me=function(Se){var Ee={};return Ee.key=void 0,Ee.highStream=null,Ee.lowStream=null,Ee.lowStreamParameter=null,Ee.isDualStream=!1,Ee.highStreamState=2,Ee.lowStreamState=2,Ee.setLowStreamParameter=function(be){Ee.lowStreamParameter=be},Ee._getVideoCameraIdByLabel=function(be,ye,Re){(0,ce.getDevices)(function(Ie){var Ce=!0,Ae=!1,Te;try{for(var Ne=Ie[Symbol.iterator](),Oe,we;!(Ce=(Oe=Ne.next()).done);Ce=!0)if(we=Oe.value,we.label===be&&"videoinput"===we.kind)return ye&&ye(we.deviceId)}catch(Le){Ae=!0,Te=Le}finally{try{!Ce&&Ne.return&&Ne.return()}finally{if(Ae)throw Te}}return Re&&Re(ne.default.NOT_FIND_DEVICE_BY_LABEL)},Re)},Ee.init=function(be,ye){if("string"!=typeof be)throw new Error("Param appId should be string");te.default.info("Initializing AgoraRTC client"),Se.appId=be,Se.sessionId=(0,se.generateSessionId)(),ye&&ye()},Ee.configPublisher=function(be){Ee.gatewayClient.configPublisher(be)},Ee.enableDualStream=function(be,ye){return"iOS"===(0,re.getBrowserOS)()?(oe.report.streamSwitch(Se.sessionId,{lts:new Date().getTime(),isdual:!0,succ:!1}),ye&&ye(ne.default.IOS_NOT_SUPPORT)):(0,re.isWeChatBrowser)()?(oe.report.streamSwitch(Se.sessionId,{lts:new Date().getTime(),isdual:!0,succ:!1}),ye&&ye(ne.default.WECHAT_NOT_SUPPORT)):(oe.report.streamSwitch(Se.sessionId,{lts:new Date().getTime(),isdual:!0,succ:!0}),Ee.isDualStream=!0,void(0===Ee.highStreamState?Ee._publishLowStream(be,function(Re){te.default.warning(Re),ye&&ye(ne.default.ENABLE_DUALSTREAM_FAILED)}):1===Ee.highStreamState?ye&&ye(ne.default.STILL_ON_PUBLISHING):be&&be()))},Ee.disableDualStream=function(be,ye){oe.report.streamSwitch(Se.sessionId,{lts:new Date().getTime(),isdual:!1,succ:!0}),Ee.isDualStream=!1,0===Ee.highStreamState?Ee._unpublishLowStream(be,function(Re){te.default.warning(Re),ye&&ye(ne.default.DISABLE_DUALSTREAM_FAILED)}):1===Ee.highStreamState?ye&&ye(ne.default.STILL_ON_PUBLISHING):be&&be()},Ee._createLowStream=function(be,ye){if(!Ee.highStream||!Ee.highStream.stream)return void(ye&&ye(ne.default.HIGH_STREAM_NOT_VIDEO_TRACE));var Re=Object.assign({},Ee.highStream.params);if(Re.streamID+=1,Re.audio=!1,!Re.video)return void(ye&&ye(ne.default.HIGH_STREAM_NOT_VIDEO_TRACE));var Ie=Ee.highStream.stream.getVideoTracks()[0];return Ie?void Ee._getVideoCameraIdByLabel(Ie.label,function(Ce){Re.cameraId=Ce;var Ae=new ce.Stream(Re);if(Ae.streamId=Ee.highStream.getId()+1,Ee.lowStreamParameter){var Te=Object.assign({},Ee.lowStreamParameter);if(!Te.width||!Te.height){var Oe=(0,de.simMap)(Ee.highStream.profile),Ne=ue.SUPPORT_RESOLUTION_LIST[Oe[0]];Te.width=Ne[0],Te.height=Ne[1]}if(Te.framerate=Te.framerate||5,Te.bitrate=Te.bitrate||50,(0,re.isSafari)()){var Ne=ue.SUPPORT_RESOLUTION_LIST[Ee.highStream.profile];Te.width=Ne[0],Te.height=Ne[1]}Ae.setVideoProfileCustomPlus(Te)}else Ae.setVideoProfileCustom((0,de.simMap)(Ee.highStream.profile));Ae.init(function(){Ee.highStream.lowStream=Ae,Ie.enabled||Ae.disableVideo(),be&&be(Ae)},ye)},ye):void(ye&&ye(ne.default.HIGH_STREAM_NOT_VIDEO_TRACE))},Ee._getLowStream=function(be,ye){Ee.lowStream?be(Ee.lowStream):Ee._createLowStream(function(Re){Ee.lowStream=Re,be(Ee.lowStream)},ye)},Ee._publishLowStream=function(be,ye){return 2===Ee.lowStreamState?Ee.highStream&&Ee.highStream.hasScreen()?ye&&ye(ne.default.SHARING_SCREEN_NOT_SUPPORT):void Ee._getLowStream(function(Re){Ee.lowStreamState=1,Ee.gatewayClient.publish(Re,function(){Ee.lowStreamState=0,be&&be()},function(Ie){te.default.debug("publish low stream failed"),ye&&ye(Ie)})},ye):ye&&ye(ne.default.LOW_STREAM_ALREADY_PUBLISHED)},Ee._unpublishLowStream=function(be,ye){return 0===Ee.lowStreamState?void(Ee.lowStream&&(Ee.gatewayClient.unpublish(Ee.lowStream,function(){},function(Re){te.default.debug("unpublish low stream failed"),ye&&ye(Re)}),Ee.lowStream.close(),Ee.lowStream=null,Ee.lowStreamState=2,be&&be())):ye&&ye(ne.default.LOW_STREAM_NOT_YET_PUBLISHED)},Ee.join=function(be,ye,Re,Ie,Ce){if(be&&"string"!=typeof be)return te.default.warning("Param channelKey should be string"),Ce&&Ce(ne.default.INVALID_PARAMETER);if("string"!=typeof ye)return te.default.warning("Param channel should be string"),Ce&&Ce(ne.default.INVALID_PARAMETER);if(Re&&("number"!=typeof Re||!(0,se.is32Uint)(Re)))return te.default.warning("Param uid should be number"),Ce&&Ce(ne.default.INVALID_PARAMETER);Ee.highStream=null,Ee.lowStream=null,Ee.lowStreamParameter=null,Ee.isDualStream=!1,Ee.highStreamState=2,Ee.lowStreamState=2;var Ae={appId:Se.appId,sid:Se.sessionId,cname:ye,uid:Re};oe.report.sessionInit(Se.sessionId,{lts:new Date().getTime(),cname:ye,appid:Se.appId,mode:Se.mode,succ:!0}),(0,ae.getGatewayList)(Ae,function(Te){te.default.info("Joining channel: "+ye),Ee.key=be||Se.appId,Ae.cid=Te.cid,Ae.uid=Te.uid,Ae.gatewayAddr=Te.gateway_addr,Ee.joinInfo=Ae,Ee.gatewayClient.join(Ae,Ee.key,function(Oe){te.default.info("Join channal "+ye+" success"),Ie(Oe)},Ce)},Ce)},Ee.renewChannelKey=function(be,ye,Re){void 0===Ee.key?(te.default.error("renewChannelKey should not be called before user join"),(0,se.safeCall)(Re,ne.default.INVALID_OPERATION)):(Ee.key=be,Ee.gatewayClient.key=be,Ee.gatewayClient.rejoin(),(0,se.safeCall)(ye))},Ee.leave=function(be,ye){te.default.info("Leaving channel"),Ee.gatewayClient.leave(be,ye)},Ee._publish=function(be,ye,Re){return 2===Ee.highStreamState?void(te.default.info("Publishing stream, uid: ",be.getId()),Ee.highStream=be,Ee.highStreamState=1,Ee.highStream.streamId=Ee.joinInfo.uid,Ee.gatewayClient.publish(be,function(){be.sid=Se.sessionId,Ee.highStreamState=0,te.default.info("Publish success, uid:",be.getId()),Ee.isDualStream?Ee._publishLowStream(function(){ye&&ye()},function(){ye&&ye()}):ye&&ye()},Re)):(te.default.warning("Can't publish stream when stream already publish",be.getId()),Re&&Re(ne.default.STREAM_ALREADY_PUBLISHED))},Ee._unpublish=function(be,ye,Re){return 0===Ee.highStreamState?void(te.default.info("Unpublish stream, uid: ",be.getId()),Ee.isDualStream&&Ee.lowStream?(Ee._unpublishLowStream(null,Re),Ee.gatewayClient.unpublish(be,null,Re),Ee.highStreamState=2,te.default.info("Unpublish stream success, uid:",be.getId())):(Ee.gatewayClient.unpublish(be,null,Re),Ee.highStreamState=2,te.default.info("Unpublish stream success, uid:",be.getId())),ye&&ye()):(te.default.warning("Can't unpublish stream when stream not publish"),Re&&Re(ne.default.STREAM_NOT_YET_PUBLISHED))},Ee.publish=function(be,ye){return 2===Ee.highStreamState?void Ee._publish(be,null,ye):void(ye&&ye(ne.default.STREAM_ALREADY_PUBLISHED))},Ee.unpublish=function(be,ye){return 0===Ee.highStreamState?void Ee._unpublish(be,null,ye):void(ye&&ye(ne.default.STREAM_NOT_YET_PUBLISHED))},Ee.subscribe=function(be,ye){te.default.info("Subscribe stream, uid: ",be.getId()),Ee.gatewayClient.subscribe(be,null,ye)},Ee.unsubscribe=function(be,ye){te.default.info("Unsubscribe stream, uid: ",be.getId()),Ee.gatewayClient.unsubscribe(be,null,ye)},Ee.setRemoteVideoStreamType=function(be,ye){Ee.gatewayClient.setRemoteVideoStreamType(be,ye)},Ee.startLiveStreaming=function(be,ye){Ee.gatewayClient.startLiveStreaming(be,ye)},Ee.stopLiveStreaming=function(be){Ee.gatewayClient.stopLiveStreaming(be)},Ee.setLiveTranscoding=function(be){Object.assign(_e,be),Ee.gatewayClient.setLiveTranscoding(_e)},Ee.gatewayClient=(0,Z.default)(Se),Ee.on=Ee.gatewayClient.on,Ee.on("rejoin",function(){var be=2===Ee.highStreamState?2:0;Ee.highStream&&0==be&&(te.default.info("publish after rejoin"),Ee.highStreamState=2,Ee.lowStreamState=2,Ee.publish(Ee.highStream,function(ye){ye&&te.default.info(ye)}))}),Ee.on("pubP2PLost",function(){te.default.debug("Start reconnect local peerConnection :",Ee.highStream.getId()),Ee.gatewayClient.dispatchEvent({type:"stream-reconnect-start",id:Ee.highStream.getId()}),Ee._unpublish(Ee.highStream,function(){Ee._publish(Ee.highStream,function(){te.default.debug("Reconnect local peerConnection success:",Ee.highStream.getId()),Ee.gatewayClient.dispatchEvent({type:"stream-reconnect-end",id:Ee.highStream.getId()})},function(ye){te.default.debug("Reconnect local peerConnection failed:"+ye),Ee.gatewayClient.dispatchEvent({type:"stream-reconnect-end",id:Ee.highStream.getId()})})},function(ye){te.default.debug("Reconnect local peerConnection failed:"+ye),Ee.gatewayClient.dispatchEvent({type:"stream-reconnect-end",id:Ee.highStream.getId()})})}),Ee.on("subP2PLost",function(be){te.default.debug("Start reconnect remote peerConnection :",be.stream.getId()),Ee.gatewayClient.dispatchEvent({type:"stream-reconnect-start",id:be.stream.getId()}),Ee.gatewayClient.unsubscribe(be.stream,function(){Ee.gatewayClient.subscribe(be.stream,function(){te.default.debug("Reconnect remote peerConnection success:",be.stream.getId()),Ee.gatewayClient.dispatchEvent({type:"stream-reconnect-end",id:be.stream.getId()})},function(ye){te.default.debug("Reconnect remote peerConnection failed:"+ye),Ee.gatewayClient.dispatchEvent({type:"stream-reconnect-end",id:be.stream.getId()})})},function(ye){te.default.debug("Reconnect remote peerConnection failed:"+ye),Ee.gatewayClient.dispatchEvent({type:"stream-reconnect-end",id:be.stream.getId()})})}),Ee},_e={width:640,height:360,videoBitrate:400,videoFramerate:15,lowLatency:!1,audioSampleRate:le.AUDIO_SAMPLE_RATE_48000,audioBitrate:48,audioChannels:1,videoGop:30,videoCodecProfile:le.VIDEO_CODEC_PROFILE_HIGH,userCount:0,userConfigExtraInfo:{},backgroundColor:0,transcodingUsers:[]};q.createClient=function(Se){return Se&&"interop"===Se.mode?(te.default.info("Creating client , MODE : Interop"),me({mode:"live"})):Se&&"h264_interop"===Se.mode?(te.default.info("Creating client , MODE : h264_interop"),me({mode:"live",codec:"h264"})):(te.default.info("Creating client , MODE : web-only"),me({mode:"rtc"}))},q.createRtcClient=function(){return te.default.info("Creating client , MODE : rtc"),te.default.warning("createRtcClient is deprecated."),me({mode:"rtc"})},q.createLiveClient=function(Se){var Ee="host";return Se&&"audience"===Se.role&&(Ee=Se.role),te.default.info("Creating client , MODE : live"),te.default.warning("createLiveClient is deprecated."),me({mode:"live",role:Ee})},q.TranscodingUser={uid:0,x:0,y:0,width:0,height:0,zOrder:0,alpha:1},q.LiveTranscoding=_e},function(z,q,J){"use strict";function Y(fe){return fe&&fe.__esModule?fe:{default:fe}}Object.defineProperty(q,"__esModule",{value:!0});var X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(fe){return typeof fe}:function(fe){return fe&&"function"==typeof Symbol&&fe.constructor===Symbol&&fe!==Symbol.prototype?"symbol":typeof fe},Z=J(7),ee=J(30),te=Y(ee),ie=J(8),ne=J(4),se=J(0),ae=Y(se),oe=J(6),re=Y(oe),de=J(10),ce=Y(de),le=J(11),pe=J(1),ue=J(5),me=J(2),ge=J(3);q.default=function(fe){function he(){for(var He in xe.remoteStreamsInChannel.clear(),xe.remoteStreams)if(xe.remoteStreams.hasOwnProperty(He)){var We=xe.remoteStreams[He];We.stop(),We.close(),delete xe.remoteStreams[He],void 0!==We.pc&&(We.pc.close(),We.pc=void 0)}}var ve=!1,Se=function(){return{_type:"ping"}},Ee=function(){return{_type:"join1",message:{appId:fe.appId,key:xe.key,channel:xe.joinInfo.cname,uid:xe.uid,version:pe.VERSION,browser:navigator.userAgent,mode:fe.mode,role:fe.role,config:xe.config}}},be=function(){return{_type:"leave"}},ye=function(He){return{_type:"control",message:He}},Re=function(He){return{_type:"token",message:He}},Ie=function(He){return{_type:"unpublish",message:He}},Ce=function(He){return{_type:"unsubscribe",message:He}},Ae=function(He,We){return{_type:"switchVideoStream",message:{id:He,type:We}}},Te=function(He,We,Ge){return{_type:"publish",options:He,sdp:We,p2pid:Ge}},Oe=function(He){return{_type:"publish_stats",options:{stats:He},sdp:null}},Ne=function(He){return{_type:"publish_stats_low",options:{stats:He},sdp:null}},we=function(He,We,Ge){return{_type:"subscribe",options:He,sdp:We,p2pid:Ge}},Le=function(He,We){return{_type:"subscribe_stats",options:{id:He,stats:We},sdp:null}},De=function(He,We){return{_type:"start_live_streaming",message:{url:He,transcodingEnabled:We}}},ke=function(He){return{_type:"stop_live_streaming",message:{url:He}}},Me=function(He){return{_type:"set_live_transcoding",message:{transcoding:He}}},xe=(0,ne.EventDispatcher)(fe);xe.socket=void 0,xe.state=0,xe.mode=fe.mode,xe.role=fe.role,xe.codec=fe.codec,xe.config={},xe.timers={},xe.timer_counter={},xe.localStreams={},xe.remoteStreams={},xe.attemps=1,xe.p2p_attemps=1,xe.audioLevel={},xe.activeSpeaker=void 0,xe.p2ps=new Map,xe.firstFrameTimer=new Map,xe.liveStreams=new Map,xe.remoteStreamsInChannel=new Set;var Pe=ce.default;xe.p2pCounter=(0,me.random)(1e5),xe.generateP2PId=function(){return++xe.p2pCounter},xe.remoteVideoStreamTypes={REMOTE_VIDEO_STREAM_HIGH:0,REMOTE_VIDEO_STREAM_LOW:1,REMOTE_VIDEO_STREAM_MEDIUM:2},xe.configPublisher=function(He){xe.config=He},xe.join=function(He,We,Ge,Ke){var ze=new Date().getTime(),qe=He.uid;return 0===xe.state?null!==qe&&void 0!==qe&&parseInt(qe)!==qe?(ae.default.error("Input uid is invalid"),Ke&&Ke(re.default.INVALID_PARAMETER),void ue.report.joinGateway(He.sid,{lts:ze,succ:!1,ec:re.default.INVALID_PARAMETER,addr:null})):(xe.joinInfo=He,xe.uid=qe,xe.key=We,xe.state=1,void Be(He,function(Je){xe.stunServerUrl=Je.stunServerUrl,xe.turnServer=Je.turnServer,xe.state=2,ae.default.debug("Connected to gateway server"),xe.pingTimer=setInterval(function(){je(Se(),function(){},function(){})},3e3),je(Ee(),function(Ye){ue.report.joinGateway(He.sid,{lts:ze,succ:!0,ec:null,vid:Ye.vid,addr:xe.socket.getURL()}),Ge(xe.uid)},function(Ye){ae.default.error("User join failed ["+Ye+"]"),Ke&&Ke(Ye),ue.report.joinGateway(He.sid,{lts:ze,succ:!1,ec:Ye,addr:xe.socket.getURL()})})},function(Je){ae.default.error("User join failed ["+Je+"]"),Ke&&Ke(Je),ue.report.joinGateway(He.sid,{lts:ze,succ:!1,ec:Je,addr:xe.socket.getURL()})})):(ae.default.error("Server already in connecting/connected state"),Ke&&Ke(re.default.INVALID_OPERATION),void ue.report.joinGateway(He.sid,{lts:ze,succ:!1,ec:re.default.INVALID_OPERATION,addr:null}))},xe.leave=function(He,We){if(2!=xe.state)return void Pe(He);for(var Ge in clearInterval(xe.pingTimer),xe.timers)xe.timers.hasOwnProperty(Ge)&&clearInterval(xe.timers[Ge]);for(var Ge in je(be(),function(ze){xe.socket.close(),xe.socket=void 0,ae.default.info("Leave channal success"),He&&He(ze)},We),xe.localStreams)if(xe.localStreams.hasOwnProperty(Ge)){var Ke=xe.localStreams[Ge];delete xe.localStreams[Ge],void 0!==Ke.pc&&(Ke.pc.close(),Ke.pc=void 0)}he(),xe.state=0},xe.publish=function(He,We,Ge){var Ke=new Date().getTime();if(He.publishLTS=Ke,"object"!==(void 0===He?"undefined":X(He))||null===He)return ae.default.error("Invalid local stream"),Ge&&Ge(re.default.INVALID_LOCAL_STREAM),void ue.report.publish(xe.joinInfo.sid,{lts:Ke,succ:!1,ec:re.default.INVALID_LOCAL_STREAM});if(null===He.stream&&void 0===He.url)return ae.default.error("Invalid local media stream"),Ge&&Ge(re.default.INVALID_LOCAL_STREAM),void ue.report.publish(xe.joinInfo.sid,{lts:Ke,succ:!1,ec:re.default.INVALID_LOCAL_STREAM});if(2!==xe.state)return ae.default.error("User is not in the session"),Ge&&Ge(re.default.INVALID_OPERATION),void ue.report.publish(xe.joinInfo.sid,{lts:Ke,succ:!1,ec:re.default.INVALID_OPERATION});var ze=He.getAttributes()||{};if(He.local&&void 0===xe.localStreams[He.getId()]&&(He.hasAudio()||He.hasVideo()||He.hasScreen())){var qe=xe.generateP2PId();void 0===He.url?(xe.localStreams[He.getId()]=He,He.pc=(0,ie.Connection)({callback:function(Je){ae.default.debug("SDP exchange in publish : send offer --  ",JSON.parse(Je)),$e(Te({state:"offer",id:He.getId(),audio:He.hasAudio(),video:He.hasVideo()||He.hasScreen(),attributes:He.getAttributes(),mode:xe.mode,codec:xe.codec,p2pid:qe},Je),function(Ye,Qe){return"error"===Ye?(ae.default.error("Publish local stream failed"),Ge&&Ge(re.default.PUBLISH_STREAM_FAILED),void ue.report.publish(xe.joinInfo.sid,{lts:Ke,succ:!1,localSDP:Je,ec:re.default.PUBLISH_STREAM_FAILED})):void(He.pc.onsignalingmessage=function(Xe){He.pc.onsignalingmessage=function(){},$e(Te({state:"ok",id:He.getId(),audio:He.hasAudio(),video:He.hasVideo(),screen:He.hasScreen(),attributes:He.getAttributes(),mode:xe.mode},Xe)),He.getUserId=function(){return Qe.id},ae.default.info("Local stream published with uid",Qe.id),He.onClose=function(){xe.unpublish(He)},He.unmuteAudio=function(){je(ye({action:"audio-out-on",streamId:He.getId()}),function(){},function(){})},He.unmuteVideo=function(){je(ye({action:"video-out-on",streamId:He.getId()}),function(){},function(){})},He.muteAudio=function(){je(ye({action:"audio-out-off",streamId:He.getId()}),function(){},function(){})},He.muteVideo=function(){je(ye({action:"video-out-off",streamId:He.getId()}),function(){},function(){})},He.getId()===He.getUserId()&&(He.isAudioOn()||He.hasAudio()&&(ae.default.debug("local stream audio mute"),He.muteAudio()),He.isVideoOn()||(He.hasVideo()||He.hasScreen())&&(ae.default.debug("local stream video mute"),He.muteVideo()))},He.pc.oniceconnectionstatechange=function(Xe){"failed"===Xe?(void 0!=xe.timers[He.getId()]&&clearInterval(xe.timers[He.getId()]),ae.default.error("Publisher connection is lost"),Ge&&Ge(re.default.PEERCONNECTION_FAILED),xe.p2ps.delete(qe),xe.dispatchEvent((0,ne.ClientEvent)({type:"pubP2PLost",stream:He})),ue.report.publish(xe.joinInfo.sid,{lts:Ke,succ:!1,ec:re.default.PEERCONNECTION_FAILED})):"connected"==Xe&&(xe.p2ps.set(qe,He),He.p2pId=qe,We&&We(),ue.report.publish(xe.joinInfo.sid,{lts:Ke,succ:!0,ec:null}))},ae.default.debug("SDP exchange in publish : receive answer --  ",JSON.parse(Ye)),He.pc.processSignalingMessage(Ye))})},audio:He.hasAudio(),video:He.hasVideo(),screen:He.hasScreen(),isSubscriber:!1,iceServers:[],stunServerUrl:xe.stunServerUrl,turnServer:xe.turnServer,maxAudioBW:ze.maxAudioBW,minVideoBW:ze.minVideoBW,maxVideoBW:ze.maxVideoBW,mode:xe.mode,codec:xe.codec}),He.pc.addStream(He.stream),ae.default.debug("PeerConnection add stream :",He.stream),xe.timers[He.getId()]=setInterval(function(){He&&He.pc&&He.pc.getStats&&He.pc.getStatsRate(function(Je){Je.forEach(function(Ye){-1===Ye.id.indexOf("outbound_rtp")&&-1===Ye.id.indexOf("OutboundRTP")||"video"!==Ye.mediaType||(Ye.googFrameWidthSent=He.videoWidth+"",Ye.googFrameHeightSent=He.videoHeight+""),He.getUserId&&(He.getId()===He.getUserId()?je(Oe(Ye),null,null):je(Ne(Ye),null,null))})})},3e3),void 0!==He.aux_stream&&(He.pc.addStream(He.aux_stream),ae.default.debug("PeerConnection add stream :",He.aux_stream))):$e(Te({state:"url",audio:He.hasAudio(),video:He.hasVideo(),attributes:He.getAttributes(),mode:xe.mode},He.url),function(Je,Ye){"success"===Je?(He.getUserId=function(){return Ye},xe.localStreams[Ye]=He,He.onClose=function(){xe.unpublish(He)}):ae.default.error("Publish local stream failed",Je)})}},xe.unpublish=function(He,We,Ge){return"object"!==(void 0===He?"undefined":X(He))||null===He?(ae.default.error("Invalid local stream"),void Pe(Ge,re.default.INVALID_LOCAL_STREAM)):2===xe.state?(void 0!=xe.timers[He.getId()]&&clearInterval(xe.timers[He.getId()]),void(void 0===xe.socket?(ae.default.error("User not in the session"),Pe(Ge,re.default.INVALID_OPERATION)):He.local&&void 0!==xe.localStreams[He.getId()]?(delete xe.localStreams[He.getId()],je(Ie(He.getUserId())),(He.hasAudio()||He.hasVideo()||He.hasScreen())&&void 0===He.url&&void 0!==He.pc&&(He.pc.close(),He.pc=void 0),He.onClose=void 0,He.unmuteAudio=void 0,He.muteAudio=void 0,He.unmuteVideo=void 0,He.muteVideo=void 0,xe.p2ps.delete(He.p2pId),We&&We()):(ae.default.error("Invalid local stream"),Pe(Ge,re.default.INVALID_LOCAL_STREAM)))):(ae.default.error("User not in the session"),void Pe(Ge,re.default.INVALID_OPERATION))},xe.subscribe=function(He,We,Ge){var Ke=new Date().getTime();if(He.subscribeLTS=Ke,"object"!==(void 0===He?"undefined":X(He))||null===He)return ae.default.error("Invalid remote stream"),Ge&&Ge(re.default.INVALID_REMOTE_STREAM),void ue.report.subscribe(xe.joinInfo.sid,{lts:Ke,succ:!1,peerid:He.getId()+"",ec:re.default.INVALID_REMOTE_STREAM});if(2!==xe.state)return ae.default.error("User is not in the session"),Ge&&Ge(re.default.INVALID_OPERATION),void ue.report.subscribe(xe.joinInfo.sid,{lts:Ke,succ:!1,peerid:He.getId()+"",ec:re.default.INVALID_OPERATION});if(He.local||!xe.remoteStreams.hasOwnProperty(He.getId()))ae.default.error("No such remote stream"),Ge&&Ge(re.default.NO_SUCH_REMOTE_STREAM),ue.report.subscribe(xe.joinInfo.sid,{lts:Ke,succ:!1,peerid:He.getId()+"",ec:re.default.INVALID_REMOTE_STREAM});else if(He.hasAudio()||He.hasVideo()||He.hasScreen()){var ze=xe.generateP2PId();He.pc=(0,ie.Connection)({callback:function(qe){ae.default.debug("SDP exchange in subscribe : send offer --  ",JSON.parse(qe)),$e(we({streamId:He.getId(),audio:!0,video:!0,mode:xe.mode,codec:xe.codec,p2pid:ze},qe),function(Je){return"error"===Je?(ae.default.error("Subscribe remote stream failed, closing stream ",He.getId()),He.close(),Ge&&Ge(re.default.SUBSCRIBE_STREAM_FAILED),void ue.report.subscribe(xe.joinInfo.sid,{lts:Ke,succ:!1,peerid:He.getId()+"",ec:re.default.SUBSCRIBE_STREAM_FAILED})):void(ae.default.debug("SDP exchange in subscribe : receive answer --  ",JSON.parse(Je)),He.pc.processSignalingMessage(Je))})},nop2p:!0,audio:!0,video:!0,screen:He.hasScreen(),isSubscriber:!0,iceServers:[],stunServerUrl:xe.stunServerUrl,turnServer:xe.turnServer}),He.pc.onaddstream=function(qe,Je){if("ontrack"===Je&&"video"===qe.track.kind||"onaddstream"===Je){if(ae.default.info("Remote stream subscribed with uid ",He.getId()),xe.remoteStreams[He.getId()].stream="onaddstream"===Je?qe.stream:qe.streams[0],!xe.remoteStreams[He.getId()].hasVideo())xe.remoteStreams[He.getId()].disableVideo();else if((0,ge.isFireFox)()){var Ye=xe.remoteStreams[He.getId()].stream;(0,me.vsResHack)(Ye,function(Xe,Ze){He.videoWidth=Xe,He.videoHeight=Ze},function(Xe){return ae.default.warning("vsResHack failed:"+Xe)})}var Qe=(0,ne.StreamEvent)({type:"stream-subscribed",stream:xe.remoteStreams[He.getId()]});xe.dispatchEvent(Qe)}He.unmuteAudio=function(){je(ye({action:"audio-in-on",streamId:He.getId()}),function(){},function(){})},He.muteAudio=function(){je(ye({action:"audio-in-off",streamId:He.getId()}),function(){},function(){})},He.unmuteVideo=function(){je(ye({action:"video-in-on",streamId:He.getId()}),function(){},function(){})},He.muteVideo=function(){je(ye({action:"video-in-off",streamId:He.getId()}),function(){},function(){})}},xe.timers[He.getId()]=setInterval(function(){He&&He.pc&&He.pc.getStats&&He.pc.getStatsRate(function(qe){qe.forEach(function(Je){-1!==Je.id.indexOf("inbound_rtp")&&"video"===Je.mediaType&&(Je.googFrameWidthReceived=He.videoWidth+"",Je.googFrameHeightReceived=He.videoHeight+""),$e(Le(He.getId(),Je),null,null)})})},3e3),xe.audioLevel[He.getId()]=0,xe.timers[He.getId()+"audio"]=setInterval(function(){He&&He.pc&&He.pc.getStats&&He.pc.getStats(function(qe){qe.forEach(function(Je){if("audio"===Je.mediaType){if(5e3<Je.audioOutputLevel)for(var Ye in 20>xe.audioLevel[He.getId()]&&(xe.audioLevel[He.getId()]+=1),xe.audioLevel)parseInt(Ye)!==He.getId()&&0<xe.audioLevel[Ye]&&(xe.audioLevel[Ye]-=1);var Qe=Object.keys(xe.audioLevel),Xe=Qe.sort(function(et,tt){return xe.audioLevel[tt]-xe.audioLevel[et]});if(xe.activeSpeaker!==Xe[0]){var Ze=(0,ne.ClientEvent)({type:"active-speaker",uid:Xe[0]});xe.dispatchEvent(Ze),xe.activeSpeaker=Xe[0],ae.default.debug("Update active speaker:"+xe.activeSpeaker)}}})})},50),He.pc.oniceconnectionstatechange=function(qe){"failed"===qe?(void 0!=xe.timers[He.getId()]&&(clearInterval(xe.timers[He.getId()]),clearInterval(xe.timers[He.getId()]+"audio")),xe.p2ps.delete(ze),ae.default.error("Subscriber connection is lost",He.getId()),Ge&&Ge(re.default.PEERCONNECTION_FAILED),xe.remoteStreams[He.getId()]&&xe.dispatchEvent((0,ne.ClientEvent)({type:"subP2PLost",stream:He})),ue.report.subscribe(xe.joinInfo.sid,{lts:Ke,succ:!1,peerid:He.getId()+"",ec:re.default.PEERCONNECTION_FAILED})):"connected"==qe&&(xe.p2ps.set(ze,He),He.p2pId=ze,We&&We(),ue.report.subscribe(xe.joinInfo.sid,{lts:Ke,succ:!0,peerid:He.getId()+"",ec:null}),xe.firstFrameTimer.set(He.getId(),setInterval(function(){He.pc?He.pc.getStats(function(Je){Je.forEach(function(Ye){-1===Ye.id.indexOf("recv")&&-1===Ye.id.indexOf("inbound_rtp")&&-1===Ye.id.indexOf("InboundRTP")||"video"===Ye.mediaType&&(0<Ye.framesDecoded||0<Ye.googFramesDecoded)&&(clearInterval(xe.firstFrameTimer.get(He.getId())),xe.firstFrameTimer.delete(He.getId()),ue.report.firstRemoteFrame(xe.joinInfo.sid,{lts:new Date().getTime(),peerid:He.getId()+"",succ:!0,width:+Ye.googFrameWidthReceived,height:+Ye.googFrameHeightReceived}))})}):(clearInterval(xe.firstFrameTimer.get(He.getId())),xe.firstFrameTimer.delete(He.getId()))},100)))}}else ae.default.error("Invalid remote stream"),Ge&&Ge(re.default.INVALID_REMOTE_STREAM),ue.report.subscribe(xe.joinInfo.sid,{lts:Ke,succ:!1,peerid:He.getId()+"",ec:re.default.INVALID_REMOTE_STREAM})},xe.unsubscribe=function(He,We,Ge){return"object"!==(void 0===He?"undefined":X(He))||null===He?(ae.default.error("Invalid remote stream"),void Pe(Ge,re.default.INVALID_REMOTE_STREAM)):2===xe.state?(void 0!=xe.timers[He.getId()]&&(clearInterval(xe.timers[He.getId()]),clearInterval(xe.timers[He.getId()]+"audio")),void 0!=xe.audioLevel[He.getId()]&&delete xe.audioLevel[He.getId()],void 0!=xe.timer_counter[He.getId()]&&delete xe.timer_counter[He.getId()],xe.remoteStreams.hasOwnProperty(He.getId())?xe.socket?He.local?(ae.default.error("Invalid remote stream"),void Pe(Ge,re.default.INVALID_REMOTE_STREAM)):(He.close(),void je(Ce(He.getId()),function(Ke){return"error"===Ke?(ae.default.error("Unsubscribe remote stream failed",He.getId()),void Pe(Ge,re.default.UNSUBSCRIBE_STREAM_FAILED)):void(void 0!==He.pc&&(He.pc.close(),He.pc=void 0),He.onClose=void 0,He.unmuteAudio=void 0,He.muteAudio=void 0,He.unmuteVideo=void 0,He.muteVideo=void 0,xe.p2ps.delete(He.p2pId),ae.default.info("Unsubscribe stream success"),xe.dispatchEvent((0,ne.ClientEvent)({type:"stream-removed",uid:He.getId(),stream:He})),We&&We())},Ge)):(ae.default.error("User is not in the session"),void Pe(Ge,re.default.INVALID_OPERATION)):void Pe(Ge,re.default.NO_SUCH_REMOTE_STREAM)):(ae.default.error("User is not in the session"),void Pe(Ge,re.default.INVALID_OPERATION))},xe.setRemoteVideoStreamType=function(He,We){if(ae.default.debug("Switching remote video stream "+He.getId()+" to "+We),"object"!==(void 0===He?"undefined":X(He))||null===He)return void ae.default.error("Invalid remote stream");if(2!==xe.state)return void ae.default.error("User is not in the session");if(!He.local){switch(We){case xe.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_HIGH:case xe.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_LOW:case xe.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_MEDIUM:break;default:return;}je(Ae(He.getId(),We),null,null)}},xe.startLiveStreaming=function(He,We){return(xe.liveStreams.set(He,We),ae.default.debug("Start live streaming "+He+" transcodingEnabled "+We),2!==xe.state)?void ae.default.error("User is not in the session"):void je(De(He,We),null,null)},xe.stopLiveStreaming=function(He){return(ae.default.debug("Stop live streaming "+He),2!==xe.state)?void ae.default.error("User is not in the session"):void(xe.liveStreams.delete(He),je(ke(He),null,null))},xe.setLiveTranscoding=function(He){if((0,me.isLiveTranscodingValid)(He)){if(xe.transcoding=He,ae.default.debug("Set live transcoding ",He),2!==xe.state)return void ae.default.error("User is not in the session");je(Me(He),null,null)}};var Ve=function(He){return 1e3*Math.min(30,Math.pow(2,He)-1)};xe.rejoin=function(){0!==xe.state&&(xe.state=0),xe.socket&&(clearInterval(xe.pingTimer),xe.socket.close(),xe.socket=void 0),Fe()};var Fe=function(){xe.key?(ae.default.info("Re-joining to channel "+xe.joinInfo.cname),xe.join(xe.joinInfo,xe.key,function(He){for(var We in ae.default.info("User "+He+" is re-joined to "+xe.joinInfo.cname),xe.localStreams)if(void 0!==xe.localStreams[We]){var Ge=xe.localStreams[We];delete xe.localStreams[We],void 0!==Ge.pc&&(Ge.pc.close(),Ge.pc=void 0)}xe.dispatchEvent((0,ne.ClientEvent)({type:"rejoin"})),xe.liveStreams&&xe.liveStreams.size&&xe.liveStreams.forEach(function(Ke,ze){Ke&&xe.setLiveTranscoding(xe.transcoding),xe.startLiveStreaming(ze,Ke)})},function(He){ae.default.error("Re-join to channel failed ["+He+"]"),xe.dispatchEvent((0,ne.StreamEvent)({type:"error",reason:He}))})):ae.default.error("Connection recover failed [Invalid channel key]")},Ue=function(He){xe.socket=(0,te.default)(He,{sid:xe.joinInfo.sid})},Be=function(He,We,Ge){void 0===xe.socket?(Ue(He.gatewayAddr),xe.socket.on("onUplinkStats",function(Ke){xe.localStreams[xe.uid]&&(xe.localStreams[xe.uid].uplinkStats=Ke)}),xe.socket.on("connect",function(){xe.attemps=1,je(Re(He),We,Ge)}),xe.socket.on("reconnect",function(){ae.default.debug("Try to reconnect choose server and get gateway list again "),(0,le.getGatewayList)(xe.joinInfo,function(Ke){xe.socket.reconnect(Ke.gateway_addr)})}),xe.socket.on("connect_error",function(Ke){for(var ze in xe.timers)xe.timers.hasOwnProperty(ze)&&clearInterval(xe.timers[ze]);for(var ze in xe.remoteStreams)if(xe.remoteStreams.hasOwnProperty(ze)){var qe=xe.remoteStreams[ze],Je=(0,ne.ClientEvent)({type:"stream-removed",uid:qe.getId(),stream:qe});xe.dispatchEvent(Je)}if(he(),1!=ve){clearInterval(xe.pingTimer),xe.state=0,xe.socket=void 0;var Je=(0,ne.StreamEvent)({type:"error",reason:re.default.SOCKET_ERROR});xe.dispatchEvent(Je);var Ye=Ve(xe.attemps);ae.default.error("Connect to server error ["+JSON.stringify(Ke)+"], attempt to recover [#"+xe.attemps+"] after "+Ye/1e3+" seconds"),setTimeout(function(){xe.attemps++,Fe()},Ye)}}),xe.socket.on("disconnect",function(Ke){if(0!==xe.state){for(var ze in xe.state=0,xe.timers)xe.timers.hasOwnProperty(ze)&&clearInterval(xe.timers[ze]);for(var ze in xe.remoteStreams)if(xe.remoteStreams.hasOwnProperty(ze)){var qe=xe.remoteStreams[ze],Je=(0,ne.ClientEvent)({type:"stream-removed",uid:qe.getId(),stream:qe});xe.dispatchEvent(Je)}if(xe.p2ps.clear(),he(),1!=ve){clearInterval(xe.pingTimer),xe.socket=void 0;var Je=(0,ne.StreamEvent)({type:"error",reason:re.default.SOCKET_DISCONNECTED});xe.dispatchEvent(Je);var Ye=Ve(xe.attemps);ae.default.error("Disconnect from server ["+Ke+"], attempt to recover [#"+xe.attemps+"] after "+Ye/1e3+" seconds"),setTimeout(function(){xe.attemps++,Fe()},Ye)}}}),xe.socket.on("onAddAudioStream",function(Ke){if(ae.default.info("Newly added audio stream with uid",Ke.id),xe.remoteStreamsInChannel.has(Ke.id)||xe.remoteStreamsInChannel.add(Ke.id),void 0===xe.remoteStreams[Ke.id]){var ze=(0,Z.Stream)({streamID:Ke.id,local:!1,audio:Ke.audio,video:Ke.video,screen:Ke.screen,attributes:Ke.attributes});xe.remoteStreams[Ke.id]=ze;var qe=(0,ne.StreamEvent)({type:"stream-added",stream:ze});xe.dispatchEvent(qe)}}),xe.socket.on("onAddVideoStream",function(Ke){if(ae.default.info("Newly added remote stream with uid",Ke.id),xe.remoteStreamsInChannel.has(Ke.id)||xe.remoteStreamsInChannel.add(Ke.id),void 0===xe.remoteStreams[Ke.id]){var ze=(0,Z.Stream)({streamID:Ke.id,local:!1,audio:Ke.audio,video:Ke.video,screen:Ke.screen,attributes:Ke.attributes});xe.remoteStreams[Ke.id]=ze;var qe=(0,ne.StreamEvent)({type:"stream-added",stream:ze});xe.dispatchEvent(qe)}else if(void 0!==xe.remoteStreams[Ke.id].stream){xe.remoteStreams[Ke.id].video=!0,xe.remoteStreams[Ke.id].enableVideo(),ae.default.info("Stream changed: enable video "+Ke.id);var Je=xe.remoteStreams[Ke.id],Ye=Je.player.elementID;Je.stop(),Je.play(Ye)}else{var ze=(0,Z.Stream)({streamID:Ke.id,local:!1,audio:!0,video:!0,screen:!1,attributes:Ke.attributes});xe.remoteStreams[Ke.id]=ze,ae.default.info("Stream changed: modify video "+Ke.id)}}),xe.socket.on("onRemoveStream",function(Ke){xe.remoteStreamsInChannel.has(Ke.id)&&xe.remoteStreamsInChannel.delete(Ke.id);var ze=xe.remoteStreams[Ke.id];if(!ze)return void console.log("ERROR stream ",Ke.id," not found onRemoveStream ",Ke);delete xe.remoteStreams[Ke.id];var qe=(0,ne.StreamEvent)({type:"stream-removed",stream:ze});xe.dispatchEvent(qe),ze.close(),void 0!==ze.pc&&(ze.pc.close(),ze.pc=void 0)}),xe.socket.on("onPublishStream",function(Ke){var ze=xe.localStreams[Ke.id],qe=(0,ne.StreamEvent)({type:"stream-published",stream:ze});xe.dispatchEvent(qe)}),xe.socket.on("mute_audio",function(Ke){if(xe.remoteStreamsInChannel.has(Ke.peerid)){ae.default.info("rcv peer mute audio:"+Ke.peerid);var ze=(0,ne.ClientEvent)({type:"mute-audio",uid:Ke.peerid});xe.dispatchEvent(ze)}}),xe.socket.on("unmute_audio",function(Ke){if(xe.remoteStreamsInChannel.has(Ke.peerid)){ae.default.info("rcv peer unmute audio:"+Ke.peerid);var ze=(0,ne.ClientEvent)({type:"unmute-audio",uid:Ke.peerid});xe.dispatchEvent(ze)}}),xe.socket.on("mute_video",function(Ke){if(xe.remoteStreamsInChannel.has(Ke.peerid)){ae.default.info("rcv peer mute video:"+Ke.peerid);var ze=(0,ne.ClientEvent)({type:"mute-video",uid:Ke.peerid});xe.dispatchEvent(ze)}}),xe.socket.on("unmute_video",function(Ke){if(xe.remoteStreamsInChannel.has(Ke.peerid)){ae.default.info("rcv peer unmute video:"+Ke.peerid);var ze=(0,ne.ClientEvent)({type:"unmute-video",uid:Ke.peerid});xe.dispatchEvent(ze)}}),xe.socket.on("user_banned",function(Ke){ae.default.info("user banned uid:"+Ke.id+"error:"+Ke.errcode);var ze=(0,ne.ClientEvent)({type:"client-banned",uid:Ke.id,attr:Ke.errcode});xe.dispatchEvent(ze),ve=!0,leave()}),xe.socket.on("onP2PLost",function(Ke){if(ae.default.debug("p2plost:",Ke),"publish"===Ke.event){var ze=xe.localStreams[Ke.uid];ze&&ue.report.publish(xe.joinInfo.sid,{lts:ze.publishLTS,succ:!1,ec:"DTLS failed"})}if("subscribe"===Ke.event){var qe=xe.remoteStreams[Ke.uid];qe&&ue.report.subscribe(xe.joinInfo.sid,{lts:qe.subscribeLTS,succ:!1,peerid:Ke.uid+"",ec:"DTLS failed"})}ae.default.debug("p2plost:",Ke.p2pid);var Je=xe.p2ps.get(Ke.p2pid);Je&&(xe.p2ps.delete(Ke.p2pid),Je.local?xe.dispatchEvent((0,ne.ClientEvent)({type:"pubP2PLost",stream:Je})):xe.remoteStreams[Je.getId()]&&xe.dispatchEvent((0,ne.ClientEvent)({type:"subP2PLost",stream:Je})))}),xe.socket.on("onRepeatJoin",function(Ke){console.log("recv onRepeatJoin message: uid="+Ke.uid)}),xe.socket.on("onPeerLeave",function(Ke){var ze=(0,ne.ClientEvent)({type:"peer-leave",uid:Ke.id});if(xe.remoteStreamsInChannel.has(Ke.id)&&xe.remoteStreamsInChannel.delete(Ke.id),xe.remoteStreams.hasOwnProperty(Ke.id)&&(ze.stream=xe.remoteStreams[Ke.id]),xe.dispatchEvent(ze),xe.remoteStreams.hasOwnProperty(Ke.id)){ae.default.info("closing stream on peer leave",Ke.id);var qe=xe.remoteStreams[Ke.id];qe.close(),delete xe.remoteStreams[Ke.id],void 0!==qe.pc&&(qe.pc.close(),qe.pc=void 0)}xe.timers.hasOwnProperty(Ke.id)&&(clearInterval(xe.timers[Ke.id]),delete xe.timers[Ke.id]),void 0!=xe.audioLevel[Ke.id]&&delete xe.audioLevel[Ke.id],void 0!=xe.timer_counter[Ke.id]&&delete xe.timer_counter[Ke.id]}),xe.socket.on("onUplinkStats",function(){}),xe.socket.on("liveStreamingStarted",function(Ke){var ze=(0,ne.LiveStreamingEvent)({type:"liveStreamingStarted",url:Ke.url});xe.dispatchEvent(ze)}),xe.socket.on("liveStreamingFailed",function(Ke){var ze=(0,ne.LiveStreamingEvent)({type:"liveStreamingFailed",url:Ke.url});xe.dispatchEvent(ze)}),xe.socket.on("liveStreamingStopped",function(Ke){var ze=(0,ne.LiveStreamingEvent)({type:"liveStreamingStopped",url:Ke.url});xe.dispatchEvent(ze)}),xe.socket.on("liveTranscodingUpdated",function(Ke){var ze=(0,ne.LiveStreamingEvent)({type:"liveTranscodingUpdated",reason:Ke.reason});xe.dispatchEvent(ze)})):xe.socket.socket.connect()},je=function(He,We,Ge){if(void 0===xe.socket)return ae.default.error("No socket available"),void Pe(Ge,re.default.INVALID_OPERATION);try{xe.socket.emitSimpleMessage(He,function(Ke,ze){"success"===Ke?"function"==typeof We&&We(ze):"function"==typeof Ge&&Ge(oe.GatewayErrorCode[ze]||ze)})}catch(Ke){ae.default.error("Socket emit message failed"+JSON.stringify(He)),ae.default.error(Ke),Pe(Ge,re.default.SOCKET_ERROR)}},$e=function(He,We){if(void 0===xe.socket)return void ae.default.error("Error in sendSimpleSdp [socket not ready]");try{xe.socket.emitSimpleMessage(He,function(Ge,Ke){We&&We(Ge,Ke)})}catch(Ge){ae.default.error("Error in sendSimpleSdp ["+Ge+"]")}};return xe}},function(z,q,J){"use strict";Object.defineProperty(q,"__esModule",{value:!0});var Y=J(31),X=function(te){return te&&te.__esModule?te:{default:te}}(Y),Z=J(4);q.default=function(te,ie){var ne={};return ne.connect=function(){ie.host=te,ne.signal=(0,X.default)(ie),ne.on=ne.signal.on,ne.dispatchEvent=ne.signal.dispatchEvent,ne.signal.on("onopen",function(se){ne.signal.onEvent=function(ae){ne.dispatchEvent((0,Z.MediaEvent)({type:ae.event,msg:ae}))},ne.dispatchEvent((0,Z.MediaEvent)({type:"connect",msg:se}))}),ne.signal.on("onError",function(se){var ae=se.msg;onError(ae.code,"error")})},ne.disconnect=function(){ne.signal.disconnect()},ne.close=function(){ne.signal.close()},ne.getURL=function(){return ne.signal.getURL()},ne.reconnect=function(se){ne.signal.creatConnection(se)},ne.emitSimpleMessage=function(se,ae){ne.signal.sendSignalCommand(se,ae)},ne.connect(),ne}},function(z,q,J){"use strict";function Y(ae){return ae&&ae.__esModule?ae:{default:ae}}Object.defineProperty(q,"__esModule",{value:!0});var X=J(4),Z=J(10),ee=Y(Z),te=J(0),ie=Y(te),ne=J(5);q.default=function(ae){var oe=(0,X.EventDispatcher)(ae);return oe.needReconnect=!0,oe.isTimeout=!1,oe.isInit=!0,oe.hostIndex=0,oe.requestID=0,oe.host=ae.host instanceof Array?ae.host:[ae.host],oe.Reconnection=function(re){oe.host=re||oe.host,oe.hostIndex=0,oe.creatConnection()},oe.getURL=function(){return oe.connection.url},oe.creatConnection=function(){return oe.hostIndex>=oe.host.length?(oe.hostIndex=0,void oe.dispatchEvent((0,X.MediaEvent)({type:"reconnect"}))):void(ie.default.debug("start connect:"+oe.host[oe.hostIndex]),oe.lts=new Date().getTime(),oe.connection=new WebSocket("wss://"+oe.host[oe.hostIndex++]),oe.connection.onopen=function(re){ie.default.debug("websockect opened"),oe.isTimeout=!1,oe.isInit=!1,clearTimeout(oe.timeoutCheck),oe.dispatchEvent((0,X.MediaEvent)({type:"onopen",event:re,socket:oe}))},oe.connection.onmessage=function(re){var de=JSON.parse(re.data);de.hasOwnProperty("_id")?oe.dispatchEvent((0,X.MediaEvent)({type:de._id,msg:de})):de.hasOwnProperty("_type")&&oe.dispatchSocketEvent((0,X.MediaEvent)({type:de._type,msg:de.message}))},oe.connection.onclose=function(re){oe.needReconnect?oe.isTimeout||oe.isInit?(ie.default.debug("websockect connect timeout"),ne.report.joinGateway(ae.sid,{lts:oe.lts,succ:!1,ec:"timeout",addr:oe.connection.url}),oe.creatConnection()):oe.dispatchEvent((0,X.MediaEvent)({type:"disconnect",event:re})):(ie.default.debug("websockect closeed"),(0,ee.default)(ae.onFailure,re),clearTimeout(oe.timeoutCheck),oe.dispatchEvent((0,X.MediaEvent)({type:"close",event:re})),oe.connection.onopen=void 0,oe.connection.onclose=void 0,oe.connection.onerror=void 0,oe.connection.onmessage=void 0,oe.connection=void 0)},oe.connection.onerror=function(){},setTimeout(function(){oe.connection&&oe.connection.readyState!=WebSocket.OPEN&&(oe.isTimeout=!0,oe.connection.close())},5e3))},oe.creatConnection(),oe.sendMessage=function(re,de){oe.connection&&oe.connection.readyState==WebSocket.OPEN?oe.connection.send(JSON.stringify(re)):de({error:"Gateway not connected"})},oe.disconnect=function(){oe.needReconnect=!0,oe.connection.close()},oe.close=function(){oe.needReconnect=!1,oe.connection.close()},oe.sendSignalCommand=function(re,de){re._id="_request_"+oe.requestID,oe.requestID+=1,"publish_stats"!==re._type&&"subscribe_stats"!==re._type&&"publish_stats_low"!==re._type&&oe.on(re._id,function(ce){ce.msg&&de&&de(ce.msg._result,ce.msg.message),delete oe.dispatcher.eventListeners[re._id]}),oe.sendMessage(re,function(ce){ce.reason="NOT_CONNECTED",de&&de(ce.reason,ce)})},oe}},function(z,q,J){"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.simMap=void 0;var Y=J(3);q.simMap=function(Z){var ee;return ee="120p"===Z||"120p_1"===Z?["120p_1","120p_1","120p_1"]:"120p_3"===Z?["120p_3","120p_3","120p_3"]:"180p"===Z||"180p_1"===Z?["90p_1","90p_1","180p_1"]:"180p_3"===Z?["120p_3","120p_3","180p_3"]:"180p_4"===Z?["120p_1","120p_1","180p_4"]:"240p"===Z||"240p_1"===Z?["120p_1","120p_1","240p_1"]:"240p_3"===Z?["120p_3","120p_3","240p_3"]:"240p_4"===Z?["120p_4","120p_4","240p_4"]:"360p"===Z||"360p_1"===Z||"360p_4"===Z||"360p_9"===Z||"360p_10"===Z||"360p_11"===Z?["90p_1","90p_1","360p_1"]:"360p_3"===Z||"360p_6"===Z?["120p_3","120p_3","360p_3"]:"360p_7"===Z||"360p_8"===Z?["120p_1","120p_1","360p_7"]:"480p"===Z||"480p_1"===Z||"480p_2"===Z||"480p_4"===Z||"480p_10"===Z?["120p_1","120p_1","480p_1"]:"480p_3"===Z||"480p_6"===Z?["120p_3","120p_3","480p_3"]:"480p_8"===Z||"480p_9"===Z?["120p_4","120p_4","480p_8"]:"720p"===Z||"720p_1"===Z||"720p_2"===Z||"720p_3"===Z?["90p_1","90p_1","720p_1"]:"720p_5"===Z||"720p_6"===Z?["120p_1","120p_1","720p_5"]:"1080p"===Z||"1080p_1"===Z||"1080p_2"===Z||"1080p_3"===Z||"1080p_5"===Z?["90p_1","90p_1","1080p_1"]:"1440p"===Z||"1440p_1"===Z||"1440p_2"===Z?["90p_1","90p_1","1440p_1"]:"4k"===Z||"4k_1"===Z||"4k_3"===Z?["90p_1","90p_1","4k_1"]:["120p_1","120p_1","360p_7"],(0,Y.isFireFox)()?[ee[1],15,100]:(0,Y.isSafari)()?[ee[2],15,50]:[ee[0],15,50]}},,function(z,q,J){"use strict";Object.defineProperty(q,"__esModule",{value:!0});var Y=J(1),X=J(0),Z=function(se){return se&&se.__esModule?se:{default:se}}(X),ee=J(2),te=J(7),ie=J(12),ne=J(28);q.default={TranscodingUser:ne.TranscodingUser,LiveTranscoding:ne.LiveTranscoding,createClient:ne.createClient,createStream:te.createStream,Logger:Z.default,getDevices:te.getDevices,checkSystemRequirements:ee.checkSystemRequirements,VERSION:Y.VERSION,AUDIO_SAMPLE_RATE_32000:ie.AUDIO_SAMPLE_RATE_32000,AUDIO_SAMPLE_RATE_44100:ie.AUDIO_SAMPLE_RATE_44100,AUDIO_SAMPLE_RATE_48000:ie.AUDIO_SAMPLE_RATE_48000,VIDEO_CODEC_PROFILE_BASELINE:ie.VIDEO_CODEC_PROFILE_BASELINE,VIDEO_CODEC_PROFILE_MAIN:ie.VIDEO_CODEC_PROFILE_MAIN,VIDEO_CODEC_PROFILE_HIGH:ie.VIDEO_CODEC_PROFILE_HIGH,REMOTE_VIDEO_STREAM_HIGH:ie.REMOTE_VIDEO_STREAM_HIGH,REMOTE_VIDEO_STREAM_LOW:ie.REMOTE_VIDEO_STREAM_LOW,REMOTE_VIDEO_STREAM_MEDIUM:ie.REMOTE_VIDEO_STREAM_MEDIUM}}]).default})},{}],3:[function(){LOGIN_STATE_NOT_LOGIN=0,LOGIN_STATE_LOGINING=1,LOGIN_STATE_LOGINED=2,LOGIN_STATE_RECONNECTING=3,SIGNALING_SDK_VERSION="1.3.0",SIGNALING_SDK_VERSION_INT=10103e5,Signal_=function(z){function q(ee){var te,ie,ne;for(ne=ee.length;ne;ne--)te=_Mathfloor(Math.random()*ne),ie=ee[ne-1],ee[ne-1]=ee[te],ee[te]=ie}function J(ee,te){var ie=new XMLHttpRequest;ie.open("POST",ee,!0),ie.setRequestHeader("Content-type","application/json; charset=utf-8"),ie.send(JSON.stringify(te))}function Y(ee,te,ie){var ne=ee.split(te,ie),se=0;for(var ae in ne)se+=te.length+ne[ae].length;return ne.push(ee.substr(se)),ne}this.getSDKVersion=function(){return SIGNALING_SDK_VERSION},this.getSDKVersion_int=function(){return SIGNALING_SDK_VERSION_INT},this.lbs_url1=["https://lbs-1-sig.agora.io","https://lbs-2-sig.agora.io"],this.lbs_url2=["https://lbs-3-sig.agora.io","https://lbs-4-sig.agora.io"],this.rp_url="http:///wsrp.sig.agora.io:8080/",this.vid=z,this.appid=z;var X=this;X.server_urls=[],X.setup_debugging=function(ee,te){if("ap"===ee)X.server_urls.push([te,8001]),X.debugging=!0;else{if("env"!==ee)return;"lbs100"===te&&(X.lbs_url1=["https://lbs100-1-sig.agora.io","https://lbs100-2-sig.agora.io"],X.lbs_url2=["https://lbs100-3-sig.agora.io","https://lbs100-4-sig.agora.io"])}};var Z=function(ee,te){this.onLoginSuccess="",this.onLoginFailed="",this.onLogout="",this.onInviteReceived="",this.onMessageInstantReceive="",this.account=ee,this.config_msg_set=0,this.config_inst_msg_with_msgid=0,this.debugging=X.debugging,this.m_msgid=0,this.state=LOGIN_STATE_LOGINING,this.line="",this.uid=0,this.dbg=!1,this.alive_conn=2;var ie=this;ie.lbs_state="requesting";var ne=X.server_urls.slice();q(ne),ie.idx=0,this.login_start_time=null,this.login_end_time=null,this.lbs_start_time=null,this.lbs_end_time=null,this.ap_start_time=null,this.ap_end_time=null,ie.browser=null;try{ie.browser=navigator.userAgent}catch(de){console.log("This browser does not support navigator.userAgent")}ie.login_data={event:"login",now:"",time:"",duration:"",key:"",seq:"",result:"",account:"",browser:ie.browser,sdk_version:X.getSDKVersion_int(),rmc:"",rmt:"",h1i1:"",h1t1:"",i2:"",i3:"",i3_0:"",i3_0_ip:"",i3_0_port:"",i3_1_ip:"",step:"",t2:"",t4:""},ie.v3_msg_set=new Map,setTimeout(function(){var de=Date.now();for(var ce of ie.v3_msg_set.keys())if(ie.v3_msg_set[ce]){if(!(3e5<de-ie.v3_msg_set[ce]))break;ie.v3_msg_set.delete(ce)}},2e3),ie.socket=null;var se=function(){if(ie.dbg){var de=[];for(var ce in arguments)de.push(arguments[ce]);console.log.apply(null,["Agora sig dbg :"].concat(de))}},ae=function(de){se("Updating the session state to "+de),ie.state=de};ie.logout=function(){ie.state===LOGIN_STATE_LOGINED&&ie.onLogout?ie.call2("user_logout",{line:ie.line},function(){ie.fire_logout(101),ie.socket.close()}):ie.state===LOGIN_STATE_LOGINING&&(ae(LOGIN_STATE_NOT_LOGIN),ie.fire_logout(101))},ie.fire_login_failed=function(de){try{ie.state===LOGIN_STATE_LOGINING&&ie.onLoginFailed&&ie.onLoginFailed(de)}catch(ce){console.error(ce)}finally{ae(LOGIN_STATE_NOT_LOGIN)}},ie.fire_logout=function(de){de||(de=0);try{ie.state===LOGIN_STATE_LOGINED&&ie.onLogout&&ie.onLogout(de)}catch(ce){console.error(ce)}finally{ae(LOGIN_STATE_NOT_LOGIN)}},ie.getStatus=function(){return ie.state};var oe=function(de,ce,le){"requesting"==ie.lbs_state&&function(pe,ue,me){var ge=new XMLHttpRequest,_e=!1,fe=setTimeout(function(){_e=!0,ge.abort(),me("timeout","")},ue);ge.open("GET",pe),ge.onreadystatechange=function(){4===ge.readyState&&(_e||(clearTimeout(fe),200===ge.status&&me("",ge.responseText)))},ge.send(null)}(ce[le]+"/getaddr?vid="+z,5e3,function(pe,ue){if(pe)0<de-1?oe(de-1,ce,(le+1)%ce.length):ie.fire_login_failed(201);else{if("requesting"!=ie.lbs_state)return;ie.lbs_state="completed",ne=JSON.parse(ue).web,re(),re()}})},re=function(){if(ie.state===LOGIN_STATE_LOGINING)var de=new function(){var ue="wss://"+(pe=ne[ie.idx])[0].replace(/\./g,"-")+"-sig-web.agora.io:"+(pe[1]+1)+"/",pe;console.log(ue),ie.idx=(ie.idx+1)%ne.length;var me=new WebSocket(ue);me.state="CONNECTING",setTimeout(function(){me.readyState!==me.CONNECTING||me.close()},6e3),me.onopen=function(){if(ie.state===LOGIN_STATE_NOT_LOGIN)me.close();else if(ie.state===LOGIN_STATE_LOGINING&&null===ie.socket)for(var ve in ie.socket=de,me.state="OPEN",se("on conn open"),ie.go_login(),fe)me.send(JSON.stringify(fe[ve]));else me.close()},me.onclose=function(){"OPEN"===me.state&&ie.state===LOGIN_STATE_LOGINED?(_e("_close",""),se("on conn close")):ie.state===LOGIN_STATE_LOGINING?2===ie.alive_conn?ie.alive_conn-=1:1===ie.alive_conn&&ie.onLoginFailed&&ie.fire_login_failed(201):"CONNECTING"===me.state&&re()},me.onmessage=function(he){var ve=he.data;se("Received message ",ve);var Se=JSON.parse(ve);"close"===Se[0]&&ie.state===LOGIN_STATE_LOGINING?ie.onLoginFailed&&ie.fire_login_failed(201):_e(Se[0],Se[1])},me.onerror=function(he){me.state="CLOSED",ie.idx<ne.length&&he.target.readyState===he.target.CLOSED?re():(se("on conn error"),ie.state===LOGIN_STATE_LOGINED&&ie.socket===de?ie.fire_logout(102):ie.state===LOGIN_STATE_LOGINING&&ie.socket==de&&ie.fire_login_failed(201))};var ge={},_e=function(he,ve){he in ge&&ge[he](ve)},fe=[];this.on=function(he,ve){ge[he]=ve},this.emit=function(he,ve){0===me.readyState?fe.push([he,ve]):(se("Sending ",[he,ve]),me.send(JSON.stringify([he,ve])))},this.close=function(){me.close()}};var ce=0,le=function(){setTimeout(function(){ie.state==LOGIN_STATE_LOGINED&&(se("send ping",++ce),ie.socket.emit("ping",ce),le())},1e4)};ie.go_login=function(){""===ie.line?(ie.socket.emit("login",{vid:z,account:ee,uid:0,token:te,device:"websdk",ip:""}),ie.login_data.account=ee,ie.login_data.vid=z,ie.login_data.key=te,ie.socket.on("login_ret",function(we){var Le=we[0],De=JSON.parse(we[1]);if(ie.login_data.duration=Date.now()-ie.login_data.time,se("login ret",Le,De),Le||"ok"!==De.result){""===Le&&(Le=De.reason),ie.login_data.now=Date.now(),ie.login_data.result="failed";try{if(ie.onLoginFailed){var ke="kick"===Le?207:"TokenErrorExpired"===Le?204:Le.startsWith("TokenError")?206:"wrong account"===Le?209:201;ie.fire_login_failed(ke)}}catch(Me){console.error(Me)}finally{J(X.rp_url,ie.login_data)}}else{ie.config_msg_set=De.config_msg_set||0,ie.config_inst_msg_with_msgid=De.config_inst_msg_with_msgid||0,ie.uid=De.uid,ie.line=De.line,ae(LOGIN_STATE_LOGINED),se("send ping",++ce),ie.socket.emit("ping",ce),le(),Oe();try{ie.login_data.now=Date.now(),ie.login_data.result="success",ie.onLoginSuccess&&ie.onLoginSuccess(ie.uid)}catch(Me){console.error(Me)}finally{J(X.rp_url,ie.login_data),Ae()}}})):ie.socket.emit("line_login",{line:ie.line});var pe=0,ue={},me={};ie.call2=function(we,Le,De){ue[++pe]=[we,Le,De],se("call ",[we,pe,Le]),ie.socket.emit("call2",[we,pe,Le])},ie.socket.on("call2-ret",function(we){var Le=we[0],De=we[1],ke=we[2];if(Le in ue){var Me=ue[Le][2];if(""===De)try{"ok"!=(ke=JSON.parse(ke)).result&&(De=ke.data.result)}catch(xe){De="wrong resp:"+ke}Me&&Me(De,ke)}});var _e=function(we){return""===we},fe=function(we){if(we.startsWith("msg-v2 ")){if(7===(Le=Y(we," ",6)).length)return[Le[1],Le[4],Le[6]];}else if(we.startsWith("msg-v3 ")){var Le;if(8===(Le=Y(we," ",7)).length)return ie.v3_msg_set.get(Le[1])?null:(ie.v3_msg_set.set(Le[1],Date.now()),[Le[2],Le[5],Le[7]])}return null},ge;ie.socket.on("pong",function(){se("recv pong")}),ie.socket.on("close",function(){ie.fire_logout(102),ie.socket.close()}),ie.socket.on("_close",function(){ie.fire_logout(102)});var he=function(we){if(we){var Le=we,De=Le[0],ke=Le[1],Me=Le[2];if("instant"===ke)try{ie.onMessageInstantReceive&&ie.onMessageInstantReceive(De,0,Me)}catch(Be){console.error(Be)}if(ke.startsWith("voip_")){var Pe=JSON.parse(Me),Ve=Pe.channel,Fe=Pe.peer,Ue=Pe.extra,xe;if("voip_invite"===ke)xe=new Ne(Ve,Fe,Ue),ie.call2("voip_invite_ack",{line:ie.line,channelName:Ve,peer:Fe,extra:""});else if(!(xe=me[Ve+Fe]))return;if("voip_invite"===ke)try{ie.onInviteReceived&&ie.onInviteReceived(xe)}catch(Be){console.error(Be)}if("voip_invite_ack"===ke)try{xe.onInviteReceivedByPeer&&xe.onInviteReceivedByPeer(Ue)}catch(Be){console.error(Be)}if("voip_invite_accept"===ke)try{xe.onInviteAcceptedByPeer&&xe.onInviteAcceptedByPeer(Ue)}catch(Be){console.error(Be)}if("voip_invite_refuse"===ke)try{xe.onInviteRefusedByPeer&&xe.onInviteRefusedByPeer(Ue)}catch(Be){console.error(Be)}if("voip_invite_failed"===ke)try{xe.onInviteFailed&&xe.onInviteFailed(Ue)}catch(Be){console.error(Be)}if("voip_invite_bye"===ke)try{xe.onInviteEndByPeer&&xe.onInviteEndByPeer(Ue)}catch(Be){console.error(Be)}if("voip_invite_msg"===ke)try{xe.onInviteMsg&&xe.onInviteMsg(Ue)}catch(Be){console.error(Be)}}}},ve=function(){return Date.now()},Se=0,Ee=0,be=0,ye=0,Re=!1,Ie=[],Ce=0,Ae=function(){Re||(Re=!0,Ce=0,0===ie.config_msg_set?ie.call2("user_getmsg",{line:ie.line,ver_clear:Se,max:30},function(we,Le){if(""===we){var De=Le,ke=Se;for(var Me in be=parseInt(De.ver_clear),Se=_Mathmax(be,ke),De.msgs){var xe=De.msgs[Me][0],Pe=De.msgs[Me][1];xe>=Se+1&&(he(fe(Pe)),Se=xe)}(30===De.msgs.length||Se<Ee)&&Ae(),ve()}Re=!1,ye=ve()}):1===ie.config_msg_set&&ie.call2("user_getmsg2",{line:ie.line,clear_msgs:Ie,max:30},function(we,Le){if(""===we){for(var De in Ie=[],Le.msgs){Le.msgs[De][0];var ke=Le.msgs[De][1];he(fe(ke))}30<=Le.msgs.length&&Ae(),ve()}Re=!1,ye=ve()}))},Te=function(){0===ie.config_msg_set?ye=ve():1===ie.config_msg_set&&0==Ce&&(Ce=ve()+500)},Oe=function(){setTimeout(function(){if(ie.state!==LOGIN_STATE_NOT_LOGIN){if(ie.state===LOGIN_STATE_LOGINED){var we=ve();0===ie.config_msg_set?be<Se&&1e3<we-ye?Ae():6e4<=we-ye&&Ae():1===ie.config_msg_set&&0<Ie.length&&we>Ce&&0<Ce&&Ae()}Oe()}},100)};ie.socket.on("notify",function(we){se("recv notify ",we),"string"==typeof we&&(we=(we=Y(we," ",2)).slice(1));var Le=we[0];if("channel2"===Le){var De=we[1],ke=we[2];if(0===ie.config_msg_set&&0!==ge.m_channel_msgid&&ge.m_channel_msgid+1>ke)return void se("ignore channel msg",De,ke,ge.m_channel_msgid);ge.m_channel_msgid=ke;var Me=fe(we[3]);if(Me){Me[0];var xe=Me[1],Pe=Me[2],Ve=JSON.parse(Pe);if("channel_msg"===xe)try{ge.onMessageChannelReceive&&ge.onMessageChannelReceive(Ve.account,Ve.uid,Ve.msg)}catch(je){console.error(je)}if("channel_user_join"===xe)try{ge.onChannelUserJoined&&ge.onChannelUserJoined(Ve.account,Ve.uid)}catch(je){console.error(je)}if("channel_user_leave"===xe)try{ge.onChannelUserLeaved&&ge.onChannelUserLeaved(Ve.account,Ve.uid)}catch(je){console.error(je)}if("channel_attr_update"===xe)try{ge.onChannelAttrUpdated&&ge.onChannelAttrUpdated(Ve.name,Ve.value,Ve.type)}catch(je){console.error(je)}}}if("msg"===Le&&(Ee=we[1],Ae()),"recvmsg"===Le){var Fe=JSON.parse(we[1]),Ue=Fe[0],Be=Fe[1];Ue===Se+1?(he(fe(Be)),Se=Ue,Te()):(Ee=Ue,Ae())}"recvmsg_by_msgid"===Le&&(ke=Y(we[1]," ",7)[1],Ie.push(ke),he(fe(we[1])),Te())}),ie.messageInstantSend=function(we,Le,De){var ke={line:ie.line,peer:we,flag:"v1:E:3600",t:"instant",content:Le};if(1===ie.config_inst_msg_with_msgid){var Me=null;"string"==typeof Le&&(Me=JSON.parse(Le).msgid),ke.messageID=Me||ve()%1e6+ie.m_msgid++%1e6}ie.call2("user_sendmsg",ke,function(xe){De&&De(!_e(xe))})},ie.invoke=function(we,Le,De){if(we.startsWith("io.agora.signal.")){var ke=we.split(".")[3];Le.line=ie.line,ie.call2(ke,Le,function(Me,xe){De&&De(Me,xe)})}};var Ne=function(we,Le,De){this.onInviteReceivedByPeer="",this.onInviteAcceptedByPeer="",this.onInviteRefusedByPeer="",this.onInviteFailed="",this.onInviteEndByPeer="",this.onInviteEndByMyself="",this.onInviteMsg="";var ke=this;this.channelName=we,this.peer=Le,this.extra=De,me[we+Le]=ke,this.channelInviteUser2=function(){De=De||"",ie.call2("voip_invite",{line:ie.line,channelName:we,peer:Le,extra:De},function(Me){if(_e(Me));else try{ke.onInviteFailed(Me)}catch(Pe){console.error(Pe)}})},this.channelInviteAccept=function(Me){Me=Me||"",ie.call2("voip_invite_accept",{line:ie.line,channelName:we,peer:Le,extra:Me})},this.channelInviteRefuse=function(Me){Me=Me||"",ie.call2("voip_invite_refuse",{line:ie.line,channelName:we,peer:Le,extra:Me})},this.channelInviteDTMF=function(Me){ie.call2("voip_invite_msg",{line:ie.line,channelName:we,peer:Le,extra:JSON.stringify({msgtype:"dtmf",msgdata:Me})})},this.channelInviteEnd=function(Me){Me=Me||"",ie.call2("voip_invite_bye",{line:ie.line,channelName:we,peer:Le,extra:Me});try{ke.onInviteEndByMyself&&ke.onInviteEndByMyself("")}catch(xe){console.error(xe)}}};ie.channelInviteUser2=function(we,Le,De){var ke=new Ne(we,Le,De);return ke.channelInviteUser2(),ke},ie.channelJoin=function(we){return ie.state==LOGIN_STATE_LOGINED?(ge=new function(){this.onChannelJoined="",this.onChannelJoinFailed="",this.onChannelLeaved="",this.onChannelUserList="",this.onChannelUserJoined="",this.onChannelUserLeaved="",this.onChannelUserList="",this.onChannelAttrUpdated="",this.onMessageChannelReceive="",this.name=we,this.state="joining",this.m_channel_msgid=0,this.messageChannelSend=function(Le,De){var ke={line:ie.line,name:we,msg:Le};if(1===ie.config_inst_msg_with_msgid){var Me=null;"string"==typeof Le&&(Me=JSON.parse(Le).msgid),ke.msgID=Me||ve()%1e6+ie.m_msgid++%1e6}ie.call2("channel_sendmsg",ke,function(){De&&De()})},this.channelLeave=function(Le){ie.call2("channel_leave",{line:ie.line,name:we},function(){if(ge.state="leaved",Le)Le();else try{ge.onChannelLeaved&&ge.onChannelLeaved(0)}catch(Me){console.error(Me)}})},this.channelSetAttr=function(Le,De,ke){ie.call2("channel_set_attr",{line:ie.line,channel:we,name:Le,value:De},function(){ke&&ke()})},this.channelDelAttr=function(Le,De){ie.call2("channel_del_attr",{line:ie.line,channel:we,name:Le},function(){De&&De()})},this.channelClearAttr=function(Le){ie.call2("channel_clear_attr",{line:ie.line,channel:we},function(){Le&&Le()})}},ie.call2("channel_join",{line:ie.line,name:we},function(Le,De){if(""===Le){ge.state="joined";try{ge.onChannelJoined&&ge.onChannelJoined()}catch(xe){console.error(xe)}var ke=De;try{ge.onChannelUserList&&ge.onChannelUserList(ke.list)}catch(xe){console.error(xe)}try{if(ge.onChannelAttrUpdated)for(var Me in ke.attrs)ge.onChannelAttrUpdated(Me,ke.attrs[Me],"update")}catch(xe){console.error(xe)}}else try{ge.onChannelJoinFailed&&ge.onChannelJoinFailed(Le)}catch(xe){console.error(xe)}}),ge):void se("You should log in first.")}}};ie.socket=null,ie.debugging?(ie.lbs_state="completed",ie.login_data.time=Date.now(),re()):(q(X.lbs_url1),q(X.lbs_url2),oe(2,X.lbs_url1,0),oe(2,X.lbs_url2,0))};this.login=function(ee,te){return new Z(ee,te)}},Signal=function(z){return new Signal_(z)}},{}],4:[function(H,W){H("../const.js");const q=H("./eventer"),J=H("./context"),Y=H("./serialize");class X extends q{constructor(){super(),this.$userInfo=null,this.$gifts=[],this.__reset()}__reset(){this.$user_list=new Y,this.$user_unmuted={},this.$racing=!1,this.$giftopen=!0}destroy(){this.__reset()}set userinfo(Z){J.storage.store("USER_INFO",Z),this.$userInfo=Z}get userinfo(){return this.$userInfo||(this.$userInfo=J.storage.get("USER_INFO")),this.$userInfo}isMaster(Z){Z||(Z=this.userinfo.id);for(let ee=0,te=J.course.teachers.length,ie;ee<te;ee++)if(ie=J.course.teachers[ee],ie.id==Z)return!0}isChairMaster(Z){return Z||(Z=this.$userInfo.id),J.course.teacher_id==Z}isSubMaster(Z){return Z||(Z=this.$userInfo.id),this.isMaster(Z)&&!this.isChairMaster(Z)}set courses(Z){this.$courses=Z}get courses(){return this.$courses}getUser(Z){return Z==this.$userInfo?this.$userInfo:this.$user_list.get(Z)}addUser(Z){this.$user_list.merge([Z])}removeUser(Z){this.$user_list.remove(Z)}get users(){return this.$user_list.data()}setUnMuted(Z){this.$user_unmuted[Z]=!0}setMuted(Z){this.$user_unmuted[Z]=!1}isMuted(Z){return!this.$user_unmuted[Z]}set racing(Z){this.$racing=Z}get racing(){return this.$racing}set giftopen(Z){this.$giftopen=Z}get giftopen(){return!!this.isMaster()||this.$giftopen}set gifts(Z){this.$gifts=Z}get gifts(){return this.$gifts}}W.exports=X},{"../const.js":1,"./context":8,"./eventer":9,"./serialize":15}],5:[function(H,W){W.exports=class{constructor(q){if(console.log("namespace...",q),this.$namespace=q,this.$data=localStorage.getItem(this.$namespace),this.$data)try{this.$data=JSON.parse(this.$data)}catch(J){this.$data={},localStorage.removeItem(this.$namespace)}else this.$data={}}get(q){return this.$data[q]}store(q,J){console.log("store...",q,this.$data),this.$data[q]=J,localStorage.setItem(this.$namespace,JSON.stringify(this.$data))}clear(){localStorage.removeItem(this.$namespace)}}},{}],6:[function(H,W){let z=H("../const.js");const q=H("./network"),J=H("./DataManager").DataManager,Y=H("./context");let X=H("./calendar");const Z=H("./room"),ee=H("./signal"),{remote:te}=$require("electron");W.exports=class{constructor(){this.data={},this.$calendar=new X(this),this.__bind(),q.token?this.content():this.login()}__resize(){}__show_gift_layer(){$(".gift-layer").show(),setTimeout(()=>{$(".gift-layer").addClass("show")},100)}__hide_gift_layer(){$(".gift-layer").removeClass("show"),setTimeout(()=>{$(".gift-layer").hide()},300)}__send_gift(){this.$gift_data&&(console.log("send gift",this.$gift_data),q.sendGift({channel_id:Y.course.channel_id,to_id:this.$gift_data.to,gift_id:this.$gift_data.gift.id}).then((ne)=>{let se=ne.total,ae=Y.dmg.getUser(this.$gift_data.to);ee.send({type:"gift",from:Y.dmg.userinfo.id,to:"all",message:{uid:this.$gift_data.to,gift:this.$gift_data.gift,total:se,from_username:Y.dmg.userinfo.child_name,to_username:ae.child_name}})}))}__bind(){$(window).on("resize",()=>{this.__resize()}),this.__resize(),$("body").on("click",".login-btn",()=>{let ne=$("input[name=mobile]").val(),se=$("input[name=password]").val();return ne&&se?void(Y.loading.show("\u6B63\u5728\u767B\u5F55..."),q.login({mobile:ne,password:se}).then((ae)=>{q.token=ae.token,q.sigtoken=ae.signaling_token,Y.dmg.userinfo=ae.user,this.content(),Y.loading.hide()},()=>{Y.loading.hide()}).done()):void alert("\u8BF7\u8F93\u5165\u624B\u673A\u53F7\u6216\u5BC6\u7801\uFF01")}),$("body").on("click",".calendar-page .start-btn",(ne)=>{let se=$(ne.currentTarget).attr("data-index"),ae=Y.dmg.courses[se];$(".enter-layer .enter-time").text(ae.start_time),$(".enter-layer").show(),setTimeout(()=>{$(".enter-layer").addClass("show")},100),Y.course=ae}),$("body").on("click",".mask .close-btn,.mask .cancel-btn",(ne)=>{let se=$(ne.currentTarget).parents(".mask");se.removeClass("show"),setTimeout(()=>{se.hide()},300)}),$("body").on("click",".enter-btn",()=>{$(".mask").removeClass("show"),setTimeout(()=>{$(".mask").hide()},300),this.course()}),$("body").on("click",".switch",(ne)=>{let se=$(ne.currentTarget).parents(".buttons");se.toggleClass("open")}),$("body").on("click",".back-btn",()=>{$(".back-layer").show(),setTimeout(()=>{$(".back-layer").addClass("show")},100)}),$("body").on("click",".ok-btn",()=>{$(".back-layer").removeClass("show"),setTimeout(()=>{$(".back-layer").hide()},300),this.leaveCourse()}),$("body").on("click",".course-close",()=>{$(".exit-layer").show(),setTimeout(()=>{$(".exit-layer").addClass("show")},100)}),$("body").on("click",".exit-btn",()=>{$(".exit-layer").removeClass("show"),setTimeout(()=>{$(".exit-layer").hide()},300),q.closeRoom(Y.course.channel_id).then((ne)=>{ne.status&&ee.send({type:"closeroom",from:Y.dmg.userinfo.id,to:"all"})})}),$("body").on("click",".prev-page",()=>{Y.session.send_message("appprevpage")}),$("body").on("click",".next-page",()=>{Y.session.send_message("appnextpage")}),$("body").on("click",".clear",()=>{Y.session.send_message("appclearall")}),$("body").on("click",".prev-step",()=>{Y.session.send_message("appprevstep")}),$("body").on("click",".next-step",()=>{Y.session.send_message("appnextstep")}),$("body").on("click",".handsup",(ne)=>{$(ne.currentTarget).hasClass("disabled")?Y.session.send_message(z.OPEN_RACE):Y.session.send_message(z.CLOSE_RACE)}),$("body").on("click",".sound",(ne)=>{ne.stopPropagation();let se=$(ne.currentTarget),ae=se.attr("data-id");se.hasClass("mute")?Y.session.send_message(z.OPEN_MIC,{uid:ae-0}):Y.session.send_message(z.CLOSE_MIC,{uid:ae-0})}),$("body").on("click",".gift",(ne)=>{$(ne.currentTarget).hasClass("disabled")?Y.session.send_message(z.OPEN_GIFT):Y.session.send_message(z.CLOSE_GIFT)}),$("body").on("click",".master-head",()=>{if(!Y.dmg.isMaster())if(Y.dmg.giftopen){let se=$("#master-video").attr("data-id");se&&(this.$gift_data={to:se},this.__show_gift_layer())}else alert("\u73B0\u5728\u8FD8\u4E0D\u80FD\u9001\u793C\u7269\u54E6~")}),$("body").on("click",".students .cell",(ne)=>{let se=$(ne.currentTarget).attr("data-id");se&&se!=Y.dmg.userinfo.id&&(Y.dmg.isMaster()||Y.dmg.giftopen?(this.$gift_data={to:se},this.__show_gift_layer()):alert("\u73B0\u5728\u8FD8\u4E0D\u80FD\u9001\u793C\u7269\u54E6~"))}),$("body").on("click",".gift-layer .gift-item",(ne)=>{let se=$(ne.currentTarget).attr("data-index");return se&&this.$gift_data?void(this.$gift_data.gift=Y.dmg.gifts[se],this.__hide_gift_layer(),this.__send_gift()):void this.__hide_gift_layer()}),$("body").on("click",".student-page .start-btn",(ne)=>{let se=$(ne.currentTarget);se.hasClass("disabled")?alert("\u6559\u5BA4\u8FD8\u6CA1\u5F00\u95E8\uFF0C\u7B49\u4F1A\u518D\u8FDB\u8BD5\u8BD5"):(Y.course=Y.dmg.courses[0],this.course())}),$("body").on("click",".logout-btn",()=>{Y.storage.clear(),te.getCurrentWindow().reload()}),Z.on("NEW_STREAM",(ne)=>{let se=ne.getId(),ae=Y.dmg.isChairMaster(se),oe=Y.dmg.isSubMaster(se);if(!oe)if(ae)$("#master-video").attr("data-id",se),ne.play("master-video");else{let re=$(`#students_${se}`);if(0===re.length){let de=Y.dmg.getUser(se)||{child_name:"-"},ce=0;for(let ge=0,_e=Y.room.gifts.length,fe;ge<_e;ge++)if(fe=Y.room.gifts[ge],fe.id==se){ce=fe.total;break}let le=Y.dmg.isMuted(se),pe=Y.dmg.racing,ue=$("#students .idle"),me=$(`<div id="students_${se}" class="cell" data-id="${se}">
							<div class="name">${de.child_name}</div>
							<div class="hand" ${pe?"":"style=\"display:none\""}></div>
							<div class="video" id="students_${se}_video"></div>
							<div class="bar">
								<div class="sound ${le?"mute":""}" data-id="${se}"></div>
								<div class="ph"></div>
								<div class="gift">${ce}</div>
							</div>
						</div>`);0==ue.length?$("#students").append(me):$(ue[0]).replaceWith(me)}ne.play("students_"+ne.getId()+"_video")}}),Z.on("REMOVE_STREAM",(ne)=>{$("#students_"+ne.getId()).remove();let se=$("#students .cell");se.length<z.CELL_COUNT&&$("#students").append(`<div class="cell idle"></div>`)}),Z.on("LEAVE_ROOM",()=>{Y.session.destroy()}),ee.on("CHANNEL_NEW_USER",(ne)=>{Y.session.send_message(z.MEMBER_ADD,{},{userinfos:[ne]}),console.log("channel new user...",ne);let se=$("#students_"+ne.id);0<se.length&&$(".name",se).text(ne.child_name)}),ee.on("CHANNEL_USER_LEAVE",(ne)=>{Y.session.send_message(z.MEMBER_LEAVE,{},{userinfos:[ne]})}),ee.on("NEW_MESSAGE",(ne)=>{console.log("receive new signal message",ne),this.__on_signal_message(ne)}),Y.session.on("NEW_MESSAGE",(ne)=>{if(console.log("receive new session message",ne),"app"==ne.to){ne.message;switch(ne.type){case z.JS_READY:break;case"starttest":break;case z.OPEN_MIC:case z.CLOSE_MIC:case z.OPEN_RACE:case z.CLOSE_RACE:case z.OPEN_GIFT:case z.CLOSE_GIFT:this.__on_signal_message(ne);}}else"all"==ne.to&&ee.send(ne)})}__on_signal_message(ne){let se=ne.message;switch(ne.type){case"closeroom":Y.dmg.isMaster()?this.leaveCourse():(alert("\u672C\u6B21\u8BFE\u7A0B\u5DF2\u7ED3\u675F\uFF0C\u5C0F\u670B\u53CB\u8BF7\u5230\u201C\u5927\u8BED\u6587\u201D\u5C0F\u7A0B\u5E8F\u5B8C\u6210\u8BFE\u540E\u4F5C\u4E1A"),this.leaveCourse());break;case z.OPEN_RACE:$("#students .hand").text("").show(),$(".cell.handsup").removeClass("disabled"),Y.dmg.racing=!0,Y.session.send_message(null,null,ne);break;case z.CLOSE_RACE:$("#students .hand").text("").hide(),$(".cell.handsup").addClass("disabled"),Y.dmg.racing=!1,Y.session.send_message(null,null,ne);break;case z.OPEN_MIC:se.uid&&$("#students_"+se.uid+" .sound").removeClass("mute"),Y.dmg.setUnMuted(se.uid),Z.stream_audio(se.uid);break;case z.CLOSE_MIC:se.uid&&$("#students_"+se.uid+" .sound").addClass("mute"),Y.dmg.setMuted(se.uid),Z.stream_audio(se.uid);break;case z.OPEN_GIFT:$(".cell.gift").removeClass("disabled"),Y.dmg.giftopen=!0;break;case z.CLOSE_GIFT:$(".cell.gift").addClass("disabled"),Y.dmg.giftopen=!1;break;case"racerank":se.uid&&$("#students_"+se.uid+" .hand").text(se.rank).show();break;case"starttest":case"stoptest":break;case"gift":let ae=se.total;Y.room.gifts.forEach((oe)=>{oe.id==se.uid&&(oe.total=ae)}),$("#students_"+se.uid+" .gift").text(ae);default:Y.session.send_message(null,null,ne);}}login(){$(".page").hide(),$(".login-page").show()}strToDate(ne){let se=ne.split(/[-: ]/);return new Date(se[0],se[1]-1,se[2],se[3],se[4],se[5])}content(){if($(".page").hide(),2==Y.dmg.userinfo.dentity){let ne=this.data.calendar_data.choosed_txt;q.lessons(`${ne.year}-${ne.month}`).then((se)=>{let ae=se.dates;this.$calendar.setHighlighted(ae)}).done(),this.__get_courses(),$(".calendar-page,.course-page").show()}else $(".student-page,.course-page").show(),q.lessonsByDate().then((ne)=>{let se=ne.rooms[0];if(se){let ae=this.strToDate(se.start_time),oe=ae.getTime()-new Date().getTime();if(se.left=oe,300000>=oe&&(se.can_enter=!0),0<oe){let re=oe/1e3/60/60/24>>0;oe-=24*(60*(60*(1e3*re)));let de=oe/1e3/60/60>>0,ce=(oe-1e3*(60*(60*de)))/1e3/60>>0;se.days=re,se.hours=de,se.minutes=ce}}Y.render("student-tmpl",{room:se}),Y.dmg.courses=ne.rooms});ee.init()}course(){if(Y.course){$("#master-video").html(""),$("#students").html("");let ne=[];for(let se=0;se<z.CELL_COUNT;se++)ne.push(`<div class="cell idle"></div>`);$("#students").html(ne.join("")),$(".page").addClass("next"),q.getGiftsList().then((se)=>{Y.dmg.gifts=se.gifts,Y.render("gifts-tmpl",se)}),q.getRoomInfo(Y.course.channel_id).then((se)=>{Y.room=se,Z.start(),ee.join(),Y.session.init("#course-content"),Y.dmg.isMaster()?$(".sidebar .buttons").show():$(".sidebar .buttons").hide();let ae=[];Y.course.teachers.forEach((re)=>{ae.push(re.id)});let oe=[Y.dmg.userinfo];oe.concat(Y.dmg.users),Y.session.send_message(z.INIT_ROOM,{channel_id:Y.course.channel_id,token:q.token},{master_ids:ae,userinfos:oe})})}}leaveCourse(){$(".page").removeClass("next"),Z.leave(),ee.leave(),Y.dmg.destroy(),setTimeout(()=>{te.getCurrentWindow().reload()},500)}__get_courses(){let ne=this.data.calendar_data.choosed_txt;q.lessonsByDate(`${ne.year}-${ne.month}-${ne.day}`).then((se)=>{Y.render("courses-tmpl",{courses:se.rooms}),Y.dmg.courses=se.rooms})}onDateChanged(){this.__get_courses()}}},{"../const.js":1,"./DataManager":4,"./calendar":7,"./context":8,"./network":13,"./room":14,"./signal":17}],7:[function(H,W){W.exports=class{constructor(q){this.$inst=q,this.$now=new Date,this.$week_txt=["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"],this.$data=q.data.calendar_data||{},this.__init(),this.__calculate_month()}__fn_(q){return q=q.toString(),q[1]?q:"0"+q}__is_sameday(q,J){return q.year==J.year&&q.month==J.month&&q.day==J.day}__is_small_eq_than(q,J){return q=new Date(q.year,q.month-1,q.day),J=new Date(J.year,J.month-1,J.day),0<=q.getTime()-J.getTime()}__date_to_obj(q){return{year:q.getFullYear(),month:q.getMonth()+1,day:q.getDate(),week:q.getDay()}}__is_disabled(q){for(let J=0,Y=this.$data.disabled.length;J<Y;J++)if(this.__is_sameday(this.$data.disabled[J],q))return!0}__is_highlighted(q){for(let J=0,Y=this.$data.highlighted.length;J<Y;J++)if(this.__is_sameday(this.$data.highlighted[J],q))return!0}__init(){this.$data.today=this.__date_to_obj(this.$now),this.$data.disabled||(this.$data.disabled=[]),this.$data.highlighted||(this.$data.highlighted=[]),this.$data.cursor||(this.$data.cursor=this.$data.today),this.$data.validDays||(this.$data.validDays=365),this.__bind()}__bind(){$("body").on("click",(q)=>{let J=$(q.target),Y=J.attr("bindtap");if(!Y){let X=["onPrevMonth","onNextMonth","onPickDate"];for(let Z=0,ee=X.length;Z<ee;Z++){let te=X[Z],ie=J.parents(`[bindtap=${te}]`);if(0<ie.length){Y=te;break}}}if("onPrevMonth"==Y)this.prevMonth();else if("onNextMonth"==Y)this.nextMonth();else if("onPickDate"==Y){let X=J.attr("data-index");this.setChoosed(this.$inst.data.calendar_data.days[X]),this.$inst.onDateChanged&&this.$inst.onDateChanged()}}),$("body").on("touchstart",(q)=>{let J=$(q.currentTarget),Y=J.attr("bindtouchstart");if(!Y){let X=J.parents("[bindtouchstart=onCalendarTouch]");0<X.length&&(J=X,Y="onCalendarTouch")}"onCalendarTouch"==Y&&(q.preventDefault(),this.$touch_start_x=q.touches[0].pageX,this.$touch_moved=!1)}),$("body").on("touchmove",(q)=>{let J=$(q.currentTarget),Y=J.attr("bindtouchmove");if(!Y){let X=J.parents("[bindtouchmove=onCalendarTouch]");0<X.length&&(J=X,Y="onCalendarTouch")}"onCalendarTouch"==Y&&(q.preventDefault(),this.$touch_moved=!0,this.$touch_last_x=q.touches[0].pageX)}),$("body").on("touchend",(q)=>{let J=$(q.currentTarget),Y=J.attr("bindtouchend");if(!Y){let X=J.parents("[bindtouchend=onCalendarTouch]");0<X.length&&(J=X,Y="onCalendarTouch")}if("onCalendarTouch"==Y){q.preventDefault();let X=this.$touch_last_x;if(this.$touch_moved){let Z=X-this.$touch_start_x;30<Z?this.prevMonth():-30>Z&&this.nextMonth()}}})}__calculate_month(){this.$data.choosed&&this.__is_disabled(this.$data.choosed)&&(this.$data.choosed=null,this.$data.choosed_txt=null);let q=this.$data.cursor;q=this.__date_to_obj(new Date(q.year,q.month-1,1));let J=1-q.week,Y=28,X=q.month;for(;X==q.month;)Y++,X=new Date(q.year,q.month-1,Y).getMonth()+1;Y--;let Z=new Date(q.year,q.month-1,Y).getDay(),ee=Y+6-Z,te=[];for(let se=J;se<=ee;se++){let ae=this.__date_to_obj(new Date(q.year,q.month-1,se)),oe=this.__is_disabled(ae);oe||(this.$data.choosed?this.__is_sameday(ae,this.$data.choosed)&&(ae.choosed=!0):this.__is_sameday(ae,this.$data.today)&&(ae.choosed=!0,this.$data.choosed=ae),ae.highlighted=this.__is_highlighted(ae)),ae.disabled=oe,ae.month==q.month?te.push(ae):te.push({})}this.$data.days=te;let ie=[],ne=[];te.forEach((se,ae)=>{0==ae%7&&0!=ae&&(ie.push(ne),ne=[]),se.index=ae,ne.push(se)}),ie.push(ne),this.$data.rows=ie,this.render()}strToDate(q){let J=q.split(/[-: ]/);return J=J.concat([0,0,0,0,0,0]),new Date(J[0],J[1]-1,J[2],J[3],J[4],J[5])}setChoosed(q){this.$data.choosed=q,this.$data.days.forEach((J)=>{J.choosed&&(J.choosed=!1),this.__is_sameday(J,q)&&(J.choosed=!0)}),this.render()}nextMonth(){let q=this.$data.cursor;this.$data.cursor=this.__date_to_obj(new Date(q.year,q.month,1)),this.__calculate_month()}prevMonth(){let q=this.$data.cursor;this.$data.cursor=this.__date_to_obj(new Date(q.year,q.month-2,1)),this.__calculate_month()}setDisabled(q){let J=[];q.forEach((Y)=>{let X=this.__date_to_obj(this.strToDate(Y));J.push(X)}),this.$data.disabled=J,this.__calculate_month()}setHighlighted(q){let J=[];q.forEach((Y)=>{let X=this.__date_to_obj(this.strToDate(Y));J.push(X)}),this.$data.highlighted=J,this.__calculate_month()}render(){if(this.$data.choosed){let Z=this.$data.choosed;this.$data.choosed_txt={year:Z.year,month:this.__fn_(Z.month),day:this.__fn_(Z.day),week:this.$week_txt[Z.week]}}let q=$("#calendar-tmpl"),J=$.templates("#calendar-tmpl"),Y=J.render({calendar_data:this.$data});this.$inst.data.calendar_data=this.$data;let X=$("#calendar-box");0<X.length?X.replaceWith(Y):q.after(Y)}}},{}],8:[function(H,W){const z=H("./Storage"),{ipcRenderer:q}=$require("electron");class J{get dmg(){return this.$dmg}set dmg(Y){this.$dmg=Y}get loading(){return this.$loading}set loading(Y){this.$loading=Y}get course(){return this.$course}set course(Y){this.$course=Y}get room(){return this.$room}set room(Y){this.$room=Y}get session(){return this.$session}set session(Y){this.$session=Y}get storage(){return this.$storage||(this.$storage=new z("DYM")),this.$storage}set storage(Y){this.$storage=Y}get video_device_id(){return this.$video_device_id}set video_device_id(Y){this.$video_device_id=Y}get audio_device_id(){return this.$audio_device_id}set audio_device_id(Y){this.$audio_device_id=Y}render(Y,X){let Z=$("#"+Y),ee=$.templates("#"+Y),te=$(ee.render(X)),ie=$(`[tmplid=tmpl_${Y}]`);te.attr("tmplid","tmpl_"+Y),0<ie.length?ie.replaceWith(te):Z.after(te)}send_to_main(Y){console.log("send_to_main",q,Y),q.send(...Y)}}W.exports=new J},{"./Storage":5}],9:[function(H,W){W.exports=class{constructor(){this.eventSubscriptions={}}on(q,J){var Y=this.eventSubscriptions[q];"undefined"==typeof Y&&(Y=this.eventSubscriptions[q]=[]),Y.push(J)}off(q){delete this.eventSubscriptions[q]}trigger(q,J,Y){var X=this.eventSubscriptions[q],Z,ee;if("undefined"!=typeof X)for(J=J instanceof Array?J:[J],Y=Y||this,(Z=0,ee=X.length);Z<ee;Z+=1)X[Z].apply(Y,J)}}},{}],10:[function(H,W){let z=H("./jquery.tmpl.js"),q=H("q"),J=H("../const.js");const Y=H("./loading"),X=H("./network"),Z=H("./Viewer"),ee=H("./context"),te=H("./DataManager"),ie=H("./session");W.exports=new class{constructor(){this.$dmg=new te,ee.dmg=this.$dmg,this.$session=new ie,ee.session=this.$session,this.$viewer=new Z,this.$loading=new Y,ee.loading=this.$loading,this.__bind()}__bind(){}}},{"../const.js":1,"./DataManager":4,"./Viewer":6,"./context":8,"./jquery.tmpl.js":11,"./loading":12,"./network":13,"./session":16,q:20}],11:[function(H,W,K){(function(z,q){var J=q.jQuery;"object"==typeof K?W.exports=J?z(q,J):function(Y){if(Y&&!Y.fn)throw"Provide jQuery or null";return z(q,Y)}:"function"==typeof define&&define.amd?define(function(){return z(q)}):z(q,!1)})(function(z,q){"use strict";function J(Ft,Ut){return function(){var jt=this,$t=jt.base,Bt;return jt.base=Ft,Bt=Ut.apply(jt,arguments),jt.base=$t,Bt}}function Y(Ft,Ut){return Je(Ut)&&(Ut=J(Ft?Ft._d?Ft:J(ee,Ft):ee,Ut),Ut._d=1),Ut}function X(Ft,Ut){for(var Bt in Ut.props)Ct.test(Bt)&&(Ft[Bt]=Y(Ft[Bt],Ut.props[Bt]))}function Z(Ft){return Ft}function ee(){return""}function te(Ft){try{throw console.log("JsRender dbg breakpoint: "+Ft),"dbg breakpoint"}catch(Ut){}return this.base?this.baseApply(arguments):Ft}function ie(Ft){this.name=(q.link?"JsViews":"JsRender")+" Error",this.message=Ft||this.name}function ne(Ft,Ut){for(var Bt in Ut)Ft[Bt]=Ut[Bt];return Ft}function oe(){var Ft=this.get("item");return Ft?Ft.index:void 0}function re(){return this.index}function pe(Ft){var Ut=this,Bt=Ut.tagCtx,jt=Bt.view,$t=Bt.args;return Ft=Ft||Ut.convert,Ft=Ft&&(""+Ft===Ft?jt.getRsc("converters",Ft)||Ne("Unknown converter: '"+Ft+"'"):Ft),$t=$t.length||Bt.index?Ft?$t.slice():$t:[jt.data],Ft&&(Ft.depends&&(Ut.depends=tt.getDeps(Ut.depends,Ut,Ft.depends,Ft)),$t[0]=Ft.apply(Ut,$t)),$t}function ge(Ft,Ut,Bt,jt,$t,Ht,Wt,Gt){var Yt=this,Qt="array"===Ut,Kt,zt,Jt;Yt.content=Gt,Yt.views=Qt?[]:{},Yt.parent=Bt,Yt.type=Ut||"top",Yt.data=jt,Yt.tmpl=$t,Jt=Yt._={key:0,useKey:Qt?0:1,id:""+Tt++,onRender:Wt,bnds:{}},Yt.linked=!!Wt,Bt?(Kt=Bt.views,zt=Bt._,zt.useKey?(Kt[Jt.key="_"+zt.useKey++]=Yt,Yt.index=kt,Yt.getIndex=oe):Kt.length===(Jt.key=Yt.index=Ht)?Kt.push(Yt):Kt.splice(Ht,0,Yt),Yt.ctx=Ft||Bt.ctx):Yt.ctx=Ft}function _e(Ft){var Ut,Bt,jt,$t,Ht,Wt,Gt;for(Ut in Vt)if(Ht=Vt[Ut],(Wt=Ht.compile)&&(Bt=Ft[Ut+"s"]))for(jt in Bt)$t=Bt[jt]=Wt(jt,Bt[jt],Ft,0),$t._is=Ut,$t&&(Gt=tt.onStore[Ut])&&Gt(jt,$t,Wt)}function he(Ft){return this.base.apply(this,Ft)}function ve(Ft,Ut,Bt,jt){function $t(Kt){var zt,qt;if(""+Kt===Kt||0<Kt.nodeType&&(Ht=Kt)){if(!Ht)if(/^\.\/[^\\:*?"<>]*$/.test(Kt))(qt=Qe[Ft=Ft||Kt])?Kt=qt:Ht=document.getElementById(Kt);else if(q.fn&&!Ke.test(Kt))try{Ht=q(document).find(Kt)[0]}catch(Jt){}Ht&&(jt?Kt=Ht.innerHTML:(zt=Ht.getAttribute(Lt),zt?zt===Dt?q.fn&&(Kt=q.data(Ht)[Dt]):(Kt=Qe[zt],delete Qe[zt]):(Ft=Ft||(q.fn?Dt:Kt),Kt=ve(Ft,Ht.innerHTML,Bt,jt)),Kt.tmplName=Ft=Ft||zt,Ft!==Dt&&(Qe[Ft]=Kt),Ht.setAttribute(Lt,Ft),q.fn&&q.data(Ht,Dt,Kt))),Ht=void 0}else Kt.fn||(Kt=void 0);return Kt}var Gt=Ut=Ut||"",Ht,Wt;if(0===jt&&(jt=void 0,Gt=$t(Gt)),jt=jt||(Ut.markup?Ut:{}),jt.tmplName=Ft,Bt&&(jt._parentTmpl=Bt),!Gt&&Ut.markup&&(Gt=$t(Ut.markup))&&Gt.fn&&(Gt=Gt.markup),void 0!==Gt)return Gt.fn||Ut.fn?Gt.fn&&(Wt=Gt):(Ut=ye(Gt,jt),Le(Gt.replace(St,"\\$&"),Ut)),Wt||(_e(jt),Wt=ne(function(){return Ut.render.apply(Ut,arguments)},Ut)),Ft&&!Bt&&Ft!==Dt&&(Mt[Ft]=Wt),Wt}function Se(Ft,Ut){return q.isFunction(Ft)?Ft.call(Ut):Ft}function Ee(Ft){var Bt=[],jt=Ft.length,Ut;for(Ut=0;Ut<jt;Ut++)Bt.push(Ft[Ut].unmap());return Bt}function ye(Ft,Ut){var jt=nt._wm||{},$t=ne({tmpls:[],links:{},bnds:[],_is:"template",render:Ae},Ut),Bt;return $t.markup=Ft,Ut.htmlTag||(Bt=yt.exec(Ft),$t.htmlTag=Bt?Bt[1].toLowerCase():""),Bt=jt[$t.htmlTag],Bt&&Bt!==jt.div&&($t.markup=q.trim($t.markup)),$t}function Re(Ft,Ut){function Bt($t,Ht,Wt){var Gt,Kt,zt,qt;if($t&&typeof $t==wt&&!$t.nodeType&&!$t.markup&&!$t.getTgt&&!("viewModel"===Ft&&$t.getters||$t.extend)){for(zt in $t)Bt(zt,$t[zt],Ht);return Ht||qe}return void 0===Ht&&(Ht=$t,$t=void 0),$t&&""+$t!==$t&&(Wt=Ht,Ht=$t,$t=void 0),qt=Wt?"viewModel"===Ft?Wt:Wt[jt]=Wt[jt]||{}:Bt,Kt=Ut.compile,null===Ht?$t&&delete qt[$t]:(Ht=Kt?Kt.call(qt,$t,Ht,Wt,0):Ht,$t&&(qt[$t]=Ht)),Kt&&Ht&&(Ht._is=Ft),Ht&&(Gt=tt.onStore[Ft])&&Gt($t,Ht,Kt),Ht}var jt=Ft+"s";qe[jt]=Bt}function Ie(Ft){ot[Ft]=function(Ut){return arguments.length?(it[Ft]=Ut,ot):it[Ft]}}function Ce(Ft){function Ut(Bt,jt){this.tgt=Ft.getTgt(Bt,jt)}return Je(Ft)&&(Ft={getTgt:Ft}),Ft.baseMap&&(Ft=ne(ne({},Ft.baseMap),Ft)),Ft.map=function(Bt,jt){return new Ut(Bt,jt)},Ft}function Ae(Ft,Ut,Bt,jt,$t,Ht){var Xt=jt,Zt="",Wt,Gt,Kt,zt,qt,Jt,Yt,Qt;if(!0===Ut?(Bt=Ut,Ut=void 0):typeof Ut!=wt&&(Ut=void 0),(Kt=this.tag)?(qt=this,Xt=Xt||qt.view,zt=Xt.getTmpl(Kt.template||qt.tmpl),!arguments.length&&(Ft=Xt)):zt=this,zt){if(!Xt&&Ft&&"view"===Ft._is&&(Xt=Ft),Xt&&Ft===Xt&&(Ft=Xt.data),Jt=!Xt,ft=ft||Jt,Xt||((Ut=Ut||{}).root=Ft),!ft||nt.useViews||zt.useViews||Xt&&Xt!==ze)Zt=Te(zt,Ft,Ut,Bt,Xt,$t,Ht,Kt);else{if(Xt?(Yt=Xt.data,Qt=Xt.index,Xt.index=kt):(Xt=ze,Xt.data=Ft,Xt.ctx=Ut),Ye(Ft)&&!Bt)for(Wt=0,Gt=Ft.length;Wt<Gt;Wt++)Xt.index=Wt,Xt.data=Ft[Wt],Zt+=zt.fn(Ft[Wt],Xt,tt);else Xt.data=Ft,Zt+=zt.fn(Ft,Xt,tt);Xt.data=Yt,Xt.index=Qt}Jt&&(ft=void 0)}return Zt}function Te(Ft,Ut,Bt,jt,$t,Ht,Wt,Gt){function Kt(oi){ni=ne({},Bt),ni[ii]=oi}var ai="",zt,qt,Jt,Yt,Qt,Xt,Zt,ei,ti,ii,ni,si;if(Gt&&(ti=Gt.tagName,si=Gt.tagCtx,Bt=Bt?Ve(Bt,Gt.ctx):Gt.ctx,Ft===$t.content?Zt=Ft===$t.ctx._wrp?void 0:$t.ctx._wrp:Ft===si.content?Zt=$t.content:Ft===Gt.template?(Zt=si.tmpl,Bt._wrp=si.content):Zt=si.content||$t.content,!1===si.props.link&&(Bt=Bt||{},Bt.link=!1),(ii=si.props.itemVar)&&("~"!==ii.charAt(0)&&we("Use itemVar='~myItem'"),ii=ii.slice(1))),$t&&(Wt=Wt||$t._.onRender,Bt=Ve(Bt,$t.ctx)),!0===Ht&&(Xt=!0,Ht=0),Wt&&(Bt&&!1===Bt.link||Gt&&Gt._.noVws)&&(Wt=void 0),ei=Wt,!0===Wt&&(ei=void 0,Wt=$t._.onRender),Bt=Ft.helpers?Ve(Ft.helpers,Bt):Bt,ni=Bt,Ye(Ut)&&!jt)for(Jt=Xt?$t:void 0!==Ht&&$t||new ge(Bt,"array",$t,Ut,Ft,Ht,Wt),$t&&$t._.useKey&&(Jt._.bnd=!Gt||Gt._.bnd&&Gt),ii&&(Jt.it=ii),ii=Jt.it,(zt=0,qt=Ut.length);zt<qt;zt++)ii&&Kt(Ut[zt]),Yt=new ge(ni,"item",Jt,Ut[zt],Ft,(Ht||0)+zt,Wt,Zt),Qt=Ft.fn(Ut[zt],Yt,tt),ai+=Jt._.onRender?Jt._.onRender(Qt,Yt):Qt;else ii&&Kt(Ut),Jt=Xt?$t:new ge(ni,ti||"data",$t,Ut,Ft,Ht,Wt,Zt),Gt&&!Gt.flow&&(Jt.tag=Gt),ai+=Ft.fn(Ut,Jt,tt);return ei?ei(ai,Jt):ai}function Ne(Ft){throw new tt.Err(Ft)}function we(Ft){Ne("Syntax error\n"+Ft)}function Le(Ft,Ut,Bt,jt,$t){function Ht(ti){ti-=Qt,ti&&Zt.push(Ft.substr(Qt,ti).replace(ht,"\\n"))}function Wt(ti,ii){ti&&(ti+="}}",we((ii?"{{"+ii+"}} block has {{/"+ti+" without {{"+ti:"Unmatched or missing {{/"+ti)+", in template:\n"+Ft))}var Jt=it.allowCode||Ut&&Ut.allowCode||!0===ot.allowCode,Yt=[],Qt=0,Xt=[],Zt=Yt,ei=[,,Yt],Kt,zt,qt;return Jt&&(Ut.allowCode=Jt),Bt&&(void 0!==jt&&(Ft=Ft.slice(0,-jt.length-2)+lt),Ft=rt+Ft+lt),Wt(Xt[0]&&Xt[0][2].pop()[0]),Ft.replace(Ge,function(ti,ii,ni,si,ai,oi,ri,di,ci,li,pi,ui){(ri&&ii||ci&&!ni||di&&":"===di.slice(-1)||li)&&we(ti),oi&&(ai=":",si=Nt),ci=ci||Bt&&!$t;var mi=(ii||Bt)&&[[]],gi="",_i="",fi="",hi="",vi="",Si="",Ei="",bi="",yi=!ci&&!ai;ni=ni||(di=di||"#data",ai),Ht(ui),Qt=ui+ti.length,ri?Jt&&Zt.push(["*","\n"+di.replace(/^:/,"ret+= ").replace(vt,"$1")+";\n"]):ni?("else"===ni&&(bt.test(di)&&we("for \"{{else if expr}}\" use \"{{else expr}}\""),mi=ei[7]&&[[]],ei[8]=Ft.substring(ei[8],ui),ei=Xt.pop(),Zt=ei[2],yi=!0),di&&xe(di.replace(ht," "),mi,Ut).replace(Et,function(Ri,Ii,Ci,Ai,Ti,Oi,Ni,wi){return Ai="'"+Ti+"':",Ni?(_i+=Oi+",",hi+="'"+wi+"',"):Ci?(fi+=Ai+Oi+",",Si+=Ai+"'"+wi+"',"):Ii?Ei+=Oi:("trigger"===Ti&&(bi+=Oi),gi+=Ai+Oi+",",vi+=Ai+"'"+wi+"',",qt=qt||Ct.test(Ti)),""}).slice(0,-1),mi&&mi[0]&&mi.pop(),zt=[ni,si||!!jt||qt||"",yi&&[],ke(hi||(":"===ni?"'#data',":""),vi,Si),ke(_i||(":"===ni?"data,":""),gi,fi),Ei,bi,mi||0],Zt.push(zt),yi&&(Xt.push(ei),ei=zt,ei[8]=Qt)):pi&&(Wt(pi!==ei[0]&&"else"!==ei[0]&&pi,ei[0]),ei[8]=Ft.substring(ei[8],ui),ei=Xt.pop()),Wt(!ei&&pi),Zt=ei[2]}),Ht(Ft.length),(Qt=Yt[Yt.length-1])&&Wt(""+Qt!==Qt&&+Qt[8]===Qt[8]&&Qt[0]),Bt?(Kt=Pe(Yt,Ft,Bt),De(Kt,[Yt[0][7]])):Kt=Pe(Yt,Ut),Kt}function De(Ft,Ut){var $t=0,Ht=Ut.length,Bt,jt;for(Ft.deps=[];$t<Ht;$t++)for(Bt in jt=Ut[$t],jt)"_jsvto"!==Bt&&jt[Bt].length&&(Ft.deps=Ft.deps.concat(jt[Bt]));Ft.paths=jt}function ke(Ft,Ut,Bt){return[Ft.slice(0,-1),Ut.slice(0,-1),Bt.slice(0,-1)]}function Me(Ft,Ut){return"\n\t"+(Ut?Ut+":{":"")+"args:["+Ft[0]+"]"+(Ft[1]||!Ut?",\n\tprops:{"+Ft[1]+"}":"")+(Ft[2]?",\n\tctx:{"+Ft[2]+"}":"")}function xe(Ft,Ut,Bt){var zt=Ut&&Ut[0],qt={bd:zt},Jt={0:qt},Yt=0,Qt=Bt?Bt.links:zt&&(zt.links=zt.links||{}),Xt=0,Zt={},ei={},ti=(Ft+(Bt?" ":"")).replace(_t,function(ii,ni,si,ai,oi,ri,di,ci,li,pi,ui,mi,gi,_i,fi,hi,vi,Si,Ei,bi){function yi(Ni,wi,Li,Di,ki,Mi,xi,Pi){var Vi="."===Li;if(Li&&(oi=oi.slice(wi.length),/^\.?constructor$/.test(Pi||oi)&&we(Ni),Vi||(Ni=(Di?"view.hlp(\""+Di+"\")":ki?"view":"data")+(Pi?(Mi?"."+Mi:Di?"":ki?"":"."+Li)+(xi||""):(Pi=Di?"":ki?Mi||"":Li,"")),Ni+=Pi?"."+Pi:"",Ni=wi+("view.data"===Ni.slice(0,9)?Ni.slice(5):Ni)),zt)){if(Ci="linkTo"===$t?Ht=Ut._jsvto=Ut._jsvto||[]:qt.bd,!(Ai=Vi&&Ci[Ci.length-1]))Ci.push(oi);else if(Ai._jsv){for(;Ai.sb;)Ai=Ai.sb;Ai.bnd&&(oi="^"+oi.slice(1)),Ai.sb=oi,Ai.bnd=Ai.bnd||"^"===oi.charAt(0)}ei[Xt]=Ei+(Vi?1:0)}return Ni}ai=zt&&ai,ai&&!ci&&(oi=ai+oi),ri=ri||"",si=si||ni||mi,oi=oi||li,pi=pi||vi||"";var Oi=")",Ri,Ii,Ci,Ai,Ti;if("["===pi&&(pi="[j._sq(",Oi=")]"),di&&!Kt&&!Gt)we(Ft);else{if(zt&&hi&&!Kt&&!Gt&&(!$t||Wt||Ht)&&(Ri=ei[Xt-1],bi.length-1>Ei-(Ri||0))){if(Ri=bi.slice(Ri,Ei+ii.length),!0!==Ii)if(Ci=Ht||Jt[Xt-1].bd,Ai=Ci[Ci.length-1],Ai&&Ai.prm){for(;Ai.sb&&Ai.sb.prm;)Ai=Ai.sb;Ti=Ai.sb={path:Ai.sb,bnd:Ai.bnd}}else Ci.push(Ti={path:Ci.pop()});hi=dt+":"+Ri+" onerror=''"+ct,Ii=Qt[hi],Ii||(Qt[hi]=!0,Qt[hi]=Ii=Le(hi,Bt,!0)),!0!==Ii&&Ti&&(Ti._jsv=Ii,Ti.prm=qt.bd,Ti.bnd=Ti.bnd||Ti.path&&0<=Ti.path.indexOf("^"))}return Kt?(Kt=!gi,Kt?ii:mi+"\""):Gt?(Gt=!_i,Gt?ii:mi+"\""):(si?(ei[Xt]=Ei++,qt=Jt[++Xt]={bd:[]},si):"")+(Si?Xt?"":(Yt=bi.slice(Yt,Ei),$t?($t=Wt=Ht=!1,"\b"):"\b,")+Yt+(Yt=Ei+ii.length,zt&&Ut.push(qt.bd=[]),"\b"):ci?(Xt&&we(Ft),zt&&Ut.pop(),$t=oi,Wt=ai,Yt=Ei+ii.length,ai&&(zt=qt.bd=Ut[$t]=[]),oi+":"):oi?oi.split("^").join(".").replace(gt,yi)+(pi?(qt=Jt[++Xt]={bd:[]},Zt[Xt]=Oi,pi):ri):ri?ri:fi?(fi=Zt[Xt]||fi,Zt[Xt]=!1,qt=Jt[--Xt],fi)+(pi?(qt=Jt[++Xt],Zt[Xt]=Oi,pi):""):ui?(Zt[Xt]||we(Ft),","):ni?"":(Kt=gi,Gt=_i,"\""))}}),$t,Ht,Wt,Gt,Kt;return!Xt&&ti||we(Ft)}function Pe(Ft,Ut,Bt){var hi=0,vi=nt.useViews||Ut.useViews||Ut.tags||Ut.templates||Ut.helpers||Ut.converters,Si="",Ei={},bi=Ft.length,jt,$t,Ht,Wt,Gt,Kt,zt,qt,Jt,Yt,Qt,Xt,Zt,ei,ti,ii,ni,si,ai,oi,ri,di,ci,li,pi,ui,mi,gi,_i,fi;for(""+Ut===Ut?(si=Bt?"data-link=\""+Ut.replace(ht," ").slice(1,-1)+"\"":Ut,Ut=0):(si=Ut.tmplName||"unnamed",Ut.allowCode&&(Ei.allowCode=!0),Ut.debug&&(Ei.debug=!0),Qt=Ut.bnds,ni=Ut.tmpls),jt=0;jt<bi;jt++)if($t=Ft[jt],""+$t===$t)Si+="\n+\""+$t+"\"";else if(Ht=$t[0],"*"===Ht)Si+=";\n"+$t[1]+"\nret=ret";else{if(Wt=$t[1],ri=!Bt&&$t[2],Gt=Me($t[3],"params")+"},"+Me(Zt=$t[4]),gi=$t[5],fi=$t[6],di=$t[8]&&$t[8].replace(vt,"$1"),(pi="else"===Ht)?Xt&&Xt.push($t[7]):(hi=0,Qt&&(Xt=$t[7])&&(Xt=[Xt],hi=Qt.push(1))),vi=vi||Zt[1]||Zt[2]||Xt||/view.(?!index)/.test(Zt[0]),(ui=":"===Ht)?Wt&&(Ht=Wt===Nt?">":Wt+Ht):(ri&&(ai=ye(di,Ei),ai.tmplName=si+"/"+Ht,ai.useViews=ai.useViews||vi,Pe(ri,ai),vi=ai.useViews,ni.push(ai)),!pi&&(oi=Ht,vi=vi||Ht&&(!et[Ht]||!et[Ht].flow),li=Si,Si=""),ci=Ft[jt+1],ci=ci&&"else"===ci[0]),_i=gi?";\ntry{\nret+=":"\n+",ei="",ti="",ui&&(Xt||fi||Wt&&Wt!==Nt)){if(mi=new Function("data,view,j,u"," // "+si+" "+hi+" "+Ht+"\nreturn {"+Gt+"};"),mi._er=gi,mi._tag=Ht,Bt)return mi;De(mi,Xt),ii="c(\""+Wt+"\",view,",Yt=!0,ei=ii+hi+",",ti=")"}if(Si+=ui?(Bt?(gi?"try{\n":"")+"return ":_i)+(Yt?(Yt=void 0,vi=Jt=!0,ii+(Xt?(Qt[hi-1]=mi,hi):"{"+Gt+"}")+")"):">"===Ht?(zt=!0,"h("+Zt[0]+")"):(qt=!0,"((v="+Zt[0]+")!=null?v:\"\")")):(Kt=!0,"\n{view:view,tmpl:"+(ri?ni.length:"0")+","+Gt+"},"),oi&&!ci){if(Si="["+Si.slice(0,-1)+"]",ii="t(\""+oi+"\",view,this,",Bt||Xt){if(Si=new Function("data,view,j,u"," // "+si+" "+hi+" "+oi+"\nreturn "+Si+";"),Si._er=gi,Si._tag=oi,Xt&&De(Qt[hi-1]=Si,Xt),Bt)return Si;ei=ii+hi+",undefined,",ti=")"}Si=li+_i+ii+(hi||Si)+")",Xt=0,oi=0}gi&&(vi=!0,Si+=";\n}catch(e){ret"+(Bt?"urn ":"+=")+ei+"j._err(e,view,"+gi+")"+ti+";}"+(Bt?"":"ret=ret"))}Si="// "+si+"\nvar v"+(Kt?",t=j._tag":"")+(Jt?",c=j._cnvt":"")+(zt?",h=j._html":"")+(Bt?";\n":",ret=\"\"\n")+(Ei.debug?"debugger;":"")+Si+(Bt?"\n":";\nreturn ret;"),!1!==it.debugMode&&(Si="try {\n"+Si+"\n}catch(e){\nreturn j._err(e, view);\n}");try{Si=new Function("data,view,j,u",Si)}catch(yi){we("Compiled template code:\n\n"+Si+"\n: \""+yi.message+"\"")}return Ut&&(Ut.fn=Si,Ut.useViews=!!vi),Si}function Ve(Ft,Ut){return Ft&&Ft!==Ut?Ut?ne(ne({},Ut),Ft):Ft:Ut&&ne({},Ut)}function Fe(Ft){return Ot[Ft]||(Ot[Ft]="&#"+Ft.charCodeAt(0)+";")}function Ue(Ft){var jt=[],Ut,Bt;if(typeof Ft==wt)for(Ut in Ft)Bt=Ft[Ut],Bt&&Bt.toJSON&&!Bt.toJSON()||Je(Bt)||jt.push({key:Ut,prop:Bt});return jt}function Be(Ft,Ut,Bt){var jt=this.jquery&&(this[0]||Ne("Unknown template: \""+this.selector+"\"")),$t=jt.getAttribute(Lt);return Ae.call($t?q.data(jt)[Dt]:Qe(jt),Ft,Ut,Bt)}function je(Ft){return void 0==Ft?"":It.test(Ft)&&(""+Ft).replace(At,Fe)||Ft}var $e=!1===q;q=q&&q.fn?q:z.jQuery;var He="v0.9.77",gt=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,_t=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*[.^]|\s*$|[^([])|[)\]])([([]?))|(\s+)/g,ht=/[ \t]*(\r\n|\n|\r)/g,vt=/\\(['"])/g,St=/['"\\]/g,Et=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$_\.]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,bt=/^if\s/,yt=/<(\w+)[>\s]/,Rt=/[\x00`><"'&=]/g,It=/[\x00`><\"'&=]/,Ct=/^on[A-Z]|^convert(Back)?$/,At=Rt,Tt=0,Ot={"&":"&amp;","<":"&lt;",">":"&gt;"," ":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;","=":"&#61;"},Nt="html",wt="object",Lt="data-jsv-tmpl",Dt="jsvTmpl",kt="For #index in nested block use #getIndex().",Mt={},xt=z.jsrender,Pt=xt&&q&&!q.render,Vt={template:{compile:ve},tag:{compile:function(Ft,Ut,Bt){function jt(){var Kt=this;Kt._={inline:!0,unlinked:!0},Kt.tagName=Ft}var Gt=new tt._tg,$t,Ht,Wt;if(Je(Ut)?Ut={depends:Ut.depends,render:Ut}:""+Ut===Ut&&(Ut={template:Ut}),Ht=Ut.baseTag)for(Wt in Ut.flow=!!Ut.flow,Ut.baseTag=Ht=""+Ht===Ht?Bt&&Bt.tags[Ht]||et[Ht]:Ht,Gt=ne(Gt,Ht),Ut)Gt[Wt]=Y(Ht[Wt],Ut[Wt]);else Gt=ne(Gt,Ut);return void 0!==($t=Gt.template)&&(Gt.template=""+$t===$t?Qe[$t]||Qe($t):$t),!1!==Gt.init&&((jt.prototype=Gt).constructor=Gt._ctr=jt),Bt&&(Gt._parentTmpl=Bt),Gt}},viewModel:{compile:function(Ft,Ut){function Bt(si){zt.apply(this,si)}function jt(){return new Bt(arguments)}function $t(si,ai){var pi=Jt.length,oi,ri,di,ci,li;for(oi=0;oi<pi;oi++)ci=Jt[oi],ri=void 0,ci+""!==ci&&(ri=ci,ci=ri.getter),void 0===(li=si[ci])&&ri&&void 0!==(di=ri.defaultVal)&&(li=Se(di,si)),ai(li,ri&&qt[ri.type],ci)}function Wt(si){si=si+""===si?JSON.parse(si):si;var _i=this,ai,oi,ri,di,ci,li,pi,ui,mi,gi;if(q.isArray(_i)){for(ui={},gi=[],ri=si.length,di=_i.length,ai=0;ai<ri;ai++){for(mi=si[ai],pi=!1,oi=0;oi<di&&!pi;oi++)ui[oi]||(li=_i[oi],Qt&&(ui[oi]=pi=Qt+""===Qt?mi[Qt]&&(ni[Qt]?li[Qt]():li[Qt])===mi[Qt]:Qt(li,mi)));pi?(li.merge(mi),gi.push(li)):gi.push(jt.map(mi))}return void(ii?ii(_i).refresh(gi):_i.splice.apply(_i,[0,_i.length].concat(gi)))}for(ci in $t(si,function(fi,hi,vi){hi?_i[vi]().merge(fi):_i[vi](fi)}),si)ni[ci]||(_i[ci]=si[ci])}function Gt(){var pi=this,si,ai,oi,ri,di,li;if(q.isArray(pi))return Ee(pi);for(si={},ri=Jt.length,oi=0;oi<ri;oi++)ai=Jt[oi],di=void 0,ai+""!==ai&&(di=ai,ai=di.getter),li=pi[ai](),si[ai]=di&&li&&qt[di.type]?q.isArray(li)?Ee(li):li.unmap():li;for(ai in pi)"_is"===ai||ni[ai]||"_"===ai.charAt(0)&&ni[ai.slice(1)]||q.isFunction(pi[ai])||(si[ai]=pi[ai]);return si}var qt=this,Jt=Ut.getters,Yt=Ut.extend,Qt=Ut.id,Xt=q.extend({_is:Ft||"unnamed",unmap:Gt,merge:Wt},Yt),Zt="",ei="",ti=Jt?Jt.length:0,ii=q.observable,ni={},Kt,zt;for(Bt.prototype=Xt,Kt=0;Kt<ti;Kt++)(function(si){si=si.getter||si,ni[si]=Kt+1;var ai="_"+si;Zt+=(Zt?",":"")+si,ei+="this."+ai+" = "+si+";\n",Xt[si]=Xt[si]||function(oi){return arguments.length?void(ii?ii(this).setProperty(si,oi):this[ai]=oi):this[ai]},ii&&(Xt[si].set=Xt[si].set||function(oi){this[ai]=oi})})(Jt[Kt]);return zt=new Function(Zt,ei.slice(0,-1)),zt.prototype=Xt,Xt.constructor=zt,jt.map=function(si){si=si+""===si?JSON.parse(si):si;var li=si,pi=[],ai,ri,ci;if(q.isArray(si)){for(si=si||[],ri=si.length,ai=0;ai<ri;ai++)pi.push(this.map(si[ai]));return pi._is=Ft,pi.unmap=Gt,pi.merge=Wt,pi}if(si)for(ci in $t(si,function(ui,mi){mi&&(ui=mi.map(ui)),pi.push(ui)}),li=this.apply(this,pi),si)ni[ci]||(li[ci]=si[ci]);return li},jt.getters=Jt,jt.extend=Yt,jt.id=Qt,jt}},helper:{},converter:{}},We,Ge,Ke,ze,qe,Je,Ye,Qe,Xe,Ze,et,tt,it,nt,ot,rt,dt,ct,lt,pt,ut,ft;if(qe={jsviews:He,sub:{View:ge,Err:ie,tmplFn:Le,parse:xe,extend:ne,extendCtx:Ve,syntaxErr:we,onStore:{},addSetting:Ie,settings:{allowCode:!1},advSet:ee,_ths:X,_tg:function(){},_cnvt:function(Ft,Ut,Bt,jt){var Wt="number"==typeof Bt&&Ut.tmpl.bnds[Bt-1],Gt=Ut.linkCtx,$t,Ht;return void 0===jt?Wt&&(Bt=Wt(Ut.data,Ut,tt)):Bt=jt={props:{},args:[jt]},Ht=Bt.args[0],(Ft||Wt)&&($t=Gt&&Gt.tag,!$t&&($t=ne(new tt._tg,{_:{inline:!Gt,bnd:Wt,unlinked:!0},tagName:":",cvt:Ft,flow:!0,tagCtx:Bt}),Gt&&(Gt.tag=$t,$t.linkCtx=Gt),Bt.ctx=Ve(Bt.ctx,(Gt?Gt.view:Ut).ctx)),$t._er=jt&&Ht,X($t,Bt),Bt.view=Ut,$t.ctx=Bt.ctx||$t.ctx||{},Bt.ctx=void 0,Ht=$t.cvtArgs("true"!==Ft&&Ft)[0],Ht=Wt&&Ut._.onRender?Ut._.onRender(Ht,Ut,$t):Ht),void 0==Ht?"":Ht},_tag:function(Ft,Ut,Bt,jt,$t,Ht){Ut=Ut||ze;var li="",pi=Ut.linkCtx||0,ui=Ut.ctx,mi=Bt||Ut.tmpl,gi="number"==typeof jt&&Ut.tmpl.bnds[jt-1],Wt,Kt,zt,qt,Jt,Yt,Qt,Xt,Zt,ei,ti,ii,ni,si,ai,oi,ri,di,ci;for("tag"===Ft._is?(Wt=Ft,Ft=Wt.tagName,jt=Wt.tagCtxs,zt=Wt.template):(Kt=Ut.getRsc("tags",Ft)||Ne("Unknown tag: {{"+Ft+"}} "),zt=Kt.template),void 0===Ht?gi&&(jt=gi(Ut.data,Ut,tt)):(li+=Ht,jt=Ht=[{props:{},args:[]}]),Xt=jt.length,Qt=0;Qt<Xt;Qt++)ei=jt[Qt],pi&&pi.tag&&(!Qt||pi.tag._.inline)&&!Wt._er||((ii=mi.tmpls&&ei.tmpl)&&(ii=ei.content=mi.tmpls[ii-1]),ei.index=Qt,ei.tmpl=ii,ei.render=Ae,ei.view=Ut,ei.ctx=Ve(ei.ctx,ui)),(Bt=ei.props.tmpl)&&(ei.tmpl=Ut.getTmpl(Bt)),Wt||(Wt=new Kt._ctr,ni=!!Wt.init,Wt.parent=Yt=ui&&ui.tag,Wt.tagCtxs=jt,ci=Wt.dataMap,pi&&(Wt._.inline=!1,pi.tag=Wt,Wt.linkCtx=pi),(Wt._.bnd=gi||pi.fn)?Wt._.arrVws={}:Wt.dataBoundOnly&&Ne("{^{"+Ft+"}} tag must be data-bound")),jt=Wt.tagCtxs,ci=Wt.dataMap,ei.tag=Wt,ci&&jt&&(ei.map=jt[Qt].map),Wt.flow||(ti=ei.ctx=ei.ctx||{},qt=Wt.parents=ti.parentTags=ui&&Ve(ti.parentTags,ui.parentTags)||{},Yt&&(qt[Yt.tagName]=Yt),qt[Wt.tagName]=ti.tag=Wt);if(!(Wt._er=Ht)){for(X(Wt,jt[0]),Wt.rendering={},Qt=0;Qt<Xt;Qt++)ei=Wt.tagCtx=jt[Qt],ri=ei.props,oi=Wt.cvtArgs(),(si=ri.dataMap||ci)&&(oi.length||ri.dataMap)&&(ai=ei.map,(!ai||ai.src!==oi[0]||$t)&&(ai&&ai.src&&ai.unmap(),ai=ei.map=si.map(oi[0],ri,void 0,!Wt._.bnd)),oi=[ai.tgt]),Wt.ctx=ei.ctx,Qt||(ni&&(di=Wt.template,Wt.init(ei,pi,Wt.ctx),ni=void 0),pi&&(pi.attr=Wt.attr=pi.attr||Wt.attr),Jt=Wt.attr,Wt._.noVws=Jt&&Jt!==Nt),Zt=void 0,Wt.render&&(Zt=Wt.render.apply(Wt,oi)),oi.length||(oi=[Ut]),void 0===Zt&&(Zt=ei.render(oi[0],!0)||($t?void 0:"")),li=li?li+(Zt||""):Zt;Wt.rendering=void 0}return Wt.tagCtx=jt[0],Wt.ctx=Wt.tagCtx.ctx,Wt._.noVws&&Wt._.inline&&(li="text"===Jt?Xe.html(li):""),gi&&Ut._.onRender?Ut._.onRender(li,Ut,Wt):li},_er:Ne,_err:function(Ft,Ut,Bt){var jt=void 0===Bt?"{Error: "+Ft.message+"}":Je(Bt)?Bt.call(Ut.data,Ft,Ut):Bt||"";return it.onError&&void 0!==(Bt=it.onError.call(Ut.data,Ft,Bt&&jt,Ut))&&(jt=Bt),Ut&&!Ut.linkCtx?Xe.html(jt):jt},_html:je,_sq:function(Ft){return"constructor"===Ft&&we(""),Ft}},settings:{delimiters:function(Ft,Ut,Bt){return Ft?(it.delimiters=[Ft,Ut,pt=Bt?Bt.charAt(0):pt],rt=Ft.charAt(0),dt=Ft.charAt(1),ct=Ut.charAt(0),lt=Ut.charAt(1),Ft="\\"+rt+"(\\"+pt+")?\\"+dt,Ut="\\"+ct+"\\"+lt,Ge="(?:(\\w+(?=[\\/\\s\\"+ct+"]))|(\\w+)?(:)|(>)|(\\*))\\s*((?:[^\\"+ct+"]|\\"+ct+"(?!\\"+lt+"))*?)",tt.rTag="(?:"+Ge+")",Ge=new RegExp("(?:"+Ft+Ge+"(\\/)?|\\"+rt+"(\\"+pt+")?\\"+dt+"(?:(?:\\/(\\w+))\\s*|!--[\\s\\S]*?--))"+Ut,"g"),Ke=new RegExp("<.*>|([^\\\\]|^)[{}]|"+Ft+".*"+Ut),ot):it.delimiters},advanced:function(Ft){return Ft?(ne(nt,Ft),tt.advSet(),ot):nt}},map:Ce},(ie.prototype=new Error).constructor=ie,oe.depends=function(){return[this.get("item"),"index"]},re.depends="index",ge.prototype={get:function(Ft,Ut){Ut||!0===Ft||(Ut=Ft,Ft=void 0);var Wt=this,Gt=!Ut||"root"===Ut,Bt,jt,$t,Ht;if(Ft){if(Ht=Ut&&Wt.type===Ut&&Wt,!Ht)if(Bt=Wt.views,Wt._.useKey){for(jt in Bt)if(Ht=Ut?Bt[jt].get(Ft,Ut):Bt[jt])break;}else for(jt=0,$t=Bt.length;!Ht&&jt<$t;jt++)Ht=Ut?Bt[jt].get(Ft,Ut):Bt[jt];}else if(Gt)for(;Wt.parent;)Ht=Wt,Wt=Wt.parent;else for(;Wt&&!Ht;)Ht=Wt.type===Ut?Wt:void 0,Wt=Wt.parent;return Ht},getIndex:re,getRsc:function(Ft,Ut){for(var $t=this,Bt,jt;void 0==Bt&&$t;)jt=$t.tmpl&&$t.tmpl[Ft],Bt=jt&&jt[Ut],$t=$t.parent;return Bt||qe[Ft][Ut]},getTmpl:function(Ft){return Ft&&(Ft.fn?Ft:this.getRsc("templates",Ft)||Qe(Ft))},hlp:function(Ft){var Bt=this,jt=Bt.linkCtx,$t=(Bt.ctx||{})[Ft],Ut;return void 0===$t&&jt&&jt.ctx&&($t=jt.ctx[Ft]),void 0===$t&&($t=Ze[Ft]),$t&&Je($t)&&!$t._wrp&&(Ut=function(){return $t.apply(this&&this!==z?this:Bt,arguments)},Ut._wrp=Bt,ne(Ut,$t)),Ut||$t},_is:"view"},tt=qe.sub,ot=qe.settings,!(xt||q&&q.render)){for(We in Vt)Re(We,Vt[We]);for(ut in Xe=qe.converters,Ze=qe.helpers,et=qe.tags,tt._tg.prototype={baseApply:he,cvtArgs:pe},ze=tt.topView=new ge,q?(q.fn.render=Be,q.observable&&(ne(tt,q.views.sub),qe.map=q.views.map)):(q={},$e&&(z.jsrender=q),q.renderFile=q.__express=q.compile=function(){throw"Node.js: use npm jsrender, or jsrender-node.js"},q.isFunction=function(Ft){return"function"==typeof Ft},q.isArray=Array.isArray||function(Ft){return"[object Array]"==={}.toString.call(Ft)},tt._jq=function(Ft){Ft!==q&&(ne(Ft,q),q=Ft,q.fn.render=Be,delete q.jsrender)},q.jsrender=He),it=tt.settings,it.allowCode=!1,Je=q.isFunction,Ye=q.isArray,q.render=Mt,q.views=qe,q.templates=Qe=qe.templates,it)Ie(ut);(ot.debugMode=function(Ft){return void 0===Ft?it.debugMode:(it.debugMode=Ft,it.onError=Ft+""===Ft?new Function("","return '"+Ft+"';"):Je(Ft)?Ft:void 0,ot)})(!1),nt=it.advanced={useViews:!1,_jsv:!1},et({if:{render:function(Ft){var Ut=this,Bt=Ut.tagCtx,jt=Ut.rendering.done||!Ft&&(arguments.length||!Bt.index)?"":(Ut.rendering.done=!0,Ut.selected=Bt.index,Bt.render(Bt.view,!0));return jt},flow:!0},for:{render:function(Ft){var Ut=!arguments.length,jt=this,$t=jt.tagCtx,Ht="",Wt=0,Bt;return jt.rendering.done||(Bt=Ut?$t.view.data:Ft,void 0!==Bt&&(Ht+=$t.render(Bt,Ut),Wt+=Ye(Bt)?Bt.length:1),(jt.rendering.done=Wt)&&(jt.selected=$t.index)),Ht},flow:!0},props:{baseTag:"for",dataMap:Ce(Ue),flow:!0},include:{flow:!0},"*":{render:Z,flow:!0},":*":{render:Z,flow:!0},dbg:Ze.dbg=Xe.dbg=te}),Xe({html:je,attr:je,url:function(Ft){return void 0==Ft?null===Ft?Ft:"":encodeURI(""+Ft)}})}return it=tt.settings,ot.delimiters("{{","}}","^"),Pt&&xt.views.sub._jq(q),q||xt},window)},{}],12:[function(H,W){W.exports=class{constructor(){this.$dom=$(`<div class="loading-mask"><div class="loading-text"></div></div>`),this.$dom.hide().appendTo("body")}show(q=""){$(".loading-text",this.$dom).html(q),this.$dom.fadeIn()}hide(){this.$dom.fadeOut()}}},{}],13:[function(H,W){const z=H("q"),q=H("./eventer"),J=H("./context");class Y extends q{constructor(){super(),this.$base_url="https://kecheng.runsnailrun.com",this.__restore_token()}__restore_token(){this.$token="";let X=J.storage.get("DYW_TOKEN");X&&(this.$token=X),X=J.storage.get("DYW_SIG_TOKEN"),X&&(this.$sigtoken=X)}__request(X,Z,ee="get"){return z.Promise((te,ie)=>{$.ajax(this.$base_url+X,{headers:{Authorization:`Bearer ${this.$token}`,Accept:"application/json"},method:ee.toUpperCase(),data:Z,dataType:"json",statusCode:{403:()=>{this.trigger("LOGIN_NEEDED")}},success:function(ne){te(ne.data)},error:function(ne){ne.responseJSON?alert(ne.responseJSON.message):alert("\u554A\u54E6\uFF0C\u7F51\u7EDC\u51FA\u95EE\u9898\u5566~"),ie()}})})}set token(X){J.storage.store("DYW_TOKEN",X),this.$token=X}get token(){return this.$token}set sigtoken(X){J.storage.store("DYW_SIG_TOKEN",X),this.$sigtoken=X}get sigtoken(){return this.$sigtoken}login(X){return this.__request("/user/login",X)}lessons(X){return this.__request("/room/lesson_date",{client_type:"app",date:X})}lessonsByDate(X){return this.__request("/room/lesson_list",{client_type:"app",date:X})}getRoomInfo(X){return this.__request("/room/channel_key",{channel_id:X},"post")}getGiftsList(){return this.__request("/api/gifts",{})}sendGift(X){return this.__request("/api/give_gift",X,"post")}closeRoom(X){return this.__request("/room/close_the_room",{channel_id:X},"post")}}W.exports=new Y},{"./context":8,"./eventer":9,q:20}],14:[function(H,W){let z=H("./AgoraRTCSDK-2.2.0");const q=H("./context"),J=H("../const"),Y=H("q"),X=H("./eventer");W.exports=new class extends X{constructor(){super(),this.__init(),this.$streams_list=[],this.$streams_hash={}}__add_stream(ee){let te=ee.getId(),ie=this.$streams_hash[te];ie==void 0?(this.$streams_list.push(ee),this.$streams_hash[te]=this.$streams_list.length-1):this.$streams_list[ie]=ee,this.stream_audio(te)}__remove_stream(ee){let te=ee.getId(),ie=this.$streams_hash[te];this.$streams_list.splice(ie,1),this.$streams_hash={},this.$streams_list.forEach((ne,se)=>{this.$streams_hash[ne.getId()]=se})}__get_stream(ee){let te=this.$streams_hash[ee];return this.$streams_list[te]}__init(){return Y.Promise((ee,te)=>{if(this.$inited)ee();else{z.getDevices(function(ne){let se=null,ae=null;ne.forEach((oe)=>{"Built-in Microphone"==oe.label&&"audioinput"==oe.kind?se=oe.deviceId:"FaceTime HD Camera"==oe.label&&"videoinput"==oe.kind&&(ae=oe.deviceId)}),q.video_device_id=ae,q.audio_device_id=se});var ie=z.createClient({mode:"interop"});ie.init(J.AGORA_APPID,()=>{this.$inited=!0,ee()},(ne)=>{this.$inited=!1,console.log("error",ne),te()}),this.$client=ie}})}stream_audio(ee){let te=this.__get_stream(ee);if(te){let ie=q.course.teacher_id==ee,ne=!q.dmg.isMuted(ee);ne||ie?(console.log("enable audio",ee),te.enableAudio()):(te.disableAudio(),console.log("disable audio",ee))}}__start_stream(){this.$client.on("error",(te)=>{console.log("Got error msg:",te.reason),"DYNAMIC_KEY_TIMEOUT"===te.reason&&this.$client.renewChannelKey(channelKey,()=>{console.log("Renew channel key successfully")},function(ie){console.log("Renew channel key failed: ",ie)})}),this.$client.on("stream-added",(te)=>{var ie=te.stream;console.log("New stream added: "+ie.getId()),console.log("Subscribe ",ie),console.log(this.$client.remoteVideoStreamTypes),this.$client.subscribe(ie,(ne)=>{console.log("Subscribe stream failed",ne)})}),this.$client.on("stream-subscribed",(te)=>{var ie=te.stream;console.log("Subscribe remote stream successfully: "+ie.getId()),this.trigger("NEW_STREAM",ie),this.__add_stream(ie)}),this.$client.on("stream-removed",(te)=>{var ie=te.stream;ie.stop(),this.trigger("REMOVE_STREAM",ie),this.__remove_stream(ie),console.log("Remote stream is removed "+ie.getId())}),this.$client.on("peer-leave",(te)=>{var ie=te.stream;ie&&(ie.stop(),this.trigger("REMOVE_STREAM",ie),this.__remove_stream(ie),console.log(te.uid+" leaved from this channel"))});let ee=z.createStream({streamID:q.dmg.userinfo.id,audio:!0,cameraId:q.video_device_id,microphoneId:q.audio_device_id,video:!0,screen:!1});ee.setVideoProfile(J.VIDEO_QUALITY),ee.on("accessAllowed",function(){}),ee.on("accessDenied",function(){alert("\u65E0\u6CD5\u8BBF\u95EE\u60A8\u7684\u6444\u50CF\u5934\u6216\u9EA6\u514B\u98CE")}),ee.init(()=>{this.__add_stream(ee),this.stream_audio(ee.getId()),this.trigger("NEW_STREAM",ee),this.$client.publish(ee,function(){alert("\u65E0\u6CD5\u8FDE\u63A5\u60A8\u7684\u89C6\u9891\u6D41\uFF0C\u8BF7\u786E\u5B9A\u60A8\u7684\u7F51\u7EDC\u662F\u5426\u826F\u597D\u3002")}),this.$client.on("stream-published",function(){})},function(){alert("\u65E0\u6CD5\u8BBF\u95EE\u60A8\u7684\u6444\u50CF\u5934\u6216\u9EA6\u514B\u98CE")}),this.$local_stream=ee}start(){this.__init().then(()=>{this.$client.join(q.room.channel_token,q.course.channel_id,q.dmg.userinfo.id,()=>{this.__start_stream()},(ee)=>{console.log("join error",ee)})},()=>{}).done()}leave(){this.$streams_list.forEach((ee)=>{this.$client.unpublish(ee,(te)=>{console.log("unpublish stream failed ",te)}),ee.stop(),ee.close()}),this.$client.leave(()=>{this.trigger("LEAVE_ROOM",this.$client),console.log("client leaves channel")},(ee)=>{console.log("client leave failed ",ee)})}}},{"../const":1,"./AgoraRTCSDK-2.2.0":2,"./context":8,"./eventer":9,q:20}],15:[function(H,W){function z(J,Y="id"){let X={};for(var Z=0,ee=J.length;Z<ee;Z++){let te=J[Z][Y];"undefined"!=typeof te&&(J[Z].$index=Z,X[te]=J[Z])}return X}W.exports=class{constructor(J=[],Y="id"){this._key=Y,this.update(J)}findByKey(J,Y){return this._list.find((X)=>{if(X[J]==Y)return!0})}data(){return this._list.concat()}first(){return this._list[0]}modify(J,...Y){this._list[J](...Y),this.update(this._list)}update(J){J instanceof Array&&(this._list=J,this._hash=z(J,this._key))}merge(J){!J instanceof Array||(J.forEach((Y)=>{let X=Y[this._key],Z=this.get(X);Z?this._list[Z.$index]=Y:this._list.push(Y)}),this._hash=z(this._list,this._key))}remove(J){let Y=this.get(J);Y&&(this._list.splice(Y.$index,1),this._hash=z(this._list,this._key))}get(J){return this._hash[J]}next(J){let Y=this.get(J);if(Y){let X=Y.$index;return this._list[X+1]}}prev(J){let Y=this.get(J);if(Y){let X=Y.$index;return this._list[X-1]}}index(J){return this._list[J]}}},{}],16:[function(H,W){const z=H("./eventer"),q=H("./context"),J=H("../../env");console.log("ENV",J);class Y extends z{constructor(){super(),this.$uuid=0,this.$_parts=[],this.$jsready=!1,this.$queue=[]}uuid(){return++this.$uuid}get view(){return this.$webview}init(X){this.$dom=$(X),this.__createWebview(),this.__bind(),this.$dom.html(""),this.$dom.append(this.$webview)}__createWebview(){let X=this.uuid(),Z=$(`<webview class="webview" src="https://kecheng.runsnailrun.com/app?from=app" partition="persist:kecheng${X}" preload="./scripts/inject.js"></webview>`);this.$webview=Z[0]}__bind(){this.$webview&&($(this.$webview).off("page-title-updated"),$(this.$webview).on("page-title-updated",(X)=>{X=X.originalEvent;let Z=X.title.match(/^#PART#(\d+)#(\d+)#(.+)$/);if(Z){let ee=parseInt(Z[1],10),te=parseInt(Z[2],10);if(ee==te){this.$_parts.push(Z[3]);let ie=this.$_parts.join("");try{this.receive_message(JSON.parse(ie))}catch(ne){console.error(ne,ie)}this.$_parts=[]}else ee<te?this.$_parts.push(Z[3]):this.$_parts=[]}}))}send_message(X,Z={},ee={}){if(this.$jsready){let te={message:Z,from:q.dmg.userinfo.id,to:"app",type:X};for(let ie in ee)te[ie]=ee[ie];this.$webview.executeJavaScript(`BridgeH5Do(${JSON.stringify(te)})`)}else this.$queue.push([X,Z,ee])}receive_message(X){"jsready"==X.type&&(this.$jsready=!0,console.log("jsready..",this.$queue),this.$queue.forEach((Z)=>{this.send_message(...Z)}),this.$queue=[]),this.trigger("NEW_MESSAGE",X)}destroy(){this.$_parts=[],this.$jsready=!1,this.$queue=[],$(this.$webview).remove()}}W.exports=Y},{"../../env":18,"./context":8,"./eventer":9}],17:[function(H,W){H("./AgoraSig-1.3.0");const z=H("../const"),q=H("./context"),J=H("./network"),Y=H("q"),X=H("./eventer");W.exports=new class extends X{constructor(){super(),this.$signal=Signal(z.AGORA_APPID),this.$inited=!1,this.$queue=[]}init(){return Y.Promise((ee,te)=>{this.$inited?ee():(this.$session=this.$signal.login(q.dmg.userinfo.id+"",J.sigtoken),this.$session.onLoginSuccess=()=>{this.$inited=!0,this.$session.invoke("io.agora.signal.user_set_attr",{name:"data",value:JSON.stringify(q.dmg.userinfo)},(ie,ne)=>{console.log("set user info success",q.dmg.userinfo,ne)}),ee(),console.log("session logined...")},this.$session.onLoginFailed=(ie)=>{ie==z.LOGIN_E_NET&&setTimeout(()=>{this.init().then(ee,te).done()},2e3),console.log("session login failed...",ie)},this.$session.onLogout=(ie)=>{ie==z.LOGOUT_E_NET&&setTimeout(()=>{this.init().then(ee,te).done()},2e3),console.log("session logout",ie)},this.$session.onError=(ie)=>{ie==z.GENERAL_E_NOT_LOGIN&&setTimeout(()=>{this.init().then(ee,te).done()},2e3),console.log("session error",ie)})})}join(){this.init().then(()=>{let ee=this.$session.channelJoin(q.course.channel_id);ee.onChannelJoined=()=>{this.$channel=ee,this.trigger("CHANNEL_JOINED",ee),this.$queue.forEach((ie)=>{this.send(ie)}),this.$queue=[]},ee.onChannelJoinFailed=()=>{console.log("channel join failed, retry after 2s"),setTimeout(()=>{this.join()},2e3)};let te=(ie)=>{this.$session.invoke("io.agora.signal.user_get_attr",{account:ie,name:"data"},(ne,se)=>{if(se.value){console.log("new user joined...",se);let ae=JSON.parse(se.value);q.dmg.addUser(ae),this.trigger("CHANNEL_NEW_USER",ae)}})};ee.onChannelUserJoined=(ie)=>{te(ie)},ee.onChannelUserList=function(ie){ie.forEach((ne)=>{te(ne[0])})},ee.onChannelUserLeaved=(ie)=>{q.dmg.removeUser(ie),this.trigger("CHANNEL_USER_LEAVE",ie)},ee.onMessageChannelReceive=(ie,ne,se)=>{console.log("receive new message",se);let ae=JSON.parse(se);this.trigger("NEW_MESSAGE",ae)}},()=>{})}leave(){this.$channel.channelLeave(()=>{this.trigger("CHANNEL_LEAVED",this.$channel),this.$channel=null})}send(ee){ee=JSON.stringify(ee),this.$channel?this.$channel.messageChannelSend(ee,()=>{console.log("\u6D88\u606F\u53D1\u9001\u6210\u529F")}):this.$queue.push(ee)}}},{"../const":1,"./AgoraSig-1.3.0":3,"./context":8,"./eventer":9,"./network":13,q:20}],18:[function(H,W){W.exports={DEBUG:!0}},{}],19:[function(H,W){function z(){}var q=W.exports={};q.nextTick=function(){var J="undefined"!=typeof window&&window.setImmediate,Y="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(J)return function(Z){return window.setImmediate(Z)};if(Y){var X=[];return window.addEventListener("message",function(Z){var ee=Z.source;if((ee===window||null===ee)&&"process-tick"===Z.data&&(Z.stopPropagation(),0<X.length)){var te=X.shift();te()}},!0),function(ee){X.push(ee),window.postMessage("process-tick","*")}}return function(ee){setTimeout(ee,0)}}(),q.title="browser",q.browser=!0,q.env={},q.argv=[],q.on=z,q.addListener=z,q.once=z,q.off=z,q.removeListener=z,q.removeAllListeners=z,q.emit=z,q.binding=function(){throw new Error("process.binding is not supported")},q.cwd=function(){return"/"},q.chdir=function(){throw new Error("process.chdir is not supported")}},{}],20:[function(H,W,K){(function(z){(function(q){"use strict";if("function"==typeof bootstrap)bootstrap("promise",q);else if("object"==typeof K&&"object"==typeof W)W.exports=q();else if("function"==typeof define&&define.amd)define(q);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=q}else if("undefined"!=typeof window||"undefined"!=typeof self){var J="undefined"==typeof window?self:window,Y=J.Q;J.Q=q(),J.Q.noConflict=function(){return J.Q=Y,this}}else throw new Error("This environment was not anticipated by Q. Please file a bug.")})(function(){"use strict";function q(rt){return function(){return je.apply(rt,arguments)}}function J(rt){return rt===Object(rt)}function Y(rt){return"[object StopIteration]"===Ye(rt)||rt instanceof Qe}function X(rt,dt){if(Pe&&dt.stack&&"object"==typeof rt&&null!==rt&&rt.stack){for(var ct=[],lt=dt;!!lt;lt=lt.source)lt.stack&&(!rt.__minimumStackCounter__||rt.__minimumStackCounter__>lt.stackCounter)&&(ze(rt,"__minimumStackCounter__",{value:lt.stackCounter,configurable:!0}),ct.unshift(lt.stack));ct.unshift(rt.stack);var pt=ct.join("\n"+Xe+"\n"),ut=Z(pt);ze(rt,"stack",{value:ut,configurable:!0})}}function Z(rt){for(var dt=rt.split("\n"),ct=[],lt=0,pt;lt<dt.length;++lt)pt=dt[lt],ie(pt)||ee(pt)||!pt||ct.push(pt);return ct.join("\n")}function ee(rt){return-1!==rt.indexOf("(module.js:")||-1!==rt.indexOf("(node.js:")}function te(rt){var dt=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(rt);if(dt)return[dt[1],+dt[2]];var ct=/at ([^ ]+):(\d+):(?:\d+)$/.exec(rt);if(ct)return[ct[1],+ct[2]];var lt=/.*@(.+):(\d+)$/.exec(rt);if(lt)return[lt[1],+lt[2]]}function ie(rt){var dt=te(rt);if(!dt)return!1;var ct=dt[0],lt=dt[1];return ct===Fe&&lt>=Ve&&lt<=ot}function ne(){if(Pe)try{throw new Error}catch(lt){var rt=lt.stack.split("\n"),dt=0<rt[0].indexOf("@")?rt[1]:rt[2],ct=te(dt);return ct?(Fe=ct[0],ct[1]):void 0}}function ae(rt){return rt instanceof ce?rt:me(rt)?ye(rt):be(rt)}function oe(){function rt(mt){lt=mt,ae.longStackSupport&&Pe&&(ut.source=mt),He(dt,function(gt,_t){ae.nextTick(function(){mt.promiseDispatch.apply(mt,_t)})},void 0),dt=void 0,ct=void 0}var dt=[],ct=[],pt=Ke(oe.prototype),ut=Ke(ce.prototype),lt;if(ut.promiseDispatch=function(mt,gt,_t){var ft=$e(arguments);dt?(dt.push(ft),"when"===gt&&_t[1]&&ct.push(_t[1])):ae.nextTick(function(){lt.promiseDispatch.apply(lt,ft)})},ut.valueOf=function(){if(dt)return ut;var mt=pe(lt);return ue(mt)&&(lt=mt),mt},ut.inspect=function(){return lt?lt.inspect():{state:"pending"}},ae.longStackSupport&&Pe)try{throw new Error}catch(mt){ut.stack=mt.stack.substring(mt.stack.indexOf("\n")+1),ut.stackCounter=Ze++}return pt.promise=ut,pt.resolve=function(mt){lt||rt(ae(mt))},pt.fulfill=function(mt){lt||rt(be(mt))},pt.reject=function(mt){lt||rt(Ee(mt))},pt.notify=function(mt){lt||He(ct,function(gt,_t){ae.nextTick(function(){_t(mt)})},void 0)},pt}function re(rt){if("function"!=typeof rt)throw new TypeError("resolver must be a function.");var dt=oe();try{rt(dt.resolve,dt.reject,dt.notify)}catch(ct){dt.reject(ct)}return dt.promise}function de(rt){return re(function(dt,ct){for(var lt=0,pt=rt.length;lt<pt;lt++)ae(rt[lt]).then(dt,ct)})}function ce(rt,dt,ct){void 0===dt&&(dt=function(ut){return Ee(new Error("Promise does not support operation: "+ut))}),void 0===ct&&(ct=function(){return{state:"unknown"}});var lt=Ke(ce.prototype);if(lt.promiseDispatch=function(ut,mt,gt){var _t;try{_t=rt[mt]?rt[mt].apply(lt,gt):dt.call(lt,mt,gt)}catch(ft){_t=Ee(ft)}ut&&ut(_t)},lt.inspect=ct,ct){var pt=ct();"rejected"===pt.state&&(lt.exception=pt.reason),lt.valueOf=function(){var ut=ct();return"pending"===ut.state||"rejected"===ut.state?lt:ut.value}}return lt}function le(rt,dt,ct,lt){return ae(rt).then(dt,ct,lt)}function pe(rt){if(ue(rt)){var dt=rt.inspect();if("fulfilled"===dt.state)return dt.value}return rt}function ue(rt){return rt instanceof ce}function me(rt){return J(rt)&&"function"==typeof rt.then}function he(){et.length=0,tt.length=0,nt||(nt=!0)}function ve(rt,dt){nt&&("object"==typeof z&&"function"==typeof z.emit&&ae.nextTick.runAfter(function(){-1!==We(tt,rt)&&(z.emit("unhandledRejection",dt,rt),it.push(rt))}),tt.push(rt),dt&&"undefined"!=typeof dt.stack?et.push(dt.stack):et.push("(no stack) "+dt))}function Se(rt){if(nt){var dt=We(tt,rt);-1!==dt&&("object"==typeof z&&"function"==typeof z.emit&&ae.nextTick.runAfter(function(){var ct=We(it,rt);-1!==ct&&(z.emit("rejectionHandled",et[dt],rt),it.splice(ct,1))}),tt.splice(dt,1),et.splice(dt,1))}}function Ee(rt){var dt=ce({when:function(ct){return ct&&Se(this),ct?ct(rt):this}},function(){return this},function(){return{state:"rejected",reason:rt}});return ve(dt,rt),dt}function be(rt){return ce({when:function(){return rt},get:function(dt){return rt[dt]},set:function(dt,ct){rt[dt]=ct},delete:function(dt){delete rt[dt]},post:function(dt,ct){return null===dt||void 0===dt?rt.apply(void 0,ct):rt[dt].apply(rt,ct)},apply:function(dt,ct){return rt.apply(dt,ct)},keys:function(){return Je(rt)}},void 0,function(){return{state:"fulfilled",value:rt}})}function ye(rt){var dt=oe();return ae.nextTick(function(){try{rt.then(dt.resolve,dt.reject,dt.notify)}catch(ct){dt.reject(ct)}}),dt.promise}function Ie(rt,dt,ct){return ae(rt).spread(dt,ct)}function Ne(rt,dt,ct){return ae(rt).dispatch(dt,ct)}function we(rt){return le(rt,function(dt){var ct=0,lt=oe();return He(dt,function(pt,ut,mt){var gt;ue(ut)&&"fulfilled"===(gt=ut.inspect()).state?dt[mt]=gt.value:(++ct,le(ut,function(_t){dt[mt]=_t,0==--ct&&lt.resolve(dt)},lt.reject,function(_t){lt.notify({index:mt,value:_t})}))},void 0),0==ct&&lt.resolve(dt),lt.promise})}function Le(rt){if(0===rt.length)return ae.resolve();var dt=ae.defer(),ct=0;return He(rt,function(lt,pt,ut){var ft=rt[ut];ct++,le(ft,function(ht){dt.resolve(ht)},function(ht){if(ct--,0==ct){var vt=ht||new Error(""+ht);vt.message="Q can\\'t get fulfillment value from any promise, all promises were rejected. Last error message: "+vt.message,dt.reject(vt)}},function(ht){dt.notify({index:ut,value:ht})})},void 0),dt.promise}function De(rt){return le(rt,function(dt){return dt=Ge(dt,ae),le(we(Ge(dt,function(ct){return le(ct,Ue,Ue)})),function(){return dt})})}var Pe=!1;try{throw new Error}catch(rt){Pe=!!rt.stack}var Ve=ne(),Ue=function(){},Be=function(){function rt(){for(var ht,vt;ct.next;)ct=ct.next,ht=ct.task,ct.task=void 0,vt=ct.domain,vt&&(ct.domain=void 0,vt.enter()),dt(ht,vt);for(;gt.length;)ht=gt.pop(),dt(ht);pt=!1}function dt(ht,vt){try{ht()}catch(St){if(mt)throw vt&&vt.exit(),setTimeout(rt,0),vt&&vt.enter(),St;else setTimeout(function(){throw St},0)}vt&&vt.exit()}var ct={task:void 0,next:null},lt=ct,pt=!1,ut=void 0,mt=!1,gt=[];if(Be=function(ht){lt=lt.next={task:ht,domain:mt&&z.domain,next:null},pt||(pt=!0,ut())},"object"==typeof z&&"[object process]"===z.toString()&&z.nextTick)mt=!0,ut=function(){z.nextTick(rt)};else if("function"==typeof setImmediate)ut="undefined"==typeof window?function(){setImmediate(rt)}:setImmediate.bind(window,rt);else if("undefined"!=typeof MessageChannel){var _t=new MessageChannel;_t.port1.onmessage=function(){ut=ft,_t.port1.onmessage=rt,rt()};var ft=function(){_t.port2.postMessage(0)};ut=function(){setTimeout(rt,0),ft()}}else ut=function(){setTimeout(rt,0)};return Be.runAfter=function(ht){gt.push(ht),pt||(pt=!0,ut())},Be}(),je=Function.call,$e=q(Array.prototype.slice),He=q(Array.prototype.reduce||function(rt,dt){var ct=0,lt=this.length;if(1===arguments.length)do{if(ct in this){dt=this[ct++];break}if(++ct>=lt)throw new TypeError}while(1);for(;ct<lt;ct++)ct in this&&(dt=rt(dt,this[ct],ct));return dt}),We=q(Array.prototype.indexOf||function(rt){for(var dt=0;dt<this.length;dt++)if(this[dt]===rt)return dt;return-1}),Ge=q(Array.prototype.map||function(rt,dt){var ct=this,lt=[];return He(ct,function(pt,ut,mt){lt.push(rt.call(dt,ut,mt,ct))},void 0),lt}),Ke=Object.create||function(rt){function dt(){}return dt.prototype=rt,new dt},ze=Object.defineProperty||function(rt,dt,ct){return rt[dt]=ct.value,rt},qe=q(Object.prototype.hasOwnProperty),Je=Object.keys||function(rt){var dt=[];for(var ct in rt)qe(rt,ct)&&dt.push(ct);return dt},Ye=q(Object.prototype.toString),Fe,Qe;Qe="undefined"==typeof ReturnValue?function(rt){this.value=rt}:ReturnValue;var Xe="From previous event:";ae.resolve=ae,ae.nextTick=Be,ae.longStackSupport=!1;var Ze=1;"object"==typeof z&&z&&z.env&&z.env.Q_DEBUG&&(ae.longStackSupport=!0),ae.defer=oe,oe.prototype.makeNodeResolver=function(){var rt=this;return function(dt,ct){dt?rt.reject(dt):2<arguments.length?rt.resolve($e(arguments,1)):rt.resolve(ct)}},ae.Promise=re,ae.promise=re,re.race=de,re.all=we,re.reject=Ee,re.resolve=ae,ae.passByCopy=function(rt){return rt},ce.prototype.passByCopy=function(){return this},ae.join=function(rt,dt){return ae(rt).join(dt)},ce.prototype.join=function(rt){return ae([this,rt]).spread(function(dt,ct){if(dt===ct)return dt;throw new Error("Q can't join: not the same: "+dt+" "+ct)})},ae.race=de,ce.prototype.race=function(){return this.then(ae.race)},ae.makePromise=ce,ce.prototype.toString=function(){return"[object Promise]"},ce.prototype.then=function(rt,dt,ct){function lt(ft){try{return"function"==typeof rt?rt(ft):ft}catch(ht){return Ee(ht)}}function pt(ft){if("function"==typeof dt){X(ft,mt);try{return dt(ft)}catch(ht){return Ee(ht)}}return Ee(ft)}function ut(ft){return"function"==typeof ct?ct(ft):ft}var mt=this,gt=oe(),_t=!1;return ae.nextTick(function(){mt.promiseDispatch(function(ft){_t||(_t=!0,gt.resolve(lt(ft)))},"when",[function(ft){_t||(_t=!0,gt.resolve(pt(ft)))}])}),mt.promiseDispatch(void 0,"when",[void 0,function(ft){var vt=!1,ht;try{ht=ut(ft)}catch(St){if(vt=!0,ae.onerror)ae.onerror(St);else throw St}vt||gt.notify(ht)}]),gt.promise},ae.tap=function(rt,dt){return ae(rt).tap(dt)},ce.prototype.tap=function(rt){return rt=ae(rt),this.then(function(dt){return rt.fcall(dt).thenResolve(dt)})},ae.when=le,ce.prototype.thenResolve=function(rt){return this.then(function(){return rt})},ae.thenResolve=function(rt,dt){return ae(rt).thenResolve(dt)},ce.prototype.thenReject=function(rt){return this.then(function(){throw rt})},ae.thenReject=function(rt,dt){return ae(rt).thenReject(dt)},ae.nearer=pe,ae.isPromise=ue,ae.isPromiseAlike=me,ae.isPending=function(rt){return ue(rt)&&"pending"===rt.inspect().state},ce.prototype.isPending=function(){return"pending"===this.inspect().state},ae.isFulfilled=function(rt){return!ue(rt)||"fulfilled"===rt.inspect().state},ce.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},ae.isRejected=function(rt){return ue(rt)&&"rejected"===rt.inspect().state},ce.prototype.isRejected=function(){return"rejected"===this.inspect().state};var et=[],tt=[],it=[],nt=!0;ae.resetUnhandledRejections=he,ae.getUnhandledReasons=function(){return et.slice()},ae.stopUnhandledRejectionTracking=function(){he(),nt=!1},he(),ae.reject=Ee,ae.fulfill=be,ae.master=function(rt){return ce({isDef:function(){}},function(ct,lt){return Ne(rt,ct,lt)},function(){return ae(rt).inspect()})},ae.spread=Ie,ce.prototype.spread=function(rt,dt){return this.all().then(function(ct){return rt.apply(void 0,ct)},dt)},ae.async=function(rt){return function(){function dt(ut,mt){var gt;if("undefined"==typeof StopIteration){try{gt=ct[ut](mt)}catch(_t){return Ee(_t)}return gt.done?ae(gt.value):le(gt.value,lt,pt)}try{gt=ct[ut](mt)}catch(_t){return Y(_t)?ae(_t.value):Ee(_t)}return le(gt,lt,pt)}var ct=rt.apply(this,arguments),lt=dt.bind(dt,"next"),pt=dt.bind(dt,"throw");return lt()}},ae.spawn=function(rt){ae.done(ae.async(rt)())},ae["return"]=function(rt){throw new Qe(rt)},ae.promised=function(rt){return function(){return Ie([this,we(arguments)],function(dt,ct){return rt.apply(dt,ct)})}},ae.dispatch=Ne,ce.prototype.dispatch=function(rt,dt){var ct=this,lt=oe();return ae.nextTick(function(){ct.promiseDispatch(lt.resolve,rt,dt)}),lt.promise},ae.get=function(rt,dt){return ae(rt).dispatch("get",[dt])},ce.prototype.get=function(rt){return this.dispatch("get",[rt])},ae.set=function(rt,dt,ct){return ae(rt).dispatch("set",[dt,ct])},ce.prototype.set=function(rt,dt){return this.dispatch("set",[rt,dt])},ae.del=ae["delete"]=function(rt,dt){return ae(rt).dispatch("delete",[dt])},ce.prototype.del=ce.prototype["delete"]=function(rt){return this.dispatch("delete",[rt])},ae.mapply=ae.post=function(rt,dt,ct){return ae(rt).dispatch("post",[dt,ct])},ce.prototype.mapply=ce.prototype.post=function(rt,dt){return this.dispatch("post",[rt,dt])},ae.send=ae.mcall=ae.invoke=function(rt,dt){return ae(rt).dispatch("post",[dt,$e(arguments,2)])},ce.prototype.send=ce.prototype.mcall=ce.prototype.invoke=function(rt){return this.dispatch("post",[rt,$e(arguments,1)])},ae.fapply=function(rt,dt){return ae(rt).dispatch("apply",[void 0,dt])},ce.prototype.fapply=function(rt){return this.dispatch("apply",[void 0,rt])},ae["try"]=ae.fcall=function(rt){return ae(rt).dispatch("apply",[void 0,$e(arguments,1)])},ce.prototype.fcall=function(){return this.dispatch("apply",[void 0,$e(arguments)])},ae.fbind=function(rt){var dt=ae(rt),ct=$e(arguments,1);return function(){return dt.dispatch("apply",[this,ct.concat($e(arguments))])}},ce.prototype.fbind=function(){var rt=this,dt=$e(arguments);return function(){return rt.dispatch("apply",[this,dt.concat($e(arguments))])}},ae.keys=function(rt){return ae(rt).dispatch("keys",[])},ce.prototype.keys=function(){return this.dispatch("keys",[])},ae.all=we,ce.prototype.all=function(){return we(this)},ae.any=Le,ce.prototype.any=function(){return Le(this)},ae.allResolved=function(rt,dt,ct){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(dt+" is deprecated, use "+ct+" instead.",new Error("").stack),rt.apply(rt,arguments)}}(De,"allResolved","allSettled"),ce.prototype.allResolved=function(){return De(this)},ae.allSettled=function(rt){return ae(rt).allSettled()},ce.prototype.allSettled=function(){return this.then(function(rt){return we(Ge(rt,function(dt){function ct(){return dt.inspect()}return dt=ae(dt),dt.then(ct,ct)}))})},ae.fail=ae["catch"]=function(rt,dt){return ae(rt).then(void 0,dt)},ce.prototype.fail=ce.prototype["catch"]=function(rt){return this.then(void 0,rt)},ae.progress=function(rt,dt){return ae(rt).then(void 0,void 0,dt)},ce.prototype.progress=function(rt){return this.then(void 0,void 0,rt)},ae.fin=ae["finally"]=function(rt,dt){return ae(rt)["finally"](dt)},ce.prototype.fin=ce.prototype["finally"]=function(rt){if(!rt||"function"!=typeof rt.apply)throw new Error("Q can't apply finally callback");return rt=ae(rt),this.then(function(dt){return rt.fcall().then(function(){return dt})},function(dt){return rt.fcall().then(function(){throw dt})})},ae.done=function(rt,dt,ct,lt){return ae(rt).done(dt,ct,lt)},ce.prototype.done=function(rt,dt,ct){var lt=function(ut){ae.nextTick(function(){if(X(ut,pt),ae.onerror)ae.onerror(ut);else throw ut})},pt=rt||dt||ct?this.then(rt,dt,ct):this;"object"==typeof z&&z&&z.domain&&(lt=z.domain.bind(lt)),pt.then(void 0,lt)},ae.timeout=function(rt,dt,ct){return ae(rt).timeout(dt,ct)},ce.prototype.timeout=function(rt,dt){var ct=oe(),lt=setTimeout(function(){dt&&"string"!=typeof dt||(dt=new Error(dt||"Timed out after "+rt+" ms"),dt.code="ETIMEDOUT"),ct.reject(dt)},rt);return this.then(function(pt){clearTimeout(lt),ct.resolve(pt)},function(pt){clearTimeout(lt),ct.reject(pt)},ct.notify),ct.promise},ae.delay=function(rt,dt){return void 0===dt&&(dt=rt,rt=void 0),ae(rt).delay(dt)},ce.prototype.delay=function(rt){return this.then(function(dt){var ct=oe();return setTimeout(function(){ct.resolve(dt)},rt),ct.promise})},ae.nfapply=function(rt,dt){return ae(rt).nfapply(dt)},ce.prototype.nfapply=function(rt){var dt=oe(),ct=$e(rt);return ct.push(dt.makeNodeResolver()),this.fapply(ct).fail(dt.reject),dt.promise},ae.nfcall=function(rt){var dt=$e(arguments,1);return ae(rt).nfapply(dt)},ce.prototype.nfcall=function(){var rt=$e(arguments),dt=oe();return rt.push(dt.makeNodeResolver()),this.fapply(rt).fail(dt.reject),dt.promise},ae.nfbind=ae.denodeify=function(rt){if(rt===void 0)throw new Error("Q can't wrap an undefined function");var dt=$e(arguments,1);return function(){var ct=dt.concat($e(arguments)),lt=oe();return ct.push(lt.makeNodeResolver()),ae(rt).fapply(ct).fail(lt.reject),lt.promise}},ce.prototype.nfbind=ce.prototype.denodeify=function(){var rt=$e(arguments);return rt.unshift(this),ae.denodeify.apply(void 0,rt)},ae.nbind=function(rt,dt){var ct=$e(arguments,2);return function(){var pt=ct.concat($e(arguments)),ut=oe();return pt.push(ut.makeNodeResolver()),ae(function(){return rt.apply(dt,arguments)}).fapply(pt).fail(ut.reject),ut.promise}},ce.prototype.nbind=function(){var rt=$e(arguments,0);return rt.unshift(this),ae.nbind.apply(void 0,rt)},ae.nmapply=ae.npost=function(rt,dt,ct){return ae(rt).npost(dt,ct)},ce.prototype.nmapply=ce.prototype.npost=function(rt,dt){var ct=$e(dt||[]),lt=oe();return ct.push(lt.makeNodeResolver()),this.dispatch("post",[rt,ct]).fail(lt.reject),lt.promise},ae.nsend=ae.nmcall=ae.ninvoke=function(rt,dt){var ct=$e(arguments,2),lt=oe();return ct.push(lt.makeNodeResolver()),ae(rt).dispatch("post",[dt,ct]).fail(lt.reject),lt.promise},ce.prototype.nsend=ce.prototype.nmcall=ce.prototype.ninvoke=function(rt){var dt=$e(arguments,1),ct=oe();return dt.push(ct.makeNodeResolver()),this.dispatch("post",[rt,dt]).fail(ct.reject),ct.promise},ae.nodeify=function(rt,dt){return ae(rt).nodeify(dt)},ce.prototype.nodeify=function(rt){return rt?void this.then(function(dt){ae.nextTick(function(){rt(null,dt)})},function(dt){ae.nextTick(function(){rt(dt)})}):this},ae.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var ot=ne();return ae})}).call(this,H("b55mWE"))},{b55mWE:19}]},{},[10]);