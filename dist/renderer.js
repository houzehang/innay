module.exports=function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="./",r(r.s=7)}([function(e,t){e.exports=require("electron")},function(e,t){e.exports="undefined"==typeof process||!process||!!process.type&&"renderer"===process.type},function(e,t){e.exports={DEBUG:!1,TC_DEBUG:!1,TEST:!0,TEACHER:!1}},function(e,t){e.exports={TEST_URL:"http://kecheng1.youshiyuwen.cn",ONLINE_URL:"https://www.mingxiyuwen.com",TENCENT_APPID:1400098973,TENCENT_ACCOUNTTYPE:28218,VIDEO_T_QUALITY:"480P_3",VIDEO_S_QUALITY:"120P_3",MAIN_WINDOW_SIZE:{width:1300,height:790},ROOM_ID:111111,LARGE_MODE:480,DANCE_MODE:200,SMALL_MODE:88,WEB_IM_GROUP_TIP:{JOIN:1,QUIT:2,KICK:3,SET_ADMIN:4,CANCEL_ADMIN:5,MODIFY_GROUP_INFO:6,MODIFY_MEMBER_INFO:7},CELL_COUNT:4,LOGIN_E_NET:201,LOGOUT_E_KICKED:103,LOGOUT_E_NET:102,LOGOUT_SUCCESS:101,GENERAL_E_NOT_LOGIN:1003,JS_READY:"jsready",INIT_ROOM:"initroom",MEMBER_ADD:"member_add",MEMBER_LEAVE:"member_leave",CLEARLINES:"clearlines",NEXT_PAGE:"nextpage",SYNC:"sync",VIDEO_PLAY:"videoplay",VIDEO_STOP:"videostop",OPEN_RACE:"#openrace",CLOSE_RACE:"#closerace",OPEN_MIC:"#openmic",CLOSE_MIC:"#closemic",COURSE_PAUSE:"#coursepause",COURSE_RESUME:"#courseresume",PUT_DANCE:"#putdance",BACK_DANCE:"#backdance",SCENE_MOVE:"scenemove",START_COURSE:"*startcourse",STOP_COURSE:"*stopcourse",WARN:"warn",WARN_RELIEVE:"warn_relieve",ENABLE_MAGIC:"enablemagic",DISABLE_MAGIC:"disablemagic",MUTE_ALL:"#muteall",UNMUTE_ALL:"#unmuteall",SHOW_RANKS:"*showranks",HIDE_RANKS:"*hideranks",OPEN_MEDDLE:"open_meddle",UPDATE:{AVAILABLE:"update available",LASTEST:"the lastest version",CHECKING:"checking for update",ERROR:"update error",DOWNLOADING:"update downloading",DOWNLOADED:"update downloaded",DOWNLOADING_UI:"downloading ui",DOWNLOADED_UI:"downloaded ui"},COCOS:1,ILLEGAL_AUDIOS:["cyberlink webcam splitter","manycam virtual webcam","BBlivePreview","CamTwist","17GuaGua Cam","PixelMaster Video HDR","PG splitter","Built-in iSight","6room"]}},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){"use strict";r.r(t);r(4),r(5),r(6);var s=r(0),n=r.n(s),o=r(3),i=r.n(o).a,a=r(1),l=r.n(a);var _=new class{constructor(){this.$uuid=0,this.$handlers={},this.$sender_pool={},this.$delegate={},l.a?(this.$sender=n.a.ipcRenderer,this.$receiver=n.a.ipcRenderer):this.$receiver=n.a.ipcMain,this.__bind()}__bind(){this.$receiver.on("MESSAGE_RPC_BRIDGE",(e,t)=>{if(!l.a){let r=e.sender.getOwnerBrowserWindow();r&&"id"in t&&(this.$sender_pool[t.id]=r)}this.__received(t)})}__send(e){let t=this.$sender;!t&&"id"in e&&(t=this.$sender_pool[e.id]),t?t.send("MESSAGE_RPC_BRIDGE",e):console.error("no sender for message",e)}__received(e){if("error"in e||"result"in e){const t=e.id,r=this.$handlers[t];if(r){try{r(e.error,e.result)}catch(e){console.error("call message handler error",e)}delete this.$handlers[t],delete this.$sender_pool[t]}else console.error("no callback handler for message",t)}else if("method"in e){let t=this.$delegate[e.method],r=e.id;if(!t)return void this.__send({id:r,error:`no method named ${e.method}`});let s=this.$sender||this.$sender_pool[r];Promise.resolve(t(e.args,s)).then((t=null)=>{e.id&&this.__send({id:r,result:t})}).catch(e=>{this.__send({id:r,error:e.message})})}}set delegate(e){for(let t in e)this.$delegate[t]=e[t]}removeDelegate(e){delete this.$delegate[e]}call({method:e,args:t,sender:r}){if(l.a||r)return new Promise((s,n)=>{let o=(l.a?"R":"M")+ ++this.$uuid;this.$handlers[o]=(e,t)=>{e?n(e):s(t)},l.a||(this.$sender_pool[o]=r),this.__send({id:o,method:e,args:t})});console.error("call from main process must set sender")}},d=r(2);const u=s.remote.require("electron-updater").autoUpdater,c=s.remote.require("electron-log"),E=e=>document.getElementById(e);new class{constructor(){this.__bind(),this.state={version:s.remote.app.getVersion(),message:"",progress:null},this.$using_backup_url=!1,d.DEBUG?this.$base_url="http://localhost:8080":d.TEST?this.$base_url="https://bundlesyuntest.mx0a.com":(this.$base_url="https://bundlesyun.mx0a.com",this.$retry_url="http://bundlesossyun.mw019.com"),this.__setState(),this.__start_updater()}__setStatus(e,t){let r;r=e==i.UPDATE.LASTEST?"已是最新版本。":e==i.UPDATE.AVAILABLE?"发现新版本。":e==i.UPDATE.CHECKING?"正在检查新版本...":e==i.UPDATE.ERROR?`更新出错，错误信息:${t}`:e==i.UPDATE.DOWNLOADING?"正在下载新版本...":e==i.UPDATE.DOWNLOADED?"下载完成，请等待安装...":e==i.UPDATE.DOWNLOADING_UI?"正在下载基础包...":e==i.UPDATE.DOWNLOADED_UI?"下载完成，请等待解压...":"正在检查版本更新...",this.__setState({message:r,progress:t})}__bind(){E("closeBtn").onclick=function(){s.remote.getCurrentWindow().close()},E("restart-btn").onclick=function(){console.log("reclick"),s.remote.app.relaunch(),s.remote.app.exit(0)}}__do_update_bundle(e){let t=this.$using_backup_url?this.$retry_url:this.$base_url;c.error("开始下载框架包",e,t),_.call({method:"startDownloadTask",args:{pack:"classroom-ui",url:`${t}/${e.url}`,md5:e.md5,version:e.version,autoUnzip:!0,checksum:!0}}).then(e=>{let t=e.identity;_.delegate={[`${t}/progress`]:({total:e,transferred:t,percent:r})=>{this.__setStatus(i.UPDATE.DOWNLOADING,{percent:100*r>>0})},[`${t}/error`]:e=>{this.__setStatus(i.UPDATE.ERROR,e.message),c.error("下载工程框架出错",e)},[`${t}/success`]:e=>{this.__setStatus(i.UPDATE.DOWNLOADED_UI),this.__on_complete()}}}).catch(e=>{c.error("下载工程框架出错",e)})}__update_bundle(e=this.$base_url){c.error("检测基础框架是否有更新",e),_.call({method:"isUpdateAvailable",args:{url:`${e}/app.json`,pack:"classroom-ui"}}).then(e=>{c.error("检测基础框架是否有更新成功",e),e.available?(this.__setStatus(i.UPDATE.DOWNLOADING_UI),this.__do_update_bundle(e.server)):(this.__setStatus(i.UPDATE.LASTEST),this.__on_complete())}).catch(t=>{c.error("检测基础框架是否有更新出错",t),e==this.$base_url&&this.$retry_url?(this.$using_backup_url=!0,c.log("尝试使用备选域名"+this.$retry_url),this.__update_bundle(this.$retry_url)):this.__setState({progress:null,error:t})})}__start_updater(){u.logger=c,u.logger.transports.file.level="info",u.on("checking-for-update",()=>{this.__setStatus(i.UPDATE.CHECKING)}),u.on("update-available",()=>{this.__setStatus(i.UPDATE.AVAILABLE)}),u.on("update-not-available",()=>{this.__update_bundle()}),u.on("error",e=>{c.error("基础框架更新出错",e),setTimeout(()=>{this.__update_bundle()},2e3)}),u.on("download-progress",e=>{this.__setStatus(i.UPDATE.DOWNLOADING,e)}),u.on("update-downloaded",()=>{this.__setStatus(i.UPDATE.DOWNLOADED),setTimeout(()=>{u.quitAndInstall()},2e3)}),u.checkForUpdates()}__setState(e={}){for(let t in e)this.state[t]=e[t];this.__render()}__on_complete(){s.ipcRenderer.send("render.complete"),_.call({method:"openMainWindow",args:{pack:"classroom-ui",data:{usingBackupUrl:this.$using_backup_url}}}).catch(e=>{c.error("开启主框架窗口出错",e),this.__setState({progress:null,error:e.message})})}__render(){this.state.progress?(E("progress").style.display="flex",E("percent").innerText=`${this.state.progress.percent>>0}%`,E("bar").style.width=`${this.state.progress.percent}%`):E("progress").style.display="none",this.state.error?(E("tips").innerText=`当前版本: ${this.state.version}, 更新出错：${this.state.error}`,E("restart-btn").style.display="flex"):(E("tips").innerText=`当前版本: ${this.state.version}, ${this.state.message}`,E("restart-btn").style.display="none")}}}]);