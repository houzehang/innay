!function(e){function t(t){for(var i,r,a=t[0],c=t[1],l=t[2],u=0,h=[];u<a.length;u++)r=a[u],n[r]&&h.push(n[r][0]),n[r]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);for(d&&d(t);h.length;)h.shift()();return o.push.apply(o,l||[]),s()}function s(){for(var e,t=0;t<o.length;t++){for(var s=o[t],i=!0,a=1;a<s.length;a++){var c=s[a];0!==n[c]&&(i=!1)}i&&(o.splice(t--,1),e=r(r.s=s[0]))}return e}var i={},n={0:0},o=[];function r(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=i,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(s,i,function(t){return e[t]}.bind(null,i));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="./";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var d=c;o.push([706,1]),s()}({127:function(e,t){e.exports=require("assert")},128:function(e,t,s){e.exports=s.p+"b7352824791f13b1940e457e27abc0d5.png"},129:function(e,t,s){e.exports=s.p+"6d642fafca2c2d2380da8366b59571f4.png"},13:function(e,t){e.exports=require("fs")},130:function(e,t,s){e.exports=s.p+"c2a59edb4d30c6baa59858353f823e34.png"},132:function(e,t,s){e.exports=s.p+"902e3e03efd0e415daad6e18a70a88ef.png"},177:function(e,t,s){e.exports=s.p+"a7ba99e77ee93076f4d6e3c7f6b0471b.png"},2:function(e,t,s){"use strict";var i=s(34),n=s(5),o=s(35),r=s(20),a=s.n(r),c=s(13),l=s.n(c),d=s(8);const u=n.remote.require("pandora-nodejs-sdk"),h=n.remote.require("electron-log"),m=n.remote.app.getPath("userData");t.a=new class{get agoraAppId(){let e=window.ENV_CONF||{};return e.TEST||e.DEBUG?"8255568bc0ab4117bce79c6ca65e1c99":"d75fe75ab0404a90b2ed7e5bab216f80"}get agoraChannelKey(){let e=window.ENV_CONF||{};return e.TEST||e.DEBUG?"83dfd49b300c4c1d8af4a5ff68c12214":"7c9b6ed9bba54dc59471cfa09e9f23ea"}get dmg(){return this.$dmg}set dmg(e){this.$dmg=e}get user(){return this.$user||{}}set user(e){this.$user=e}get loading(){return this.$loading}set loading(e){this.$loading=e}get detector(){return this.$detector}set detector(e){this.$detector=e}get course(){return this.$course}set course(e){this.$course=e}get room(){return this.$room}set room(e){this.$room=e}get session(){return this.$session}set session(e){this.$session=e}get storage(){return this.$storage||(this.$storage=i.a),this.$storage}set storage(e){this.$storage=e}set usingBackupUrl(e){this.$using_backup_url=e}get usingBackupUrl(){return this.$using_backup_url}get video_device_id(){return this.$video_device_id}set video_device_id(e){this.$video_device_id=e}get audio_device_id(){return this.$audio_device_id}set audio_device_id(e){this.$audio_device_id=e}get domains(){return this.$domains||d.default.DOMAIN_LIST_DEFAULT}set domains(e){this.$domains=e}addDownloaded(e,t){this.$local_files||(this.$local_files={}),this.$local_files[e]=t}getDownloaded(e){if(this.$local_files)return this.$local_files[e]}send_to_main(e){console.log("send_to_main",n.ipcRenderer,e),n.ipcRenderer.send(...e)}restoreOldDevice(){localStorage.getItem("IS_OLD_DEVICE")&&(console.log("copy low version old device"),o.a.store("IS_OLD_DEVICE",1))}set oldDevice(e){o.a.store("IS_OLD_DEVICE",1&e)}set joinClassEnabled(e){this.$join_class_enabled=!!e}get joinClassEnabled(){return void 0===this.$join_class_enabled||this.$join_class_enabled}get(e,t=document){return"object"==typeof e?e:(t&&"string"==typeof t&&(t=this.get(t)),/^\./.test(e)?t.getElementsByClassName(e.replace(/^\./,"")):(/^#/.test(e)&&(e=e.replace(/^#/,"")),document.getElementById(e)))}offset(e){e=this.get(e);var t=0,s=0;do{t+=e.offsetTop,s+=e.offsetLeft,e=e.parentNode}while(e.parentNode);return{top:t,left:s}}get rkey(){return"TNyv1khX-,5IOzgBWgpu"}empty(e){if("string"==typeof e&&(e=this.get(e)),e.length)for(let t=0,s=e.length;t<s;t++)e[t].innerHTML="";else e&&(e.innerHTML="")}get lkey(){return"Yu6oGz2USJb9RMgG84KalD,19Dnr5YuF0mV1QoEgBxX2"}__upload_log(e,t,s){return new Promise((i,n)=>{if(!l.a.existsSync(e))return void n();let o=l.a.readFileSync(e,"utf8");if(o){let r=this.lkey.split(","),a=this.rkey.split(",");o=o.split("\n").map(s),u.send(new u.Auth(r[0]+"DxyKE2vUz"+a[0],r[1]+"PVhUEGplM"+a[1]),t,o).then(()=>{l.a.writeFileSync(e,"","utf8")}).then(i,n)}else n()})}upload_system_logs(){this.__upload_log(a.a.join(m,"system.log"),"mingxi_pc_system",e=>{let t=e.split(" ");return{time:[t.shift(),t.shift()].join(" "),content:t.join(" "),user:this.user.id,name:this.user.child_name}}).then(()=>{h.log("update system logs success")}).catch(e=>{h.error("update system logs failed ",e)})}upload_agora_logs(){this.__upload_log(a.a.join(m,"agora.log"),"mingxi_pc_agora",e=>{let t=e.split(";");return{time:t.shift(),content:t.join(";"),user:this.user.id,name:this.user.child_name}}).then(()=>{h.log("update agora logs success")}).catch(e=>{h.error("update agora logs failed ",e)})}log(...e){h.log(...e);let t=window.ENV_CONF||{};(t.DEBUG||t.TC_DEBUG||t.TEST)&&console.log(...e)}error(...e){h.error(...e);let t=window.ENV_CONF||{};(t.DEBUG||t.TC_DEBUG||t.TEST)&&console.error(...e)}filterVideoDevice(e){return e=e.filter((e={})=>{let t=!1;return d.default.ILLEGAL_AUDIOS.map(s=>{new RegExp(s.toLowerCase()).test((e.devicename||"").toLowerCase())&&(t=!0)}),!t})}}},20:function(e,t){e.exports=require("path")},230:function(e,t){e.exports=require("child_process")},250:function(e,t){e.exports=require("string_decoder")},263:function(e,t){const s={KEY_C:{code:"C",windowFocusNeeded:!0},KEY_M:{code:"M",windowFocusNeeded:!0},KEY_G:{code:"G",windowFocusNeeded:!0},KEY_LEFT:{code:"Left",windowFocusNeeded:!0},KEY_RIGHT:{code:"Right",windowFocusNeeded:!0},KEY_ENTER:{code:"Return",windowFocusNeeded:!0},KEY_ESC:{code:"Escape",windowFocusNeeded:!0}};for(const e in s)s[e].toString=()=>s[e].code;e.exports=s},268:function(e,t,s){},269:function(e,t,s){},270:function(e,t,s){},279:function(e,t,s){},284:function(e,t){e.exports=require("constants")},286:function(e,t){e.exports=require("stream")},290:function(e,t,s){},291:function(e,t,s){},297:function(e,t,s){},298:function(e,t,s){},299:function(e,t,s){},300:function(e,t,s){},301:function(e,t,s){},34:function(e,t,s){"use strict";t.a=new class{constructor(e="MINGXI.INC"){if(this.$namespace=e,this.$data=localStorage.getItem(this.$namespace),console.log("namespace...",e,this.$data),this.$data)try{this.$data=JSON.parse(this.$data)}catch(e){this.$data={},localStorage.removeItem(this.$namespace)}else this.$data={}}get(e){return this.$data[e]}store(e,t){this.$data[e]=t,localStorage.setItem(this.$namespace,JSON.stringify(this.$data))}clear(){localStorage.removeItem(this.$namespace)}}},35:function(e,t,s){"use strict";var i=s(261),n=s.n(i),o=s(262),r=s.n(o),a=s(62),c=s.n(a),l=s(5);const d="MINGXI-INC";t.a=new class{constructor(){let e;e=c.a?l.remote.app:l.app;const t=new r.a(`${e.getPath("userData")}/db.json`);this.$db=n()(t)}get(e){let t=this.$db.get(d).cloneDeep().value();if(t)return t[e]}store(e,t){let s=this.$db.get(d).value()||{};s[e]=t,this.$db.set(d,{...s}).write()}remove(e){let t=this.$db.get(d).value();t&&t[e]&&(delete t[e],this.$db.set(d,{...t}).write())}clear(){this.$db.unset(d).write()}update(){this.$db.read()}}},4:function(e,t,s){"use strict";s.r(t);var i=s(78),n=s(2),o=s(5),r=s(8),a=s(45),c=s.n(a);var l=class{constructor(){}};var d=new class extends l{constructor(){super()}get baseUrl(){let e=window.ENV_CONF||{};return e.DEBUG||e.TEST?r.default.TEST_URL:r.default.ONLINE_URL}post(e,t={}){c.a.post(this.baseUrl+e,t)}quest(e,t={}){return new Promise((s,i)=>{c.a.ajax(this.baseUrl+e,{...t,success:(...n)=>{console.log("MINGXI_DEBUG_LOG>>>>>>>>>request success",e,t),t.success(s,i,...n)},error:(...e)=>{t.error&&t.error(s,i,...e)}})})}};t.default=new class extends i.a{constructor(){super(),this.$log_queue=[],this.__restore_token()}__restore_token(){this.$token="";let e=n.a.storage.get("DYW_TOKEN");e&&(this.$token=e),(e=n.a.storage.get("DYW_SIG_TOKEN"))&&(this.$sigtoken=e)}upload_file(e){const t=new FormData;return t.append("upload_file",e),d.quest("/uploadfile/index",{headers:{Authorization:`Bearer ${this.$token}`},method:"POST",data:t,processData:!1,contentType:!1,success:(e,t,s)=>{s.data&&s.data.url?e(s.data.url):t()},error:(e,t)=>{alert("啊哦，文件上传失败~"),t()}})}__request(e,t={},s="get"){return t.client="pc",d.quest(e,{headers:{Authorization:`Bearer ${this.$token}`,Accept:"application/json"},method:s.toUpperCase(),data:t,dataType:"json",statusCode:{403:()=>{this.trigger("LOGIN_NEEDED")}},success:(e,t,s)=>{e(s.data)},error:(e,t,s)=>{if(s.responseJSON&&alert(s.responseJSON.message),401==s.status)return this.trigger("LOGOUT_NEEDED"),void t();s.responseJSON||alert("啊哦，网络出问题啦~"),t()}})}set token(e){n.a.storage.store("DYW_TOKEN",e),this.$token=e}get token(){return this.$token}set sigtoken(e){n.a.storage.store("DYW_SIG_TOKEN",e),this.$sigtoken=e}get sigtoken(){return this.$sigtoken}servcerTime(){return this.__request("/api/time")}login(e){return this.__request("/user/login",e,"post")}getLoginDentities(e){return this.__request("/api/dentities",e,"post")}getLoginCode(e){return this.__request("/user/send_sms_for_client",e,"post")}getNewCodeimg(){return d.quest("/captcha/api/mini",{headers:{Authorization:`Bearer ${this.$token}`},processData:!1,contentType:!1,success:(e,t,s)=>{e(s)}})}newLogin(e){return this.__request("/user/sms_login_for_client",e,"post")}forgetPassword(e){return this.__request("/user/forget_password_for_client",e,"post")}checkPwIsDefault(){return d.quest("/user/check_password_default",{headers:{Authorization:`Bearer ${this.$token}`},method:"POST",processData:!1,contentType:!1,success:(e,t,s)=>{s.data?e(s.data):t()}})}getLessonComming(){return this.__request("/room/class_lesson_first",{client:"pc"},"post")}getLessonListComming(e={}){return e.client="pc",e.type="prepare",this.__request("/room/class_lesson_list",e,"post")}getLessonListDone(e={}){return e.client="pc",e.type="haved",this.__request("/room/class_lesson_list",e,"post")}lessons(e){return this.__request("/room/lesson_date",{date:e})}lessonsByDate(e){return this.__request("/room/lesson_list",{date:e})}lessonsByHistory(){return this.__request("/room/my_lesson_list",{client:"pc",type:"haved"})}getRoomInfo(e,t){let s=(window.ENV_CONF||{}).systeminfo||{os:{},cpu:{},system:{}},i="";try{let e=o.remote.process.getSystemMemoryInfo()||{total:0},t="操作系统："+(s.os.distro||"").replace(/[^a-zA-Z_0-9 ]/g,"")+" "+(s.os.kernal||""),n="CPU型号："+(s.cpu.brand||""),r="CPU核数："+(s.cpu.physicalCores||"")+"核"+(s.cpu.cores||"")+"线程",a="CPU主频："+(s.cpu.speed||"")+"Hz"+(s.cpu.speed==s.cpu.speedmax?"":" - "+(s.cpu.speedmax||"")+"Hz"),c="系统内存："+Math.round((e.total||0)/1024/1024*10)/10+"G",l="设备型号："+(s.system.manufacturer||"")+(s.system.model||"");i+=t+"\n",i+=n+"\n",i+=r+"\n",i+=a+"\n",i+=c+"\n",i+=l}catch(e){console.log(e)}return this.__request("/room/channel_key",{channel_id:e,device:i,is_preview:t},"post")}getRoomInfoForRecord(e){return this.__request("/room/record_room_info",{channel_id:e},"post")}getGiftsList(){return this.__request("/api/gifts",{})}sendGift(e){return this.__request("/api/give_gift",e,"post")}warn(e){return this.__request("/room/user_leave_class",e,"post")}baseUpload(e){return this.__request("/room/user_base_upload",e,"post")}closeRoom(e){return this.__request("/room/close_the_room",{channel_id:e},"post")}getServerTime(){return this.__request("/api/time")}beginClass(e,t){return this.__request("/room/class_begin",{channel_id:e,user_ids:t},"post")}changeUserInfo(e){return this.__request("/user/edit_user_info",e,"post")}earlyWarning(e){return this.__request("/room/room_early_warning",{channel_id:e},"post")}getContactInfo(){return this.__request("/user/banji_contact")}checkDevice(){return this.__request("/api/device_testing",{logs:[window.ENV_CONF.systeminfo]},"post")}__get_system_info(){let e=o.remote.process.getProcessMemoryInfo(),t=o.remote.process.getSystemMemoryInfo(),s=o.remote.process.getCPUUsage(),i=e=>Math.round(e/1024*10)/10+"M";return{um:`${i(e.workingSetSize)}/${i(e.peakWorkingSetSize)}`,tm:`${i(t.free)}/${Math.round(t.total/1024/1024*10)/10+"G"}/${t.swapFree||0}/${t.swapTotal||0}`,cpu:`${Math.round(100*s.percentCPUUsage)/100}/${s.idleWakeupsPerSecond}`}}reportSystemBaseInfo(){let e=setInterval(()=>{window.ENV_CONF&&window.ENV_CONF.systeminfo&&(clearInterval(e),this.log(window.ENV_CONF.systeminfo))},1e3)}log(e={}){console.log("net log:",e),this.$log_queue.push(e),this.$log_delay||(this.$log_delay=setInterval(()=>{this.$log_queue.length>0&&d.post("/api/h5_log",{logs:this.$log_queue,user:n.a.user.id,system:this.__get_system_info()}),this.$log_queue=[]},8e3))}getCampLesson(e={}){return this.__request("/api/drainage/training/index",e,"post")}device_check(){}showOthers(e){return this.__request("/api/show_others",{client:"pc",show:e?"1":"0"},"post")}}},5:function(e,t){e.exports=require("electron")},59:function(e,t){e.exports=require("os")},60:function(e,t){e.exports=require("events")},628:function(e,t,s){var i={"./cat":225,"./cat.js":225,"./cd":155,"./cd.js":155,"./chmod":226,"./chmod.js":226,"./common":19,"./common.js":19,"./cp":156,"./cp.js":156,"./dirs":227,"./dirs.js":227,"./echo":228,"./echo.js":228,"./error":157,"./error.js":157,"./exec":229,"./exec-child":231,"./exec-child.js":231,"./exec.js":229,"./find":232,"./find.js":232,"./grep":233,"./grep.js":233,"./head":234,"./head.js":234,"./ln":235,"./ln.js":235,"./ls":160,"./ls.js":160,"./mkdir":236,"./mkdir.js":236,"./mv":237,"./mv.js":237,"./popd":238,"./popd.js":238,"./pushd":239,"./pushd.js":239,"./pwd":159,"./pwd.js":159,"./rm":161,"./rm.js":161,"./sed":240,"./sed.js":240,"./set":241,"./set.js":241,"./sort":242,"./sort.js":242,"./tail":243,"./tail.js":243,"./tempdir":158,"./tempdir.js":158,"./test":244,"./test.js":244,"./to":245,"./to.js":245,"./toEnd":246,"./toEnd.js":246,"./touch":247,"./touch.js":247,"./uniq":248,"./uniq.js":248,"./which":249,"./which.js":249};function n(e){var t=o(e);return s(t)}function o(e){if(!s.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=o,e.exports=n,n.id=628},629:function(e,t,s){e.exports=s.p+"bc1d284153addee6123ff5a4477cc348.mp3"},630:function(e,t,s){e.exports=s.p+"ced767bc6f5a2b3b4aa787a623c4d401.mp3"},631:function(e,t,s){e.exports=s.p+"fa0a03038cf314001046e993be9eaa34.mp3"},632:function(e,t,s){e.exports=s.p+"a308658ab809a57125760af59bafcdc9.png"},633:function(e,t,s){e.exports=s.p+"ee249243adbe0a911542dc517ea6c2ae.png"},643:function(e,t){e.exports=require("buffer")},659:function(e,t){},660:function(e,t){},678:function(e,t){},679:function(e,t){},682:function(e,t){e.exports=require("zlib")},693:function(e,t){e.exports=require("querystring")},701:function(e,t){e.exports=require("http")},702:function(e,t){e.exports=require("https")},703:function(e,t){e.exports=require("url")},706:function(e,t,s){"use strict";s.r(t);s(29),s(268),s(269),s(270);var i=s(3),n=s.n(i),o=s(258),r=s(23),a=s(72);const c={STUDENT:1,MASTER:2};var l=(e={type:"alert",configure:{content:""}},t)=>{switch(t.type){case"SHOW_ALERT":return{...e,type:"alert",configure:t.configure,showing:!0};case"SHOW_CONFIRM":return{...e,type:"confirm",configure:t.configure,showing:!0};case"HIDE_DIALOG":return{...e,showing:!1};default:return e}};var d=(e={},t)=>{switch(t.type){case"LOGIN_SUCCESS":return{...e,account:t.account};case"LOGOUT":return{...e,account:null};case"CHANGE_USER_INFO":return{...e,account:t.user};default:return e}};var u=(e={},t)=>{switch(t.type){case"ROOM_LIST":return{...e,rooms:t.rooms};case"ROOM_INFO":return{...e,room:t.data};case"CALENDAR_DATA":return{...e,calendar:t.data};case"START_COURSE":return{...e,courseStarted:!0};case"COURSE_END":return{...e,courseStarted:!1};case"ENTER_TESTER":return{...e,courseStarted:!1,enterTester:!0,fromPage:t.page};case"ENTER_MY_COURSES":return{...e,enterMyCourses:!0};case"EXIT_MY_COURSES":return{...e,enterMyCourses:!1};case"EXIT_TESTER":let s=e.fromPage;return{...e,enterTester:!1,courseStarted:"course"==s};case"NET_STATUS_BAD":return{...e,netStatus:0};case"NET_STATUS_GOOD":return{...e,netStatus:1};case"COURSE_RECORDING":return{...e,recording:t.status,flow:t.camp};case"LESSON_COMMING":return{...e,commingRoom:t.commingRoom};case"CAMP_LESSON":return{...e,campRoom:t.campRoom};case"LESSONS_COMMING":return console.log("LESSONS_COMMING action.commingRooms",t.commingRooms),{...e,commingRooms:t.commingRooms};case"LESSONS_DONE":return console.log("LESSONS_DONE action.doneRooms",t.doneRooms),{...e,doneRooms:t.doneRooms};case"LESSONS_TOTAL_COMMING":return{...e,totalComming:t.totalComming};case"LESSONS_TOTAL_DONE":return{...e,totalDone:t.totalDone};case"CHANGE_PASSWORD":return console.log("MINGXI=============action.changePwd",t.changePwd,t.fromViewUser),{...e,changePwd:t.changePwd,fromViewUser:t.fromViewUser};case"SHOW_GLOBAL_MSG":return{...e,globalMsg:t.globalMsg};default:return e}},h=s(34);var m=(e={},t)=>{let s,i,n,o;switch(t.type){case"ROOM_INFO":let r=t.data,a={child_name:r.teacher_name,avatarurl:r.teacher_avatar,id:r.teacher_id};if(!r.camp){let e=r.start_time.split(/[-: ]/),s=new Date(e[0],e[1]-1,e[2]||1,e[3]||0,e[4]||0,e[5]||0).getTime()-Date.now(),i=h.a.get("STATUS_"+r.channel_id);(o=(o=i||{duration:t.data.duration,waiting:s,id:r.channel_id})||{}).waiting=s}return{...e,info:t.data,switches:{gift:!0,muteall:!0},dancing:[],status:o,teacher:a};case"ROOM_GIFT":return{...e,gifts:t.data};case"ROOM_MORE_INFO":let c={...e.info};return c.channel_token=t.data.channel_token,c.features=t.data.features,console.log(t.data.students,"action.data.students"),{...e,info:c,students:t.data.students};case"NEW_GIFT":let l=t.data;for(let t=0,s=(n=[...e.students]).length;t<s;t++){let e=n[t];e.id==l.uid&&(e.gift_total=l.total)}return{...e,students:n};case"WARN":let d=t.data;for(let s=0,i=(n=[...e.students]).length;s<i;s++){let e=n[s];e.id==d.uid?e.warn=t.status:e.warn=!1}return{...e,students:n};case"USER_MUTED":if(n=[...e.students])for(let e=0,s=n.length;e<s;e++){let s=n[e];s.id==t.id&&(s.unmuted=!t.mute,s.unmuted&&!t.recovering&&s.speak++)}return{...e,students:n};case"USER_ADD_ROOM":if(a={...e.teacher},t.id==a.id)return a.online=!0,{...e,teacher:a};for(let s=0,i=(n=[...e.students]).length;s<i;s++){let e=n[s];if(e.id==t.id){e.online=!0,e.online_time=(new Date).getTime();break}}return{...e,students:n};case"NEW_STREAM":if((s=t.stream.getId())==(a={...e.teacher}).id)return a.stream=t.stream,a.online=!0,a.stream_inited=!1,{...e,teacher:a};for(let s=0,i=(n=[...e.students]).length;s<i;s++){let e=n[s];e.id==t.stream.getId()&&(e.stream=t.stream,e.online=!0,e.online_time||(e.online_time=(new Date).getTime()),e.stream_inited=!1)}return{...e,students:n};case"STREAM_LEAVE":if((s=t.stream.getId())==(a={...e.teacher}).id)return a.stream=null,a.online=!1,a.stream_inited=!1,{...e,teacher:a};for(let t=0,i=(n=[...e.students]).length;t<i;t++){let e=n[t];e.id==s&&(e.stream=null,e.online_time=null,e.online=!1,e.dancing=!1,e.stream_inited=!1)}return{...e,students:n};case"HANDSUP_SWITCH":if((i={...e.switches}).handsup=t.status,e.students=e.students||[],n=[...e.students])for(let e=0,t=n.length;e<t;e++)n[e].rank=null;return{...e,switches:i,students:n};case"GIFT_SWITCH":return(i={...e.switches}).gift=t.status,{...e,switches:i};case"MAGIC_SWITCH":return(i={...e.switches}).magic=t.status,{...e,switches:i};case"MUTEALL_SWITCH":if(i={...e.switches},n=[...e.students])for(let e=0,s=n.length;e<s;e++)n[e].unmuted=!t.status;return i.muteall=t.status,{...e,students:n,switches:i};case"RANK_SWITCH":return(i={...e.switches}).rank=t.status,{...e,switches:i};case"SILENT_SWITCH":return(i={...e.switches}).silent=t.status,{...e,switches:i};case"HANDSUP_RANK":if(n=[...e.students])for(let e=0,s=n.length;e<s;e++){let s=n[e];if(s.id==t.id){s.rank=t.rank,s.handsup++;break}}return{...e,students:n};case"DANCING":if(n=[...e.students])for(let e=0,s=n.length;e<s;e++){let s=n[e];s.id==t.id?s.dancing=t.status:s.dancing=!1}return{...e,students:n};case"COURSE_BEGIN":return(o={...e.status}).started=!0,h.a.store("STATUS_"+o.id,o),{...e,status:o};case"COURSE_PAUSE":return(o={...e.status}).paused=!0,h.a.store("STATUS_"+o.id,o),{...e,status:o};case"COURSE_RESUME":return(o={...e.status}).paused=!1,h.a.store("STATUS_"+o.id,o),{...e,status:o};case"COURSE_END":return(o={...e.status}).started=!1,o.paused=!1,h.a.store("STATUS_"+o.id,o),{...e,status:o};case"COURSE_TICK":return(o={...e.status}).started&&!o.paused?(o.duration--,h.a.store("STATUS_"+o.id,o),{...e,status:o}):e;case"COURSE_STARTING_TICK":return(o={...e.status}).waiting-=1e3,{...e,status:o};case"GIFT_UPDATE":n=[...e.students];let u=t.data;if(n)for(let e=0,t=n.length;e<t;e++){let t=n[e];for(let e=0,s=u.length;e<s;e++){let s=u[e];if(s.to_id==t.id){t.gift_total=s.total;break}}}return{...e,students:n};case"PROGRESS_UPDATE":n=[...e.students];let m=t.percent,p=t.id;if(n)if(100==m){let e=null,t=1;for(let s=0,i=n.length;s<i;s++){let i=n[s];i.id==p?(i.percent=m,e=i):i.progress_rank&&t++}e&&(e.progress_rank=t)}else for(let e=0,t=n.length;e<t;e++){let t=n[e];if(t.id==p){t.percent=m;break}}return{...e,students:n};case"PROGRESS_RESET":if(n=[...e.students])for(let e=0,t=n.length;e<t;e++){let t=n[e];t.progress_rank=null,t.percent=null}return{...e,students:n};case"QUESTION_LIST":return(i={...e.switches}).questionList=t.status,{...e,switches:i};case"QUESTION_DETAIL":return(i={...e.switches}).questionDetail=t.status,{...e,switches:i};default:return e}};var p=(e={type:"toast",configure:{content:""}},t)=>{switch(t.type){case"SHOW_TOAST":return{...e,type:"toast",configure:t.configure,showing:!0};case"HIDE_DIALOG":return{...e,showing:!1};default:return e}},g=Object(a.c)({dialog:l,login:d,main:u,room:m,toast:p}),_=s(709),v=s(710),f=s(45),E=s.n(f);var S=new class{constructor(){this.$inited=!1}__init(){this.$dom=E()('<div class="loading-mask"><div class="loading-close"></div><div class="loading-text"></div></div>'),this.$dom.hide().appendTo("body"),this.$inited=!0,E()(this.$dom).on("click",".loading-close",()=>{this.hide()})}show(e=""){this.$inited||this.__init(),E()(".loading-text",this.$dom).html(e),this.$dom.fadeIn()}hide(){this.$dom&&this.$dom.fadeOut()}};const b=e=>({type:"SHOW_ALERT",configure:e}),y=e=>({type:"SHOW_CONFIRM",configure:e}),T=e=>t=>{S.show(e)},C=()=>e=>{S.hide()},N=()=>e=>{let t=h.a.get("USER_INFO");t&&e(w(t))},w=e=>t=>{h.a.store("USER_INFO",e),t({type:"LOGIN_SUCCESS",account:e})},R=e=>({type:"ROOM_MORE_INFO",data:e}),A=e=>({type:"NEW_GIFT",data:e}),D=(e,t)=>({type:"WARN",data:e,status:t}),k=(e,t=!0,s=!1)=>({type:"USER_MUTED",id:e,mute:t,recovering:s}),U=e=>({type:"USER_ADD_ROOM",id:e}),I=e=>({type:"NEW_STREAM",stream:e}),L=e=>({type:"STREAM_LEAVE",stream:e}),x=e=>({type:"HANDSUP_SWITCH",status:e}),O=e=>({type:"MAGIC_SWITCH",status:e}),P=e=>({type:"MUTEALL_SWITCH",status:e}),M=e=>({type:"RANK_SWITCH",status:e}),V=e=>({type:"SILENT_SWITCH",status:e}),F=(e,t)=>({type:"HANDSUP_RANK",id:e,rank:t}),B=(e,t)=>({type:"DANCING",id:e,status:t}),G=(e,t)=>({type:"COURSE_RECORDING",status:e,camp:t}),W=e=>(console.log(e,"device 接收到的page==="),{type:"ENTER_TESTER",page:e}),j=e=>({type:"GIFT_UPDATE",data:e}),H=(e,t)=>({type:"PROGRESS_UPDATE",percent:t,id:e}),q=e=>({type:"QUESTION_DETAIL",status:e}),X=(e,t)=>({type:"CHANGE_PASSWORD",changePwd:e,fromViewUser:t}),K=e=>({type:"SHOW_TOAST",configure:e}),Y=e=>({type:"SHOW_GLOBAL_MSG",globalMsg:e});s(279),s(7);var z,Q=s(4),J=s(2),Z=s(5),ee=s.n(Z),te=s(263),se=s.n(te).a;function ie(e,t,s,i){z||(z="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:z,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}var ne,oe=Object(r.b)((e,t)=>({showing:e.toast.showing}),(e,t)=>({dispatchHide:()=>{e({type:"HIDE_DIALOG"})}}))(class extends n.a.Component{constructor(e){super(e),Z.ipcRenderer.on("hotkey",(e,t)=>{this.onHotKey&&"function"==typeof this.onHotKey&&this.onHotKey(t)})}componentDidMount(){let e=setTimeout(()=>{this.props.dispatchHide(),clearTimeout(e)},3e3)}render(){const{type:e,configure:t}=this.props.data;return ie("div",{className:"toast-box"},void 0,ie("div",{className:"toast"},void 0,ie("p",{},void 0,t.content)))}componentWillUnmount(){}});function re(e,t,s,i){ne||(ne="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:ne,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}var ae=re("div",{className:"title"},void 0,re("div",{className:"none-color"},void 0,"修改密码")),ce=re("div",{className:"safe-title"},void 0,"安全验证");var le,de=Object(r.b)((e,t)=>({showToastState:e.toast}),e=>({loginSuccess:t=>e(w(t)),showLoading:t=>e(T(t)),hideLoading:()=>e(C()),alert:t=>e(b(t)),onShowTost:t=>e(K(t)),onChangePwd:(t,s)=>e(X(t,s))}))(class extends n.a.Component{constructor(e){super(e),this.state={mobile:"",password:"",code:"",dentity:1,showCountBtn:!1,totalNum:60,timer:null,submitBtn:!1,sendCodeBtnText:"获取验证码"}}handleChange(e,t){let s=t.target.value;this.setState({[e]:s},()=>{this.state.mobile&&this.state.password&&this.state.code?this.setState({submitBtn:!0}):this.setState({submitBtn:!1})})}onExit(){this.props.onClose(!!this.props.fromViewUser);let e=(new Date).getTime();localStorage.setItem("FIRSTTIME",e)}onSubmit(){let e=this.state.mobile,t=this.state.password,s=this.state.code;e&&s&&t&&(this.props.showLoading("正在提交..."),Q.default.forgetPassword({mobile:e,password:t,code:s,sms_type:"pc_password"}).then(e=>{Q.default.token=e.token,Q.default.sigtoken=e.signaling_token,J.a.user=e.user,this.props.hideLoading(),this.props.onShowTost({content:"密码修改成功！"}),setTimeout(()=>{this.props.loginSuccess(e.user),this.props.onChangePwd(!1,!1)},3e3)},()=>{this.props.hideLoading()}))}inputOnBlur(){Z.ipcRenderer.send("on-hotkey")}inputOnFocus(){Z.ipcRenderer.send("off-hotkey")}chooseLoginStyle(e){this.setState({currentType:e})}openSafeMask(){if(!/^1[3456789]\d{9}$/.test(this.state.mobile))return this.props.onShowTost({content:"手机号格式不正确！"}),!1;this.setState({showSafeMaskFlag:!0}),this.getCode()}getCode(){Q.default.getNewCodeimg().then(e=>{this.setState({piccode:"",picCodeData:e,picCodeDataImg:e.img,picCodeKey:e.key})})}closeSafeMask(){this.setState({showSafeMaskFlag:!1})}picLogin(){Q.default.getLoginCode({mobile:this.state.mobile,key:this.state.picCodeKey,captcha:this.state.piccode,sms_type:"pc_password"}).then(e=>{this.closeSafeMask(),this.setState({showCountBtn:!0}),this.state.timer=setInterval(()=>{this.setState({totalNum:this.state.totalNum-1,countBtn:!1,sendCodeBtnText:"重新发送"}),this.state.totalNum<=0&&(clearInterval(this.state.timer),this.setState({totalNum:60,showCountBtn:!1,countBtn:!0}))},1e3),this.props.onShowTost({content:"验证码已发送您的手机，十分钟内输入有效！"})})}render(){const{showToastState:e}=this.props;return re("div",{className:"channgepwd-container"},void 0,re("div",{className:"page changepwd-page"},void 0,re("div",{className:"changepwd-box"},void 0,re("div",{className:"icon-img-box",onClick:()=>{this.onExit()}},void 0,re("img",{className:"icon-img",src:s(128)})),ae,re("div",{},void 0,re("div",{className:"input-control"},void 0,re("div",{className:"input-box"},void 0,re("img",{className:"icon-img",src:s(129)}),re("input",{type:"tel",maxLength:"11",onChange:e=>{this.handleChange("mobile",e)},name:"mobile",value:this.state.mobile||"",placeholder:"请输入手机号",onBlur:this.inputOnBlur,onFocus:this.inputOnFocus}))),re("div",{className:"input-control"},void 0,re("div",{className:"input-box code-inputbox"},void 0,re("div",{className:"input-left-box"},void 0,re("img",{className:"icon-img",src:s(130)}),re("input",{type:"tel",maxLength:"4",onChange:e=>{this.handleChange("code",e)},name:"code",value:this.state.code||"",placeholder:"请输入短信验证码",onBlur:this.inputOnBlur,onFocus:this.inputOnFocus})),re("button",{className:11==this.state.mobile.length?"code-box open-code":"code-box",disabled:11!=this.state.mobile.length,style:{display:0==this.state.showCountBtn?"block":"none"},onClick:()=>{this.openSafeMask()}},void 0,this.state.sendCodeBtnText),re("button",{className:this.state.countBtn?"code-box open-code":"code-box",style:{display:1==this.state.showCountBtn?"block":"none"}},void 0,this.state.totalNum,"s可重发"))),re("div",{className:"input-control"},void 0,re("div",{className:"input-box"},void 0,re("input",{type:"password",className:"newpwd-input",onChange:e=>{this.handleChange("password",e)},name:"password",value:this.state.password||"",placeholder:"请设置密码(6-20位字符，支持字母或数字)",onBlur:this.inputOnBlur,onFocus:this.inputOnFocus})))),re("button",{className:this.state.submitBtn?"login-btn":"not-btn",onClick:()=>{this.onSubmit()}}))),re("div",{className:"safe-mask",style:{display:this.state.showSafeMaskFlag?"flex":"none"}},void 0,re("div",{className:"safe-container"},void 0,re("div",{className:"icon-img-box",onClick:()=>{this.closeSafeMask()}},void 0,re("img",{className:"icon-img",src:s(128)})),ce,re("div",{className:"pic-codewrap"},void 0,re("div",{className:"input-left-box"},void 0,re("img",{className:"icon-img",src:s(177)}),re("input",{type:"tel",maxLength:"11",onChange:e=>{this.handleChange("piccode",e)},name:"piccode",value:this.state.piccode,placeholder:"请输入右边图中的验证码",onBlur:this.inputOnBlur,onFocus:this.inputOnFocus})),re("div",{className:"pic-codebox",onClick:()=>{this.getCode()}},void 0,re("img",{className:"icon-img",src:this.state.picCodeDataImg}))),re("button",{className:"login-btn",onClick:()=>{this.picLogin()}}))),e.showing?re(oe,{data:e}):"")}});function ue(e,t,s,i){le||(le="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:le,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}var he=ue("div",{className:"box-mline"}),me=ue("div",{className:"safe-title"},void 0,"安全验证");var pe=Object(r.b)((e,t)=>({showToastState:e.toast,changePwd:e.main.changePwd,fromViewUser:e.main.fromViewUser}),e=>({loginSuccess:t=>e(w(t)),showLoading:t=>e(T(t)),hideLoading:()=>e(C()),alert:t=>e(b(t)),onShowTost:t=>e(K(t)),onChangePwd:(t,s)=>e(X(t,s))}))(class extends n.a.Component{constructor(e){super(e),this.state={mobile:"",password:"",code:"",piccode:"",dentity:1,currentType:"code",showSafeMaskFlag:!1,showCountBtn:!1,totalNum:60,timer:null,submitBtn:!1,submitcode:!1,sendCodeBtnText:"获取验证码",debugIp:localStorage.getItem("debug_ip")}}handleChange(e,t){let s=t.target.value.trim();this.setState({[e]:s},()=>{this.state.mobile&&this.state.code?this.setState({submitBtn:!0}):this.setState({submitBtn:!1}),this.state.mobile&&this.state.password?this.setState({submitcode:!0}):this.setState({submitcode:!1})})}onLogin(){let e=this.state.mobile,t=this.state.password,s=this.state.code,i=this.state.dentity;("code"!=this.state.currentType||e&&s)&&("password"!=this.state.currentType||e&&t)&&(this.props.showLoading("正在登录..."),"password"==this.state.currentType?Q.default.login({mobile:e,password:t,dentity:i}).then(e=>{Q.default.token=e.token,Q.default.sigtoken=e.signaling_token,J.a.user=e.user,this.props.hideLoading(),this.props.loginSuccess(e.user)},()=>{this.props.hideLoading()}):"code"==this.state.currentType&&Q.default.newLogin({mobile:e,code:s,sms_type:"pc_login"}).then(e=>{Q.default.token=e.token,Q.default.sigtoken=e.signaling_token,J.a.user=e.user,this.props.hideLoading(),this.props.loginSuccess(e.user)},()=>{this.props.hideLoading()}))}inputOnBlur(){Z.ipcRenderer.send("on-hotkey")}inputOnFocus(){Z.ipcRenderer.send("off-hotkey")}chooseLoginStyle(e){this.setState({currentType:e})}openSafeMask(){if(!/^1[3456789]\d{9}$/.test(this.state.mobile))return this.props.onShowTost({content:"手机号格式不正确！"}),!1;this.setState({showSafeMaskFlag:!0}),this.getCode()}getCode(){Q.default.getNewCodeimg().then(e=>{this.setState({piccode:"",picCodeData:e,picCodeDataImg:e.img,picCodeKey:e.key})})}closeSafeMask(){this.setState({showSafeMaskFlag:!1})}picLogin(){Q.default.getLoginCode({mobile:this.state.mobile,key:this.state.picCodeKey,captcha:this.state.piccode,sms_type:"pc_login"}).then(e=>{this.closeSafeMask(),this.setState({showCountBtn:!0}),this.state.timer=setInterval(()=>{this.setState({totalNum:this.state.totalNum-1,countBtn:!1,sendCodeBtnText:"重新发送"}),this.state.totalNum<=0&&(clearInterval(this.state.timer),this.setState({totalNum:60,showCountBtn:!1,countBtn:!0}))},1e3),this.props.onShowTost({content:"验证码已发送您的手机，十分钟内输入有效！"})})}forgetPassWord(){this.props.onChangePwd(!0,!0)}__select_server(e){localStorage.setItem("debug_ip",e),this.setState({debugIp:e}),this.props.onShowTost({content:`已切换至 - ${e}`}),setTimeout(()=>{Z.remote.getCurrentWindow().reload()},500)}render(){const{showToastState:e,changePwd:t,fromViewUser:i}=this.props;let n=0,o=this.state.debugIp||"";return/steven/.test(o)?n=1:/mingxiyuwen/.test(o)&&(n=2),ue("div",{className:"full-h"},void 0,this.state.debugIp||(window.ENV_CONF||{}).DEBUG||(window.ENV_CONF||{}).TEST?ue("div",{className:"choose-server"},void 0,ue("div",{className:`server-btn ${0==n?"sel":""}`,onClick:()=>{0!=n&&this.__select_server("http://kecheng1.youshiyuwen.cn")}},void 0,"kecheng1"),ue("div",{className:`server-btn ${1==n?"sel":""}`,onClick:()=>{1!=n&&this.__select_server("http://steven.mx0a.com")}},void 0,"steven"),ue("div",{className:`server-btn ${2==n?"sel":""}`,onClick:()=>{2!=n&&this.__select_server("https://www.mingxiyuwen.com")}},void 0,"online")):"",ue("div",{className:"page login-page"},void 0,ue("div",{className:"login-box"},void 0,ue("div",{className:"title"},void 0,ue("div",{className:"code"==this.state.currentType?"current-style":"none-color",onClick:()=>{this.chooseLoginStyle("code")}},void 0,"验证码登录"),he,ue("div",{className:"password"==this.state.currentType?"current-style":"none-color",onClick:()=>{this.chooseLoginStyle("password")}},void 0,"密码登录")),"code"==this.state.currentType?ue("div",{},void 0,ue("div",{className:"input-control"},void 0,ue("div",{className:"input-box"},void 0,ue("img",{className:"icon-img",src:s(129)}),ue("input",{type:"tel",maxLength:"11",onChange:e=>{this.handleChange("mobile",e)},name:"mobile",value:this.state.mobile,placeholder:"请输入手机号",onBlur:this.inputOnBlur,onFocus:this.inputOnFocus}))),ue("div",{className:"input-control"},void 0,ue("div",{className:"input-box code-inputbox"},void 0,ue("div",{className:"input-left-box"},void 0,ue("img",{className:"icon-img",src:s(130)}),ue("input",{type:"tel",maxLength:"4",onChange:e=>{this.handleChange("code",e)},name:"code",value:this.state.code,placeholder:"请输入短信验证码",onBlur:this.inputOnBlur,onFocus:this.inputOnFocus})),ue("button",{className:11==this.state.mobile.length?"code-box open-code":"code-box",disabled:11!=this.state.mobile.length,style:{display:this.state.showCountBtn?"none":"block"},onClick:()=>{this.openSafeMask()}},void 0,this.state.sendCodeBtnText),ue("button",{className:this.state.countBtn?"code-box open-code":"code-box",style:{display:this.state.showCountBtn?"block":"none"}},void 0,this.state.totalNum,"s可重发"))),ue("div",{className:"submit-wrap"},void 0,ue("button",{className:this.state.submitBtn?"login-btn":"not-btn",onClick:()=>{this.onLogin()}}))):ue("div",{},void 0,ue("div",{className:"input-control"},void 0,ue("div",{className:"input-box"},void 0,ue("img",{className:"icon-img",src:s(129)}),ue("input",{type:"tel",maxLength:"11",onChange:e=>{this.handleChange("mobile",e)},name:"mobile",value:this.state.mobile,placeholder:"请输入手机号",onBlur:this.inputOnBlur,onFocus:this.inputOnFocus}))),ue("div",{className:"input-control"},void 0,ue("div",{className:"input-box"},void 0,ue("img",{className:"icon-img",src:s(130)}),ue("input",{type:"password",onChange:e=>{this.handleChange("password",e)},name:"password",value:this.state.password,placeholder:"请输入密码",onBlur:this.inputOnBlur,onFocus:this.inputOnFocus}))),ue("div",{className:"forget-pw",onClick:()=>{this.forgetPassWord()}},void 0,"忘记密码"),ue("div",{className:"submit-wrap"},void 0,ue("button",{className:this.state.submitcode?"login-btn":"not-btn",onClick:()=>{this.onLogin()}}))))),ue("div",{className:"safe-mask-main",style:{display:this.state.showSafeMaskFlag?"flex":"none"}},void 0,ue("div",{className:"safe-container"},void 0,ue("div",{className:"icon-img-box",onClick:()=>{this.closeSafeMask()}},void 0,ue("img",{className:"icon-img",src:s(128)})),me,ue("div",{className:"pic-codewrap"},void 0,ue("div",{className:"input-left-box"},void 0,ue("img",{className:"icon-img",src:s(177)}),ue("input",{type:"tel",maxLength:"11",onChange:e=>{this.handleChange("piccode",e)},name:"piccode",value:this.state.piccode,placeholder:"请输入右边图中的验证码",onBlur:this.inputOnBlur,onFocus:this.inputOnFocus})),ue("div",{className:"pic-codebox",onClick:()=>{this.getCode()}},void 0,ue("img",{className:"icon-img",src:this.state.picCodeDataImg}))),ue("button",{className:"login-btn",onClick:()=>{this.picLogin()}}))),e.showing?ue(oe,{data:e}):"",t?ue(de,{onClose:()=>{this.props.onChangePwd(!1,!1)}}):"")}}),ge=(s(290),s(62)),_e=s.n(ge);const ve="MESSAGE_RPC_BRIDGE";var fe=new class{constructor(){this.$uuid=0,this.$handlers={},this.$sender_pool={},this.$delegate={},_e.a?(this.$sender=ee.a.ipcRenderer,this.$receiver=ee.a.ipcRenderer):this.$receiver=ee.a.ipcMain,this.__bind()}__bind(){this.$receiver.on(ve,(e,t)=>{if(!_e.a){let s=e.sender.getOwnerBrowserWindow();s&&"id"in t&&(this.$sender_pool[t.id]=s)}this.__received(t)})}__send(e){let t=this.$sender;!t&&"id"in e&&(t=this.$sender_pool[e.id]),t?t.send(ve,e):console.error("no sender for message",e)}__received(e){if("error"in e||"result"in e){const t=e.id,s=this.$handlers[t];if(s){try{s(e.error,e.result)}catch(e){console.error("call message handler error",e)}delete this.$handlers[t],delete this.$sender_pool[t]}else console.error("no callback handler for message",t)}else if("method"in e){let t=this.$delegate[e.method],s=e.id;if(!t)return void this.__send({id:s,error:`no method named ${e.method}`});let i=this.$sender||this.$sender_pool[s];Promise.resolve(t(e.args,i)).then((t=null)=>{e.id&&this.__send({id:s,result:t})}).catch(e=>{this.__send({id:s,error:e.message})})}}set delegate(e){for(let t in e)this.$delegate[t]=e[t]}removeDelegate(e){delete this.$delegate[e]}call({method:e,args:t,sender:s}){if(_e.a||s)return new Promise((i,n)=>{let o=(_e.a?"R":"M")+ ++this.$uuid;this.$handlers[o]=(e,t)=>{e?n(e):i(t)},_e.a||(this.$sender_pool[o]=s),this.__send({id:o,method:e,args:t})});console.error("call from main process must set sender")}},Ee=s(35),Se=s(96),be=s.n(Se),ye=s(73);const Te=Z.remote.require("electron-log");var Ce,Ne=new class{constructor(){Ee.a.update(),this.$domains=JSON.parse(Ee.a.get("DOMAINS")||"{}")}get domains(){return this.$domains}set domains(e){this.$domains=e}pull(e){let t=t=>{t&&(this.$domains=t,this.__snyc_domains()),e()};this.$timer_pulling_domain=setTimeout(()=>{clearTimeout(this.$timer_pulling_domain),this.$timer_pulling_domain=null,t()},5e3),fe.call({method:"getDomains",args:{url:ye.TEST||ye.DEBUG?be.a.DOMAIN_URL_TEST:be.a.DOMAIN_URL}}).then(e=>{clearTimeout(this.$timer_pulling_domain),this.$timer_pulling_domain=null,t(e)})}__snyc_domains(){Ee.a.store("DOMAINS",JSON.stringify(this.$domains))}availibleDomain(e,t){try{let s=this.$domains[e],i=null,n=null;if(!s)return null;let o=s=>(s.used=!0,s.active=!0,Te.log("[debug-domain]",`使用了一个${t?"新的":""}域名:`,e,s.url),s.url);for(let e of s){let{url:s,used:r,active:a}=e;t||n||(n=()=>o(e)),(t?a||r:!a)?e.active=!1:i||(o(e),i=s)}return this.__snyc_domains(),i||t||!n?i:n()}catch(e){}return null}};function we(e,t,s,i){Ce||(Ce="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:Ce,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}const Re=Z.remote.require("electron-log");var Ae=class extends n.a.Component{constructor(e){super(e),this.$downloading=null,this.state={title:"准备更新基础库...",percent:0,notice:""},this.$domain_course=Ne.availibleDomain("course"),console.log("MINGXI_DEBUG_LOG>>>>>>>>>init download","")}__start(e){const t=this.props.data,s=this.props.recording,i=this.props.camp,n=this.props.homework,o=this.props.preview,r=Ne.availibleDomain("frame",e);if(!r)return void this.__setStatus("UPDATE.ERROR",new Error("检测基础库出错，无可用域名"));const a={room:t,token:Q.default.token,account:this.props.user};let c=!1;n?this.__update_homework_frame(r).then(e=>{Re.log(`下载作业资源成功。版本号：${e.version} 资源库下载地址：${r}`),this.props.complete(a)}).catch(e=>{Re.error("检测作业资源出错",e,`下载地址：${r}/homework.json`),this.__setStatus("UPDATE.ERROR",e),this.__start(!0)}):o?this.__update_base_frame(r).then(e=>{Re.log(`下载基础库成功。版本号：${e.version} 基础库下载地址：${r}`);let s=t.prepare_name;return c=!0,this.__update_preview_bundle(s)}).then(e=>{Re.log(`下载预习课程包成功。课程名：${t.prepare_name}, 版本号：${e.version}`),this.__on_complete(a)}).catch(e=>{this.__setStatus("UPDATE.ERROR",e),c?Re.error("检测预习课程包出错",e):(Re.error("检测基础库出错",e,`基础库下载地址：${r}/liveroom.json 预习课程包:${t.prepare_name}.json`),this.__start(!0))}):this.__update_base_frame(r).then(e=>{Re.log(`下载基础库成功。版本号：${e.version} 基础库下载地址：${r}`);let n=t.en_name;return s&&!i&&(n+=`.${t.version}`.replace("..",".")),c=!0,this.__update_course_bundle(n)}).then(e=>{Re.log(`下载课程包成功。课程名：${t.en_name}, 版本号：${e.version}`),this.__on_complete(a)}).catch(e=>{this.__setStatus("UPDATE.ERROR",e),c?Re.error("检测课程包出错",e):(Re.error("检测基础库出错",e,`基础库下载地址：${r}/liveroom.json 课程包：${t.en_name}.json`),this.__start(!0))})}__restart(){this.setState({title:"准备更新基础库...",percent:0,notice:"",error:null}),this.__start()}componentDidMount(){this.__start()}componentWillUnmount(){this.$unmounted=!0,this.$downloading&&fe.call({method:"abortDownloadTask",args:{identity:this.$downloading}}).then(()=>{Re.log("中止任务成功",this.$downloading)}).catch(e=>{Re.error("中止任务失败",this.$downloading,e)})}__setStatus(e,t){if(!this.$unmounted)switch(this.setState({error:null}),e){case"UPDATE.BASEFRAME":this.setState({title:"准备下载基础库"});break;case"UPDATE.DOWNLOADING":this.setState({notice:"正在下载，请稍候...",percent:Math.min(1,t.percent)});break;case"UPDATE.ERROR":this.setState({error:`下载失败，${t}`});break;case"UPDATE.DOWNLOADED_UI":this.setState({notice:"下载成功！",percent:1});break;case"UPDATE.DOWNLOADING_UI":this.setState({notice:"有版本更新，等待下载...",percent:0});break;case"UPDATE.LASTEST":this.setState({notice:"已是最新版本，无需更新。",percent:1});break;case"UPDATE.COURSE_BUNDLE":this.setState({title:"准备下载课程包"})}}__on_complete(e){let t=this.props.recording,s=this.props.camp,i=this.props.preview;t?s?(e.recording=!0,e.camp=!0,this.props.complete(e)):Q.default.getRoomInfoForRecord(e.room.channel_id).then(s=>{e.students=s.students,e.recording=t,this.props.complete(e)},e=>{this.props.error(e)}):Q.default.getRoomInfo(e.room.channel_id,i).then(t=>{e.students=t.students,e.channel_token=t.channel_token,e.rtm_signaling_token=t.rtm_signaling_token,e.features=t.features,e.star_switch=t.star_switch,e.eye_switch=t.eye_switch,this.props.complete(e)},e=>{this.props.error(e)})}__do_update_bundle({pack:e,result:t,base_url:s=this.$base_url,checksum:i=!0}){return new Promise((n,o)=>{fe.call({method:"startDownloadTask",args:{pack:e,url:`${s}/${t.url}`,md5:t.md5,version:t.version,key:t.lesson,autoUnzip:!0,checksum:i}}).then(e=>{let s=e.identity;this.$downloading=s,fe.delegate={[`${s}/progress`]:({total:e,transferred:t,percent:s})=>{this.__setStatus("UPDATE.DOWNLOADING",{percent:s})},[`${s}/error`]:e=>{this.$downloading=null,this.__setStatus("UPDATE.ERROR",e.message),o(e)},[`${s}/success`]:()=>{this.$downloading=null,this.__setStatus("UPDATE.DOWNLOADED_UI"),n(t)}}}).catch(t=>{this.$downloading=null,Re.error("下载文件出错",e,t),o(t)})})}__update_homework_frame(e){return new Promise((t,s)=>{fe.call({method:"isUpdateAvailable",args:{url:`${e}/homework.json`,pack:"homeworkroom"}}).then(i=>{this.__setStatus("UPDATE.BASEFRAME"),i.available?(this.__setStatus("UPDATE.DOWNLOADING_UI"),this.__do_update_bundle({pack:"homeworkroom",result:i.server,base_url:e}).then(e=>{t(e)}).catch(e=>{s(e)})):(this.__setStatus("UPDATE.LASTEST"),t(i.server))}).catch(e=>{s(e)})})}__update_base_frame(e){return new Promise((t,s)=>{fe.call({method:"isUpdateAvailable",args:{url:`${e}/liveroom.json`,pack:"liveroom"}}).then(i=>{this.__setStatus("UPDATE.BASEFRAME"),i.available?(this.__setStatus("UPDATE.DOWNLOADING_UI"),this.__do_update_bundle({pack:"liveroom",result:i.server,base_url:e}).then(e=>{t(e)}).catch(e=>{s(e)})):(this.__setStatus("UPDATE.LASTEST"),t(i.server))}).catch(e=>{s(e)})})}__update_preview_bundle(e){return new Promise((t,s)=>{fe.call({method:"getLocalInstalledVersion",args:{pack:"preview-ui"}}).then(i=>{let n=o=>{let r=Ne.availibleDomain("course",o);if(!r){let t=`no avalible domain for course-preview[${e}] retrying`;return Re.log("[debug-domain] errorMessage",t),void s(new Error(t))}fe.call({method:"getServerPackageVersion",args:{url:`${r}/${e}.json`}}).then(e=>{this.__setStatus("UPDATE.COURSE_BUNDLE"),e=e||{},i&&i.key==e.lesson&&i.md5==e.md5?(this.__setStatus("UPDATE.LASTEST"),t(e)):(this.__setStatus("UPDATE.DOWNLOADING_UI"),this.__do_update_bundle({pack:"preview-ui",result:e,base_url:r}).then(e=>{t(e)}).catch(e=>{s(e)}))}).catch(e=>{n(!0)})};n()}).catch(e=>{s(e)})})}__update_course_bundle(e){return new Promise((t,s)=>{fe.call({method:"getLocalInstalledVersion",args:{pack:"course-ui"}}).then(i=>{let n=o=>{let r=Ne.availibleDomain("course",o);if(!r){let e="no avalible domain for course retrying";return Re.log("[debug-domain] errorMessage",e),void s(new Error(e))}fe.call({method:"getServerPackageVersion",args:{url:`${r}/${e}.json`}}).then(e=>{this.__setStatus("UPDATE.COURSE_BUNDLE"),e=e||{},i&&i.key==e.lesson&&i.md5==e.md5?(this.__setStatus("UPDATE.LASTEST"),t(e)):(this.__setStatus("UPDATE.DOWNLOADING_UI"),this.__do_update_bundle({pack:"course-ui",result:e,base_url:r}).then(e=>{t(e)}).catch(e=>{s(e)}))}).catch(e=>{n(!0)})};n()}).catch(e=>{s(e)})})}render(){return we("div",{className:"downloader"},void 0,we("div",{className:"info"},void 0,this.state.title),this.state.error?[we("div",{className:"info notice"},"notice",this.state.error),we("div",{className:"restart-btn",onClick:()=>{this.__restart()}},"restart")]:[we("div",{className:"progress"},"progress",we("div",{className:"bar"},void 0,we("div",{className:"bar-i",style:{width:`${100*this.state.percent}%`}})),we("div",{className:"percent"},void 0,100*this.state.percent>>0,"%")),we("div",{className:"info notice"},"notice",this.state.notice)])}},$e=s(78),De=s(8);var ke=class extends $e.a{constructor(e){super(),this.$inst=e,this.$uuid=0,this.$_parts=[],this.$jsready=!1,this.$queue=[]}uuid(){return++this.$uuid}init(e){window.CANVAS_HOLDER=e,this.$dom=J.a.get(e),this.__bind(),this.__createWebview()}__createWebview(){let e,t=window.ENV_CONF||{};e=t.DEBUG?"mingxi://liveroom":t.TEST?De.default.TEST_URL:De.default.ONLINE_URL,E.a.get(`${e}?from=app&t=`+(new Date).getTime(),t=>{this.$inst.isMaster()?window.CANVAS_LOCATION=`${e}?from=app`:window.CANVAS_LOCATION=`${e}?from=native`,window.CANVAS_SIZE=[this.$dom.width(),this.$dom.height()],window.$=E.a;let s=[];t.replace(/<script.+?src="([^"]+)"/g,(t,i)=>{/(flexible)|(zepto)|(vconsole)/.test(i)||(/^\//.test(i)&&(i=e+i),s.push(i))});let i=()=>{let e=s.shift();if(e){var t=document.createElement("script");t.async=!0,t.src=e,t.onload=i,document.getElementsByTagName("head")[0].appendChild(t)}};i()})}reload(){}__bind(){window.ON_SESSION_MESSAGE=e=>{console.log("receive session message",e),this.receive_message(e)}}send_message(e,t={},s={}){if(this.$jsready){let i={message:t,from:this.$inst.props.account.id,to:"app",type:e};for(let e in s)i[e]=s[e];window.BridgeH5Do&&window.BridgeH5Do(i)}else this.$queue.push([e,t,s])}receive_message(e){"jsready"==e.type&&(this.$jsready=!0,console.log("jsready..",this.$queue),this.$queue.forEach(e=>{this.send_message(...e)}),this.$queue=[]),this.trigger("NEW_MESSAGE",e)}destroy(){this.$_parts=[],this.$jsready=!1,this.$queue=[],J.a.empty(this.$dom)}};var Ue,Ie=class extends n.a.Component{constructor(e){super(e),this.$uuid=0,this.$stat_arr=[],this.$session=new ke(this),this.$entered=!1}get uuid(){return++this.$uuid}isMaster(e){console.log("course.base.page isMaster called",this.props.room),e||(e=this.props.account.id);for(let t=0,s=this.props.room.teachers.length;t<s;t++)if(this.props.room.teachers[t].id==e)return!0}isChairMaster(e){return e||(e=this.props.account.id),this.props.room.teacher_id==e}isSubMaster(e){return e||(e=this.props.account.id),this.isMaster(e)&&!this.isChairMaster(e)}getUser(e){if(e==this.props.teacher.id)return this.props.teacher;for(let t=0,s=this.props.students.length;t<s;t++){let s=this.props.students[t];if(s.id==e)return s}}__load_sound(e){J.a.getDownloaded(e)||(console.log("call load file...",e),Z.ipcRenderer.send("DOWNLOAD",e))}playMusic(e,t){this.stopMusic();let s=e,i=J.a.getDownloaded(e);i&&(s=i);let n=this.$room.rtc.startAudioMixing(s,!0,!1,1);Q.default.log({name:"play music",soundUrl:s,needevent:t,result:n}),t?(this.$playing=e,this.$session.send_message("soundupdate",{url:this.$playing,time:0})):this.$playing=!1}stopMusic(e){let t=this.$room.rtc.stopAudioMixing();console.log("stop audio mix",t),this.$playing&&(e||this.$session.send_message("soundended",{url:this.$playing}),this.$playing=null)}componentWillUnmount(){this.$signal.leave(),this.$room.leave(),this.$session.destroy(),clearInterval(this.$tick_timer),clearInterval(this.$music_timer),clearTimeout(this.$back_timer),clearTimeout(this.$put_timer),J.a.empty("dancing-head"),J.a.empty(".avatar-head"),clearTimeout(this.$reload_timer),window.onresize=null,this.props.hideLoading(),J.a.detector.check(),this.onHotKey=null,Z.ipcRenderer.removeListener("DOWNLOADED",this.$downloaded_handler)}componentDidMount(){J.a.detector.uncheck(),this.$room.rtc.on("networkquality",(e,t,s)=>{if(console.log("网络状态：",e,t,s),0==e){let e=Math.max(t,s);if(e=1==e||2==e?1:3==e?2:4==e?3:5==e?4:0,this.$stat_arr.push(e),this.$stat_arr.length>=3){let t=0;this.$stat_arr.forEach(e=>{t+=e}),e=t/this.$stat_arr.length>>0,J.a.detector.setStatus(e),this.$stat_arr=[]}else J.a.detector.setStatusOnce(e)}});let e=null;this.$signal.on("RECONNECT_SIGNAL",()=>{this.props.showLoading("网络不稳定哦，正在重连中~")}),this.$signal.on("CONNECT_SIGNAL",()=>{this.props.showLoading("正在连线其他人，稍等一下~"),e=setTimeout(()=>{this.props.showLoading("当前网络环境不太好哦，耐心等一等吧~")},6e3)}),this.$signal.on("HIDE_LOADING",()=>{this.props.hideLoading(),clearTimeout(e)}),this.$signal.on("NETWORK_BAD",()=>{this.props.showLoading("网络状态不佳，稍等一下~")}),this.$signal.on("CONNECTED_SIGNAL",()=>{this.props.hideLoading(),clearTimeout(e),this.$session.send_message("signal_connected")}),this.$signal.on("RECONNECTED_SIGNAL",()=>{this.$session.send_message("signal_reconnected")}),this.$signal.on("CONNECT_SIGNAL_ERROR",()=>{this.props.showLoading("当前网络环境不太好哦，耐心等一等吧~"),clearTimeout(e)}),this.$signal.on("CONNECT_KICKED",()=>{this.props.showLoading("有人登录了你的帐号哦~"),clearTimeout(e)}),this.$signal.on("CHANNEL_NEW_USER",e=>{this.$session.send_message(De.default.MEMBER_ADD,{},{userinfos:e.userinfos}),console.log("channel new user...",e.userinfos)}),this.$signal.on("CHANNEL_USER_LEAVE",e=>{this.$session.send_message(De.default.MEMBER_LEAVE,{},{userinfos:[e]})}),this.$signal.on("NEW_MESSAGE",e=>{console.log("receive new from app",e),this.__on_signal_message(e)}),this.$session.on("NEW_MESSAGE",e=>{this.__on_session_message(e)}),this.__query_roominfo_more(),this.$session.init("#course-content"),Q.default.getServerTime().then(e=>{this.setState({time:1e3*e.time}),this.setState({time_diff:1e3*e.time-Date.now()})}),this.$room.rtc.on("audiomixingfinished",()=>{console.log("on audiomixingfinished",this.$playing),this.$playing&&(this.$session.send_message("soundended",{url:this.$playing}),this.$playing=null)}),this.__tick()}__get_server_time(){return Date.now()+(this.state.time_diff||0)}__query_roominfo_more(e){console.log("start querying more roominfo..."),this.$roominfo_callbacks=this.$roominfo_callbacks||[],e&&this.$roominfo_callbacks.push(e),this.$roominfo_networking||(this.$roominfo_networking=!0,Q.default.getRoomInfo(this.props.room.channel_id).then(e=>{this.$roominfo_networking=!1,this.$entered=!0,this.props.onRoomMoreInfo(e),this.$room.start(),this.$signal.join(),this.__send_init_room(),this.$roominfo_callbacks.forEach(e=>{e(!0)}),this.$roominfo_callbacks=null},()=>{console.log("call error leave course"),this.leaveCourse()}))}__get_feature(e){let t;return console.log("__get_feature,uid:",e),e||(e=this.props.account.id),this.props.students.map(s=>{s&&s.id==e&&(t=s.frature)}),t}__get_feature_hash(){let e={};return this.props.students.map(t=>{t&&t.id&&(e[t.id]=t.frature)}),e}__send_init_room(){let e=[];this.props.room.teachers.forEach(t=>{e.push(t.id)});let t=[this.props.teacher];t=t.concat(this.props.students),this.$session.send_message(De.default.INIT_ROOM,{channel_id:this.props.room.channel_id,token:Q.default.token},{master_ids:e,userinfos:t,feature_data:this.__get_feature_hash(),classroom_info:{teacher_name:this.props.room.teacher_name,teacher_id:this.props.room.teacher_id,teacher_avatar:this.props.room.teacher_avatar,channel_token:this.props.room.channel_token,agora_appid:J.a.agoraAppId,userid:this.props.account.id}})}__tick(e){this.$tick_timer=setInterval(()=>{this.props.onCourseTick(),e&&"function"==typeof e&&e()},1e3),this.$music_timer=setInterval(()=>{if(this.$playing){let e=this.$room.rtc.getAudioMixingCurrentPosition();this.$session.send_message("soundupdate",{url:this.$playing,time:e})}},100)}__on_session_message(e,t){if("app"==e.to||t){let t=e.message;switch(e.type){case De.default.JS_READY:break;case De.default.OPEN_MIC:this.props.onUserMuted(t.uid,!1,"app"==e.to),this.$room.refreshMute();break;case De.default.CLOSE_MIC:this.props.onUserMuted(t.uid,!0),this.$room.refreshMute();break;case De.default.ENABLE_MAGIC:this.props.onMagicSwitch(!0);break;case De.default.DISABLE_MAGIC:this.props.onMagicSwitch(!1);break;case De.default.MUTE_ALL:this.props.onMuteAllSwitch(!0),this.$room.refreshMute();break;case De.default.UNMUTE_ALL:this.props.onMuteAllSwitch(!1),this.$room.refreshMute();break;case De.default.SHOW_RANKS:this.props.onRankSwitch(!0);break;case De.default.HIDE_RANKS:this.props.onRankSwitch(!1);break;case De.default.PUT_DANCE:this.props.onDancing(t.id,!0),this.$room.refreshMute();break;case De.default.BACK_DANCE:this.props.onDancing(t.id,!1),this.$room.refreshMute();break;case De.default.START_COURSE:this.setState({control:!1}),this.props.onBeginCourse();break;case"playsound":let s=t.url,i=t.needevent;this.playMusic(s,i);break;case"stopsound":let n=t.noevent;this.stopMusic(n);break;case"showdraft":this.showDraft(t.content);break;case"showfeature":this.showFeature(t.feature);case"loadsound":this.__load_sound(t.url);break;case"course-process":this.setState({process:t});break;case"openStream":this.openStream(t.state);break;default:-1==e.type.indexOf("*")&&this.__on_signal_message(e)}}else this.$signal.send(e)}__in_weak_net(){return 0==this.props.netStatus&&!this.isMaster()}showDraft(e){this.isMaster()&&this.setState({draft:e})}showFeature(e){this.isMaster()&&this.setState({feature:e})}hideDraft(){this.setState({draft:null})}__on_signal_message(e){let t=e.message;switch(e.type){case"closeroom":this.leaveCourse();break;case De.default.OPEN_MIC:case De.default.CLOSE_MIC:case De.default.PUT_DANCE:case De.default.BACK_DANCE:this.$session.send_message(null,null,e);break;case De.default.OPEN_RACE:this.props.onHandsupSwitch(!0),this.$session.send_message(null,null,e);break;case De.default.CLOSE_RACE:this.props.onHandsupSwitch(!1),this.$session.send_message(null,null,e);break;case"racerank":this.props.onHandsupRank(t.uid,t.rank);break;case De.default.NEXT_PAGE:this.$playing=!1,this.hideDraft(),this.props.onProgressReset(),this.$session.send_message(null,null,e);break;case De.default.DISABLE_MAGIC:this.props.onProgressReset(),this.$session.send_message(null,null,e);break;case"gift":this.props.onNewGift(t),this.$session.send_message(null,null,e);break;case"progress":this.props.switches.magic&&this.props.onProgressUpdate(e.from,t.percent);break;case De.default.WARN:this.props.onWarn(t,!0),this.$session.send_message(null,null,e);break;case De.default.WARN_RELIEVE:this.props.onWarn(t,!1),this.$session.send_message(null,null,e);break;case De.default.OPEN_MEDDLE:this.reportInfo(e);break;case"helpToSelectDevice":this.selectDevice(t.uid,t.kind,t.deviceId,t.deviceName);break;default:this.$session.send_message(null,null,e)}}reportInfo(){}selectDevice(e,t,s,i){}openStream(e){}leaveCourse(){}preLeaveCourse(e){}__put_to_dancing(e){if(this.$last_dancing){if(this.$last_dancing==e)return;this.__back_from_dancing(this.$last_dancing)}console.log("do put message",e),J.a.empty(`#student_${e}`),J.a.empty("#dancing-head"),this.$room.cameraTo(e,J.a.get("#dancing-head"),!0),this.$last_dancing=e}__back_from_dancing(e){if(this.$last_dancing&&this.$last_dancing==e){if(J.a.empty("#dancing-head"),J.a.empty(`#student_${e}`),this.__in_weak_net()&&e!=this.props.account.id){let t=this.getUser(e);t&&(t.stream_inited=!1),this.$room.unsubscribe(e)}else this.$room.cameraTo(e,J.a.get(`#student_${e}`));this.$last_dancing=null}}onHelpClick(){this.props.confirm({title:"设备检测",content:"即将进行设备检测，是否暂时退出教室？",sure:()=>{this.props.showLoading("正在退出房间..."),this.$waiting_to_tester=!0,this.leaveCourse()}})}};function Le(e,t,s,i){Ue||(Ue="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:Ue,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}const xe=s(4),Oe=s(8),{getCurrentWindow:Pe}=$require("electron").remote,{ipcRenderer:Me}=$require("electron"),Ve=$require("fs");var Fe=Le("div",{className:"videos-container",id:"videos-container"}),Be=Le("div",{className:"content"},void 0,Le("div",{className:"course-content kc-canvas-area cocos",id:"course-content"}));var Ge,We=Object(r.b)((e,t)=>({account:e.login.account,room:e.room.info,students:e.room.students,teacher:e.room.teacher,started:e.main.courseStarted,switches:e.room.switches,status:e.room.status,netStatus:e.main.netStatus}),e=>({onRoomMoreInfo:t=>e(R(t)),onNewStream:t=>e(I(t)),onStreamLeave:t=>e(L(t)),onHandsupSwitch:t=>e(x(t)),onMagicSwitch:t=>e(O(t)),onRankSwitch:t=>e(M(t)),onMuteAllSwitch:t=>e(P(t)),onSilentSwitch:t=>e(V(t)),onNewGift:t=>e(A(t)),onWarn:(t,s)=>e(D(t,s)),onHandsupRank:(t,s)=>e(F(t,s)),onUserMuted:(t,s,i)=>e(k(t,s,i)),onDancing:(t,s)=>e(B(t,s)),onEndCourse:()=>e({type:"COURSE_END"}),onBeginCourse:()=>e({type:"COURSE_BEGIN"}),onPauseCourse:()=>e({type:"COURSE_PAUSE"}),onResumeCourse:()=>e({type:"COURSE_RESUME"}),onCourseTick:()=>e({type:"COURSE_TICK"}),confirm:t=>e(y(t)),alert:t=>e(b(t)),onEnterTester:t=>e(W(t)),showLoading:t=>e(T(t)),hideLoading:()=>e(C()),onUpdateGift:t=>e(j(t)),onProgressUpdate:(t,s)=>e(H(t,s)),onProgressReset:()=>e({type:"PROGRESS_RESET"}),onUserAddRoom:t=>e(U(t)),onQuestionList:t=>e((e=>({type:"QUESTION_LIST",status:e}))(t)),onQuestionDetail:t=>e(q(t)),onCourseRecording:t=>e(G(t))}))(class extends Ie{constructor(e){super(e),this.$uuid=0,this.$audio=n.a.createRef(),this.$audios_files={},Me.on("DOWNLOADED",(e,t,s)=>{this.$audios_files[t]=s})}componentDidMount(){this.$session.on("NEW_MESSAGE",e=>{this.__on_session_message(e)}),this.$session.init("#course-content"),this.__query_roominfo_more(),xe.getServerTime().then(e=>{this.setState({time:1e3*e.time}),this.setState({time_diff:1e3*e.time-Date.now()})}),this.$audio.addEventListener("ended",()=>{console.log("on audiomixingfinished",this.$playing),this.$playing&&(this.$session.send_message("soundended",{url:this.$playing}),this.$playing=null)}),this.__tick()}componentWillUnmount(){this.$session.destroy(),clearInterval(this.$tick_timer),clearInterval(this.$music_timer),$(window).off("resize"),this.props.hideLoading()}__tick(){this.$tick_timer=setInterval(()=>{this.props.onCourseTick()},1e3),this.$music_timer=setInterval(()=>{if(this.$playing){let e=Math.floor(1e3*this.$audio.currentTime);this.$session.send_message("soundupdate",{url:this.$playing,time:e})}},100)}__query_roominfo_more(){xe.getRoomInfoForRecord(this.props.room.channel_id).then(e=>{this.props.onRoomMoreInfo(e),this.__send_init_room()})}__send_init_room(){let e=[];this.props.room.teachers.forEach(t=>{e.push(t.id)});let t=[this.props.teacher];t=t.concat(this.props.students),this.$session.send_message(Oe.INIT_ROOM,{channel_id:this.props.room.channel_id,token:xe.token},{recording:!0,master_ids:e,userinfos:t,classroom_info:{teacher_name:this.props.room.teacher_name,teacher_id:this.props.room.teacher_id,teacher_avatar:this.props.room.teacher_avatar,channel_token:this.props.room.channel_token,agora_appid:J.a.agoraAppId,userid:this.props.account.id,version:this.props.room.version,offset_time:this.props.room.offset_time,en_name:this.props.room.en_name}})}__on_session_message(e,t){if("app"==e.to||t){let t=e.message;switch(e.type){case Oe.JS_READY:case Oe.OPEN_MIC:case Oe.CLOSE_MIC:break;case Oe.ENABLE_MAGIC:this.props.onMagicSwitch(!0);break;case Oe.DISABLE_MAGIC:this.props.onMagicSwitch(!1);break;case Oe.MUTE_ALL:case Oe.UNMUTE_ALL:break;case Oe.SHOW_RANKS:this.props.onRankSwitch(!0);break;case Oe.HIDE_RANKS:this.props.onRankSwitch(!1);break;case Oe.PUT_DANCE:case Oe.BACK_DANCE:case Oe.START_COURSE:break;case"playsound":let s=t.url,i=t.needevent;this.playMusic(s,i);break;case"stopsound":let n=t.noevent;this.stopMusic(n);break;case"showdraft":this.showDraft(t.content);break;case"showfeature":this.showFeature(t.feature);case"loadsound":this.__load_sound(t.url);break;case"course-process":this.setState({process:t});break;default:-1==e.type.indexOf("*")&&this.__on_signal_message(e)}}else this.__on_signal_message(e)}leaveCourse(){localStorage.setItem("ENTERED",1),Pe().reload()}preLeaveCourse(){this.props.confirm({content:"确定要临时退出房间吗？",sure:()=>{this.props.showLoading("正在退出房间..."),this.leaveCourse()}})}__select_question(e){this.props.onQuestionDetail(e),this.props.onQuestionList(!1)}playMusic(e,t){this.stopMusic();let s=e;if(this.$audios_files[e]){s=this.$audios_files[e];const t=Ve.readFileSync(s);s="data:audio/mp3;base64,"+Buffer.from(t).toString("base64")}this.$audio.src=s,this.$audio.play(),t?(this.$playing=e,this.$session.send_message("soundupdate",{url:this.$playing,time:0})):this.$playing=!1}stopMusic(e){let t=this.$audio.pause();console.log("stop audio mix - replay",t),this.$playing&&(e||this.$session.send_message("soundended",{url:this.$playing}),this.$playing=null)}render(){return Le("div",{className:"page course-page student"},void 0,Le("div",{className:"inner"},void 0,n.a.createElement("audio",{src:"",ref:e=>{this.$audio=e}}),Fe,Le("div",{className:"course-page-back",onClick:()=>{this.preLeaveCourse()}}),Be))}});function je(e,t,s,i){Ge||(Ge="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:Ge,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}const He=s(4),qe=s(8),{getCurrentWindow:Xe}=$require("electron").remote,{ipcRenderer:Ke}=$require("electron"),Ye=$require("fs");var ze=je("div",{className:"videos-container",id:"videos-container"}),Qe=je("div",{className:"content"},void 0,je("div",{className:"course-content kc-canvas-area cocos",id:"course-content"}));var Je=Object(r.b)((e,t)=>({account:e.login.account,room:e.room.info,students:e.room.students,teacher:e.room.teacher,started:e.main.courseStarted,switches:e.room.switches,status:e.room.status,netStatus:e.main.netStatus}),e=>({onRoomMoreInfo:t=>e(R(t)),onNewStream:t=>e(I(t)),onStreamLeave:t=>e(L(t)),onHandsupSwitch:t=>e(x(t)),onMagicSwitch:t=>e(O(t)),onRankSwitch:t=>e(M(t)),onMuteAllSwitch:t=>e(P(t)),onSilentSwitch:t=>e(V(t)),onNewGift:t=>e(A(t)),onWarn:(t,s)=>e(D(t,s)),onHandsupRank:(t,s)=>e(F(t,s)),onUserMuted:(t,s,i)=>e(k(t,s,i)),onDancing:(t,s)=>e(B(t,s)),onEndCourse:()=>e({type:"COURSE_END"}),onBeginCourse:()=>e({type:"COURSE_BEGIN"}),onPauseCourse:()=>e({type:"COURSE_PAUSE"}),onResumeCourse:()=>e({type:"COURSE_RESUME"}),onCourseTick:()=>e({type:"COURSE_TICK"}),confirm:t=>e(y(t)),alert:t=>e(b(t)),onEnterTester:t=>e(W(t)),showLoading:t=>e(T(t)),hideLoading:()=>e(C()),onUpdateGift:t=>e(j(t)),onProgressUpdate:(t,s)=>e(H(t,s)),onProgressReset:()=>e({type:"PROGRESS_RESET"}),onUserAddRoom:t=>e(U(t)),onQuestionList:t=>e(onQuestionList(t)),onQuestionDetail:t=>e(q(t)),onCourseRecording:t=>e(G(t))}))(class extends Ie{constructor(e){super(e),this.$uuid=0,this.$audio=n.a.createRef(),this.$audios_files={},Ke.on("DOWNLOADED",(e,t,s)=>{this.$audios_files[t]=s})}componentDidMount(){this.$session.on("NEW_MESSAGE",e=>{this.__on_session_message(e)}),this.$session.init("#course-content"),this.__send_init_room(),He.getServerTime().then(e=>{this.setState({time:1e3*e.time}),this.setState({time_diff:1e3*e.time-Date.now()})}),this.$audio.addEventListener("ended",()=>{console.log("on audiomixingfinished",this.$playing),this.$playing&&(this.$session.send_message("soundended",{url:this.$playing}),this.$playing=null)}),this.__tick()}componentWillUnmount(){this.$session.destroy(),clearInterval(this.$tick_timer),clearInterval(this.$music_timer),$(window).off("resize"),this.props.hideLoading()}__tick(){this.$tick_timer=setInterval(()=>{this.props.onCourseTick()},1e3),this.$music_timer=setInterval(()=>{if(this.$playing){let e=Math.floor(1e3*this.$audio.currentTime);this.$session.send_message("soundupdate",{url:this.$playing,time:e})}},100)}__send_init_room(){let e=[];this.props.room.teachers.forEach(t=>{e.push(t.id)}),this.$session.send_message(qe.INIT_ROOM,{channel_id:this.props.room.channel_id,token:He.token,flow:!0},{recording:!0,master_ids:e,camp_info:this.props.room})}__on_signal_message(e){let t=e.message;switch(e.type){case"closeroom":this.leaveCourse();break;case qe.OPEN_MIC:case qe.CLOSE_MIC:case qe.PUT_DANCE:case qe.BACK_DANCE:this.$session.send_message(null,null,e);break;case qe.OPEN_RACE:this.props.onHandsupSwitch(!0),this.$session.send_message(null,null,e);break;case qe.CLOSE_RACE:this.props.onHandsupSwitch(!1),this.$session.send_message(null,null,e);break;case"racerank":break;case qe.NEXT_PAGE:this.$playing=!1,this.hideDraft(),this.$session.send_message(null,null,e);break;case qe.DISABLE_MAGIC:this.$session.send_message(null,null,e);break;case"gift":this.props.onNewGift(t),this.$session.send_message(null,null,e);break;case"progress":this.props.switches.magic;break;case qe.WARN:this.props.onWarn(t,!0),this.$session.send_message(null,null,e);break;case qe.WARN_RELIEVE:this.props.onWarn(t,!1),this.$session.send_message(null,null,e);break;default:this.$session.send_message(null,null,e)}}__on_session_message(e,t){if("app"==e.to||t){let t=e.message;switch(e.type){case qe.JS_READY:case qe.OPEN_MIC:case qe.CLOSE_MIC:break;case qe.ENABLE_MAGIC:this.props.onMagicSwitch(!0);break;case qe.DISABLE_MAGIC:this.props.onMagicSwitch(!1);break;case qe.MUTE_ALL:case qe.UNMUTE_ALL:break;case qe.SHOW_RANKS:this.props.onRankSwitch(!0);break;case qe.HIDE_RANKS:this.props.onRankSwitch(!1);break;case qe.PUT_DANCE:case qe.BACK_DANCE:case qe.START_COURSE:break;case"playsound":let s=t.url,i=t.needevent;this.playMusic(s,i);break;case"stopsound":let n=t.noevent;this.stopMusic(n);break;case"showdraft":this.showDraft(t.content);break;case"showfeature":this.showFeature(t.feature);case"loadsound":this.__load_sound(t.url);break;case"course-process":this.setState({process:t});break;case"course-end":this.leaveCourse();break;default:-1==e.type.indexOf("*")&&this.__on_signal_message(e)}}else this.__on_signal_message(e)}leaveCourse(){localStorage.setItem("ENTERED",1),Xe().reload()}preLeaveCourse(){this.props.confirm({content:"确定要临时退出房间吗？",sure:()=>{this.props.showLoading("正在退出房间..."),this.leaveCourse()}})}playMusic(e,t){this.stopMusic();let s=e;if(this.$audios_files[e]){s=this.$audios_files[e];const t=Ye.readFileSync(s);s="data:audio/mp3;base64,"+Buffer.from(t).toString("base64")}this.$audio.src=s,this.$audio.play(),t?(this.$playing=e,this.$session.send_message("soundupdate",{url:this.$playing,time:0})):this.$playing=!1}stopMusic(e){let t=this.$audio.pause();console.log("stop audio mix - replay",t),this.$playing&&(e||this.$session.send_message("soundended",{url:this.$playing}),this.$playing=null)}isMaster(e){console.log("course.base.page isMaster called",this.props.room),e||(e=this.props.account.id);for(let t=0,s=this.props.room.teachers.length;t<s;t++)if(this.props.room.teachers[t].id==e)return!0}render(){return je("div",{className:"page course-page student"},void 0,je("div",{className:"inner"},void 0,n.a.createElement("audio",{src:"",ref:e=>{this.$audio=e}}),ze,je("div",{className:"course-page-back",onClick:()=>{this.preLeaveCourse()}}),Qe))}}),Ze=(s(291),s(264)),et=s.n(Ze),tt=(s(296),s(20)),st=s.n(tt),it=(s(178),function(){var e=this;function t(t){e.console&&(e.console.error?e.console.error(t):e.console.log&&e.console.log(t))}function s(t){return(t=t||e)!==t.top}var i='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',n='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>';function o(t,s){function o(e){var s=t.parentNode;s&&(s.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+e+"</div></div></td></tr></table>")}if(!e.WebGLRenderingContext)return o(i),null;var r=function(e,t){for(var s=["webgl","experimental-webgl"],i=null,n=0;n<s.length;++n){try{i=e.getContext(s[n],t)}catch(e){}if(i)break}return i}(t,s);return r||o(n),r}function r(){s()&&(document.body.className="iframe")}function a(e,s,i,n){var o=n||t,r=e.createShader(i);return e.shaderSource(r,s),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(o("*** Error compiling shader '"+r+"':"+e.getShaderInfoLog(r)),e.deleteShader(r),null)}function c(e,s,i,n,o){var r=o||t,a=e.createProgram();return s.forEach(function(t){e.attachShader(a,t)}),i&&obj_attrib.forEach(function(t,s){e.bindAttribLocation(a,n?n[s]:s,t)}),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)?a:(r("Error in program linking:"+e.getProgramInfoLog(a)),e.deleteProgram(a),null)}function l(e,t,s,i){var n,o,r=document.getElementById(t);if(!r)throw"*** Error: unknown script element"+t;if(n=r.text,!s)if("x-shader/x-vertex"===r.type)o=e.VERTEX_SHADER;else if("x-shader/x-fragment"===r.type)o=e.FRAGMENT_SHADER;else if(o!==e.VERTEX_SHADER&&o!==e.FRAGMENT_SHADER)throw"*** Error: unknown shader type";return a(e,n,s||o,i)}var d=["VERTEX_SHADER","FRAGMENT_SHADER"];function u(e,t,s,i,n){for(var o=[],r=0;r<t.length;++r)o.push(a(e,t[r],e[d[r]],n));return c(e,o,s,i,n)}function h(e,t){return t===e.SAMPLER_2D?e.TEXTURE_2D:t===e.SAMPLER_CUBE?e.TEXTURE_CUBE_MAP:void 0}function m(e,t){var s=0;function i(t,i){var n,o,r=e.getUniformLocation(t,i.name),a=i.type,c=i.size>1&&"[0]"===i.name.substr(-3);if(a===e.FLOAT&&c)return function(t){e.uniform1fv(r,t)};if(a===e.FLOAT)return function(t){e.uniform1f(r,t)};if(a===e.FLOAT_VEC2)return function(t){e.uniform2fv(r,t)};if(a===e.FLOAT_VEC3)return function(t){e.uniform3fv(r,t)};if(a===e.FLOAT_VEC4)return function(t){e.uniform4fv(r,t)};if(a===e.INT&&c)return function(t){e.uniform1iv(r,t)};if(a===e.INT)return function(t){e.uniform1i(r,t)};if(a===e.INT_VEC2)return function(t){e.uniform2iv(r,t)};if(a===e.INT_VEC3)return function(t){e.uniform3iv(r,t)};if(a===e.INT_VEC4)return function(t){e.uniform4iv(r,t)};if(a===e.BOOL)return function(t){e.uniform1iv(r,t)};if(a===e.BOOL_VEC2)return function(t){e.uniform2iv(r,t)};if(a===e.BOOL_VEC3)return function(t){e.uniform3iv(r,t)};if(a===e.BOOL_VEC4)return function(t){e.uniform4iv(r,t)};if(a===e.FLOAT_MAT2)return function(t){e.uniformMatrix2fv(r,!1,t)};if(a===e.FLOAT_MAT3)return function(t){e.uniformMatrix3fv(r,!1,t)};if(a===e.FLOAT_MAT4)return function(t){e.uniformMatrix4fv(r,!1,t)};if((a===e.SAMPLER_2D||a===e.SAMPLER_CUBE)&&c){for(var l=[],d=0;d<info.size;++d)l.push(s++);return function(t,s){return function(i){e.uniform1iv(r,s),i.forEach(function(i,n){e.activeTexture(e.TEXTURE0+s[n]),e.bindTexture(t,i)})}}(h(e,a),l)}if(a===e.SAMPLER_2D||a===e.SAMPLER_CUBE)return n=h(e,a),o=s++,function(t){e.uniform1i(r,o),e.activeTexture(e.TEXTURE0+o),e.bindTexture(n,t)};throw"unknown type: 0x"+a.toString(16)}for(var n={},o=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r=0;r<o;++r){var a=e.getActiveUniform(t,r);if(!a)break;var c=a.name;"[0]"===c.substr(-3)&&(c=c.substr(0,c.length-3));var l=i(t,a);n[c]=l}return n}function p(e,t){Object.keys(t).forEach(function(s){var i=e[s];i&&i(t[s])})}function g(e,t){var s={};function i(t){return function(s){e.bindBuffer(e.ARRAY_BUFFER,s.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,s.numComponents||s.size,s.type||e.FLOAT,s.normalize||!1,s.stride||0,s.offset||0)}}for(var n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o=0;o<n;++o){var r=e.getActiveAttrib(t,o);if(!r)break;var a=e.getAttribLocation(t,r.name);s[r.name]=i(a)}return s}function _(e,t){Object.keys(t).forEach(function(s){var i=e[s];i&&i(t[s])})}function v(e,t,s){_(t,s.attribs),s.indices&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s.indices)}var f=["","MOZ_","OP_","WEBKIT_"];function E(e,t,s){return function(e,t){var s=0;return e.push=function(){for(var t=0;t<arguments.length;++t){var i=arguments[t];if(i instanceof Array||i.buffer&&i.buffer instanceof ArrayBuffer)for(var n=0;n<i.length;++n)e[s++]=i[n];else e[s++]=i}},e.reset=function(e){s=e||0},e.numComponents=t,Object.defineProperty(e,"numElements",{get:function(){return this.length/this.numComponents|0}}),e}(new(s||Float32Array)(e*t),e)}function S(e,t,s,i){s=s||e.ARRAY_BUFFER;var n=e.createBuffer();return e.bindBuffer(s,n),e.bufferData(s,t,i||e.STATIC_DRAW),n}function b(e){return"indices"!==e}function y(e,t){if(t instanceof Int8Array)return e.BYTE;if(t instanceof Uint8Array)return e.UNSIGNED_BYTE;if(t instanceof Int16Array)return e.SHORT;if(t instanceof Uint16Array)return e.UNSIGNED_SHORT;if(t instanceof Int32Array)return e.INT;if(t instanceof Uint32Array)return e.UNSIGNED_INT;if(t instanceof Float32Array)return e.FLOAT;throw"unsupported typed array type"}function T(e){return e.buffer&&e.buffer instanceof ArrayBuffer}function C(e,t){var s;if(t%(s=e.indexOf("coord")>=0?2:e.indexOf("color")>=0?4:3)>0)throw"can not guess numComponents. You should specify it.";return s}function N(e,t){if(T(e))return e;Array.isArray(e)&&(e={data:e}),e.numComponents||(e.numComponents=C(t,e.length));var s=e.type;s||"indices"===t&&(s=Uint16Array);var i=E(e.numComponents,e.data.length/e.numComponents|0,s);return i.push(e.data),i}function w(e,t,s){var i=s||function(e){var t={};return Object.keys(e).filter(b).forEach(function(e){t["a_"+e]=e}),t}(t),n={};return Object.keys(i).forEach(function(s){var o,r=i[s],a=N(t[r],r);n[s]={buffer:S(e,a),numComponents:a.numComponents||C(r),type:y(e,a),normalize:(o=a,o instanceof Int8Array||o instanceof Uint8Array)}}),n}function R(e,t,s,i,n){var o=s.indices,r=void 0===i?s.numElements:i;n=void 0===n?n:0,o?e.drawElements(t,r,e.UNSIGNED_SHORT,n):e.drawArrays(t,n,r)}return{createAugmentedTypedArray:E,createAttribsFromArrays:w,createBuffersFromArrays:function(e,t){var s={};return Object.keys(t).forEach(function(i){var n="indices"===i?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER,o=N(t[i],name);s[i]=S(e,o,n)}),t.indices?s.numElements=t.indices.length:t.position&&(s.numElements=t.position.length/3),s},createBufferInfoFromArrays:function(e,t,s){var i={attribs:w(e,t,s)},n=t.indices;return n?(n=N(n,"indices"),i.indices=S(e,n,e.ELEMENT_ARRAY_BUFFER),i.numElements=n.length):i.numElements=function(e){var t=e[Object.keys(e)[0]];return T(t)?t.numElements:t.data.length/t.numComponents}(t),i},createAttributeSetters:g,createProgram:c,createProgramFromScripts:function(e,t,s,i,n){for(var o=[],r=0;r<t.length;++r)o.push(l(e,t[r],e[d[r]],n));return c(e,o,s,i,n)},createProgramFromSources:u,createProgramInfo:function(e,t,s,i,n){var o=u(e,t=t.map(function(e){var t=document.getElementById(e);return t?t.text:e}),s,i,n);return o?{program:o,uniformSetters:m(e,o),attribSetters:g(e,o)}:null},createUniformSetters:m,drawBufferInfo:R,drawObjectList:function(e,t){var s=null,i=null;t.forEach(function(t){var n=t.programInfo,o=t.bufferInfo,r=!1;n!==s&&(s=n,e.useProgram(n.program),r=!0),(r||o!==i)&&(i=o,v(e,n.attribSetters,o)),p(n.uniformSetters,t.uniforms),R(e,e.TRIANGLES,o)})},getWebGLContext:function(e,t,i){var n=i||{};if(s()){if(r(),!n.dontResize&&!1!==n.resize){var a=e.clientWidth,c=e.clientHeight;e.width=a,e.height=c}}else if(!n.noTitle&&!1!==n.title){var l=document.title,d=document.createElement("h1");d.innerText=l,document.body.insertBefore(d,document.body.children[0])}return o(e,t)},updateCSSIfInIFrame:r,getExtensionWithKnownPrefixes:function(e,t){for(var s=0;s<f.length;++s){var i=f[s]+t,n=e.getExtension(i);if(n)return n}},resizeCanvasToDisplaySize:function(e,t){t=t||1;var s=e.clientWidth*t,i=e.clientHeight*t;return(e.width!==s||e.height!==i)&&(e.width=s,e.height=i,!0)},setAttributes:_,setBuffersAndAttributes:v,setUniforms:p,setupWebGL:o}}()),nt=s(60),ot=s.n(nt);const rt=it.createProgramFromSources,at=ot.a.EventEmitter,ct=function(){let e,t,s,i,n,o,r,a,c;const l={view:void 0,mirrorView:!1,container:void 0,canvas:void 0,renderImageCount:0,initWidth:0,initHeight:0,initRotation:0,canvasUpdated:!1,clientWidth:0,clientHeight:0,contentMode:0,event:new at,firstFrameRender:!1};function d(t){t&&e&&e.deleteBuffer(t)}function u(t){t&&e&&e.deleteTexture(t)}l.setContentMode=function(e){l.contentMode=e},l.bind=function(e){p(e,l.mirrorView,e.clientWidth,e.clientHeight,l.initRotation,console.warn)},l.unbind=function(){try{e.getExtension("WEBGL_lose_context").loseContext()}catch(e){console.warn(e)}t=void 0,s=void 0,i=void 0,u(n),u(o),u(r),n=void 0,o=void 0,r=void 0,d(a),d(c),a=void 0,c=void 0,e=void 0;try{l.container&&l.container.removeChild(l.canvas),l.view&&l.view.removeChild(l.container)}catch(e){console.warn(e)}l.canvas=void 0,l.container=void 0,l.view=void 0,l.mirrorView=!1},l.renderImage=function(d){if(!e)return void console.log("!gl");if(d.width!=l.initWidth||d.height!=l.initHeight||d.rotation!=l.initRotation||d.mirror!=l.mirrorView){const e=l.view;l.unbind(),p(e,d.mirror,d.width,d.height,d.rotation,e=>{console.error(`init canvas ${d.width}*${d.height} rotation ${d.rotation} failed. ${e}`)})}e.bindBuffer(e.ARRAY_BUFFER,a);const u=d.width+d.left+d.right,h=d.height+d.top+d.bottom;e.bufferData(e.ARRAY_BUFFER,new Float32Array([d.left/u,d.bottom/h,1-d.right/u,d.bottom/h,d.left/u,1-d.top/h,d.left/u,1-d.top/h,1-d.right/u,d.bottom/h,1-d.right/u,1-d.top/h]),e.STATIC_DRAW),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),function(t,s,i,a,c){var l;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,t,s,0,e.LUMINANCE,e.UNSIGNED_BYTE,i),(l=e.getError())!=e.NO_ERROR&&console.log("upload y plane ",t,s,i.byteLength," error",l);e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,t/2,s/2,0,e.LUMINANCE,e.UNSIGNED_BYTE,a),(l=e.getError())!=e.NO_ERROR&&console.log("upload u plane ",t,s,a.byteLength,"  error",l);e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,t/2,s/2,0,e.LUMINANCE,e.UNSIGNED_BYTE,c),(l=e.getError())!=e.NO_ERROR&&console.log("upload v plane ",t,s,c.byteLength,"  error",l)}(u,h,d.yplane,d.uplane,d.vplane),function(i,n,o){if(l.canvasUpdated)return;l.clientWidth=l.view.clientWidth,l.clientHeight=l.view.clientHeight;try{0===l.contentMode?0===i||180===i?l.clientWidth/l.clientHeight>n/o?l.canvas.style.zoom=l.clientWidth/n:l.canvas.style.zoom=l.clientHeight/o:l.clientHeight/l.clientWidth>n/o?l.canvas.style.zoom=l.clientHeight/o:l.canvas.style.zoom=l.clientWidth/n:0===i||180===i?l.clientWidth/l.clientHeight>n/o?l.canvas.style.zoom=l.clientHeight/o:l.canvas.style.zoom=l.clientWidth/n:l.clientHeight/l.clientWidth>n/o?l.canvas.style.zoom=l.clientWidth/n:l.canvas.style.zoom=l.clientHeight/o}catch(e){return console.log(`updateCanvas 00001 gone ${l.canvas}`),console.log(l),void console.error(e)}e.bindBuffer(e.ARRAY_BUFFER,c),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0);const r={x:0,y:0},a={x:n,y:0},d={x:n,y:o},u={x:0,y:o};let h=r,m=a,p=d,g=u;switch(i){case 0:break;case 90:h=a,m=d,p=u,g=r;break;case 180:h=d,m=u,p=r,g=a;break;case 270:h=u,m=r,p=a,g=d}e.bufferData(e.ARRAY_BUFFER,new Float32Array([h.x,h.y,m.x,m.y,g.x,g.y,g.x,g.y,m.x,m.y,p.x,p.y]),e.STATIC_DRAW);const _=e.getUniformLocation(t,"u_resolution");e.uniform2f(_,n,o)}(d.rotation,d.width,d.height),e.drawArrays(e.TRIANGLES,0,6),l.renderImageCount+=1,l.firstFrameRender||(l.firstFrameRender=!0,l.event.emit("ready"))},l.drawFrame=function({header:e,yUint8Array:t,uUint8Array:s,vUint8Array:i}){var n=new DataView(e),o=(n.getUint8(0),n.getUint8(1)),r=n.getUint16(2),a=n.getUint16(4),c=n.getUint16(6),d=n.getUint16(8),u=n.getUint16(10),h=n.getUint16(12),m=n.getUint16(14),p=n.getUint32(16);l.renderImage({mirror:o,width:r,height:a,left:c,top:d,right:u,bottom:h,rotation:m,yplane:new Uint8Array(t),uplane:new Uint8Array(s),vplane:new Uint8Array(i)});Date.now()};const h="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;   vec2 zeroToTwo = zeroToOne * 2.0;   vec2 clipSpace = zeroToTwo - 1.0;   gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",m="precision mediump float;uniform sampler2D Ytex;uniform sampler2D Utex,Vtex;varying vec2 v_texCoord;void main(void) {  float nx,ny,r,g,b,y,u,v;  mediump vec4 txl,ux,vx;  nx=v_texCoord[0];  ny=v_texCoord[1];  y=texture2D(Ytex,vec2(nx,ny)).r;  u=texture2D(Utex,vec2(nx,ny)).r;  v=texture2D(Vtex,vec2(nx,ny)).r;  y=1.1643*(y-0.0625);  u=u-0.5;  v=v-0.5;  r=y+1.5958*v;  g=y-0.39173*u-0.81290*v;  b=y+2.017*u;  gl_FragColor=vec4(r,g,b,1.0);}";function p(d,u,p,g,_,v){l.clientWidth=d.clientWidth,l.clientHeight=d.clientHeight,l.view=d,l.mirrorView=u,l.canvasUpdated=!1,l.container=document.createElement("div"),l.container.style.width="100%",l.container.style.height="100%",l.container.style.display="flex",l.container.style.justifyContent="center",l.container.style.alignItems="center",l.view.appendChild(l.container),l.canvas=document.createElement("canvas"),0==_||180==_?(l.canvas.width=p,l.canvas.height=g):(l.canvas.width=g,l.canvas.height=p),l.initWidth=p,l.initHeight=g,l.initRotation=_,l.mirrorView&&(l.canvas.style.transform="rotateY(180deg)"),l.container.appendChild(l.canvas);try{e=l.canvas.getContext("webgl",{preserveDrawingBuffer:!0})||l.canvas.getContext("experimental-webgl")}catch(e){console.log(e)}if(!e)return e=void 0,void v({error:"Browser not support! No WebGL detected."});e.clearColor(0,0,0,1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),t=rt(e,[h,m]),e.useProgram(t),function(){s=e.getAttribLocation(t,"a_position"),i=e.getAttribLocation(t,"a_texCoord"),c=e.createBuffer(),a=e.createBuffer(),e.activeTexture(e.TEXTURE0),n=e.createTexture(),e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.activeTexture(e.TEXTURE1),o=e.createTexture(),e.bindTexture(e.TEXTURE_2D,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.activeTexture(e.TEXTURE2),r=e.createTexture(),e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);const l=e.getUniformLocation(t,"Ytex");e.uniform1i(l,0);const d=e.getUniformLocation(t,"Utex");e.uniform1i(d,1);const u=e.getUniformLocation(t,"Vtex");e.uniform1i(u,2)}()}return l};ct.prototype.constructor=function(){return new ct};var lt=ct;var dt={GlRenderer:class{constructor(){this.self=lt.apply(this)}bind(e){return this.self.bind(e)}unbind(){return this.self.unbind()}drawFrame(e){return this.self.drawFrame(e)}setContentMode(e){return this.self.setContentMode(e)}}};const ut={defaultShaderType:["VERTEX_SHADER","FRAGMENT_SHADER"],loadShader:function(e,t,s,i){var n=i||console.error,o=e.createShader(s);return e.shaderSource(o,t),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)?o:(n("*** Error compiling shader '"+o+"':"+e.getShaderInfoLog(o)),e.deleteShader(o),null)},createProgram:function(e,t,s,i,n){var o=n||console.error,r=e.createProgram();return t.forEach(function(t){e.attachShader(r,t)}),s&&obj_attrib.forEach(function(t,s){e.bindAttribLocation(r,i?i[s]:s,t)}),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)?r:(o("Error in program linking:"+e.getProgramInfoLog(r)),e.deleteProgram(r),null)},createProgramFromSources(e,t,s,i,n){for(var o=[],r=0;r<t.length;++r)o.push(ut.loadShader(e,t[r],e[ut.defaultShaderType[r]],n));return ut.createProgram(e,o,s,i,n)}};var ht=function(){let e,t,s,i,n,o,r,a,c,l;const d={view:void 0,mirrorView:!1,container:void 0,canvas:void 0,renderImageCount:0,initWidth:0,initHeight:0,initRotation:0,canvasUpdated:!1,clientWidth:0,clientHeight:0,contentMode:0,event:new nt.EventEmitter,firstFrameRender:!1};function u(t){t&&e&&e.deleteBuffer(t)}function h(t){t&&e&&e.deleteTexture(t)}d.setContentMode=function(e){d.contentMode=e},d.bind=function(l){!function(l,u,h,g,_){d.mirrorView=l,d.canvasUpdated=!1,d.canvas=document.createElement("canvas"),0==g||180==g?(d.canvas.width=u,d.canvas.height=h):(d.canvas.width=h,d.canvas.height=u),d.initWidth=u,d.initHeight=h,d.initRotation=g;try{e=d.canvas.getContext("webgl",{preserveDrawingBuffer:!0})||d.canvas.getContext("experimental-webgl")}catch(e){console.log(e)}if(!e)return e=void 0,void _({error:"Browser not support! No WebGL detected."});e.clearColor(0,0,0,1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),t=ut.createProgramFromSources(e,[m,p]),e.useProgram(t),function(){s=e.getAttribLocation(t,"a_position"),i=e.getAttribLocation(t,"a_texCoord"),c=e.createBuffer(),a=e.createBuffer(),e.activeTexture(e.TEXTURE0),n=e.createTexture(),e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.activeTexture(e.TEXTURE1),o=e.createTexture(),e.bindTexture(e.TEXTURE_2D,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.activeTexture(e.TEXTURE2),r=e.createTexture(),e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);const l=e.getUniformLocation(t,"Ytex");e.uniform1i(l,0);const d=e.getUniformLocation(t,"Utex");e.uniform1i(d,1);const u=e.getUniformLocation(t,"Vtex");e.uniform1i(u,2)}()}(d.mirrorView,l.width,l.height,d.initRotation,console.warn)},d.updateSize=function(e){d.unbind(),d.bind(e)},d.unbind=function(){try{e.getExtension("WEBGL_lose_context").loseContext()}catch(e){console.warn(e)}t=void 0,s=void 0,i=void 0,h(n),h(o),h(r),n=void 0,o=void 0,r=void 0,u(a),u(c),a=void 0,c=void 0,e=void 0,d.canvas=void 0,d.mirrorView=!1},d.renderImage=function(l){if(!e)return void console.log("!gl");e.bindBuffer(e.ARRAY_BUFFER,a);const u=l.width+l.left+l.right,h=l.height+l.top+l.bottom;var m,p,g,_,v,f;e.bufferData(e.ARRAY_BUFFER,new Float32Array([l.left/u,l.bottom/h,1-l.right/u,l.bottom/h,l.left/u,1-l.top/h,l.left/u,1-l.top/h,1-l.right/u,l.bottom/h,1-l.right/u,1-l.top/h]),e.STATIC_DRAW),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),m=u,p=h,g=l.yplane,_=l.uplane,v=l.vplane,e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,m,p,0,e.LUMINANCE,e.UNSIGNED_BYTE,g),(f=e.getError())!=e.NO_ERROR&&console.log("upload y plane ",m,p,g.byteLength," error",f),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,m/2,p/2,0,e.LUMINANCE,e.UNSIGNED_BYTE,_),(f=e.getError())!=e.NO_ERROR&&console.log("upload u plane ",m,p,_.byteLength,"  error",f),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,m/2,p/2,0,e.LUMINANCE,e.UNSIGNED_BYTE,v),(f=e.getError())!=e.NO_ERROR&&console.log("upload v plane ",m,p,v.byteLength,"  error",f),function(i,n,o){if(i!=d.initRotation&&(d.canvasUpdated=!1,d.initRotation=i),d.canvasUpdated)return;var r=d.initWidth,a=d.initHeight;e.bindBuffer(e.ARRAY_BUFFER,c),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0);var l=Math.max(r/n,a/o),u=n*l-r>>1,h=o*l-a>>1;const m={x:-u,y:-h},p={x:r+u,y:-h},g={x:r+u,y:a+h},_={x:-u,y:a+h};let v,f,E,S;switch(d.mirrorView?(v=p,f=m,E=_,S=g):(v=m,f=p,E=g,S=_),i){case 0:break;case 90:v=p,f=g,E=_,S=m;break;case 180:v=g,f=_,E=m,S=p;break;case 270:v=_,f=m,E=p,S=g}e.bufferData(e.ARRAY_BUFFER,new Float32Array([v.x,v.y,f.x,f.y,S.x,S.y,S.x,S.y,f.x,f.y,E.x,E.y]),e.STATIC_DRAW);const b=e.getUniformLocation(t,"u_resolution");e.uniform2f(b,r,a),d.canvasUpdated=!0}(l.rotation,l.width,l.height),e.drawArrays(e.TRIANGLES,0,6),d.renderImageCount+=1,d.firstFrameRender||(d.firstFrameRender=!0,d.event.emit("ready"))},d.drawFrame=function({header:e,yUint8Array:t,uUint8Array:s,vUint8Array:i}){if(!l){l=setTimeout(function(){l=null},1e3/15);var n=new DataView(e),o=(n.getUint8(0),n.getUint8(1)),r=n.getUint16(2),a=n.getUint16(4),c=n.getUint16(6),u=n.getUint16(8),h=n.getUint16(10),m=n.getUint16(12),p=n.getUint16(14);n.getUint32(16);d.renderImage({mirror:o,width:r,height:a,left:c,top:u,right:h,bottom:m,rotation:p,yplane:new Uint8Array(t),uplane:new Uint8Array(s),vplane:new Uint8Array(i)}),Date.now()}};const m="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;   vec2 zeroToTwo = zeroToOne * 2.0;   vec2 clipSpace = zeroToTwo - 1.0;   gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",p="precision mediump float;uniform sampler2D Ytex;uniform sampler2D Utex,Vtex;varying vec2 v_texCoord;void main(void) {  float nx,ny,r,g,b,y,u,v;  mediump vec4 txl,ux,vx;  nx=v_texCoord[0];  ny=v_texCoord[1];  y=texture2D(Ytex,vec2(nx,ny)).r;  u=texture2D(Utex,vec2(nx,ny)).r;  v=texture2D(Vtex,vec2(nx,ny)).r;  y=1.1643*(y-0.0625);  u=u-0.5;  v=v-0.5;  r=y+1.5958*v;  g=y-0.39173*u-0.81290*v;  b=y+2.017*u;  gl_FragColor=vec4(r,g,b,1.0);}";return d};class mt extends ot.a.EventEmitter{constructor(e){super(),this.rtcChannel=e,this.initEventHandler()}initEventHandler(){const e=(e,...t)=>{setImmediate(()=>{this.emit(e,...t)})};this.rtcChannel.onEvent("apierror",e=>{console.error(`api ${e} failed. this is an error\n              thrown by c++ addon layer. it often means sth is\n              going wrong with this function call and it refused\n              to do what is asked. kindly check your parameter types\n              to see if it matches properly.`)}),this.rtcChannel.onEvent("joinChannelSuccess",(t,s)=>{e("joinChannelSuccess",t,s)}),this.rtcChannel.onEvent("channelWarning",(t,s)=>{e("channelWarning",t,s)}),this.rtcChannel.onEvent("channelError",(t,s)=>{e("channelError",t,s)}),this.rtcChannel.onEvent("rejoinChannelSuccess",(t,s)=>{e("rejoinChannelSuccess",t,s)}),this.rtcChannel.onEvent("leaveChannel",t=>{e("leaveChannel",t)}),this.rtcChannel.onEvent("clientRoleChanged",(t,s)=>{e("clientRoleChanged",t,s)}),this.rtcChannel.onEvent("userJoined",(t,s)=>{e("userJoined",t,s)}),this.rtcChannel.onEvent("userOffline",(t,s)=>{e("userOffline",t,s)}),this.rtcChannel.onEvent("connectionLost",()=>{e("connectionLost")}),this.rtcChannel.onEvent("requestToken",()=>{e("requestToken")}),this.rtcChannel.onEvent("tokenPrivilegeWillExpire",t=>{e("tokenPrivilegeWillExpire",t)}),this.rtcChannel.onEvent("rtcStats",t=>{e("rtcStats",t)}),this.rtcChannel.onEvent("networkQuality",(t,s,i)=>{e("networkQuality",t,s,i)}),this.rtcChannel.onEvent("remoteVideoStats",t=>{e("remoteVideoStats",t)}),this.rtcChannel.onEvent("remoteAudioStats",t=>{e("remoteAudioStats",t)}),this.rtcChannel.onEvent("remoteAudioStateChanged",(t,s,i,n)=>{e("remoteAudioStateChanged",t,s,i,n)}),this.rtcChannel.onEvent("activeSpeaker",t=>{e("activeSpeaker",t)}),this.rtcChannel.onEvent("firstRemoteVideoFrame",(t,s,i,n)=>{e("firstRemoteVideoFrame",t,s,i,n)}),this.rtcChannel.onEvent("userMuteAudio",(t,s)=>{e("userMuteAudio",t,s)}),this.rtcChannel.onEvent("firstRemoteAudioDecoded",(t,s)=>{e("firstRemoteAudioDecoded",t,s)}),this.rtcChannel.onEvent("videoSizeChanged",(t,s,i,n)=>{e("videoSizeChanged",t,s,i,n)}),this.rtcChannel.onEvent("remoteVideoStateChanged",(t,s,i,n)=>{e("remoteVideoStateChanged",t,s,i,n)}),this.rtcChannel.onEvent("streamMessage",(t,s,i)=>{e("streamMessage",t,s,i)}),this.rtcChannel.onEvent("streamMessageError",(t,s,i,n,o)=>{e("streamMessage",t,s,i,n,o)}),this.rtcChannel.onEvent("channelMediaRelayStateChanged",(t,s)=>{e("channelMediaRelayStateChanged",t,s)}),this.rtcChannel.onEvent("channelMediaRelayEvent",t=>{e("channelMediaRelayEvent",t)}),this.rtcChannel.onEvent("firstRemoteAudioFrame",(t,s)=>{e("firstRemoteAudioFrame",t,s)}),this.rtcChannel.onEvent("rtmpStreamingStateChanged",(t,s,i)=>{e("rtmpStreamingStateChanged",t,s,i)}),this.rtcChannel.onEvent("streamPublished",(t,s)=>{e("streamPublished",t,s)}),this.rtcChannel.onEvent("streamUnpublished",t=>{e("streamUnpublished",t)}),this.rtcChannel.onEvent("transcodingUpdated",()=>{e("transcodingUpdated")}),this.rtcChannel.onEvent("streamInjectedStatus",(t,s,i)=>{e("streamInjectedStatus",t,s,i)}),this.rtcChannel.onEvent("remoteSubscribeFallbackToAudioOnly",(t,s)=>{e("remoteSubscribeFallbackToAudioOnly",t,s)}),this.rtcChannel.onEvent("connectionStateChanged",(t,s)=>{e("connectionStateChanged",t,s)})}joinChannel(e,t,s,i){return this.rtcChannel.joinChannel(e,t,s,i||{autoSubscribeAudio:!0,autoSubscribeVideo:!0})}joinChannelWithUserAccount(e,t,s){return this.rtcChannel.joinChannelWithUserAccount(e,t,s||{autoSubscribeAudio:!0,autoSubscribeVideo:!0})}channelId(){return this.rtcChannel.channelId()}getCallId(){return this.rtcChannel.getCallId()}setClientRole(e){return this.rtcChannel.setClientRole(e)}setRemoteUserPriority(e,t){return this.rtcChannel.setRemoteUserPriority(e,t)}renewToken(e){return this.rtcChannel.renewToken(e)}setEncryptionSecret(e){return this.rtcChannel.setEncryptionSecret(e)}setEncryptionMode(e){return this.rtcChannel.setEncryptionMode(e)}setRemoteVoicePosition(e,t,s){return this.rtcChannel.setRemoteVoicePosition(e,t,s)}setDefaultMuteAllRemoteAudioStreams(e){return this.rtcChannel.setDefaultMuteAllRemoteAudioStreams(e)}setDefaultMuteAllRemoteVideoStreams(e){return this.rtcChannel.setDefaultMuteAllRemoteVideoStreams(e)}muteAllRemoteAudioStreams(e){return this.rtcChannel.muteAllRemoteAudioStreams(e)}muteRemoteAudioStream(e,t){return this.rtcChannel.muteRemoteAudioStream(e,t)}muteAllRemoteVideoStreams(e){return this.rtcChannel.muteAllRemoteVideoStreams(e)}muteRemoteVideoStream(e,t){return this.rtcChannel.muteRemoteVideoStream(e,t)}setRemoteVideoStreamType(e,t){return this.rtcChannel.setRemoteVideoStreamType(e,t)}setRemoteDefaultVideoStreamType(e){return this.rtcChannel.setRemoteDefaultVideoStreamType(e)}createDataStream(e,t){return this.rtcChannel.createDataStream(e,t)}sendStreamMessage(e,t){return this.rtcChannel.sendStreamMessage(e,t)}addPublishStreamUrl(e,t){return this.rtcChannel.addPublishStreamUrl(e,t)}removePublishStreamUrl(e){return this.rtcChannel.removePublishStreamUrl(e)}setLiveTranscoding(e){return this.rtcChannel.setLiveTranscoding(e)}addInjectStreamUrl(e,t){return this.rtcChannel.addInjectStreamUrl(e,t)}removeInjectStreamUrl(e){return this.rtcChannel.removeInjectStreamUrl(e)}startChannelMediaRelay(e){return this.rtcChannel.startChannelMediaRelay(e)}updateChannelMediaRelay(e){return this.rtcChannel.updateChannelMediaRelay(e)}stopChannelMediaRelay(){return this.rtcChannel.stopChannelMediaRelay()}getConnectionState(){return this.rtcChannel.getConnectionState()}publish(){return this.rtcChannel.publish()}unpublish(){return this.rtcChannel.unpublish()}leaveChannel(){return this.rtcChannel.leaveChannel()}release(){return this.rtcChannel.release()}}var pt,gt=class extends ot.a.EventEmitter{constructor(){super(),this.rtcEngine=new agora.NodeRtcEngine,this.initEventHandler(),this.streams=new Map,this.renderMode=this._checkWebGL()?1:2,this.customRenderer=dt.CustomRenderer}setRenderMode(e=1){this.renderMode=e}setCustomRenderer(e){this.customRenderer=e}_checkWebGL(){const e=document.createElement("canvas");let t;e.width=1,e.height=1;const s={alpha:!1,depth:!1,stencil:!1,antialias:!1,preferLowPowerToHighPerformance:!0};try{t=e.getContext("webgl",s)||e.getContext("experimental-webgl",s)}catch(e){return!1}return!!t}initEventHandler(){const e=this,t=(e,...t)=>{setImmediate(()=>{this.emit(e,...t)})};this.rtcEngine.onEvent("apierror",e=>{console.error(`api ${e} failed. this is an error\n              thrown by c++ addon layer. it often means sth is\n              going wrong with this function call and it refused\n              to do what is asked. kindly check your parameter types\n              to see if it matches properly.`)}),this.rtcEngine.onEvent("joinchannel",function(e,s,i){t("joinedchannel",e,s,i),t("joinedChannel",e,s,i)}),this.rtcEngine.onEvent("rejoinchannel",function(e,s,i){t("rejoinedchannel",e,s,i),t("rejoinedChannel",e,s,i)}),this.rtcEngine.onEvent("warning",function(e,s){t("warning",e,s)}),this.rtcEngine.onEvent("error",function(e,s){t("error",e,s)}),this.rtcEngine.onEvent("audiovolumeindication",function(e,s,i){e[0]&&(t("audiovolumeindication",e[0].uid,e[0].volume,s,i),t("audioVolumeIndication",e[0].uid,e[0].volume,s,i)),t("groupAudioVolumeIndication",e,s,i)}),this.rtcEngine.onEvent("leavechannel",function(){t("leavechannel"),t("leaveChannel")}),this.rtcEngine.onEvent("rtcstats",function(e){t("rtcstats",e),t("rtcStats",e)}),this.rtcEngine.onEvent("localvideostats",function(e){t("localvideostats",e),t("localVideoStats",e)}),this.rtcEngine.onEvent("localAudioStats",function(e){t("localAudioStats",e)}),this.rtcEngine.onEvent("remotevideostats",function(e){t("remotevideostats",e),t("remoteVideoStats",e)}),this.rtcEngine.onEvent("remoteAudioStats",function(e){t("remoteAudioStats",e)}),this.rtcEngine.onEvent("remoteAudioTransportStats",function(e,s,i,n){t("remoteAudioTransportStats",{uid:e,delay:s,lost:i,rxKBitRate:n})}),this.rtcEngine.onEvent("remoteVideoTransportStats",function(e,s,i,n){t("remoteVideoTransportStats",{uid:e,delay:s,lost:i,rxKBitRate:n})}),this.rtcEngine.onEvent("audiodevicestatechanged",function(e,s,i){t("audiodevicestatechanged",e,s,i),t("audioDeviceStateChanged",e,s,i)}),this.rtcEngine.onEvent("audiomixingfinished",function(){t("audiomixingfinished"),t("audioMixingFinished")}),this.rtcEngine.onEvent("audioMixingStateChanged",function(e,s){t("audioMixingStateChanged",e,s)}),this.rtcEngine.onEvent("apicallexecuted",function(e,s){t("apicallexecuted",e,s),t("apiCallExecuted",e,s)}),this.rtcEngine.onEvent("remoteaudiomixingbegin",function(){t("remoteaudiomixingbegin"),t("remoteAudioMixingBegin")}),this.rtcEngine.onEvent("remoteaudiomixingend",function(){t("remoteaudiomixingend"),t("remoteAudioMixingEnd")}),this.rtcEngine.onEvent("audioeffectfinished",function(e){t("audioeffectfinished",e),t("audioEffectFinished",e)}),this.rtcEngine.onEvent("videodevicestatechanged",function(e,s,i){t("videodevicestatechanged",e,s,i),t("videoDeviceStateChanged",e,s,i)}),this.rtcEngine.onEvent("networkquality",function(e,s,i){t("networkquality",e,s,i),t("networkQuality",e,s,i)}),this.rtcEngine.onEvent("lastmilequality",function(e){t("lastmilequality",e),t("lastMileQuality",e)}),this.rtcEngine.onEvent("lastmileProbeResult",function(e){t("lastmileProbeResult",e)}),this.rtcEngine.onEvent("firstlocalvideoframe",function(e,s,i){t("firstlocalvideoframe",e,s,i),t("firstLocalVideoFrame",e,s,i)}),this.rtcEngine.onEvent("firstremotevideodecoded",function(e,s,i,n){t("addstream",e,n),t("addStream",e,n),t("firstRemoteVideoDecoded",e,s,i,n)}),this.rtcEngine.onEvent("videosizechanged",function(e,s,i,n){t("videosizechanged",e,s,i,n),t("videoSizeChanged",e,s,i,n)}),this.rtcEngine.onEvent("firstremotevideoframe",function(e,s,i,n){t("firstremotevideoframe",e,s,i,n),t("firstRemoteVideoFrame",e,s,i,n)}),this.rtcEngine.onEvent("userjoined",function(e,s){console.log("user : "+e+" joined."),t("userjoined",e,s),t("userJoined",e,s)}),this.rtcEngine.onEvent("useroffline",function(s,i){if(t("userOffline",s,i),!e.streams)return e.streams=new Map,void console.log("Warning!!!!!!, streams is undefined.");e.destroyRender(s),e.rtcEngine.unsubscribe(s),t("removestream",s,i),t("removeStream",s,i)}),this.rtcEngine.onEvent("usermuteaudio",function(e,s){t("usermuteaudio",e,s),t("userMuteAudio",e,s)}),this.rtcEngine.onEvent("usermutevideo",function(e,s){t("usermutevideo",e,s),t("userMuteVideo",e,s)}),this.rtcEngine.onEvent("userenablevideo",function(e,s){t("userenablevideo",e,s),t("userEnableVideo",e,s)}),this.rtcEngine.onEvent("userenablelocalvideo",function(e,s){t("userenablelocalvideo",e,s),t("userEnableLocalVideo",e,s)}),this.rtcEngine.onEvent("cameraready",function(){t("cameraready"),t("cameraReady")}),this.rtcEngine.onEvent("videostopped",function(){t("videostopped"),t("videoStopped")}),this.rtcEngine.onEvent("connectionlost",function(){t("connectionlost"),t("connectionLost")}),this.rtcEngine.onEvent("streammessage",function(e,s,i,n){t("streammessage",e,s,i,n),t("streamMessage",e,s,i,n)}),this.rtcEngine.onEvent("streammessageerror",function(e,s,i,n,o){t("streammessageerror",e,s,i,n,o),t("streamMessageError",e,s,i,n,o)}),this.rtcEngine.onEvent("mediaenginestartcallsuccess",function(){t("mediaenginestartcallsuccess"),t("mediaEngineStartCallSuccess")}),this.rtcEngine.onEvent("requestchannelkey",function(){t("requestchannelkey"),t("requestChannelKey")}),this.rtcEngine.onEvent("firstlocalaudioframe",function(e){t("firstlocalaudioframe",e),t("firstLocalAudioFrame",e)}),this.rtcEngine.onEvent("firstremoteaudioframe",function(e,s){t("firstremoteaudioframe",e,s),t("firstRemoteAudioFrame",e,s)}),this.rtcEngine.onEvent("firstRemoteAudioDecoded",function(e,s){t("firstRemoteAudioDecoded",e,s)}),this.rtcEngine.onEvent("remoteVideoStateChanged",function(e,s,i,n){t("remoteVideoStateChanged",e,s,i,n)}),this.rtcEngine.onEvent("cameraFocusAreaChanged",function(e,s,i,n){t("cameraFocusAreaChanged",e,s,i,n)}),this.rtcEngine.onEvent("cameraExposureAreaChanged",function(e,s,i,n){t("cameraExposureAreaChanged",e,s,i,n)}),this.rtcEngine.onEvent("tokenPrivilegeWillExpire",function(e){t("tokenPrivilegeWillExpire",e)}),this.rtcEngine.onEvent("streamPublished",function(e,s){t("streamPublished",e,s)}),this.rtcEngine.onEvent("streamUnpublished",function(e){t("streamUnpublished",e)}),this.rtcEngine.onEvent("transcodingUpdated",function(){t("transcodingUpdated")}),this.rtcEngine.onEvent("streamInjectStatus",function(e,s,i){t("streamInjectStatus",e,s,i)}),this.rtcEngine.onEvent("localPublishFallbackToAudioOnly",function(e){t("localPublishFallbackToAudioOnly",e)}),this.rtcEngine.onEvent("remoteSubscribeFallbackToAudioOnly",function(e,s){t("remoteSubscribeFallbackToAudioOnly",e,s)}),this.rtcEngine.onEvent("microphoneEnabled",function(e){t("microphoneEnabled",e)}),this.rtcEngine.onEvent("connectionStateChanged",function(e,s){t("connectionStateChanged",e,s)}),this.rtcEngine.onEvent("activespeaker",function(e){t("activespeaker",e),t("activeSpeaker",e)}),this.rtcEngine.onEvent("clientrolechanged",function(e,s){t("clientrolechanged",e,s),t("clientRoleChanged",e,s)}),this.rtcEngine.onEvent("audiodevicevolumechanged",function(e,s,i){t("audiodevicevolumechanged",e,s,i),t("audioDeviceVolumeChanged",e,s,i)}),this.rtcEngine.onEvent("videosourcejoinsuccess",function(e){t("videosourcejoinedsuccess",e),t("videoSourceJoinedSuccess",e)}),this.rtcEngine.onEvent("videosourcerequestnewtoken",function(){t("videosourcerequestnewtoken"),t("videoSourceRequestNewToken")}),this.rtcEngine.onEvent("videosourceleavechannel",function(){t("videosourceleavechannel"),t("videoSourceLeaveChannel")}),this.rtcEngine.onEvent("localUserRegistered",function(e,s){t("localUserRegistered",e,s)}),this.rtcEngine.onEvent("userInfoUpdated",function(e,s){t("userInfoUpdated",e,s)}),this.rtcEngine.onEvent("localVideoStateChanged",function(e,s){t("localVideoStateChanged",e,s)}),this.rtcEngine.onEvent("localAudioStateChanged",function(e,s){t("localAudioStateChanged",e,s)}),this.rtcEngine.onEvent("remoteAudioStateChanged",function(e,s,i,n){t("remoteAudioStateChanged",e,s,i,n)}),this.rtcEngine.onEvent("audioMixingStateChanged",function(e,s){t("audioMixingStateChanged",e,s)}),this.rtcEngine.onEvent("channelMediaRelayState",function(e,s){t("channelMediaRelayState",e,s)}),this.rtcEngine.onEvent("channelMediaRelayEvent",function(e){t("channelMediaRelayEvent",e)}),this.rtcEngine.registerDeliverFrame(function(t){e.onRegisterDeliverFrame(t)})}_getRenderer(e,t){return e<2?0===t?this.streams.get("local"):this.streams.get(String(t)):2===e?void console.warn("Type 2 not support in production mode."):3===e?this.streams.get("videosource"):void console.warn("Invalid type for getRenderer, only accept 0~3.")}getRender(e){return 0===e?this.streams.get("local"):this.streams.get(String(e))}_checkData(e,t,s,i){return 20!=e.byteLength?(console.error("invalid image header "+e.byteLength),!1):20===t.byteLength?(console.error("invalid image yplane "+t.byteLength),!1):20===s.byteLength?(console.error("invalid image uplanedata "+s.byteLength),!1):t.byteLength==4*s.byteLength&&s.byteLength==i.byteLength||(console.error("invalid image header "+t.byteLength+" "+s.byteLength+" "+i.byteLength),!1)}onRegisterDeliverFrame(e){const t=e.length;for(let s=0;s<t;s++){const t=e[s],{type:i,uid:n,header:o,ydata:r,udata:a,vdata:c}=t;if(!(o&&r&&a&&c)){console.log("Invalid data param ： "+o+" "+r+" "+a+" "+c);continue}const l=this._getRenderer(i,n);l?this._checkData(o,r,a,c)&&l.drawFrame({header:o,yUint8Array:r,uUint8Array:a,vUint8Array:c}):console.warn("Can't find renderer for uid : "+n)}}resizeRender(e){if(this.streams.has(String(e))){const t=this.streams.get(String(e));t&&t.refreshCanvas()}}initRender(e,t){let s;this.streams.has(String(e))&&this.destroyRender(e),(s=t&&t.cocos?new ht:new dt.GlRenderer).bind(t),this.streams.set(String(e),s)}destroyRender(e,t){if(!this.streams.has(String(e)))return;const s=this.streams.get(String(e));try{s.unbind(),this.streams.delete(String(e))}catch(e){t&&t(e)}}initialize(e){return this.rtcEngine.initialize(e)}createChannel(e){let t=this.rtcEngine.createChannel(e);return t?new mt(t):null}getVersion(){return this.rtcEngine.getVersion()}getErrorDescription(e){return this.rtcEngine.getErrorDescription(e)}getConnectionState(){return this.rtcEngine.getConnectionState()}joinChannel(e,t,s,i){return this.rtcEngine.joinChannel(e,t,s,i)}leaveChannel(){return this.rtcEngine.leaveChannel()}release(){return this.rtcEngine.release()}setHighQualityAudioParameters(e,t,s){return Utils_1.deprecate("setAudioProfile"),this.rtcEngine.setHighQualityAudioParameters(e,t,s)}subscribe(e,t){return this.initRender(e,t),this.rtcEngine.subscribe(e)}setupRemoteVideo(e,t,s){return t?(this.initRender(e,t),this.rtcEngine.subscribe(e,s)):(this.destroyRender(e),this.rtcEngine.unsubscribe(e,s))}setupLocalVideo(e){return this.initRender("local",e),this.rtcEngine.setupLocalVideo()}setVideoRenderDimension(e,t,s,i){this.rtcEngine.setVideoRenderDimension(e,t,s,i)}setVideoRenderFPS(e){this.rtcEngine.setFPS(e)}setVideoRenderHighFPS(e){this.rtcEngine.setHighFPS(e)}addVideoRenderToHighFPS(e){this.rtcEngine.addToHighVideo(e)}removeVideoRenderFromHighFPS(e){this.rtcEngine.removeFromHighVideo(e)}setupViewContentMode(e,t){return this.streams.has(String(e))?(this.streams.get(String(e)).setContentMode(t),0):-1}renewToken(e){return this.rtcEngine.renewToken(e)}setChannelProfile(e){return this.rtcEngine.setChannelProfile(e)}setClientRole(e){return this.rtcEngine.setClientRole(e)}startEchoTest(){return Utils_1.deprecate("startEchoTestWithInterval"),this.rtcEngine.startEchoTest()}stopEchoTest(){return this.rtcEngine.stopEchoTest()}startEchoTestWithInterval(e){return this.rtcEngine.startEchoTestWithInterval(e)}enableLastmileTest(){return this.rtcEngine.enableLastmileTest()}disableLastmileTest(){return this.rtcEngine.disableLastmileTest()}startLastmileProbeTest(e){return this.rtcEngine.startLastmileProbeTest(e)}stopLastmileProbeTest(){return this.rtcEngine.stopLastmileProbeTest()}enableVideo(){return this.rtcEngine.enableVideo()}disableVideo(){return this.rtcEngine.disableVideo()}startPreview(){return this.rtcEngine.startPreview()}stopPreview(){return this.rtcEngine.stopPreview()}setVideoProfile(e,t=!1){return this.rtcEngine.setVideoProfile(e,t)}setCameraCapturerConfiguration(e){return this.rtcEngine.setCameraCapturerConfiguration(e)}setVideoEncoderConfiguration(e){const{width:t=640,height:s=480,frameRate:i=15,minFrameRate:n=-1,bitrate:o=0,minBitrate:r=-1,orientationMode:a=0,degradationPreference:c=0}=e;return this.rtcEngine.setVideoEncoderConfiguration({width:t,height:s,frameRate:i,minFrameRate:n,bitrate:o,minBitrate:r,orientationMode:a,degradationPreference:c})}setBeautyEffectOptions(e,t){return this.rtcEngine.setBeautyEffectOptions(e,t)}setRemoteUserPriority(e,t){return this.rtcEngine.setRemoteUserPriority(e,t)}enableAudio(){return this.rtcEngine.enableAudio()}disableAudio(){return this.rtcEngine.disableAudio()}setAudioProfile(e,t){return this.rtcEngine.setAudioProfile(e,t)}setVideoQualityParameters(e){return this.rtcEngine.setVideoQualityParameters(e)}setEncryptionSecret(e){return this.rtcEngine.setEncryptionSecret(e)}setEncryptionMode(e){return this.rtcEngine.setEncryptionMode(e)}muteLocalAudioStream(e){return this.rtcEngine.muteLocalAudioStream(e)}muteAllRemoteAudioStreams(e){return this.rtcEngine.muteAllRemoteAudioStreams(e)}setDefaultMuteAllRemoteAudioStreams(e){return this.rtcEngine.setDefaultMuteAllRemoteAudioStreams(e)}muteRemoteAudioStream(e,t){return this.rtcEngine.muteRemoteAudioStream(e,t)}muteLocalVideoStream(e){return this.rtcEngine.muteLocalVideoStream(e)}enableLocalVideo(e){return this.rtcEngine.enableLocalVideo(e)}enableLocalAudio(e){return this.rtcEngine.enableLocalAudio(e)}muteAllRemoteVideoStreams(e){return this.rtcEngine.muteAllRemoteVideoStreams(e)}setDefaultMuteAllRemoteVideoStreams(e){return this.rtcEngine.setDefaultMuteAllRemoteVideoStreams(e)}enableAudioVolumeIndication(e,t){return this.rtcEngine.enableAudioVolumeIndication(e,t)}muteRemoteVideoStream(e,t){return this.rtcEngine.muteRemoteVideoStream(e,t)}setInEarMonitoringVolume(e){return this.rtcEngine.setInEarMonitoringVolume(e)}pauseAudio(){return Utils_1.deprecate("disableAudio"),this.rtcEngine.pauseAudio()}resumeAudio(){return Utils_1.deprecate("enableAudio"),this.rtcEngine.resumeAudio()}setLogFile(e){return this.rtcEngine.setLogFile(e)}setLogFileSize(e){return this.rtcEngine.setLogFileSize(e)}videoSourceSetLogFile(e){return this.rtcEngine.videoSourceSetLogFile(e)}setLogFilter(e){return this.rtcEngine.setLogFilter(e)}enableDualStreamMode(e){return this.rtcEngine.enableDualStreamMode(e)}setRemoteVideoStreamType(e,t){return this.rtcEngine.setRemoteVideoStreamType(e,t)}setRemoteDefaultVideoStreamType(e){return this.rtcEngine.setRemoteDefaultVideoStreamType(e)}enableWebSdkInteroperability(e){return this.rtcEngine.enableWebSdkInteroperability(e)}setLocalVideoMirrorMode(e){return this.rtcEngine.setLocalVideoMirrorMode(e)}setLocalVoicePitch(e){return this.rtcEngine.setLocalVoicePitch(e)}setLocalVoiceEqualization(e,t){return this.rtcEngine.setLocalVoiceEqualization(e,t)}setLocalVoiceReverb(e,t){return this.rtcEngine.setLocalVoiceReverb(e,t)}setLocalVoiceChanger(e){return this.rtcEngine.setLocalVoiceChanger(e)}setLocalVoiceReverbPreset(e){return this.rtcEngine.setLocalVoiceReverbPreset(e)}setLocalPublishFallbackOption(e){return this.rtcEngine.setLocalPublishFallbackOption(e)}setRemoteSubscribeFallbackOption(e){return this.rtcEngine.setRemoteSubscribeFallbackOption(e)}registerLocalUserAccount(e,t){return this.rtcEngine.registerLocalUserAccount(e,t)}joinChannelWithUserAccount(e,t,s){return this.rtcEngine.joinChannelWithUserAccount(e,t,s)}getUserInfoByUserAccount(e){return this.rtcEngine.getUserInfoByUserAccount(e)}getUserInfoByUid(e){return this.rtcEngine.getUserInfoByUid(e)}switchChannel(e,t){return this.rtcEngine.switchChannel(e,t)}adjustRecordingSignalVolume(e){return this.rtcEngine.adjustRecordingSignalVolume(e)}adjustPlaybackSignalVolume(e){return this.rtcEngine.adjustPlaybackSignalVolume(e)}setExternalAudioSource(e,t,s){return this.rtcEngine.setExternalAudioSource(e,t,s)}getVideoDevices(){return this.rtcEngine.getVideoDevices()}setVideoDevice(e){return this.rtcEngine.setVideoDevice(e)}getCurrentVideoDevice(){return this.rtcEngine.getCurrentVideoDevice()}startVideoDeviceTest(){return this.rtcEngine.startVideoDeviceTest()}stopVideoDeviceTest(){return this.rtcEngine.stopVideoDeviceTest()}getAudioPlaybackDevices(){return this.rtcEngine.getAudioPlaybackDevices()}setAudioPlaybackDevice(e){return this.rtcEngine.setAudioPlaybackDevice(e)}getPlaybackDeviceInfo(e,t){return this.rtcEngine.getPlaybackDeviceInfo(e,t)}getCurrentAudioPlaybackDevice(){return this.rtcEngine.getCurrentAudioPlaybackDevice()}setAudioPlaybackVolume(e){return this.rtcEngine.setAudioPlaybackVolume(e)}getAudioPlaybackVolume(){return this.rtcEngine.getAudioPlaybackVolume()}getAudioRecordingDevices(){return this.rtcEngine.getAudioRecordingDevices()}setAudioRecordingDevice(e){return this.rtcEngine.setAudioRecordingDevice(e)}getRecordingDeviceInfo(e,t){return this.rtcEngine.getRecordingDeviceInfo(e,t)}getCurrentAudioRecordingDevice(){return this.rtcEngine.getCurrentAudioRecordingDevice()}getAudioRecordingVolume(){return this.rtcEngine.getAudioRecordingVolume()}setAudioRecordingVolume(e){return this.rtcEngine.setAudioRecordingVolume(e)}startAudioPlaybackDeviceTest(e){return this.rtcEngine.startAudioPlaybackDeviceTest(e)}stopAudioPlaybackDeviceTest(){return this.rtcEngine.stopAudioPlaybackDeviceTest()}startAudioDeviceLoopbackTest(e){return this.rtcEngine.startAudioDeviceLoopbackTest(e)}stopAudioDeviceLoopbackTest(){return this.rtcEngine.stopAudioDeviceLoopbackTest()}enableLoopbackRecording(e=!1,t=null){return this.rtcEngine.enableLoopbackRecording(e,t)}startAudioRecordingDeviceTest(e){return this.rtcEngine.startAudioRecordingDeviceTest(e)}stopAudioRecordingDeviceTest(){return this.rtcEngine.stopAudioRecordingDeviceTest()}getAudioPlaybackDeviceMute(){return this.rtcEngine.getAudioPlaybackDeviceMute()}setAudioPlaybackDeviceMute(e){return this.rtcEngine.setAudioPlaybackDeviceMute(e)}getAudioRecordingDeviceMute(){return this.rtcEngine.getAudioRecordingDeviceMute()}setAudioRecordingDeviceMute(e){return this.rtcEngine.setAudioRecordingDeviceMute(e)}videoSourceInitialize(e){return this.rtcEngine.videoSourceInitialize(e)}setupLocalVideoSource(e){this.initRender("videosource",e)}videoSourceEnableWebSdkInteroperability(e){return this.rtcEngine.videoSourceEnableWebSdkInteroperability(e)}videoSourceJoin(e,t,s,i){return this.rtcEngine.videoSourceJoin(e,t,s,i)}videoSourceLeave(){return this.rtcEngine.videoSourceLeave()}videoSourceRenewToken(e){return this.rtcEngine.videoSourceRenewToken(e)}videoSourceSetChannelProfile(e){return this.rtcEngine.videoSourceSetChannelProfile(e)}videoSourceSetVideoProfile(e,t=!1){return this.rtcEngine.videoSourceSetVideoProfile(e,t)}getScreenWindowsInfo(){return this.rtcEngine.getScreenWindowsInfo()}getScreenDisplaysInfo(){return this.rtcEngine.getScreenDisplaysInfo()}startScreenCapture2(e,t,s,i){return Utils_1.deprecate('"videoSourceStartScreenCaptureByScreen" or "videoSourceStartScreenCaptureByWindow"'),this.rtcEngine.startScreenCapture2(e,t,s,i)}stopScreenCapture2(){return this.rtcEngine.stopScreenCapture2()}startScreenCapturePreview(){return this.rtcEngine.videoSourceStartPreview()}startScreenCaptureByWindow(e,t,s){return this.rtcEngine.startScreenCaptureByWindow(e,t,s)}startScreenCaptureByScreen(e,t,s){return this.rtcEngine.startScreenCaptureByScreen(e,t,s)}updateScreenCaptureParameters(e){return this.rtcEngine.updateScreenCaptureParameters(e)}setScreenCaptureContentHint(e){return this.rtcEngine.setScreenCaptureContentHint(e)}stopScreenCapturePreview(){return this.rtcEngine.videoSourceStopPreview()}videoSourceEnableDualStreamMode(e){return this.rtcEngine.videoSourceEnableDualStreamMode(e)}videoSourceSetParameters(e){return this.rtcEngine.videoSourceSetParameter(e)}videoSourceUpdateScreenCaptureRegion(e){return this.rtcEngine.videoSourceUpdateScreenCaptureRegion(e)}videoSourceRelease(){return this.rtcEngine.videoSourceRelease()}videoSourceStartScreenCaptureByScreen(e,t,s){return this.rtcEngine.videosourceStartScreenCaptureByScreen(e,t,s)}videoSourceStartScreenCaptureByWindow(e,t,s){return this.rtcEngine.videosourceStartScreenCaptureByWindow(e,t,s)}videoSourceUpdateScreenCaptureParameters(e){return this.rtcEngine.videosourceUpdateScreenCaptureParameters(e)}videoSourceSetScreenCaptureContentHint(e){return this.rtcEngine.videosourceSetScreenCaptureContentHint(e)}startScreenCapture(e,t,s,i){return Utils_1.deprecate(),this.rtcEngine.startScreenCapture(e,t,s,i)}stopScreenCapture(){return this.rtcEngine.stopScreenCapture()}updateScreenCaptureRegion(e){return this.rtcEngine.updateScreenCaptureRegion(e)}startAudioMixing(e,t,s,i){return this.rtcEngine.startAudioMixing(e,t,s,i)}stopAudioMixing(){return this.rtcEngine.stopAudioMixing()}pauseAudioMixing(){return this.rtcEngine.pauseAudioMixing()}resumeAudioMixing(){return this.rtcEngine.resumeAudioMixing()}adjustAudioMixingVolume(e){return this.rtcEngine.adjustAudioMixingVolume(e)}adjustAudioMixingPlayoutVolume(e){return this.rtcEngine.adjustAudioMixingPlayoutVolume(e)}adjustAudioMixingPublishVolume(e){return this.rtcEngine.adjustAudioMixingPublishVolume(e)}getAudioMixingDuration(){return this.rtcEngine.getAudioMixingDuration()}getAudioMixingCurrentPosition(){return this.rtcEngine.getAudioMixingCurrentPosition()}getAudioMixingPlayoutVolume(){return this.rtcEngine.getAudioMixingPlayoutVolume()}getAudioMixingPublishVolume(){return this.rtcEngine.getAudioMixingPublishVolume()}setAudioMixingPosition(e){return this.rtcEngine.setAudioMixingPosition(e)}addPublishStreamUrl(e,t){return this.rtcEngine.addPublishStreamUrl(e,t)}removePublishStreamUrl(e){return this.rtcEngine.removePublishStreamUrl(e)}setLiveTranscoding(e){return this.rtcEngine.setLiveTranscoding(e)}addInjectStreamUrl(e,t){return this.rtcEngine.addInjectStreamUrl(e,t)}removeInjectStreamUrl(e){return this.rtcEngine.removeInjectStreamUrl(e)}setRecordingAudioFrameParameters(e,t,s,i){return this.rtcEngine.setRecordingAudioFrameParameters(e,t,s,i)}setPlaybackAudioFrameParameters(e,t,s,i){return this.rtcEngine.setPlaybackAudioFrameParameters(e,t,s,i)}setMixedAudioFrameParameters(e,t){return this.rtcEngine.setMixedAudioFrameParameters(e,t)}createDataStream(e,t){return this.rtcEngine.createDataStream(e,t)}sendStreamMessage(e,t){return this.rtcEngine.sendStreamMessage(e,t)}startChannelMediaRelay(e){return this.rtcEngine.startChannelMediaRelay(e)}updateChannelMediaRelay(e){return this.rtcEngine.updateChannelMediaRelay(e)}stopChannelMediaRelay(){return this.rtcEngine.stopChannelMediaRelay()}getEffectsVolume(){return this.rtcEngine.getEffectsVolume()}setEffectsVolume(e){return this.rtcEngine.setEffectsVolume(e)}setVolumeOfEffect(e,t){return this.rtcEngine.setVolumeOfEffect(e,t)}playEffect(e,t,s,i,n,o,r){return this.rtcEngine.playEffect(e,t,s,i,n,o,r)}stopEffect(e){return this.rtcEngine.stopEffect(e)}stopAllEffects(){return this.rtcEngine.stopAllEffects()}preloadEffect(e,t){return this.rtcEngine.preloadEffect(e,t)}unloadEffect(e){return this.rtcEngine.unloadEffect(e)}pauseEffect(e){return this.rtcEngine.pauseEffect(e)}pauseAllEffects(){return this.rtcEngine.pauseAllEffects()}resumeEffect(e){return this.rtcEngine.resumeEffect(e)}resumeAllEffects(){return this.rtcEngine.resumeAllEffects()}enableSoundPositionIndication(e){return this.rtcEngine.enableSoundPositionIndication(e)}setRemoteVoicePosition(e,t,s){return this.rtcEngine.setRemoteVoicePosition(e,t,s)}getCallId(){return this.rtcEngine.getCallId()}rate(e,t,s){return this.rtcEngine.rate(e,t,s)}complain(e,t){return this.rtcEngine.complain(e,t)}setBool(e,t){return this.rtcEngine.setBool(e,t)}setInt(e,t){return this.rtcEngine.setInt(e,t)}setUInt(e,t){return this.rtcEngine.setUInt(e,t)}setNumber(e,t){return this.rtcEngine.setNumber(e,t)}setString(e,t){return this.rtcEngine.setString(e,t)}setObject(e,t){return this.rtcEngine.setObject(e,t)}getBool(e){return this.rtcEngine.getBool(e)}getInt(e){return this.rtcEngine.getInt(e)}getUInt(e){return this.rtcEngine.getUInt(e)}getNumber(e){return this.rtcEngine.getNumber(e)}getString(e){return this.rtcEngine.getString(e)}getObject(e){return this.rtcEngine.getObject(e)}getArray(e){return this.rtcEngine.getArray(e)}setParameters(e){return this.rtcEngine.setParameters(e)}convertPath(e){return this.rtcEngine.convertPath(e)}setProfile(e,t){return this.rtcEngine.setProfile(e,t)}initializePluginManager(){return this.rtcEngine.initializePluginManager()}releasePluginManager(){return this.rtcEngine.releasePluginManager()}registerPlugin(e){return this.rtcEngine.registerPlugin(e)}unregisterPlugin(e){return this.rtcEngine.unregisterPlugin(e)}getPlugins(){return this.rtcEngine.getPlugins().map(e=>this.createPlugin(e.id))}createPlugin(e){return{id:e,enable:()=>this.enablePlugin(e,!0),disable:()=>this.enablePlugin(e,!1),setParameter:t=>this.setPluginParameter(e,t)}}enablePlugin(e,t){return this.rtcEngine.enablePlugin(e,t)}setPluginParameter(e,t){return this.rtcEngine.setPluginParameter(e,t)}};function _t(e,t,s,i){pt||(pt="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:pt,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}var vt=_t("div",{className:"step-title"},void 0,"确认摄像头能够正常显示，如有问题切换设备试试"),ft=_t("option",{disabled:!0},"nothing","无可用摄像头设备"),Et=_t("div",{className:"step-title"},void 0,"说几句话确认音量有变化，如有问题切换设备试试"),St=_t("option",{disabled:!0,selected:!0},"nothing","无可用麦克风设备"),bt=_t("div",{className:"mic-icon"}),yt=_t("div",{className:"step-title"},void 0,"调整音量确认能听到音乐，如有问题切换设备试试"),Tt=_t("option",{disabled:!0,selected:!0},"nothing","无可用扬声器设备"),Ct=_t("div",{className:"music-icon"}),Nt=_t("div",{className:"line l0"}),wt=_t("div",{className:"line l1"}),Rt=_t("div",{className:"line l2"}),At=_t("div",{className:"step step-0"},void 0,_t("div",{className:"step-name"},void 0,_t("i",{className:"icon"}),"主机检测"),_t("div",{className:"step-num"},void 0,"1")),$t=_t("div",{className:"step-name"},void 0,_t("i",{className:"icon"}),"摄像头检测"),Dt=_t("div",{className:"step-num failed"},void 0,"!"),kt=_t("div",{className:"step-num"},void 0,"2"),Ut=_t("div",{className:"step-name"},void 0,_t("i",{className:"icon"}),"麦克风检测"),It=_t("div",{className:"step-num failed"},void 0,"!"),Lt=_t("div",{className:"step-num"},void 0,"3"),xt=_t("div",{className:"step-name"},void 0,_t("i",{className:"icon"}),"扬声器检测"),Ot=_t("div",{className:"step-num failed"},void 0,"!"),Pt=_t("div",{className:"step-num"},void 0,"4");var Mt,Vt=Object(r.b)((e,t)=>({account:e.login.account,room:e.room.info,fromPage:e.main.fromPage}),e=>({onExitTester:()=>e({type:"EXIT_TESTER"}),alert:t=>e(b(t)),confirm:t=>e(y(t))}))(class extends n.a.Component{constructor(e){super(e),Ee.a.update(),this.$client=new gt,this.$client.initialize(J.a.agoraAppId),this.$client.on("error",(e,t)=>{console.error("Got error msg:",e),Q.default.log({"DEVICE-TEST":`init error, code: ${e}, message: ${t}`}),J.a.log(`device-init error, code: ${e}, message: ${t}`)}),this.$client.setChannelProfile(1),this.$client.setClientRole(1),this.$client.setAudioProfile(0,1),this.$client.setParameters('{"che.audio.live_for_comm":true}'),this.$client.setParameters('{"che.audio.enable.agc":false}'),this.$client.setParameters('{"che.video.moreFecSchemeEnable":true}'),this.$client.setParameters('{"che.video.lowBitRateStreamParameter":{"width":192,"height":108,"frameRate":15,"bitRate":100}}'),this.$client.enableDualStreamMode(!0),this.$client.enableVideo(),this.$client.enableLocalVideo(!0),this.$client.setVideoProfile(450),this.$client.enableLastmileTest(),this.$client.setAudioPlaybackVolume(150),this.$agora_log_file=st.a.join(Z.remote.app.getPath("userData"),"agora.log"),this.$client.setLogFile(this.$agora_log_file),this.$max_device_volumn=0,this.$quality_msg=["未知","极好","好","一般","差","极差","不可用"],this.state={volume:this.$client.getAudioPlaybackVolume()/255*100>>0,step:0,netquality:0,net_history:[0],check_over:0,camera_failed:!1,mic_failed:!1,speaker_failed:!1};let t=this.__resume_devices();for(let e in t)this.state[e]=t[e];this.$client.on("lastmilequality",e=>{console.log("quality",e);let t=this.state.net_history;(t=t.splice(t.length-50,t.length)).push(e),this.setState({netquality:e,net_history:t}),e=1==e||2==e?1:3==e?2:4==e?3:5==e?4:0,Q.default.log({name:"NET:STATUS",status:e,from:"DEVICE-TEST"}),J.a.log(`device-net status: ${e}`)})}__is_device_in(e,t){if(!t)return!1;let s;for(let i=0,n=e.length;i<n;i++)if(e[i].deviceid==t){s=!0;break}return s}__resume_devices(){let e=Ee.a.get("VIDEO_DEVICE"),t=Ee.a.get("AUDIO_DEVICE"),s=Ee.a.get("PLAYBACK_DEVICE"),i=this.$client.getVideoDevices(),n=this.$client.getAudioRecordingDevices(),o=this.$client.getAudioPlaybackDevices();i=J.a.filterVideoDevice(i),this.__is_device_in(i,e)||(e=null),this.__is_device_in(n,t)||(t=null),this.__is_device_in(o,s)||(s=null),e?this.$client.setVideoDevice(e):e=this.$client.getCurrentVideoDevice(),t?this.$client.setAudioRecordingDevice(t):t=this.$client.getCurrentAudioRecordingDevice(),s?this.$client.setAudioPlaybackDevice(s):s=this.$client.getCurrentAudioPlaybackDevice();let r="无可用摄像头设备",a="无可用扬声器设备",c="无可用麦克风设备";for(let t=0,s=i.length;t<s;t++){let s=i[t];if(s.deviceid==e){r=s.devicename;break}}for(let e=0,s=n.length;e<s;e++){let s=n[e];if(s.deviceid==t){c=s.devicename;break}}for(let e=0,t=o.length;e<t;e++){let t=o[e];if(t.deviceid==s){a=t.devicename;break}}return Q.default.log({"DEVICE-TEST":"device list",camera:i,mic:n,speaker:o}),J.a.log(`device-list camera:${i} mic:${n} speaker:${o}`),{currentVideoDevice:e,currentVideoName:r,currentSpeakerDevice:s,currentSpeakerName:a,currentAudioDevice:t,currentAudioName:c,video_devices:i,audio_devices:n,speaker_devices:o}}componentDidMount(){console.log("frompage",this.props.fromPage)}componentWillUnmount(){try{this.$client.videoSourceLeave(),this.$client.videoSourceRelease(),this.$client.destroyRender("local"),this.$client.stopPreview(),this.$client.stopAudioRecordingDeviceTest(),this.$client.removeAllListeners("audiovolumeindication"),this.$client.stopAudioPlaybackDeviceTest(),this.$client.disableLastmileTest()}catch(e){console.log("client leave failed ",e)}}onStartMicTest(){this.$client.startAudioRecordingDeviceTest(100),this.$client.on("audiovolumeindication",(e,t,s)=>{if(2==this.state.step){let e=parseInt(s/255*13,10);e>this.$max_device_volumn&&(this.$max_device_volumn=e),this.setState({inputVolume:e})}})}onChangeVolume(e){this.setState({volume:e}),this.$client.setAudioPlaybackVolume(e/100*255>>0)}onStartPreview(){this.$previewing||(this.$client.setupLocalVideo(J.a.get("#video-area")),this.$client.startPreview(),this.$previewing=!0)}onStopPreviewAndStepTo(e,t=(()=>{})){this.$previewing=!1,this.$client.destroyRender("local"),this.$client.stopPreview(),J.a.empty("#video-area"),setTimeout(()=>{this.setState({step:e}),t()})}step0(){let e=(window.ENV_CONF||{}).systeminfo||{os:{},cpu:{},system:{}};try{let t=Z.remote.process.getSystemMemoryInfo()||{total:0},s="操作系统："+(e.os.distro||"").replace(/[^a-zA-Z_0-9 ]/g,"")+" "+(e.os.kernal||""),i="CPU型号："+(e.cpu.brand||""),n="CPU核数："+(e.cpu.physicalCores||"")+"核"+(e.cpu.cores||"")+"线程",o="CPU主频："+(e.cpu.speed||"")+"Hz"+(e.cpu.speed==e.cpu.speedmax?"":" - "+(e.cpu.speedmax||"")+"Hz"),r="系统内存："+Math.round((t.total||0)/1024/1024*10)/10+"G",a="设备型号："+(e.system.manufacturer||"")+(e.system.model||"");return _t("div",{className:"step-content"},void 0,_t("div",{className:"os-detail-area"},void 0,_t("div",{className:"os-cell"},void 0,_t("div",{className:"cell-tag"},void 0,s),_t("div",{className:"cell-tag"},void 0,i),_t("div",{className:"cell-tag"},void 0,n),_t("div",{className:"cell-tag"},void 0,o),_t("div",{className:"cell-tag"},void 0,r),_t("div",{className:"cell-tag"},void 0,a))),_t("div",{className:"step-btns"},void 0,_t("button",{onClick:()=>{J.a.joinClassEnabled?(Q.default.log({"DEVICE-TEST":"hardware test passed"}),J.a.log("device-hardware test passed"),this.setState({step:1})):this.props.alert({content:"亲爱的宝妈您好，因我们课件的动画和交互较多，经检测您目前的设备可能不支持我们的正常上课，为了避免影响您的上课体验，请联系您的顾问老师帮您解决，感谢您的支持！",sure:()=>{}})},className:"step-btn check-correct"})))}catch(e){console.log("error:device->step0,",e.message||e)}return""}__on_step1_done({passed:e}){this.onStartMicTest(),this.onStopPreviewAndStepTo(2,()=>{this.setState({camera_failed:!e})}),Q.default.log({"DEVICE-TEST":`camera test ${e?"passed":"failed"}`}),J.a.log(`device-camera test ${e?"passed":"failed"}`)}step1(){return setTimeout(()=>{this.onStartPreview()},0),_t("div",{className:"step-content"},void 0,vt,_t("div",{className:"selector"},void 0,"设备：",_t("div",{className:"select-box"},void 0,this.state.currentVideoName,_t("div",{className:"select-icon"},void 0,_t("img",{src:s(132)}))),_t("select",{className:"select",value:this.state.currentVideoDevice,onChange:e=>{var t=e.nativeEvent.target.selectedIndex,s=e.nativeEvent.target[t].text;this.setState({currentVideoDevice:e.target.value,currentVideoName:s}),Ee.a.store("VIDEO_DEVICE",e.target.value),this.$client.setVideoDevice(e.target.value),Q.default.log({"DEVICE-TEST":`change camera id:${e.target.value}, name: ${s}`}),J.a.log(`device-change camera id:${e.target.value}, name: ${s}`)}},void 0,this.state.video_devices.length>0?this.state.video_devices.map(e=>_t("option",{value:e.deviceid},e.deviceid,e.devicename)):ft)),n.a.createElement("div",{className:"video-area",id:"video-area",ref:e=>this.$video_area=e}),_t("div",{className:"step-btns"},void 0,_t("button",{onClick:()=>{this.__on_step1_done({passed:!1})},className:"step-btn no-pass cantsee-image"}),_t("button",{onClick:()=>{this.__on_step1_done({passed:!0})},className:"step-btn clear-image"}),_t("button",{onClick:()=>{this.onStopPreviewAndStepTo(0),this.setState({step:0})},className:"prev-step-btn"},void 0,"上一步")))}__on_step2_done({passed:e}){this.$client.stopAudioRecordingDeviceTest(),this.setState({step:3}),this.setState({check_over:!0}),this.setState({mic_failed:!e}),Q.default.log({"DEVICE-TEST":`mic test ${e?"passed":"failed"}, max volumn: ${this.$max_device_volumn/12*100>>0}%`}),J.a.log(`device-mic test ${e?"passed":"failed"}, max volumn: ${this.$max_device_volumn/12*100>>0}%`)}step2(){let e=[];for(let t=0;t<12;t++)t>=this.state.inputVolume?e.push(_t("div",{className:"mic-step"},t)):e.push(_t("div",{className:"mic-step on"},t));return _t("div",{className:"step-content"},void 0,Et,_t("div",{className:"selector"},void 0,"设备：",_t("div",{className:"select-box"},void 0,this.state.currentAudioName,_t("div",{className:"select-icon"},void 0,_t("img",{src:s(132)}))),_t("select",{className:"select",value:this.state.currentAudioDevice,onChange:e=>{var t=e.nativeEvent.target.selectedIndex,s=e.nativeEvent.target[t].text;this.setState({currentAudioDevice:e.target.value,currentAudioName:s}),Ee.a.store("AUDIO_DEVICE",e.target.value),this.$client.setAudioRecordingDevice(e.target.value),Q.default.log({"DEVICE-TEST":`change mic id:${e.target.value}, name: ${s}`}),J.a.log(`device-change mic id:${e.target.value}, name: ${s}`)}},void 0,this.state.audio_devices.length>0?this.state.audio_devices.map(e=>_t("option",{value:e.deviceid},e.deviceid,e.devicename)):St)),_t("div",{className:"mic-area"},void 0,bt,e),_t("div",{className:"step-btns"},void 0,_t("button",{onClick:()=>{this.__on_step2_done({passed:!1})},className:"step-btn no-pass no-voice"}),_t("button",{onClick:()=>{this.__on_step2_done({passed:!0})},className:"step-btn see-voice"}),_t("button",{onClick:()=>{this.$client.stopAudioRecordingDeviceTest(),this.setState({step:1})},className:"prev-step-btn"},void 0,"上一步")))}__on_step3_done({passed:e}){let t;this.$client.stopAudioPlaybackDeviceTest(),this.setState({speaker_failed:!e}),Q.default.log({"DEVICE-TEST":`speaker test ${e?"passed":"failed"}`}),J.a.log(`device-speaker test ${e?"passed":"failed"}`),(t=!(!this.state.camera_failed&&!this.state.mic_failed&&e))?(this.props.confirm({content:"设备检测存在异常，请联系课程顾问帮您解决。",cancel_txt:"",sure_txt:"",sure:()=>{Q.default.log({"DEVICE-TEST":"user device test failed and restart."}),J.a.log("device-user device test failed and restart."),this.$playing=!1,this.setState({step:1,camera_failed:!1,mic_failed:!1,speaker_failed:!1})},cancel:()=>{Q.default.log({"DEVICE-TEST":"user device test failed and stepover."}),J.a.log("device-user device test failed and stepover."),this.__exit()},style:De.default.EBTN_STYLE_CONFIG.kDeviceTest}),J.a.upload_agora_logs()):this.props.alert({content:"设备检测通过，欢迎您进入明兮学堂。",sure:()=>{Q.default.log({"DEVICE-TEST":"user device test success."}),J.a.log("device-user device test success."),this.__exit()}})}step3(){return this.$playing||(this.$playing=!0,setTimeout(()=>{let e;e=(window.ENV_CONF||{}).DEBUG?st.a.join(window.ENV_CONF.__dirname,"libs","AgoraSDK","music.mp3"):st.a.join(window.ENV_CONF.__dirname,"app.asar.unpacked","dist","libs","AgoraSDK","music.mp3"),console.log("filepath",e),this.$client.startAudioPlaybackDeviceTest(e)},0)),_t("div",{className:"step-content"},void 0,yt,_t("div",{className:"selector"},void 0,"设备：",_t("div",{className:"select-box"},void 0,this.state.currentSpeakerName,_t("div",{className:"select-icon"},void 0,_t("img",{src:s(132)}))),_t("select",{className:"select",value:this.state.currentSpeakerDevice,onChange:e=>{var t=e.nativeEvent.target.selectedIndex,s=e.nativeEvent.target[t].text;this.setState({currentSpeakerDevice:e.target.value,currentSpeakerName:s}),Ee.a.store("PLAYBACK_DEVICE",e.target.value),this.$client.setAudioPlaybackDevice(e.target.value),Q.default.log({"DEVICE-TEST":`change speaker id:${e.target.value}, name: ${s}`}),J.a.log(`device-change speaker id:${e.target.value}, name: ${s}`)}},void 0,this.state.speaker_devices.length>0?this.state.speaker_devices.map(e=>_t("option",{value:e.deviceid},e.deviceid,e.devicename)):Tt)),_t("div",{className:"music-area"},void 0,Ct,_t("div",{className:"progress-bar"},void 0,_t(et.a,{min:0,max:100,value:this.state.volume,onChange:e=>{this.onChangeVolume(e)}}))),_t("div",{className:"step-btns"},void 0,_t("button",{className:"step-btn no-pass no-hear",onClick:()=>{this.__on_step3_done({passed:!1})}}),_t("button",{className:"step-btn can-hear",onClick:()=>{this.__on_step3_done({passed:!0})}}),_t("button",{onClick:()=>{this.$playing=!1,this.$client.stopAudioPlaybackDeviceTest(),this.onStartMicTest(),this.setState({step:2})},className:"prev-step-btn"},void 0,"上一步")))}__exit(){J.a.upload_system_logs(),J.a.upload_agora_logs(),this.props.onExitTester(),this.props.onExit(),this.state.check_over&&localStorage.setItem("DEVICE_CHECKED_ALREADY",1)}render(){return _t("div",{className:"sound-outer"},void 0,_t("button",{className:"page-back",onClick:()=>{this.__exit()}}),_t("div",{className:"sound-tester s-"+this.state.step},void 0,_t("div",{className:this.state.netquality>3?"network bad":"network"},void 0,"实时网络状态: ",this.$quality_msg[this.state.netquality]),_t("div",{className:"network-bar"},void 0,this.state.net_history.map((e,t)=>_t("div",{className:"quality q-"+e},t))),_t("div",{className:"steps"},void 0,Nt,wt,Rt,At,_t("div",{className:"step step-1"},void 0,$t,this.state.camera_failed?Dt:kt),_t("div",{className:"step step-2"},void 0,Ut,this.state.mic_failed?It:Lt),_t("div",{className:"step step-3"},void 0,xt,this.state.speaker_failed?Ot:Pt)),this[`step${this.state.step}`]()))}});s(297);function Ft(e,t,s,i){Mt||(Mt="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:Mt,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}var Bt=Ft("div",{className:"mycourses-btn"}),Gt=Ft("div",{className:"txt"},void 0,"我的课程"),Wt=Ft("div",{className:"device-btn"}),jt=Ft("div",{className:"txt"},void 0,"设备检测"),Ht=Ft("div",{className:"help-btn"}),qt=Ft("div",{className:"txt"},void 0,"问题帮助"),Xt=Ft("div",{className:"camp-area"},void 0,Ft("div",{className:"icon"}),Ft("div",{className:"txt"},void 0,"训练营"));var Kt,Yt=class extends n.a.Component{constructor(e){super(e)}componentDidMount(){}componentWillUnmount(){}render(){let e;this.props.user.dentity==c.STUDENT&&(e=!0);let t=this.props.flow;return Ft("div",{className:"sidebar-container"},void 0,Ft("div",{className:e?`${t?"sidebar flow":"sidebar"}`:"sidebar teacher"},void 0,Ft("div",{className:"avatar-area center",onClick:()=>{this.props.onViewUser()}},void 0,Ft("div",{className:"avatar",style:{backgroundImage:`url(${e?this.props.user.child_avatar:this.props.user.avatarurl})`}}),Ft("div",{className:"nickname"},void 0,e?this.props.user.child_name:this.props.user.nickname)),e?Ft("div",{className:"mycourses-area center",onClick:()=>{this.props.onEnterMyCourses()}},void 0,Bt,Gt):"",Ft("div",{className:"device-area center",onClick:()=>{this.props.onDeviceTest()}},void 0,Wt,jt),e?Ft("div",{className:"help-area center",onClick:()=>{this.props.onViewHelper()}},void 0,Ht,qt):""),t?Ft("div",{className:"camp-entry",onClick:()=>{this.props.onViewCamp()}},void 0,Xt):"")}};var zt,Qt=Object(r.b)((e,t)=>({globalMsg:e.main.globalMsg}),(e,t)=>({onShowGlobalMsg:t=>{e(Y(t))}}))(class extends n.a.Component{constructor(e){super(e)}componentDidMount(){}componentWillUnmount(){}render(){return this.props.globalMsg?function(e,t,s,i){Kt||(Kt="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:Kt,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}("div",{className:"global-msg-pannel"},void 0,"【系统提示】"+this.props.globalMsg):""}});s(298);function Jt(e,t,s,i){zt||(zt="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:zt,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}const Zt=Z.remote.require("electron-log");var es=Jt("div",{className:"logout-line"});var ts,ss=class extends n.a.Component{constructor(e){let t;super(e),this.props.user.dentity==c.STUDENT&&(t=!0),this.$origin_username=t?this.props.user.child_name:this.props.user.nickname,this.state={editmode:!1,username:this.$origin_username,avatarurl:t?this.props.user.child_avatar:this.props.user.avatarurl,version:"-"}}componentDidMount(){this.setState({version:window.ENV_CONF.version})}componentWillUnmount(){}__on_change_confirm(){this.state.username?(this.state.username!=this.$origin_username&&this.props.confirm({content:"是否确定修改昵称？",sure:()=>{Q.default.changeUserInfo({child_name:this.state.username}).then(e=>{e.status&&this.__change_user()})}}),this.setState({editmode:!1})):this.setState({username:this.$origin_username,editmode:!1})}__change_user(){let e={...this.props.user,child_avatar:this.state.avatarurl,child_name:this.state.username};this.props.user.child_name=this.state.username,this.props.user.child_avatar=this.state.avatarurl,this.$origin_username=this.state.username,this.props.onChangeUser(e)}__clear_cached_data(){this.props.confirm({content:"确定要清除本地缓存文件吗？",sure:()=>{fe.call({method:"clearCachedData",args:{packs:[{name:"course-ui"},{name:"preview-ui"},{name:"liveroom"},{name:"homeworkroom"},{name:"classroom-ui",packageOnly:!0,clearAssetsLater:!0}]}}).then(()=>{this.props.alert({content:"清除缓存成功！"}),Zt.log("清除缓存成功！")}).catch(e=>{this.props.alert({content:"清除缓存失败，"+e.message}),Zt.error("清除缓存失败",e)})}})}__on_change_avatar(e){e&&Q.default.upload_file(e).then(e=>{Q.default.changeUserInfo({child_avatar:e}).then(t=>{t.status&&(this.setState({avatarurl:e}),this.__change_user())})})}render(){let e;return this.props.user.dentity==c.STUDENT&&(e=!0),Jt("div",{className:e?"view-user":"view-user teacher"},void 0,Jt("div",{className:"avatar",style:{backgroundImage:`url(${this.state.avatarurl})`}},void 0,e?Jt("input",{type:"file",accept:"image/x-png,image/jpeg",onChange:e=>{this.__on_change_avatar(e.target.files[0])}}):""),Jt("div",{className:"nickname"},void 0,this.state.editmode?Jt("input",{type:"text",onChange:e=>{this.setState({username:e.target.value})},value:this.state.username,autoFocus:!0,onBlur:()=>{this.__on_change_confirm()}}):[Jt("div",{className:"text"},"0",this.state.username),e?Jt("div",{className:"edit-btn",onClick:()=>{this.setState({editmode:!0})}},"1"):""]),Jt("div",{className:"logout-btn",onClick:()=>{this.props.onLogout()}},void 0,"退出登录"),es,Jt("div",{className:"change-pw",onClick:()=>{this.props.changePw()}},void 0,"修改密码"),Jt("div",{className:"version"},void 0,"当前版本：",this.state.version),Jt("div",{className:"cleardata",onClick:()=>{this.__clear_cached_data()}},void 0,"清除缓存"))}},is=(s(299),s(59)),ns=s.n(is);function os(e,t,s,i){ts||(ts="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:ts,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}const rs=ee.a.shell,as="https://mingxi-software.oss-cn-beijing.aliyuncs.com/sunlogin/SunloginClient9.8.dmg",cs="https://mingxi-software.oss-cn-beijing.aliyuncs.com/sunlogin/SunloginClient_10.3.0.27372.exe";var ls=os("div",{className:"tips"},void 0,"遇到问题请扫码联系助教老师");var ds,us=class extends n.a.Component{constructor(e){super(e),this.state={info:{}},this.$darwin=new RegExp("darwin","i").test(ns.a.type())}componentDidMount(){Q.default.getContactInfo().then(e=>{this.setState({info:e.contact})})}componentWillUnmount(){}render(){return os("div",{className:"helper-block"},void 0,os("div",{className:"code"},void 0,os("img",{src:this.state.info.contact_qrcode})),os("div",{className:"name"},void 0,this.state.info.nickname),ls,os("div",{className:"tips sunlogin",onClick:()=>{rs.openExternal(this.$darwin?as:cs)}},void 0,"☞下载向日葵远程辅助工具"))}};function hs(e,t,s,i){ds||(ds="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:ds,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}s(300);s(73),s(4);var ms,ps=class extends n.a.Component{constructor(e){super(e),this.state={}}componentDidMount(){}componentWillUnmount(){}render(){let e=this.props.room;return hs("div",{className:"camp-panel"},void 0,hs("div",{className:"lesson-box"},"1",hs("div",{className:"cover"},void 0,hs("img",{src:e.avatar,alt:""})),hs("div",{className:"info"},void 0,hs("div",{className:"name"},void 0,hs("span",{},void 0,e.name)),hs("div",{className:"desc"},void 0,"课时简介：",e.content||"暂无"),hs("div",{className:"tag"},void 0,hs("div",{className:"date-label"},void 0,e.open_tip||"开放时间"),hs("div",{className:"date"},void 0,hs("span",{},void 0,e.open_date))))),hs("div",{className:"btns-panel"},void 0,hs("button",{className:"start-btn",onClick:()=>{this.props.onStartLearning()}},void 0,e.start_study||"开始学习")))}},gs=(s(301),s(13),s(265));function _s(e,t,s,i){ms||(ms="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:ms,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}var vs=_s("div",{className:"leave-flag"}),fs=_s("div",{className:"back-flag"}),Es=_s("div",{className:"xiuxue-flag"}),Ss=_s("span",{},void 0,"要上课程"),bs=_s("span",{},void 0,"已上课程"),ys=_s("span",{className:"label"},void 0,"课时消耗情况："),Ts=_s("div",{className:"date-icon"}),Cs=_s("button",{className:"waiting-btn"}),Ns=_s("div",{className:"empty"},void 0,_s("div",{className:"icon"}),_s("span",{},void 0,"接下来没有课程了~")),ws=_s("div",{className:"beta-icon"}),Rs=_s("div",{className:"split-ph"}),As=_s("div",{className:"star-icon"}),$s=_s("div",{className:"empty"},void 0,_s("div",{className:"icon"}),_s("span",{},void 0,"已上的课程会在这里显示哦~"));var Ds,ks=Object(r.b)((e,t)=>({commingRooms:e.main.commingRooms,doneRooms:e.main.doneRooms,totalComming:e.main.totalComming,totalDone:e.main.totalDone}),e=>({onExitMyCourses:()=>e((e=>({type:"EXIT_MY_COURSES",page:e}))()),onLessonsComming:t=>e((e=>({type:"LESSONS_COMMING",commingRooms:e}))(t)),onLessonsDone:t=>e((e=>({type:"LESSONS_DONE",doneRooms:e}))(t)),onLessonsTotalComming:t=>e((e=>({type:"LESSONS_TOTAL_COMMING",totalComming:e}))(t)),onLessonsTotalDone:t=>e((e=>({type:"LESSONS_TOTAL_DONE",totalDone:e}))(t))}))(class extends n.a.Component{constructor(e){super(e),this.state={comming_page_selected:!0},this.__reset()}__reset(){this.$page_comming=1,this.$page_done=1,this.$no_morelessons_comming=!1,this.$no_morelessons_done=!1,this.$querying_comming_lessons=!1,this.$querying_done_lessons=!1,this.props.onLessonsComming([]),this.props.onLessonsDone([]),this.props.onLessonsTotalDone(0)}componentDidMount(){this.__query_courses()}componentWillUnmount(){this.__reset()}__query_courses(e){if(this.state.comming_page_selected){if(this.$no_morelessons_comming||this.$querying_comming_lessons)return;(e||1==this.$page_comming)&&(this.$querying_comming_lessons=!0,Q.default.getLessonListComming({page:this.$page_comming}).then(e=>{if(this.$querying_comming_lessons=!1,e&&e.list&&e.list.data&&e.list.data.length>0){this.$page_comming=Number(e.list.current_page)+1;let t=(this.props.commingRooms||[]).concat(e.list.data||[]);console.log("latest 最新",this.props.commingRooms,"=======",e.list.data),this.props.onLessonsComming(t),e.total&&e.total.length>0&&this.props.onLessonsTotalComming(e.total)}else this.$no_morelessons_comming=!0}))}else{if(this.$no_morelessons_done||this.$querying_done_lessons)return;if(e||1==this.$page_done)return this.$querying_done_lessons=!0,Q.default.getLessonListDone({page:this.$page_done}).then(e=>{if(this.$querying_done_lessons=!1,e&&e.list&&e.list.data&&e.list.data.length>0){this.$page_done=Number(e.list.current_page)+1;let t=(this.props.doneRooms||[]).concat(e.list.data||[]);this.props.onLessonsDone(t),e.total&&e.total.length>0&&this.props.onLessonsTotalDone(e.total)}else this.$no_morelessons_done=!0})}}handleScroll(e){const t=e.target.clientHeight,s=e.target.scrollHeight;t+e.target.scrollTop===s&&this.__query_courses(!0)}__select_page(e){this.setState({comming_page_selected:1==e}),this.__reset(),setTimeout(()=>{this.__query_courses()},0)}__get_room_flag(e){return"leave"==e?vs:"back"==e?fs:"xiuxue"==e?Es:""}render(){let e=[],t=[];return _s("div",{className:"page student-page"},void 0,_s("div",{className:"btn-exit",onClick:()=>{this.props.onExitMyCourses(),this.props.onExit()}}),_s("div",{className:"inner"},void 0,_s("div",{className:"student-box"},void 0,_s("div",{className:"my-courses"},void 0,_s("div",{className:"nav-area"},void 0,_s("div",{className:this.state.comming_page_selected?"switch-bar":"switch-bar first-selected"},void 0,_s("div",{className:"switch-bar-left",onClick:()=>{this.__select_page(1)}},void 0,Ss),_s("div",{className:"switch-bar-right",onClick:()=>{this.__select_page(2)}},void 0,bs)),this.props.totalDone&&this.props.totalDone.length>0?_s("div",{className:"course-according"},void 0,ys,_s("span",{className:"value"},void 0,this.state.comming_page_selected?this.props.totalComming:this.props.totalDone)):""),(this.props.commingRooms||[]).forEach((t,s)=>{t.channel_id&&(t.can_enter=!0),e.push(_s("div",{className:"lesson-box-panel"},"comming_room_"+s,_s("div",{className:"date-tip"},void 0,Ts,_s("span",{},void 0,t.class_date," ",t.week_day)),_s("div",{className:"lesson-box"},void 0,_s("div",{className:"cover"},void 0,_s("img",{src:t.avatar,alt:""})),_s("div",{className:"info"},void 0,_s("div",{className:"name"},void 0,_s("span",{},void 0,t.name)),_s("div",{className:"desc"},void 0,"课时简介：",t.content),_s("div",{className:"tag"},void 0,_s("div",{className:"tag-kind"},void 0,t.label),_s("span",{className:"tag-effect"},void 0,"学习力提升："+(t.ability||""))),_s("div",{className:"date"},void 0,_s("span",{},void 0,t.between_time))),_s("div",{className:"btns-panel"},void 0,t.can_enter&&"normal"==t.class_state?_s("button",{className:"start-btn",onClick:()=>{this.props.onStartRoom(t)}}):"",t.can_enter&&"normal"==t.class_state&&"on"==t.preview_status&&t.prepare_name?_s("button",{className:"preview-btn",onClick:()=>{this.props.onStartPreview(t)}}):"",t.can_enter?"":Cs,this.__get_room_flag(t.class_state)))))}),this.state.comming_page_selected?_s("div",{onScroll:e=>{this.handleScroll(e)},className:e.length>0?"courses-comming-area":"courses-comming-area empty-area",id:"courses-comming-area"},void 0,e.length>0?e:Ns):_s("div",{onScroll:e=>{this.handleScroll(e)},className:"courses-done-area",id:"courses-done-area"},void 0,(this.props.doneRooms||[]).forEach((e,s)=>{t.push(_s("div",{className:"lesson-done-box-panel"},"done_room_"+s,_s("div",{className:"box-panel-top"},void 0,_s("span",{className:"lesson-name"},void 0,e.name),_s("span",{className:"lesson-level"},void 0,"（",e.lesson_name,"）")),_s("div",{className:"box-panel-center"},void 0,_s("span",{className:"lesson-time"},void 0,e.class_date," ",e.class_time)),_s("div",{className:"box-panel-bottom"},void 0,_s("span",{className:"normal"==e.class_state?"lesson-state":"lesson-state abnormal"},void 0,"normal"==e.class_state?"正常结束":"leave"==e.class_state?"请假":"未到课"),e.button_hf&&e.button_playback_pc?_s("div",{className:"btn-view-record",onClick:()=>{this.props.onRecordRoom(e)}},void 0,e.beta?ws:""):"",_s("div",{className:"btn-view-review",onClick:()=>{this.props.onStartHomework(e)}}),Rs,As,_s("span",{className:"star-count"},void 0,e.star))))}),_s("div",{className:t.length>0?"container":"container empty-container"},void 0,t.length>0?t:$s))))))}});s(219);function Us(e,t,s,i){Ds||(Ds="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:Ds,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}const Is=s(629),Ls=s(630),xs=s(631);var Os=Us("div",{className:"camp-flag"}),Ps=Us("div",{className:"time"},"0","接下来没有课程啦～"),Ms=Us("div",{className:"no-lesson"},"1","去“明兮大语文”小程序",Us("br",{}),"和其他小朋友一起完成作业吧~"),Vs=Us("div",{className:"anim-sprite"}),Fs=Us("div",{className:"radial-outer"}),Bs=Us("div",{className:"dot"}),Gs=Us("div",{className:"dot2"}),Ws=Us("div",{className:"dot"}),js=Us("div",{className:"time"},"0","老师开始讲课啦，赶快进入教室哦！"),Hs=Us("div",{className:"leave-flag"}),qs=Us("div",{className:"back-flag"}),Xs=Us("div",{className:"xiuxue-flag"}),Ks=Us("br",{}),Ys=Us(us,{}),zs=Us(Qt,{}),Qs=Us(Je,{}),Js=Us(We,{});var Zs,ei=Object(r.b)((e,t)=>({account:e.login.account,rooms:e.main.rooms,changePwd:e.main.changePwd,fromViewUser:e.main.fromViewUser,room:e.room.info,gifts:e.room.gifts,calendar:e.main.calendar,started:e.main.courseStarted,recording:e.main.recording,flow:e.main.flow,testing:e.main.enterTester,mycourses:e.main.enterMyCourses,commingRoom:e.main.commingRoom,campRoom:e.main.campRoom,globalMsg:e.main.globalMsg,showToastState:e.toast}),e=>({onRoomInfo:t=>e((e=>({type:"ROOM_INFO",data:e}))(t)),onLogout:()=>e((()=>e=>{h.a.clear(),e({type:"LOGOUT"})})()),onChangePwd:(t,s)=>e(X(t,s)),onStartCourse:()=>e({type:"START_COURSE"}),confirm:t=>e(y(t)),alert:t=>e(b(t)),hide:()=>e({type:"HIDE_DIALOG"}),onEnterTester:t=>e(W(t)),onEnterMyCourses:()=>e((e=>({type:"ENTER_MY_COURSES",page:e}))()),onChangeUserInfo:t=>e((e=>(h.a.store("USER_INFO",e),{type:"CHANGE_USER_INFO",user:e}))(t)),onCourseRecording:(t,s)=>e(G(t,s)),onLessonComming:t=>e((e=>({type:"LESSON_COMMING",commingRoom:e}))(t)),onCampLesson:t=>e((e=>({type:"CAMP_LESSON",campRoom:e}))(t)),hideLoading:()=>e(C()),showLoading:t=>e(T(t)),onShowGlobalMsg:t=>e(Y(t)),onShowTost:t=>e(K(t))}))(class extends n.a.Component{constructor(e){super(e),this.$detect_delay=5e3,this.$cache_valid_time=36e5,this.state={showChangePwdMask:!1,timeDiff:0,progress:.1,audioOn:!0,relaxTime:"",audio_url:"",relaxDone5To10:!1},Q.default.on("LOGOUT_NEEDED",()=>{this.onLogout()}),Z.ipcRenderer.on("room-closed",()=>{this.__get_lesson_comming(),J.a.upload_system_logs(),J.a.upload_agora_logs()}),this.$audio_bg=n.a.createRef(),this.$audio_tip=n.a.createRef(),this.__check_device()}__check_device(){let e=1==localStorage.getItem("DEVICE_CHECKED_ALREADY");e||this.props.showLoading("首次进入，需要为您做些优化"),this.$timer_device_check=setInterval(()=>{window.ENV_CONF&&window.ENV_CONF.systeminfo&&(clearInterval(this.$timer_device_check),this.$timer_device_check=null,Q.default.checkDevice().then(t=>{this.props.hideLoading(),J.a.oldDevice=!!t.old_device,J.a.joinClassEnabled=!!t.to_class,t.old_user||e||this.props.alert({content:"欢迎进入明兮学堂，为了您更好的体验，请先来检测下设备吧",sure:()=>{this.props.onEnterTester("main")},sure_txt:"设备检测",close_hidden:!0})}))},200)}strToDate(e){let t=e.split(/[-: ]/);return new Date(t[0],t[1]-1,t[2]||1,t[3]||0,t[4]||0,t[5]||0)}__serverTime(){return(new Date).getTime()+this.state.timeDiff}__stop_relax(e){let t=`RELAX_REC_${e.channel_id}`;this.$audio_bg.pause(),this.$audio_tip.pause(),this.$timer_relax&&clearInterval(this.$timer_relax),this.$timer_relax_3_to_5&&clearInterval(this.$timer_relax_3_to_5),this.setState({relaxTime:"",progress:0}),localStorage.setItem(t,"1")}__get_lesson_comming(){Q.default.getServerTime().then(e=>{this.setState({time:1e3*e.time}),this.setState({timeDiff:1e3*e.time-Date.now()}),Q.default.getLessonComming().then(e=>{let t=e.room;if(t){let e=`RELAX_REC_${t.channel_id}`,s=`RELAX_TOTAL_${t.channel_id}`,i="1"==localStorage.getItem(e),n=this.strToDate(t.start_time).getTime(),o=n-this.__serverTime(),r=localStorage.getItem(s),a=parseInt(r||o);!r&&localStorage.setItem(s,o.toString());let c=e=>((Math.floor(e/3600)<10?"0"+Math.floor(e/3600):Math.floor(e/3600))+":"+(Math.floor(e/60%60)<10?"0"+Math.floor(e/60%60):Math.floor(e/60%60))+":"+(Math.floor(e%60)<10?"0"+Math.floor(e%60):Math.floor(e%60))).replace(/^00:/,"");if(t.left=o,o>0){let e=o/1e3/60/60/24>>0,s=(o-=1e3*e*60*60*24)/1e3/60/60>>0,r=(o-60*s*60*1e3)/1e3/60>>0;if(t.days=e,t.hours=s,t.minutes=r,t.follow&&!i){let e=()=>{let e=n-this.__serverTime(),s=Math.max(1,100*(1-e/a));if(e<=18e4)return this.__stop_relax(t),this.props.hide(),this.onStartRoom(t),!1;let i=c(e/1e3);this.setState({relaxTime:i,progress:s});let o=e>=18e4&&e<3e5;return e>=3e5&&e<6e5&&!this.$relax_done_5_to_10&&(this.$relax_done_5_to_10=!0,this.$audio_tip.src=this.__get_audio("xiuxi"),this.$audio_tip.play()),o&&!this.$relax_done_3_to_5&&(this.$relax_done_3_to_5=!0,this.$audio_tip.src=this.__get_audio("shangke"),this.$audio_tip.play(),this.$timer_relax_3_to_5=setInterval(()=>{this.$audio_tip.play()},2e4)),!0};if(this.$timer_relax=setInterval(()=>{e()},1e3),!e())return;this.onStartRoom(t,!0),this.$audio_bg.src=this.__get_audio("background"),this.state.audioOn&&this.$audio_bg.play()}}else t.follow&&!i&&(localStorage.setItem(e,"1"),this.onStartRoom(t));this.props.onLessonComming(t)}Q.default.getCampLesson().then(e=>{console.log("camp room info",e),this.props.onCampLesson(e)})})})}__get_audio(e){return{background:Is,xiugxi:xs,shangke:Ls}[e]}__isOldPassWord(){Q.default.checkPwIsDefault().then(e=>{e.status&&this.state.showChangePwdMask&&this.props.confirm({title:"温馨提示",content:"系统检测您现在使用的默认密码，为了账户的安全，建议进行修改。",sure:()=>{this.__view_change_pwd()},sure_txt:"修改密码",close_hidden:!0,style:De.default.EBTN_STYLE_CONFIG.kChangePwd})})}__remindChangePwd(){this.__remindTime(),this.__isOldPassWord()}__remindTime(){(new Date).getTime()-localStorage.getItem("FIRSTTIME")>6048e5?this.setState({showChangePwdMask:!0}):this.setState({showChangePwdMask:!1})}componentDidMount(){this.__get_lesson_comming(),J.a.user=this.props.account,J.a.restoreOldDevice(),Q.default.reportSystemBaseInfo()}componentWillUnmount(){this.$timer_device_check&&(clearInterval(this.$timer_device_check),this.$timer_device_check=null),Z.ipcRenderer.removeAllListeners("room-closed")}__camp_room(){let e=this.props.campRoom;return e?(e.students=[],Us("div",{className:"lesson-box flow"},"1",Us("div",{className:"cover"},void 0,Us("img",{src:e.avatar,alt:""})),Us("div",{className:"info"},void 0,Us("div",{className:"name"},void 0,Us("span",{},void 0,e.name)),Us("div",{className:"desc"},void 0,"课时简介：",e.content||"暂无"),Us("div",{className:"tag"},void 0,Us("div",{className:"tag-kind"},void 0,e.open_tip||"开放时间"),Us("div",{className:"date"},void 0,Us("span",{},void 0,e.open_date)))),Us("div",{className:"btns-panel"},void 0,Us("button",{className:"start-btn flow",onClick:()=>{this.onRecordRoom(e,!0)}},void 0,e.start_study)),Os)):[Ps,Ms]}__student_page(){let e=this.props.commingRoom;e&&(e.can_enter=!0);let t=this.state.progress,i={borderTopLeftRadius:"0.51rem",borderTopRightRadius:"0.51rem",width:"1.01rem",height:"0.51rem",top:"-1.01rem",left:"-0.005rem",visibility:`${t<=50?"visible":"hidden"}`},o={borderTopLeftRadius:"0.51rem",borderTopRightRadius:"0.51rem",width:"1.01rem",height:"0.51rem",top:"-1.52rem",left:"-0.005rem"},r={visibility:`${t>50&&t<100?"visible":"hidden"}`},a={borderTopLeftRadius:"0.51rem",borderTopRightRadius:"0.51rem",width:"1rem",height:"0.5rem",top:"-2.022rem",visibility:`${t>50?"visible":"hidden"}`},c={width:"0.9rem",height:"0.91rem",top:"-2.476rem",left:"0.0474rem"};return t>50?(i.transform="rotate(270deg)",o.transform=`rotate(${90+3.6*t}deg)`):i.transform=`rotate(${90+3.6*t}deg)`,Us("div",{className:"page student-pages"},void 0,n.a.createElement("audio",{src:"",crossOrigin:"anonymous",autoPlay:"autoplay",ref:e=>{this.$audio_bg=e}}),n.a.createElement("audio",{src:"",crossOrigin:"anonymous",autoPlay:"autoplay",ref:e=>{this.$audio_tip=e}}),Us("div",{className:"inner"},void 0,Us("div",{className:"student-box"},void 0,this.state.relaxTime?Us("div",{className:"relax-bubble"},void 0,Us("div",{className:"tip-label"},void 0,`课间休息还有${(()=>{let e=this.state.relaxTime.split(":"),t=2==e.length?0:parseInt(e[0]);return(t>0?`${t}小时`:"")+(2==e.length?parseInt(e[0]):parseInt(e[1]))+"分"+(2==e.length?parseInt(e[1]):parseInt(e[2]))+"秒"})()}哦～`),Us("div",{className:"btn-audio"+(this.state.audioOn?"":" off"),onClick:()=>{let e=!this.state.audioOn;this.setState({audioOn:e}),e?this.$audio_bg.play():this.$audio_bg.pause()}}),Vs,Us("div",{className:"col-md-25 col-sm-50"},void 0,Us("div",{className:"tox-progress"},void 0,Us("div",{className:"progress-inner"},void 0,Us("div",{className:"time-number"+(this.state.relaxTime.length<=5?"":" small")},void 0,Us("span",{},void 0,this.state.relaxTime)),Fs,Us("div",{className:"radial-mask-1",style:i},void 0,Bs),Us("div",{className:"radial-mask-2",style:o},void 0,Us("div",{className:"dot",style:r}),Gs),Us("div",{className:"radial-mask-3",style:a},void 0,Ws),Us("div",{className:"radial-inner",style:c}))))):"",Us("div",{className:"main-page"},void 0,e?[Us("div",{className:"lesson-box"},"1",Us("div",{className:"cover"},void 0,Us("div",{className:"cover-img"},void 0,Us("img",{src:e.avatar,alt:""})),Us("div",{className:"name"},void 0,e.name)),Us("div",{className:"info"},void 0,Us("div",{className:"desc"},void 0,"课时简介：",e.content||"暂无"),Us("div",{className:"tag"},void 0,Us("div",{className:"tag-kind"},void 0,e.label),Us("span",{className:"tag-effect"},void 0,"学习力提升："+e.ability)),Us("div",{className:"date"},void 0,Us("span",{},void 0,e.class_date," ",e.class_time))),Us("div",{className:"btns-panel"},void 0,e.can_enter&&"normal"==e.class_state?Us("div",{className:"start-imgbtn"},void 0,Us("img",{src:s(632),onClick:()=>{this.__stop_relax(e),this.onStartRoom(e)},alt:""})):"","on"==e.preview_status&&e.prepare_name&&!e.follow?Us("div",{className:"preview-imgbtn"},void 0,Us("img",{src:s(633),onClick:()=>{this.onStartPreview(e)},alt:""})):"",this.__get_room_flag(e.class_state))),e.left>0?Us("div",{className:"time"},"0","上课倒计时：",e.days>0?Us("label",{},void 0,Us("span",{},void 0,e.days),"天"):"",e.hours>0?Us("label",{},void 0,Us("span",{},void 0,e.hours),"小时"):"",e.minutes>0?Us("label",{},void 0,Us("span",{},void 0,e.minutes),"分钟"):""):js]:this.__camp_room()))))}__get_room_flag(e){return"leave"==e?Hs:"back"==e?qs:"xiuxue"==e?Xs:""}onStartPreview(e){this.onDownloadPreview(e)}onStartHomework(e){this.onDownloadHomework(e)}onStartRoom(e,t){console.log("MINGXI_DEBUG_LOG>>>>>>>>>onStartRoom",t),J.a.joinClassEnabled?this.onDownload(e,!1,!1,t):this.props.alert({content:"亲爱的宝妈您好，因我们课件的动画和交互较多，经检测您目前的设备可能不支持我们的正常上课，为了避免影响您的上课体验，请联系您的顾问老师帮您解决，感谢您的支持！",sure:()=>{}})}__onStartRoom(e,t){this.props.onRoomInfo(e),t?(this.props.hide(),Object(gs.setTimeout)(()=>{this.onEnterRoom(!0,camp)},500)):this.props.confirm({content:Us("div",{},void 0,"上课时间：",e.start_time,Ks,"准备好开始上课了吗？"),sure:()=>{this.onEnterRoom()}})}onRecordRoom(e,t){!t||(e.camp=!0,e.teachers=[e.master_teacher_id],e.is_enter)?this.onDownload(e,!0,t):this.props.alert({content:"该课程不在开放时间"})}onDownloadHomework(e){this.props.alert({title:"下载作业包",content:Us(Ae,{data:e,homework:!0,complete:e=>{this.props.hide(),fe.call({method:"openLiveRoom",args:{pack:"homeworkroom",data:e}}).catch(e=>{console.error(e)})},error:e=>{},user:this.props.account}),nobutton:!0,noanim:!0})}onDownloadPreview(e){this.props.alert({title:"下载课程包",content:Us(Ae,{data:e,preview:!0,complete:e=>{this.props.hide(),e.preview=!0,fe.call({method:"openLiveRoom",args:{pack:"liveroom",data:e}}).catch(e=>{console.error(e)})},error:e=>{},user:this.props.account}),nobutton:!0,noanim:!0})}onDownload(e,t,s,i){let n=e.follow,o=Us(Ae,{data:e,recording:t,camp:s,complete:e=>{n&&i?console.log("MINGXI_DEBUG_LOG>>>>>>>>>download over but without joining",""):(this.props.hide(),fe.call({method:"openLiveRoom",args:{pack:"liveroom",data:e}}).catch(e=>{console.error(e)}))},error:e=>{},user:this.props.account});this.props.alert({title:"下载课程包",content:o,nobutton:!0,noanim:!0,hidden:!!i})}onEnterRoom(e,t){e?this.props.onCourseRecording(!0,t):this.props.onStartCourse()}onConfirmToLogout(){this.props.confirm({content:"确认退出当前登录的帐号吗？",sure:()=>{this.onLogout()}})}onLogout(){this.props.onLogout()}__view_user(){this.props.confirm({title:"个人信息",nobutton:!0,content:Us(ss,{user:this.props.account,onLogout:()=>{this.onConfirmToLogout()},onChangeUser:e=>{this.props.onChangeUserInfo(e)},alert:(...e)=>{this.props.alert(...e)},confirm:(...e)=>{this.props.confirm(...e)},changePw:()=>{this.__view_change_pwd(!0)}}),linestyle:De.default.LINE_CONFIRM_TITLE.lineTitle})}__view_change_pwd(e){this.props.onChangePwd(!0,!!e),this.props.hide()}__view_camp(){this.props.confirm({nobutton:!0,title_hidden:!0,large_mod:!0,content:Us(ps,{room:this.props.campRoom,onStartLearning:()=>{this.onRecordRoom(this.props.campRoom,!0)}})})}__on_helper(){this.props.confirm({title:"问题帮助",nobutton:!0,content:Ys})}render(){let e,t,s="",i=this.props.campRoom&&this.props.commingRoom;if(this.props.globalMsg&&(t=zs),this.props.started)e=Us(CourseForStudent,{onLeaveRoom:()=>{this.__get_lesson_comming()}});else if(this.props.recording)e=this.props.flow?Qs:Js;else if(this.props.testing)e=Us(Vt,{onExit:()=>{this.__get_lesson_comming(),this.__remindChangePwd()}});else if(this.props.mycourses)e=Us(ks,{onStartRoom:e=>{this.onStartRoom(e)},onRecordRoom:e=>{this.onRecordRoom(e)},onStartHomework:e=>{this.onStartHomework(e)},onStartPreview:e=>{this.onStartPreview(e)},onExit:()=>{this.__get_lesson_comming()}});else if(this.props.changePwd)e=Us(de,{fromViewUser:this.props.fromViewUser,onClose:e=>{this.props.onChangePwd(!1,!1),e&&this.__view_user()}});else{e=this.__student_page();let t=()=>!!this.state.relaxTime&&(this.props.onShowTost({content:"马上就要上课啦，不要走开哦～"}),!0);s=Us(Yt,{flow:i,user:this.props.account,onDeviceTest:()=>{!t()&&this.props.onEnterTester("main")},onViewUser:()=>{!t()&&this.__view_user()},onViewHelper:()=>{!t()&&this.__on_helper()},onEnterMyCourses:()=>{!t()&&this.props.onEnterMyCourses()},onViewCamp:()=>{!t()&&this.__view_camp()}})}return console.log("this.props.started",this.props.changePwd),Us("div",{className:"full-h"},void 0,s,e,t,this.props.showToastState.showing?Us(oe,{data:this.props.showToastState}):"")}});s(634);function ti(e,t,s,i){Zs||(Zs="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:Zs,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}var si=Object(r.b)((e,t)=>({showing:e.dialog.showing}),(e,t)=>({dispatchHide:()=>{e({type:"HIDE_DIALOG"})}}))(class extends n.a.Component{constructor(e){super(e),Z.ipcRenderer.on("hotkey",(e,t)=>{this.onHotKey&&"function"==typeof this.onHotKey&&this.onHotKey(t)})}hide(){this.props.dispatchHide(),this.props.data.configure.cancel&&this.props.data.configure.cancel()}sure(){this.props.dispatchHide(),this.props.data.configure.sure&&this.props.data.configure.sure()}render(){this.props.data.configure.hidden;let e=[];const{type:t,configure:s}=this.props.data;let i=s.style||De.default.EBTN_STYLE_CONFIG.kNormal,n=`ok-btn ${i[0]}`,o=`cancel-btn ${i[1]}`,r=`${(s.linestyle||De.default.LINE_CONFIRM_TITLE.lineTitle)[0]}`;return"confirm"==t&&e.push(ti("button",{className:o,onClick:this.hide.bind(this)},"cancel-btn")),e.push(ti("button",{className:n,onClick:this.sure.bind(this)},"ok-btn")),ti("div",{className:`mask dialog-layer ${this.props.data.configure.hidden?" hide":" show"}`},void 0,ti("div",{className:`${"dialog "+(s.classname||"")}${s.large_mod?" large":""}`,style:s.styles},void 0,ti("div",{className:s.title_hidden?"title clear":"title"},void 0,"个人信息"==s.title?ti("div",{className:r},void 0,s.title_hidden?"":`${s.title||"提示"}`):s.title_hidden?"":`${s.title||"提示"}`,this.props.data.configure.close_hidden?"":ti("div",{className:"close-btn",onClick:this.hide.bind(this)})),ti("div",{className:s.nobutton?"content nobtn":"content"},void 0,ti("div",{className:s.large_mod?"texts large":"texts"},void 0,s.content),s.nobutton?"":ti("div",{className:"btns"},void 0,e))))}onHotKey(e){if(this.props.showing)switch(se[e]){case se.KEY_ENTER:this.sure();break;case se.KEY_ESC:this.hide()}}componentWillUnmount(){this.onHotKey=null}});var ii,ni=class extends $e.a{constructor(){super(),this.$status=1,this.$warn_times=0,this.$max_warn_times=3,this.$check_delay=3e4,this.$in_bad_status=!1,this.$check_timer=null,this.$check_closed=!0,this.$waring_threshold=2,console.log(this,"NetDetector---thiss")}get waring_threshold(){return this.$waring_threshold}set waring_threshold(e){this.$waring_threshold=e}get good(){return 1==this.$status}get offline(){return 0==this.$status}get warning(){return 0==this.$status||this.$status>this.$waring_threshold}check(){}uncheck(){console.log("call uncheck"),clearTimeout(this.$check_timer),this.$check_closed=!0}setStatus(e){this.__setStatus(e)}setStatusOnce(e){this.$status=e,this.trigger("NET:STATUS",this.$status)}onAjaxTime(e){if(this.$check_closed)return;if(!(e-=0))return;let t;t=-1==e?0:e<=300?1:e<=500?2:e<=1200?3:4,console.log("set status",t),this.__setStatus(t)}get inBadStatus(){return this.$in_bad_status}__setStatus(e){this.$status=e,this.trigger("NET:STATUS",this.$status),Q.default.log({name:"NET:STATUS",status:this.$status}),this.warning?this.$warn_times++:this.$warn_times--,this.$warn_times>=this.$max_warn_times?(this.$warn_times=this.$max_warn_times,this.$in_bad_status||(this.trigger("NET_STATUS_BAD"),this.$in_bad_status=!0)):this.$warn_times<=0&&(this.$warn_times=0,this.$in_bad_status&&(this.trigger("NET_STATUS_GOOD"),this.$in_bad_status=!1))}unload(){}},oi=s(121),ri=s.n(oi);function ai(e,t,s,i){ii||(ii="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:ii,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}const ci=ee.a.shell;var li=ai(pe,{}),di=ai(ei,{});var ui,hi=Object(r.b)((e,t)=>({account:e.login.account,dialog:e.dialog}),(e,t)=>({confirm:t=>e(y(t)),onNetStatusBad:()=>e({type:"NET_STATUS_BAD"}),onNetStatusGood:()=>e({type:"NET_STATUS_GOOD"})}))(class extends n.a.Component{constructor(e){super(e),this.state={packageUrlList:null}}componentDidMount(){this.__start_detector(),console.log("did mount..."),ye.DEBUG||ye.TEST?ri.a.log("Debug模式不清除课程资源"):fe.call({method:"clearCachedData",args:{packs:[{name:"course-ui"},{name:"preview-ui"}]}}).then(()=>{ri.a.log("APP启动清除课程资源缓存成功！")}).catch(e=>{ri.a.error("APP启动清除程资源缓存失败",e)})}componentWillUnmount(){this.$detector.unload()}__start_detector(){let e=new ni;J.a.detector=e,J.a.detector.waring_threshold=3}render(){const{dialog:e,account:t}=this.props;let s=[];return ai(_.a,{},void 0,ai("div",{className:"full-h"},void 0,ai("div",{className:"slave",onDoubleClick:()=>{remote.getCurrentWindow().webContents.openDevTools()}}),ai("div",{className:"slave-l",onDoubleClick:()=>{let e=`https://mingxi-bundles-test.oss-cn-beijing.aliyuncs.com/domain.json?t=${Date.now()}`;E.a.ajax(e,{headers:{Accept:"application/json"},method:"GET",data:{},dataType:"json",success:e=>{let t="darwin"===process.platform?e.mac:e.win;this.setState({packageUrlList:t})},error:(...t)=>{console.log("domain.json was missing at",e)}})}}),ai(v.a,{exact:!0,path:"/",render:()=>t?di:li}),e.showing?ai(si,{data:e}):"",this.state.packageUrlList&&this.state.packageUrlList.length>0?ai("div",{className:"package-url-panel",onDoubleClick:()=>{this.setState({packageUrlList:[]})}},void 0,this.state.packageUrlList.forEach((e,t)=>{s.push(ai("div",{className:"package-item",onClick:()=>{ci.openExternal(e)}},`package-item-${t}`,decodeURI(e)))}),s):""))}}),mi=s(267);function pi(e,t,s,i){ui||(ui="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var n=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);else t||(t=n||{});if(1===o)t.children=i;else if(o>1){for(var a=new Array(o),c=0;c<o;c++)a[c]=arguments[c+3];t.children=a}return{$$typeof:ui,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}Z.ipcRenderer.on("configure",(e,t)=>{window.ENV_CONF||(window.ENV_CONF={});for(let e in t)window.ENV_CONF[e]=t[e];let s,i="native-"+function(){switch(process.platform){case"win32":return"win";case"darwin":return"mac"}}();s=t.__apppath+"/dist",console.log("app configure",t),t.data&&t.data.usingBackupUrl&&(J.a.usingBackupUrl=!0),window.agora=$require(`${s}/libs/AgoraSDK/${i}/agora_node_ext.node`),function(){const e=[mi.a],t=Object(a.d)(g,Object(a.a)(...e));t.dispatch(N()),Object(o.render)(pi(r.a,{store:t},void 0,gi),document.getElementById("app"))}()}),Z.ipcRenderer.on("systeminfo",(e,t)=>{console.log("systeminfo",t),window.ENV_CONF||(window.ENV_CONF={});for(let e in t)window.ENV_CONF[e]=t[e]});var gi=pi(hi,{})},73:function(e,t){e.exports={DEBUG:!0,TC_DEBUG:!0,TEST:!1,TEACHER:!1}},78:function(e,t,s){"use strict";t.a=class{constructor(){this.eventSubscriptions={}}on(e,t){var s=this.eventSubscriptions[e];void 0===s&&(s=this.eventSubscriptions[e]=[]),s.push(t)}off(e){delete this.eventSubscriptions[e]}trigger(e,t,s){var i,n,o=this.eventSubscriptions[e];if(void 0!==o)for(t=t instanceof Array?t:[t],s=s||this,i=0,n=o.length;i<n;i+=1)o[i].apply(s,t)}}},8:function(e,t,s){"use strict";s.r(t);var i=s(96),n=s.n(i);t.default=n.a},84:function(e,t){e.exports=require("util")},96:function(e,t){e.exports={TEST_URL:(()=>{try{return localStorage.getItem("debug_ip")||"http://kecheng1.youshiyuwen.cn"}catch(e){}})(),ONLINE_URL:"https://www.mingxiyuwen.com",TENCENT_APPID:1400098973,TENCENT_ACCOUNTTYPE:28218,VIDEO_T_QUALITY:"480P_3",VIDEO_S_QUALITY:"120P_3",MAIN_WINDOW_SIZE:{width:1300,height:790},ROOM_ID:111111,LARGE_MODE:480,DANCE_MODE:200,SMALL_MODE:88,WEB_IM_GROUP_TIP:{JOIN:1,QUIT:2,KICK:3,SET_ADMIN:4,CANCEL_ADMIN:5,MODIFY_GROUP_INFO:6,MODIFY_MEMBER_INFO:7},CELL_COUNT:4,LOGIN_E_NET:201,LOGOUT_E_KICKED:103,LOGOUT_E_NET:102,LOGOUT_SUCCESS:101,GENERAL_E_NOT_LOGIN:1003,JS_READY:"jsready",INIT_ROOM:"initroom",MEMBER_ADD:"member_add",MEMBER_LEAVE:"member_leave",CLEARLINES:"clearlines",NEXT_PAGE:"nextpage",SYNC:"sync",VIDEO_PLAY:"videoplay",VIDEO_STOP:"videostop",OPEN_RACE:"#openrace",CLOSE_RACE:"#closerace",OPEN_MIC:"#openmic",CLOSE_MIC:"#closemic",COURSE_PAUSE:"#coursepause",COURSE_RESUME:"#courseresume",PUT_DANCE:"#putdance",BACK_DANCE:"#backdance",SCENE_MOVE:"scenemove",START_COURSE:"*startcourse",STOP_COURSE:"*stopcourse",WARN:"warn",WARN_RELIEVE:"warn_relieve",ENABLE_MAGIC:"enablemagic",DISABLE_MAGIC:"disablemagic",MUTE_ALL:"#muteall",UNMUTE_ALL:"#unmuteall",SHOW_RANKS:"*showranks",HIDE_RANKS:"*hideranks",OPEN_MEDDLE:"open_meddle",UPDATE:{AVAILABLE:"update available",LASTEST:"the lastest version",CHECKING:"checking for update",ERROR:"update error",DOWNLOADING:"update downloading",DOWNLOADED:"update downloaded",DOWNLOADING_UI:"downloading ui",DOWNLOADED_UI:"downloaded ui"},COCOS:1,ILLEGAL_AUDIOS:["cyberlink webcam splitter","manycam virtual webcam","BBlivePreview","CamTwist","17GuaGua Cam","PixelMaster Video HDR","PG splitter","Built-in iSight","6room"],DOMAIN_URL:"https://mingxi-bundles-test.oss-cn-beijing.aliyuncs.com/domain_list_online.json",DOMAIN_URL_TEST:"https://mingxi-bundles-test.oss-cn-beijing.aliyuncs.com/domain_list_test.json",DOMAIN_LIST_DEFAULT:{static:[{url:"https://bundlesyun.mx0a.com"},{url:"http://bundlesossyun.mw019.com"}],frame:[{url:"https://bundlesyun.mx0a.com"},{url:"http://bundlesossyun.mw019.com"}],query:[{url:"https://www.mingxiyuwen.com"}],course:[{url:"https://lessonsyun.mx0a.com"},{url:"http://lessonsossyun.mw019.com"}],updater:[{url:"http://file.mw019.com/software"}]},DOMAIN_LIST_DEFAULT_TEST:{static:[{url:"https://bundlesyuntest.mx0a.com"}],frame:[{url:"https://bundlesyuntest.mx0a.com"}],query:[{url:"http://kecheng1.youshiyuwen.cn"}],course:[{url:"https://lessonsyuntest.mx0a.com"}],updater:[{url:"http://file.mw019.com/software"}]},EBTN_STYLE_CONFIG:{kNormal:["ok","cancel"],kDeviceTest:["check-jump","check-again"],kChangePwd:["changepwd","none"],kClassExit:["leave-class","end-class"]},LINE_CONFIRM_TITLE:{lineTitle:["title-text"]}}}});