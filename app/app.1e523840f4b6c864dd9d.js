!function(e){function t(t){for(var o,n,a=t[0],l=t[1],c=t[2],u=0,h=[];u<a.length;u++)n=a[u],i[n]&&h.push(i[n][0]),i[n]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);for(d&&d(t);h.length;)h.shift()();return r.push.apply(r,c||[]),s()}function s(){for(var e,t=0;t<r.length;t++){for(var s=r[t],o=!0,a=1;a<s.length;a++){var l=s[a];0!==i[l]&&(o=!1)}o&&(r.splice(t--,1),e=n(n.s=s[0]))}return e}var o={},i={0:0},r=[];function n(t){if(o[t])return o[t].exports;var s=o[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=o,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="./";var a=window.webpackJsonp=window.webpackJsonp||[],l=a.push.bind(a);a.push=t,a=a.slice();for(var c=0;c<a.length;c++)t(a[c]);var d=l;r.push([226,1]),s()}({1:function(e,t){e.exports=require("electron")},11:function(e,t){e.exports=require("os")},115:function(e,t,s){},116:function(e,t,s){},117:function(e,t,s){},118:function(e,t,s){},126:function(e,t,s){},128:function(e,t){e.exports=require("constants")},130:function(e,t){e.exports=require("stream")},151:function(e,t,s){},159:function(e,t){e.exports=require("http")},16:function(e,t){e.exports=require("fs")},160:function(e,t){e.exports=require("https")},161:function(e,t){e.exports=require("url")},163:function(e,t,s){},174:function(e,t){e.exports=require("buffer")},190:function(e,t){},191:function(e,t){},209:function(e,t){},210:function(e,t){},213:function(e,t){e.exports=require("zlib")},224:function(e,t){e.exports=require("querystring")},226:function(e,t,s){"use strict";s.r(t);s(17),s(115),s(116),s(117),s(118);var o=s(91),i=s(11),r=s.n(i),n=s(30),a=s.n(n),l=s(36),c=s.n(l),d=s(1),u=s.n(d);var h=class{constructor(){}},_=a.a;var m=new class{constructor(e="MINGXI.INC"){if(this.$namespace=e,this.$data=localStorage.getItem(this.$namespace),console.log("namespace...",e,this.$data),this.$data)try{this.$data=JSON.parse(this.$data)}catch(e){this.$data={},localStorage.removeItem(this.$namespace)}else this.$data={}}get(e){return this.$data[e]}store(e,t){this.$data[e]=t,localStorage.setItem(this.$namespace,JSON.stringify(this.$data))}clear(){localStorage.removeItem(this.$namespace)}},p=s(4),g=s.n(p),f=s(16),v=s.n(f);const w=d.remote.require("pandora-nodejs-sdk"),y=d.remote.require("electron-log"),$=d.remote.app.getPath("userData");var b=new class{get agoraAppId(){let e=window.ENV_CONF||{};return e.TEST||e.DEBUG?"8255568bc0ab4117bce79c6ca65e1c99":"d75fe75ab0404a90b2ed7e5bab216f80"}get agoraChannelKey(){let e=window.ENV_CONF||{};return e.TEST||e.DEBUG?"83dfd49b300c4c1d8af4a5ff68c12214":"7c9b6ed9bba54dc59471cfa09e9f23ea"}get dmg(){return this.$dmg}set dmg(e){this.$dmg=e}get user(){return this.$user||{}}set user(e){this.$user=e}get loading(){return this.$loading}set loading(e){this.$loading=e}get detector(){return this.$detector}set detector(e){this.$detector=e}get course(){return this.$course}set course(e){this.$course=e}get room(){return this.$room}set room(e){this.$room=e}get session(){return this.$session}set session(e){this.$session=e}get storage(){return this.$storage||(this.$storage=m),this.$storage}set storage(e){this.$storage=e}set usingBackupUrl(e){this.$using_backup_url=e}get usingBackupUrl(){return this.$using_backup_url}get video_device_id(){return this.$video_device_id}set video_device_id(e){this.$video_device_id=e}get audio_device_id(){return this.$audio_device_id}set audio_device_id(e){this.$audio_device_id=e}get domains(){return this.$domains||_.DOMAIN_LIST_DEFAULT}set domains(e){this.$domains=e}set distPath(e){this.$dist_path=e}get distPath(){return this.$dist_path}addDownloaded(e,t){this.$local_files||(this.$local_files={}),this.$local_files[e]=t}getDownloaded(e){if(this.$local_files)return this.$local_files[e]}send_to_main(e){console.log("send_to_main",d.ipcRenderer,e),d.ipcRenderer.send(...e)}restoreOldDevice(){localStorage.getItem("IS_OLD_DEVICE")&&console.log("copy low version old device")}set oldDevice(e){DB.store("IS_OLD_DEVICE",1&e)}set joinClassEnabled(e){this.$join_class_enabled=!!e}get joinClassEnabled(){return void 0===this.$join_class_enabled||this.$join_class_enabled}get(e,t=document){return"object"==typeof e?e:(t&&"string"==typeof t&&(t=this.get(t)),/^\./.test(e)?t.getElementsByClassName(e.replace(/^\./,"")):(/^#/.test(e)&&(e=e.replace(/^#/,"")),document.getElementById(e)))}offset(e){e=this.get(e);var t=0,s=0;do{t+=e.offsetTop,s+=e.offsetLeft,e=e.parentNode}while(e.parentNode);return{top:t,left:s}}get rkey(){return"TNyv1khX-,5IOzgBWgpu"}empty(e){if("string"==typeof e&&(e=this.get(e)),e.length)for(let t=0,s=e.length;t<s;t++)e[t].innerHTML="";else e&&(e.innerHTML="")}get lkey(){return"Yu6oGz2USJb9RMgG84KalD,19Dnr5YuF0mV1QoEgBxX2"}__upload_log(e,t,s){return new Promise((o,i)=>{if(!v.a.existsSync(e))return void i();let r=v.a.readFileSync(e,"utf8");if(r){let n=this.lkey.split(","),a=this.rkey.split(",");r=r.split("\n").map(s),w.send(new w.Auth(n[0]+"DxyKE2vUz"+a[0],n[1]+"PVhUEGplM"+a[1]),t,r).then(()=>{v.a.writeFileSync(e,"","utf8")}).then(o,i)}else i()})}upload_system_logs(){this.__upload_log(g.a.join($,"system.log"),"mingxi_pc_system",e=>{let t=e.split(" ");return{time:[t.shift(),t.shift()].join(" "),content:t.join(" "),user:this.user.id,name:this.user.child_name}}).then(()=>{y.log("update system logs success")}).catch(e=>{y.error("update system logs failed ",e)})}upload_agora_logs(){this.__upload_log(g.a.join($,"agora.log"),"mingxi_pc_agora",e=>{let t=e.split(";");return{time:t.shift(),content:t.join(";"),user:this.user.id,name:this.user.child_name}}).then(()=>{y.log("update agora logs success")}).catch(e=>{y.error("update agora logs failed ",e)})}log(...e){y.log(...e);let t=window.ENV_CONF||{};(t.DEBUG||t.TC_DEBUG||t.TEST)&&console.log(...e)}error(...e){y.error(...e);let t=window.ENV_CONF||{};(t.DEBUG||t.TC_DEBUG||t.TEST)&&console.error(...e)}filterVideoDevice(e){return e=e.filter((e={})=>{let t=!1;return _.ILLEGAL_AUDIOS.map(s=>{new RegExp(s.toLowerCase()).test((e.devicename||"").toLowerCase())&&(t=!0)}),!t})}set sentryBrowser(e){this.$sentry_browser=e}get sentryBrowser(){return this.$sentry_browser}set ffmpeg(e){this.$ffmpeg_path=e}get ffmpeg(){return this.$ffmpeg_path}mark(e,t,s={},o=""){t?this.$sentry_browser.captureEventWithCode(e,t,s,o):this.$sentry_browser.captureMessageWithCode(e,o)}markClick(e){try{let t=e=>{for(const t in e)if(/reactEventHandlers/.test(t))return e[t];return{}},s=e=>""!==e.id?"@id="+e.id:null!==e.getAttribute("class")?"@class="+e.getAttribute("class"):void 0,o=e=>{if(!e)return null;let s={...e},i=t(s).onClick;return i?[e,i.toString()]:o(e.parentNode)},i=o(e.target);if(i){let e=s(i[0]),t=i[1];e&&!/full-h/.test(e)&&this.mark(20006,{eventDetail:t},{},e)}}catch(e){console.error("mark click error",e.message)}}showReport(){this.$sentry_browser.showReport()}linkTo(e="http://gookoo.cn"){d.shell.openExternal(e)}};var N=new class extends h{constructor(){super()}formatDate(e,t){const s=["Y","M","D","h","m","s"],o=[],i=new Date(e);o.push(i.getFullYear()),o.push(this.__format_number(i.getMonth()+1)),o.push(this.__format_number(i.getDate())),o.push(this.__format_number(i.getHours())),o.push(this.__format_number(i.getMinutes())),o.push(this.__format_number(i.getSeconds()));for(const e in o)({}).hasOwnProperty.call(o,e)&&(t=t.replace(s[e],o[e]));return t.replace("2020-","").replace("2021-","").replace("2022-","").replace("2023-","")}__format_number(e){return(e=e.toString())[1]?e:`0${e}`}};var S=new class{constructor(){this.$client=o,d.ipcRenderer.on("sentry_log",(e,t={})=>{t.info?this.__captureEvent(t.title,t.level,t.info,t.extra):this.__captureMessage(t.title,t.level)}),this.$prefix_hash={fatal:"✙✙",error:"✖✖",log:"✎✎",info:"✔✔",warning:"☂☂"},window.alert=(e=>t=>{this.captureEventWithCode(20003,{message:t},{},t.toString().substring(0,30)+".."),e(t)})(window.alert),this.$round=Number(localStorage.getItem("LAUNCH_ROUND")||"1"),localStorage.setItem("LAUNCH_ROUND",this.$round+1),this.$cpu_status="",this.getCPUUsage(),d.remote.getCurrentWindow().on("close",e=>{this.captureMessageWithCode(10003)})}init(){console.log("init sentry debug#test:",window.ENV_CONF.DEBUG,window.ENV_CONF.TEST),this.$client.init({dsn:a.a.SENTRY_DSN,environment:window.ENV_CONF.DEBUG?"DEBUG":window.ENV_CONF.TEST?"TEST_OR_PREONLINE":"ONLINE",debug:!1,beforeSend:e=>(e.exception,e)})}__get_ip(){const e=i.networkInterfaces();let t="Uknown";for(let s in e){let o=e[s];for(let e=0;e<o.length;e++){let s=o[e];"IPv4"!==s.family||"127.0.0.1"===s.address||s.internal||(t=s.address)}}return t}showReport(){this.$client.showReportDialog({title:"问题反馈/优化建议/功能推荐",subtitle:"",name:"",subtitle2:"",labelName:"怎么称呼？",labelEmail:"你的电子邮箱",labelComments:"你想说。。",errorFormEntry:"请填写完整后重试",labelSubmit:"提交",onLoad:()=>{try{document.getElementById("id_name").setAttribute("placeholder",""),document.getElementById("id_email").setAttribute("placeholder",""),document.getElementById("id_comments").setAttribute("placeholder",""),document.getElementById("id_name").style.height="36px",document.getElementById("id_email").style.height="36px",document.getElementById("id_comments").style.height="44px",document.getElementById("powered-by").style.display="none"}catch(e){}}})}bindUser(e,t,s,o,i){this.$uid=e,this.$nickname=t,this.$mobile=s,this.$version=o,this.$token=i,this.$profile=localStorage.getItem("MINGXI.INC"),this.$client.configureScope(i=>{i.setTag("version",o),i.setTag("app_version","1.0.2"),i.setUser({id:e,username:t,mobile:s,ip_address:this.__get_ip()})})}getCPUUsage(){var e=this.getCPUInfo(),t=e.idle,s=e.total;this.$timer_cpu_observer&&clearTimeout(this.$timer_cpu_observer),this.$timer_cpu_observer=setTimeout(()=>{var e=this.getCPUInfo(),o=e.idle,i=e.total,r=(o-t)/(i-s);this.$cpu_status="【 CPU使用："+(100*(1-r)).toFixed(2)+"% 】",this.getCPUUsage()},1e3)}getCPUInfo(){var e=i.cpus(),t=0,s=0,o=0,r=0,n=0;for(var a in e)t+=e[a].times.user,s+=e[a].times.nice,o+=e[a].times.sys,n+=e[a].times.irq,r+=e[a].times.idle;return{idle:r,total:t+s+o+r+n}}__captureMessage(e,t){return this.$client.captureMessage(`${this.__prefixForLevel(t)}【\b${this.$round}th】【${this.$uid||"-"} / ${this.$nickname||"-"} / ${this.$mobile||"-"}】【${N.formatDate(Date.now(),"Y-M-D h:m:s")}】【${e}】`,t)}__captureEvent(e,t,s,o){return this.$client.captureEvent({message:`${this.__prefixForLevel(t)}【\b${this.$round}th】【${this.$uid||"-"} / ${this.$nickname||"-"} / ${this.$mobile||"-"}】【${N.formatDate(Date.now(),"Y-M-D h:m:s")}】【${e}】`,extra:{_cpu_mem_:this.$cpu_status+`【 内存使用：总共${(i.totalmem()/1024/1024).toFixed(2)}M 剩余${(i.freemem()/1024/1024).toFixed(2)}M 】`,_profile_:this.$profile,...s},...o,level:t})}__prefixForLevel(e){return this.$prefix_hash[e||"fatal"]}captureMessageWithCode(e,t=""){console.log("MINGXI_DEBUG_LOG>>>>>>>>>code",e);let s=c.a.MESSAGE[e],o=s[0],i=c.a.LEVEL[s[1]];return this.__captureMessage(o+t,i)}captureEventWithCode(e,t={},s={},o=""){let i=c.a.EVENT[e],r=i[0],n=c.a.LEVEL[i[1]];return this.__captureEvent(r+o,n,t,s)}},E=s(3),D=s.n(E),T=s(35),k=s.n(T),I=s(18),O=s(25);var C=(e={type:"alert",configure:{content:""}},t)=>{switch(t.type){case"SHOW_ALERT":return{...e,type:"alert",configure:t.configure,showing:!0};case"SHOW_CONFIRM":return{...e,type:"confirm",configure:t.configure,showing:!0};case"HIDE_DIALOG":return{...e,showing:!1};default:return e}};var U=(e={},t)=>{switch(t.type){case"LOGIN_SUCCESS":return{...e,account:t.account};case"LOGOUT":return{...e,account:null};case"CHANGE_USER_INFO":return{...e,account:t.user};default:return e}};var L=(e={},t)=>{switch(t.type){case"ROOM_LIST":return{...e,rooms:t.rooms};case"ROOM_INFO":return{...e,room:t.data};case"CALENDAR_DATA":return{...e,calendar:t.data};case"START_COURSE":return{...e,courseStarted:!0};case"COURSE_END":return{...e,courseStarted:!1};case"ENTER_TESTER":return{...e,courseStarted:!1,enterTester:!0,fromPage:t.page};case"ENTER_MY_COURSES":return{...e,enterMyCourses:!0};case"EXIT_MY_COURSES":return{...e,enterMyCourses:!1};case"EXIT_TESTER":let s=e.fromPage;return{...e,enterTester:!1,courseStarted:"course"==s};case"NET_STATUS_BAD":return{...e,netStatus:0};case"NET_STATUS_GOOD":return{...e,netStatus:1};case"COURSE_RECORDING":return{...e,recording:t.status,flow:t.camp};case"LESSON_COMMING":return{...e,commingRoom:t.commingRoom};case"CAMP_LESSON":return{...e,campRoom:t.campRoom};case"LESSONS_COMMING":return console.log("LESSONS_COMMING action.commingRooms",t.commingRooms),{...e,commingRooms:t.commingRooms};case"LESSONS_DONE":return console.log("LESSONS_DONE action.doneRooms",t.doneRooms),{...e,doneRooms:t.doneRooms};case"LESSONS_TOTAL_COMMING":return{...e,totalComming:t.totalComming};case"LESSONS_TOTAL_DONE":return{...e,totalDone:t.totalDone};case"CHANGE_PASSWORD":return console.log("MINGXI=============action.changePwd",t.changePwd,t.fromViewUser),{...e,changePwd:t.changePwd,fromViewUser:t.fromViewUser};case"SHOW_GLOBAL_MSG":return{...e,globalMsg:t.globalMsg};default:return e}};var M=(e={},t)=>{let s,o,i,r;switch(t.type){case"ROOM_INFO":let n=t.data,a={child_name:n.teacher_name,avatarurl:n.teacher_avatar,id:n.teacher_id};if(!n.camp){let e=n.start_time.split(/[-: ]/),s=new Date(e[0],e[1]-1,e[2]||1,e[3]||0,e[4]||0,e[5]||0).getTime()-Date.now(),o=m.get("STATUS_"+n.channel_id);(r=(r=o||{duration:t.data.duration,waiting:s,id:n.channel_id})||{}).waiting=s}return{...e,info:t.data,switches:{gift:!0,muteall:!0},dancing:[],status:r,teacher:a};case"ROOM_GIFT":return{...e,gifts:t.data};case"ROOM_MORE_INFO":let l={...e.info};return l.channel_token=t.data.channel_token,l.features=t.data.features,console.log(t.data.students,"action.data.students"),{...e,info:l,students:t.data.students};case"NEW_GIFT":let c=t.data;for(let t=0,s=(i=[...e.students]).length;t<s;t++){let e=i[t];e.id==c.uid&&(e.gift_total=c.total)}return{...e,students:i};case"WARN":let d=t.data;for(let s=0,o=(i=[...e.students]).length;s<o;s++){let e=i[s];e.id==d.uid?e.warn=t.status:e.warn=!1}return{...e,students:i};case"USER_MUTED":if(i=[...e.students])for(let e=0,s=i.length;e<s;e++){let s=i[e];s.id==t.id&&(s.unmuted=!t.mute,s.unmuted&&!t.recovering&&s.speak++)}return{...e,students:i};case"USER_ADD_ROOM":if(a={...e.teacher},t.id==a.id)return a.online=!0,{...e,teacher:a};for(let s=0,o=(i=[...e.students]).length;s<o;s++){let e=i[s];if(e.id==t.id){e.online=!0,e.online_time=(new Date).getTime();break}}return{...e,students:i};case"NEW_STREAM":if((s=t.stream.getId())==(a={...e.teacher}).id)return a.stream=t.stream,a.online=!0,a.stream_inited=!1,{...e,teacher:a};for(let s=0,o=(i=[...e.students]).length;s<o;s++){let e=i[s];e.id==t.stream.getId()&&(e.stream=t.stream,e.online=!0,e.online_time||(e.online_time=(new Date).getTime()),e.stream_inited=!1)}return{...e,students:i};case"STREAM_LEAVE":if((s=t.stream.getId())==(a={...e.teacher}).id)return a.stream=null,a.online=!1,a.stream_inited=!1,{...e,teacher:a};for(let t=0,o=(i=[...e.students]).length;t<o;t++){let e=i[t];e.id==s&&(e.stream=null,e.online_time=null,e.online=!1,e.dancing=!1,e.stream_inited=!1)}return{...e,students:i};case"HANDSUP_SWITCH":if((o={...e.switches}).handsup=t.status,e.students=e.students||[],i=[...e.students])for(let e=0,t=i.length;e<t;e++)i[e].rank=null;return{...e,switches:o,students:i};case"GIFT_SWITCH":return(o={...e.switches}).gift=t.status,{...e,switches:o};case"MAGIC_SWITCH":return(o={...e.switches}).magic=t.status,{...e,switches:o};case"MUTEALL_SWITCH":if(o={...e.switches},i=[...e.students])for(let e=0,s=i.length;e<s;e++)i[e].unmuted=!t.status;return o.muteall=t.status,{...e,students:i,switches:o};case"RANK_SWITCH":return(o={...e.switches}).rank=t.status,{...e,switches:o};case"SILENT_SWITCH":return(o={...e.switches}).silent=t.status,{...e,switches:o};case"HANDSUP_RANK":if(i=[...e.students])for(let e=0,s=i.length;e<s;e++){let s=i[e];if(s.id==t.id){s.rank=t.rank,s.handsup++;break}}return{...e,students:i};case"DANCING":if(i=[...e.students])for(let e=0,s=i.length;e<s;e++){let s=i[e];s.id==t.id?s.dancing=t.status:s.dancing=!1}return{...e,students:i};case"COURSE_BEGIN":return(r={...e.status}).started=!0,m.store("STATUS_"+r.id,r),{...e,status:r};case"COURSE_PAUSE":return(r={...e.status}).paused=!0,m.store("STATUS_"+r.id,r),{...e,status:r};case"COURSE_RESUME":return(r={...e.status}).paused=!1,m.store("STATUS_"+r.id,r),{...e,status:r};case"COURSE_END":return(r={...e.status}).started=!1,r.paused=!1,m.store("STATUS_"+r.id,r),{...e,status:r};case"COURSE_TICK":return(r={...e.status}).started&&!r.paused?(r.duration--,m.store("STATUS_"+r.id,r),{...e,status:r}):e;case"COURSE_STARTING_TICK":return(r={...e.status}).waiting-=1e3,{...e,status:r};case"GIFT_UPDATE":i=[...e.students];let u=t.data;if(i)for(let e=0,t=i.length;e<t;e++){let t=i[e];for(let e=0,s=u.length;e<s;e++){let s=u[e];if(s.to_id==t.id){t.gift_total=s.total;break}}}return{...e,students:i};case"PROGRESS_UPDATE":i=[...e.students];let h=t.percent,_=t.id;if(i)if(100==h){let e=null,t=1;for(let s=0,o=i.length;s<o;s++){let o=i[s];o.id==_?(o.percent=h,e=o):o.progress_rank&&t++}e&&(e.progress_rank=t)}else for(let e=0,t=i.length;e<t;e++){let t=i[e];if(t.id==_){t.percent=h;break}}return{...e,students:i};case"PROGRESS_RESET":if(i=[...e.students])for(let e=0,t=i.length;e<t;e++){let t=i[e];t.progress_rank=null,t.percent=null}return{...e,students:i};case"QUESTION_LIST":return(o={...e.switches}).questionList=t.status,{...e,switches:o};case"QUESTION_DETAIL":return(o={...e.switches}).questionDetail=t.status,{...e,switches:o};default:return e}};var A=(e={type:"toast",configure:{content:""}},t)=>{switch(t.type){case"SHOW_TOAST":return{...e,type:"toast",configure:t.configure,showing:!0};case"HIDE_DIALOG":return{...e,showing:!1};default:return e}},G=Object(O.c)({dialog:C,login:U,main:L,room:M,toast:A}),R=s(229),x=s(230),P=s(7),F=s.n(P);var j=new class{constructor(){this.$inited=!1}__init(){this.$dom=F()('<div class="loading-mask"><div class="loading-close"></div><div class="loading-text"></div></div>'),this.$dom.hide().appendTo("body"),this.$inited=!0,F()(this.$dom).on("click",".loading-close",()=>{this.hide()})}show(e=""){this.$inited||this.__init(),F()(".loading-text",this.$dom).html(e),this.$dom.fadeIn()}hide(){this.$dom&&this.$dom.fadeOut()}};const q=e=>({type:"SHOW_CONFIRM",configure:e}),B=()=>e=>{let t=m.get("USER_INFO");t&&e(W(t))},W=e=>t=>{m.store("USER_INFO",e),t({type:"LOGIN_SUCCESS",account:e})},H=e=>({type:"SHOW_GLOBAL_MSG",globalMsg:e});var V;var X,z=Object(I.b)((e,t)=>({globalMsg:e.main.globalMsg}),(e,t)=>({onShowGlobalMsg:t=>{e(H(t))}}))(class extends D.a.Component{constructor(e){super(e)}componentDidMount(){}componentWillUnmount(){}render(){return this.props.globalMsg?function(e,t,s,o){V||(V="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),t&&i)for(var n in i)void 0===t[n]&&(t[n]=i[n]);else t||(t=i||{});if(1===r)t.children=o;else if(r>1){for(var a=new Array(r),l=0;l<r;l++)a[l]=arguments[l+3];t.children=a}return{$$typeof:V,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}("div",{className:"global-msg-pannel"},void 0,"【系统提示】"+this.props.globalMsg):""}});s(2);function K(e,t,s,o){X||(X="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),t&&i)for(var n in i)void 0===t[n]&&(t[n]=i[n]);else t||(t=i||{});if(1===r)t.children=o;else if(r>1){for(var a=new Array(r),l=0;l<r;l++)a[l]=arguments[l+3];t.children=a}return{$$typeof:X,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}var Y,J=class extends E.Component{constructor(){super(),this.transitionTime=300,this.state={notices:[]},this.removeNotice=this.removeNotice.bind(this)}getNoticeKey(){const{notices:e}=this.state;return`notice-${(new Date).getTime()}-${e.length}`}addNotice(e){const{notices:t}=this.state;return e.key=this.getNoticeKey(),t[0]=e,this.setState({notices:t}),e.duration>0&&setTimeout(()=>{this.removeNotice(e.key)},e.duration),()=>{this.removeNotice(e.key)}}removeNotice(e){const{notices:t}=this.state;this.setState({notices:t.filter(t=>t.key!==e||(t.onClose&&setTimeout(t.onClose,this.transitionTime),!1))})}render(){const{notices:e}=this.state,t={info:"toast_info",success:"toast_success",error:"toast_error",loading:"toast_loading"};return K("div",{className:"toast"},void 0,e.map(e=>K("div",{className:"toast_bg"},e.key,K("div",{className:"toast_box"},void 0,K("div",{className:`toast_icon ${t[e.type]}`}),K("div",{className:"toast_text"},void 0,e.content)))))}};s(126);function Q(e,t,s,o){Y||(Y="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),t&&i)for(var n in i)void 0===t[n]&&(t[n]=i[n]);else t||(t=i||{});if(1===r)t.children=o;else if(r>1){for(var a=new Array(r),l=0;l<r;l++)a[l]=arguments[l+3];t.children=a}return{$$typeof:Y,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}var Z=Q(J,{});let ee;const te=(e,t,s=2e3,o)=>(ee||(ee=function(){const e=document.createElement("div");document.body.appendChild(e);const t=k.a.render(Z,e);return{addNotice:e=>t.addNotice(e),destroy(){k.a.unmountComponentAtNode(e),document.body.removeChild(e)}}}()),ee.addNotice({type:e,content:t,duration:s,onClose:o}));var se,oe={info:(e,t,s)=>te("info",e,t,s),success:(e="操作成功",t,s)=>te("success",e,t,s),error:(e,t,s)=>te("error",e,t,s),loading:(e="加载中...",t=0,s)=>te("loading",e,t,s)};function ie(e,t,s,o){se||(se="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),t&&i)for(var n in i)void 0===t[n]&&(t[n]=i[n]);else t||(t=i||{});if(1===r)t.children=o;else if(r>1){for(var a=new Array(r),l=0;l<r;l++)a[l]=arguments[l+3];t.children=a}return{$$typeof:se,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}const re=u.a.clipboard;var ne=ie("div",{},void 0,"登陆方式：",ie("div",{className:"login-style qq"})),ae=ie("div",{},void 0,"登陆方式：",ie("div",{className:"login-style qq"}));var le,ce=class extends D.a.Component{constructor(e){super(e),this.state={hover:!1}}__goto(e){this.$timer&&clearTimeout(this.$timer),this.$timer=setTimeout(()=>{clearTimeout(this.$timer),b.linkTo(e)},100)}__writeTextToClipboard(e){oe.success("复制成功",1e3),re.writeText(e)}render(){return ie("div",{className:"matter-container",onMouseOver:()=>{},onMouseOut:e=>{}},void 0,ie("div",{className:"matter-content"},void 0,ie("div",{className:"matter-item"},void 0,ie("div",{className:"logo qiantu",onClick:()=>{this.__goto("https://www.58pic.com/")}}),ie("div",{className:"matter-item-title"},void 0,ie("span",{className:"icon icon-link",onClick:()=>{this.__goto("https://www.58pic.com/")}})),ne,ie("div",{},void 0,"账号：2415343397",ie("span",{className:"copy",onClick:()=>{this.__writeTextToClipboard("2415343397")}},void 0,"复制")),ie("div",{},void 0,"动态密码：",this.state.view_open_qiantu?"chengxubao598":"************",ie("span",{className:"copy view icon icon-eye",onClick:()=>{let e=this.state.view_open_qiantu;this.setState({view_open_qiantu:!e})}}),ie("span",{className:"copy",onClick:()=>{this.__writeTextToClipboard("chengxubao598")}},void 0,"复制"))),ie("div",{className:"matter-item"},void 0,ie("div",{className:"logo _6m5m",onClick:()=>{this.__goto("http://www.6m5m.com/")}}),ie("div",{className:"matter-item-title"},void 0,ie("span",{className:"icon icon-link",onClick:()=>{this.__goto("http://www.6m5m.com/")}})),ae,ie("div",{},void 0,"账号：2415343397",ie("span",{className:"copy",onClick:()=>{this.__writeTextToClipboard("2415343397")}},void 0,"复制")),ie("div",{},void 0,"动态密码：",this.state.view_open_6m5m?"chengxubao598":"************",ie("span",{className:"copy view icon icon-eye",onClick:()=>{let e=this.state.view_open_6m5m;this.setState({view_open_6m5m:!e})}}),ie("span",{className:"copy",onClick:()=>{this.__writeTextToClipboard("chengxubao598")}},void 0,"复制"))),ie("div",{className:"matter-item"},void 0,ie("div",{className:"logo aigei",onClick:()=>{this.__goto("http://www.aigei.com/")}}),ie("div",{className:"matter-item-title"},void 0,ie("span",{className:"icon icon-link",onClick:()=>{this.__goto("http://www.aigei.com/")}})),ie("div",{},void 0,"登陆方式：暂不可用"),ie("div",{},void 0,"账号：暂不可用",ie("span",{className:"copy",onClick:()=>{this.__writeTextToClipboard("暂不可用")}},void 0,"复制")),ie("div",{},void 0,"动态密码：",this.state.view_open_aigei?"暂不可用":"************",ie("span",{className:"copy view icon icon-eye",onClick:()=>{let e=this.state.view_open_aigei;this.setState({view_open_aigei:!e})}}),ie("span",{className:"copy",onClick:()=>{this.__writeTextToClipboard("暂不可用")}},void 0,"复制")))))}},de=s(10),ue=s.n(de),he=s(28),_e=s.n(he);function me(e,t,s,o){le||(le="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),t&&i)for(var n in i)void 0===t[n]&&(t[n]=i[n]);else t||(t=i||{});if(1===r)t.children=o;else if(r>1){for(var a=new Array(r),l=0;l<r;l++)a[l]=arguments[l+3];t.children=a}return{$$typeof:le,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}u.a.clipboard;var pe=me("div",{className:"tips"},void 0,me("span",{},void 0,"第一步 : 导入视频"),me("span",{},void 0,"第二步 : 设置开始和截止时间"),me("span",{},void 0,"第三步 : 生成GIF"),me("span",{},void 0,"第四步 : 保存GIF")),ge=me("div",{id:"slideToolCtrol",className:"slideToolCtrol"},void 0,me("div",{id:"slideToolBorder",className:"slideToolBorder"},void 0,me("div",{id:"slideTitle",className:"slideTitle"},void 0,me("span",{id:"titleSpan",className:"titleSpan"},void 0,"设置开始和截止时间")),me("div",{id:"slideTool",className:"slideTool"},void 0,me("div",{id:"slideLeft",className:"slideLeft"},void 0,me("span",{id:"slider1",className:"slider1"},void 0,me("span",{id:"value1",className:"value1",value:"0"},void 0,"00:00:00"))),me("div",{id:"slideRight",className:"slideRight"},void 0,me("span",{id:"slider2",className:"slider2"},void 0,me("span",{id:"value2",className:"value2",value:"2"},void 0,"00:00:00"))))));var fe=class extends D.a.Component{constructor(e){super(e),this.state={videoShow:!0,mp4:"",mp4W:480,mp4H:480,gif:"",gifRaw:"",videoDuration:0},this.$play_reason={},this.$video_elem=null,this.$darwin=new RegExp("darwin","i").test(r.a.type()),this.$temp_gif_folder=g.a.join(d.remote.app.getPath("userData"),"gif_out"),ue.a.ensureDirSync(this.$temp_gif_folder)}componentDidMount(){this.props.onDownloadFfmpeg(),this.__settle_slider()}componentWillUnmount(){this.$video_elem=null,this.$play_reason={}}__check_ffmpeg(){localStorage.removeItem("ffmpeg_ready"),this.props.onDownloadFfmpeg(!0)}__change_num_to_timestr(e){let t=parseInt(e),s="";return s+=`${Math.floor(t/3600)<10?"0"+Math.floor(t/3600):Math.floor(t/3600)}:`,s+=`${Math.floor(t/60%60)<10?"0"+Math.floor(t/60%60):Math.floor(t/60%60)}:`,s+=`${Math.floor(t%60)<10?"0"+Math.floor(t%60):Math.floor(t%60)}`}__settle_slider(){var e=document.getElementById("slider1"),t=document.getElementById("slider2"),s=document.getElementById("slideTool"),o=document.getElementById("slideLeft"),i=document.getElementById("slideRight");document.getElementById("p1"),e.onmousedown=(i=>{e.pressed=!0;var r=i||event,n=r.offsetX;r.offsetY,console.log("leftMouseDown"),document.onmousemove=(i=>{let r=(i||event).clientX-220;e.style.left=r-s.offsetLeft-n+"px",r-s.offsetLeft-n<=0&&(e.style.left="0px"),r-s.offsetLeft-n>=550&&(e.style.left="550px"),e.offsetLeft>=t.offsetLeft&&(e.style.left=t.offsetLeft+"px");var a=100*e.offsetLeft/550;o.style.width=e.offsetLeft+"px",F()("#value1").text(this.__change_num_to_timestr(a*this.state.videoDuration/100)),F()("#value1").attr("value",a)}),document.onmouseup=(()=>{document.onmousemove=null,e.pressed&&(e.pressed=!1,this.__preview_video())})}),t.onmousedown=(o=>{t.pressed=!0,console.log("MINGXI_DEBUG_LOG>>>>>>>>>slider2","");var r=o||event,n=r.offsetX;r.offsetY,document.onmousemove=(o=>{var r=o||event;let a=r.clientX-220;t.style.left=a-s.offsetLeft-n+"px",a-s.offsetLeft-n<=0&&(t.style.left="0px"),a-s.offsetLeft-n>=550&&(t.style.left="550px"),t.offsetLeft<=e.offsetLeft&&(t.style.left=e.offsetLeft+"px"),console.log("MINGXI_DEBUG_LOG>>>>>>>>>slider2",t.offsetLeft,a,r);var l=100*t.offsetLeft/550;console.log("MINGXI_DEBUG_LOG>>>>>>>>>value",l),i.style.width=t.offsetLeft+"px",F()("#value2").text(this.__change_num_to_timestr(l*this.state.videoDuration/100)),F()("#value2").attr("value",l)}),document.onmouseup=(()=>{document.onmousemove=null,t.pressed&&(t.pressed=!1,this.__preview_video())})})}__preview_video(){if(this.$video_elem){let e=F()("#value1")[0].getAttribute("value")*this.state.videoDuration/100,t=F()("#value2")[0].getAttribute("value")*this.state.videoDuration/100;console.log("MINGXI_DEBUG_LOG>>>>>>>>>from, to",e,t),this.$video_elem.currentTime=e,this.$video_elem.from=e,this.$video_elem.to=t,this.$video_elem.play()}}__save_gif(){this.state.gifRaw&&d.remote.dialog.showSaveDialog(d.remote.getCurrentWindow(),{title:"请选择要保存的文件名",buttonLabel:"保存",filters:[{name:"image",extensions:["gif"]}]},e=>{console.log("MINGXI_DEBUG_LOG>>>>>>>>>result.filePath",e);try{ue.a.copyFileSync(this.state.gifRaw,e),d.remote.shell.showItemInFolder(e)}catch(e){}})}__preview_gif(){let e,t=_e.a.exec,s=_e.a.execSync;this.$darwin?(e=b.ffmpeg.replace(/ /g,"\\ "),s(`chmod 777 '${b.ffmpeg}'`)):e=b.ffmpeg;let o=this.$darwin?`${this.$temp_gif_folder}/video_preview.gif`:`${this.$temp_gif_folder}\\video_preview.gif`,i=o.replace(/ /g,"\\ "),r=F()("#value1")[0].getAttribute("value")*this.state.videoDuration/100,n=F()("#value2")[0].getAttribute("value")*this.state.videoDuration/100,a=Math.max(1,parseInt(n-r)),l=`${e} -t ${a} -ss ${this.__change_num_to_timestr(r)} -i ${this.state.mp4.replace("file://","")} -s ${this.state.mp4W+"x"+this.state.mp4H} -y ${i}`;this.$darwin||(l=`${e} -t ${a} -ss ${this.__change_num_to_timestr(r)} -i ${this.state.mp4.replace("file://","")} -s ${this.state.mp4W+"x"+this.state.mp4H} -y -vf "fps=10,scale=320:-1:flags=lanczos,split[s0][s1];[s0]palettegen[p];[s1][p]paletteuse" -loop 0 ${i}`),l=window._test_command||l,console.log("MINGXI_DEBUG_LOG>>>>>>>>>command is:",l),this.props.showLoading("生成中..."),t(l,(e,t,s)=>{console.log("MINGXI_DEBUG_LOG>>>>>>>>>[exec] error",e),console.log("MINGXI_DEBUG_LOG>>>>>>>>>[exec] stdout",t),console.log("MINGXI_DEBUG_LOG>>>>>>>>>[exec] stderr",s),e||this.setState({gif:null,gifRaw:null},()=>{this.setState({gif:o+"?t="+Date.now(),gifRaw:o})}),this.props.hideLoading()})}__import_files(){d.ipcRenderer.send("open-directory-dialog","openFile"),d.remote.dialog.showOpenDialog(d.remote.getCurrentWindow(),{properties:["openFile"],filters:[{name:"mp4",extensions:["mp4"]}]},(e=[])=>{let t=e[0];t&&(this.$video_elem=null,this.$play_reason={},this.setState({videoShow:!1,videoDuration:0,gif:"",gifRaw:""},()=>{this.props.showLoading("载入中..."),this.setState({videoShow:!0,mp4:"file://"+t})}))})}__try_to_play(e){this.$play_reason[e]=!0,this.$play_reason.canplay&&this.$play_reason.duration&&(this.$video_elem=F()("#video_preview")[0],this.props.hideLoading())}render(){return me("div",{className:"gif-container"},void 0,me("div",{className:"preview"},void 0,this.state.videoShow?me("video",{width:"400px",height:"300px",className:"video-preview",id:"video_preview",controls:"controls",onDoubleClick:()=>{},onDurationChange:e=>{console.log("MINGXI_DEBUG_LOG>>>>>>>>>event.currentTarget",e.currentTarget),this.setState({videoDuration:e.currentTarget.duration},()=>{try{F()("#value1").text(this.__change_num_to_timestr(F()("#value1")[0].getAttribute("value")*this.state.videoDuration/100)),F()("#value2").text(this.__change_num_to_timestr(F()("#value2")[0].getAttribute("value")*this.state.videoDuration/100))}catch(e){console.log("MINGXI_DEBUG_LOG>>>>>>>>>error",e)}console.log("MINGXI_DEBUG_LOG>>>>>>>>>duration change",""),this.__try_to_play("duration")})},onLoadedMetadata:e=>{this.setState({mp4W:e.currentTarget.videoWidth,mp4H:e.currentTarget.videoHeight})},onCanPlay:()=>{console.log("MINGXI_DEBUG_LOG>>>>>>>>>can play",""),this.__try_to_play("canplay")},onTimeUpdate:e=>{console.log("MINGXI_DEBUG_LOG>>>>>>>>>event progress",e.currentTarget.currentTime,e.currentTarget.from,e.currentTarget.to,this.$video_elem?this.$video_elem.to:"none"),F()("#value1")[0].getAttribute("value"),this.state.videoDuration;let t=F()("#value2")[0].getAttribute("value")*this.state.videoDuration/100;this.$video_elem&&e.currentTarget.currentTime>t&&this.$video_elem.pause()}},void 0,this.state.mp4?me("source",{src:this.state.mp4,type:"video/mp4"}):""):"",me("div",{className:"gif-preview"},void 0,this.state.gif?me("img",{className:"img",src:"file://"+this.state.gif,alt:""}):pe)),ge,me("footer",{className:"toolbar toolbar-footer fixed-bottom"},void 0,me("div",{className:"toolbar-actions"},void 0,me("button",{className:"btn btn-default",onClick:()=>{this.__import_files()}},void 0,"导入视频"),me("button",{className:"btn btn-primary preview-video",onClick:()=>{this.__preview_video()}},void 0,"播放预览"),me("button",{className:"btn btn-warning preview-gif",onClick:()=>{this.__preview_gif()}},void 0,"生成GIF"),me("button",{className:"btn btn-positive save-gif",onClick:()=>{this.__save_gif()}},void 0,"保存GIF"),me("button",{className:"btn btn-default check",onClick:()=>{this.__check_ffmpeg()}},void 0,"检测依赖库"))))}};s(151);var ve=class{constructor(){this.eventSubscriptions={}}on(e,t){var s=this.eventSubscriptions[e];void 0===s&&(s=this.eventSubscriptions[e]=[]),s.push(t)}off(e){delete this.eventSubscriptions[e]}trigger(e,t,s){var o,i,r=this.eventSubscriptions[e];if(void 0!==r)for(t=t instanceof Array?t:[t],s=s||this,o=0,i=r.length;o<i;o+=1)r[o].apply(s,t)}},we=s(31),ye=s.n(we);const $e="MESSAGE_RPC_BRIDGE";var be=new class{constructor(){this.$uuid=0,this.$handlers={},this.$sender_pool={},this.$delegate={},ye.a?(this.$sender=u.a.ipcRenderer,this.$receiver=u.a.ipcRenderer):this.$receiver=u.a.ipcMain,this.__bind()}__bind(){this.$receiver.on($e,(e,t)=>{if(!ye.a){let s=e.sender.getOwnerBrowserWindow();s&&"id"in t&&(this.$sender_pool[t.id]=s)}this.__received(t)})}__send(e){let t=this.$sender;!t&&"id"in e&&(t=this.$sender_pool[e.id]),t?t.send($e,e):console.error("no sender for message",e)}__received(e){if("error"in e||"result"in e){const t=e.id,s=this.$handlers[t];if(s){try{s(e.error,e.result)}catch(e){console.error("call message handler error",e)}delete this.$handlers[t],delete this.$sender_pool[t]}else console.error("no callback handler for message",t)}else if("method"in e){let t=this.$delegate[e.method],s=e.id;if(!t)return void this.__send({id:s,error:`no method named ${e.method}`});let o=this.$sender||this.$sender_pool[s];Promise.resolve(t(e.args,o)).then((t=null)=>{e.id&&this.__send({id:s,result:t})}).catch(e=>{this.__send({id:s,error:e.message})})}}set delegate(e){for(let t in e)this.$delegate[t]=e[t]}removeDelegate(e){delete this.$delegate[e]}call({method:e,args:t,sender:s}){if(ye.a||s)return new Promise((o,i)=>{let r=(ye.a?"R":"M")+ ++this.$uuid;this.$handlers[r]=((e,t)=>{e?i(e):o(t)}),ye.a||(this.$sender_pool[r]=s),this.__send({id:r,method:e,args:t})});console.error("call from main process must set sender")}},Ne=s(38),Se=s.n(Ne);var Ee=new class{constructor(){console.log("MINGXI_DEBUG_LOG>>>>>>>>>remove db",""),this.$domains={},this.$types={}}get types(){return this.$types}get domains(){return this.$domains}set domains(e){this.$domains=e}pull(e){let t=t=>{if(console.log("MINGXI_DEBUG_LOG>>>>>>>>>domains",t),t){let e={};for(const s in t){let o=t[s]||[];e[s]=o.map(e=>({url:e}))}console.log("MINGXI_DEBUG_LOG>>>>>>>>>result",e),this.$domains=e,this.__snyc_domains()}e()};this.$timer_pulling_domain=setTimeout(()=>{clearTimeout(this.$timer_pulling_domain),this.$timer_pulling_domain=null,t()},5e3),be.call({method:"getDomains",args:{url:a.a.DOMAIN_URL}}).then(e=>{clearTimeout(this.$timer_pulling_domain),this.$timer_pulling_domain=null,t(e)})}__snyc_domains(){}clearDoaminMarks(e){let t=this.domains[e];t&&t.map(t=>{console.log("MINGXI_DEBUG_LOG>>>>>>>>>clear kind",e),t.active=!1,t.used=!1})}availibleDomain(e,t){if(Se.a.log("search availibleDomain kind",e,t),"query"==e&&localStorage.getItem("debug_ip")&&!t)return localStorage.getItem("debug_ip");try{let s=this.$domains[e],o=null,i=null;if(!s)return null;let r=s=>(s.used=!0,s.active=!0,Se.a.log("[debug-domain]",`使用了一个${t?"新的":""}域名:`,e,s.url),s.url);for(let e of s){let{url:s,used:n,active:a}=e;t||i||(i=(()=>(Se.a.log("[debug-domain]","use back up",e.url),r(e)))),(t?a||n:!a)?e.active=!1:o||(r(e),o=s)}return this.__snyc_domains(),Se.a.log("found:",o),o||t||!i?o:i()}catch(e){}return null}};var De=new class extends h{constructor(){super(),this.$status_white_list=[200,301,302,400,401,403,404,419,422,500]}get baseUrl(){return this.$base_url||(this.$base_url=Ee.availibleDomain("query")),this.$base_url}post(e,t={}){F.a.post(this.baseUrl+e,t)}__status_in_white_list(e){return~this.$status_white_list.indexOf(e)}__use_new_base_domain(){let e=Ee.availibleDomain("query",!0);return!!e&&(this.$base_url=e,!0)}quest(e,t={}){return new Promise((s,o)=>{F.a.ajax(this.baseUrl+e,{...t,success:(...e)=>{t.success(s,o,...e)},error:(...i)=>{console.log("request error",e,...i);let r=([...i][0]||{}).status;if(!this.__status_in_white_list(r)){if(this.__use_new_base_domain())return this.quest(e,t);if(confirm("域名异常，重新尝试？"))return Ee.clearDoaminMarks("query"),this.quest(e,t)}t.error&&t.error(s,o,...i)}})})}};var Te,ke=new class extends ve{constructor(){super(),this.$log_queue=[],this.__restore_token()}__restore_token(){this.$token="";let e=b.storage.get("DYW_TOKEN");e&&(this.$token=e),(e=b.storage.get("DYW_SIG_TOKEN"))&&(this.$sigtoken=e)}upload_file(e){const t=new FormData;return t.append("upload_file",e),De.quest("/uploadfile/index",{headers:{Authorization:`Bearer ${this.$token}`},method:"POST",data:t,processData:!1,contentType:!1,success:(e,t,s)=>{s.data&&s.data.url?e(s.data.url):t()},error:(e,t)=>{alert("啊哦，文件上传失败~"),t()}})}__request(e,t={},s="get"){return t.client="pc",De.quest(e,{headers:{Authorization:`Bearer ${this.$token}`,Accept:"application/json"},method:s.toUpperCase(),data:t,dataType:"json",statusCode:{403:()=>{this.trigger("LOGIN_NEEDED")}},success:(e,t,s)=>{e(s.data)},error:(e,t,s)=>{if(s.responseJSON&&alert(s.responseJSON.message),401==s.status)return this.trigger("LOGOUT_NEEDED"),void t();s.responseJSON||alert("啊哦，网络出问题啦~"),t()}})}set token(e){b.storage.store("DYW_TOKEN",e),this.$token=e}get token(){return this.$token}set sigtoken(e){b.storage.store("DYW_SIG_TOKEN",e),this.$sigtoken=e}get sigtoken(){return this.$sigtoken}login(e){return this.__request("/user/login",e,"post")}getLoginDentities(e){return this.__request("/api/dentities",e,"post")}getLoginCode(e){return this.__request("/user/send_sms_for_client",e,"post")}getNewCodeimg(){return De.quest("/captcha/api/mini",{headers:{Authorization:`Bearer ${this.$token}`},processData:!1,contentType:!1,success:(e,t,s)=>{e(s)}})}newLogin(e){return this.__request("/user/sms_login_for_client",e,"post")}forgetPassword(e){return this.__request("/user/forget_password_for_client",e,"post")}checkPwIsDefault(){return De.quest("/user/check_password_default",{headers:{Authorization:`Bearer ${this.$token}`},method:"POST",processData:!1,contentType:!1,success:(e,t,s)=>{s.data?e(s.data):t()}})}getLessonComming(){return this.__request("/room/class_lesson_first",{client:"pc"},"post")}getLessonListComming(e={}){return e.client="pc",e.type="prepare",this.__request("/room/class_lesson_list",e,"post")}getLessonListDone(e={}){return e.client="pc",e.type="haved",this.__request("/room/class_lesson_list",e,"post")}lessons(e){return this.__request("/room/lesson_date",{date:e})}lessonsByDate(e){return this.__request("/room/lesson_list",{date:e})}lessonsByHistory(){return this.__request("/room/my_lesson_list",{client:"pc",type:"haved"})}getRoomInfo(e,t){let s=(window.ENV_CONF||{}).systeminfo||{os:{},cpu:{},system:{}},o="";try{let e=d.remote.process.getSystemMemoryInfo()||{total:0},t="操作系统："+(s.os.distro||"").replace(/[^a-zA-Z_0-9 ]/g,"")+" "+(s.os.kernal||""),i="CPU型号："+(s.cpu.brand||""),r="CPU核数："+(s.cpu.physicalCores||"")+"核"+(s.cpu.cores||"")+"线程",n="CPU主频："+(s.cpu.speed||"")+"Hz"+(s.cpu.speed==s.cpu.speedmax?"":" - "+(s.cpu.speedmax||"")+"Hz"),a="系统内存："+Math.round((e.total||0)/1024/1024*10)/10+"G",l="设备型号："+(s.system.manufacturer||"")+(s.system.model||"");o+=t+"\n",o+=i+"\n",o+=r+"\n",o+=n+"\n",o+=a+"\n",o+=l}catch(e){console.log(e)}return this.__request("/room/channel_key",{channel_id:e,device:o,is_preview:t},"post")}getRoomInfoForRecord(e){return this.__request("/room/record_room_info",{channel_id:e},"post")}getGiftsList(){return this.__request("/api/gifts",{})}sendGift(e){return this.__request("/api/give_gift",e,"post")}warn(e){return this.__request("/room/user_leave_class",e,"post")}baseUpload(e){return this.__request("/room/user_base_upload",e,"post")}closeRoom(e){return this.__request("/room/close_the_room",{channel_id:e},"post")}getServerTime(){return this.__request("/api/time")}beginClass(e,t){return this.__request("/room/class_begin",{channel_id:e,user_ids:t},"post")}changeUserInfo(e){return this.__request("/user/edit_user_info",e,"post")}earlyWarning(e){return this.__request("/room/room_early_warning",{channel_id:e},"post")}getContactInfo(){return this.__request("/user/banji_contact")}checkDevice(){return this.__request("/api/device_testing",{logs:[window.ENV_CONF.systeminfo]},"post")}__get_system_info(){let e=d.remote.process.getProcessMemoryInfo(),t=d.remote.process.getSystemMemoryInfo(),s=d.remote.process.getCPUUsage(),o=e=>Math.round(e/1024*10)/10+"M";return{um:`${o(e.workingSetSize)}/${o(e.peakWorkingSetSize)}`,tm:`${o(t.free)}/${Math.round(t.total/1024/1024*10)/10+"G"}/${t.swapFree||0}/${t.swapTotal||0}`,cpu:`${Math.round(100*s.percentCPUUsage)/100}/${s.idleWakeupsPerSecond}`}}reportSystemBaseInfo(){let e=setInterval(()=>{window.ENV_CONF&&window.ENV_CONF.systeminfo&&(clearInterval(e),this.log(window.ENV_CONF.systeminfo))},1e3)}log(e={}){console.log("net log:",e),this.$log_queue.push(e),this.$log_delay||(this.$log_delay=setInterval(()=>{this.$log_queue.length>0&&De.post("/api/h5_log",{logs:this.$log_queue,user:b.user.id,system:this.__get_system_info()}),this.$log_queue=[]},8e3))}getCampLesson(e={}){return this.__request("/api/drainage/training/index",e,"post")}device_check(){}showOthers(e){return this.__request("/api/show_others",{client:"pc",show:e?"1":"0"},"post")}};function Ie(e,t,s,o){Te||(Te="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),t&&i)for(var n in i)void 0===t[n]&&(t[n]=i[n]);else t||(t=i||{});if(1===r)t.children=o;else if(r>1){for(var a=new Array(r),l=0;l<r;l++)a[l]=arguments[l+3];t.children=a}return{$$typeof:Te,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}const Oe=d.remote.require("electron-log");var Ce,Ue=class extends D.a.Component{constructor(e){super(e),this.$downloading=null,this.state={title:"准备更新基础库...",percent:0,notice:""},this.$domain_course=Ee.availibleDomain("lessons"),console.log("MINGXI_DEBUG_LOG>>>>>>>>>init download",""),this.$darwin=new RegExp("darwin","i").test(r.a.type())}__start(e){const t=this.props.data,s=this.props.recording,o=this.props.camp,i=this.props.homework,r=this.props.preview,n=Ee.availibleDomain("frame",e);if(!n)return void this.__setStatus("UPDATE.ERROR",new Error("检测基础库出错，无可用域名"));const a={room:t,token:ke.token,account:this.props.user};let l=!1;i?this.__update_homework_frame(n).then(e=>{Oe.log(`下载作业资源成功。版本号：${e.version} 资源库下载地址：${n}`),this.props.complete(a)}).catch(e=>{Oe.error("检测作业资源出错",e,`下载地址：${n}/homework.json`),this.__setStatus("UPDATE.ERROR",e),this.__start(!0)}):r?this.__update_base_frame(n).then(e=>{Oe.log(`下载基础库成功。版本号：${e.version} 基础库下载地址：${n}`);let s=t.prepare_name;return l=!0,this.__update_preview_bundle(s)}).then(e=>{Oe.log(`下载预习课程包成功。课程名：${t.prepare_name}, 版本号：${e.version}`),this.__on_complete(a)}).catch(e=>{this.__setStatus("UPDATE.ERROR",e),l?Oe.error("检测预习课程包出错",e):(Oe.error("检测基础库出错",e,`基础库下载地址：${n}/liveroom.json 预习课程包:${t.prepare_name}.json`),this.__start(!0))}):this.__update_base_frame(n).then(e=>{Oe.log(`下载基础库成功。版本号：${e.version} 基础库下载地址：${n}`);let i=t.en_name;return s&&!o&&(i+=`.${t.version}`.replace("..",".")),l=!0,this.__update_course_bundle(i)}).then(e=>{Oe.log(`下载课程包成功。课程名：${t.en_name}, 版本号：${e.version}`,t),this.__on_complete(a)}).catch(e=>{this.__setStatus("UPDATE.ERROR",e),l?Oe.error("检测课程包出错",e):(Oe.error("检测基础库出错",e,`基础库下载地址：${n}/liveroom.json 课程包：${t.en_name}.json`),this.__start(!0))})}__restart(){this.setState({title:"准备更新基础库...",percent:0,notice:"",error:null}),this.__start()}__start_download(){this.__update_ffmpeg().then(e=>{this.props.complete(e)}).catch(e=>{this.__setStatus("UPDATE.ERROR",e)})}componentDidMount(){this.__start_download()}componentWillUnmount(){this.$unmounted=!0,this.$downloading&&be.call({method:"abortDownloadTask",args:{identity:this.$downloading}}).then(()=>{Oe.log("中止任务成功",this.$downloading)}).catch(e=>{Oe.error("中止任务失败",this.$downloading,e)})}__setStatus(e,t){if(!this.$unmounted)switch(this.setState({error:null}),e){case"UPDATE.BASEFRAME":this.setState({title:"准备下载依赖库"});break;case"UPDATE.DOWNLOADING":this.setState({notice:"正在下载，请稍候...",percent:Math.min(1,t.percent)});break;case"UPDATE.ERROR":this.setState({error:`下载失败，${t}`});break;case"UPDATE.DOWNLOADED_UI":this.setState({notice:"下载成功！",percent:1});break;case"UPDATE.DOWNLOADING_UI":this.setState({notice:"有版本更新，等待下载...",percent:0});break;case"UPDATE.LASTEST":this.setState({notice:"已是最新版本，无需更新",percent:1});break;case"UPDATE.COURSE_BUNDLE":this.setState({title:"准备下载课程包"})}}__on_complete(e){let t=this.props.recording,s=this.props.camp,o=this.props.preview;t?s?(e.recording=!0,e.camp=!0,this.props.complete(e)):ke.getRoomInfoForRecord(e.room.channel_id).then(s=>{e.students=s.students,e.recording=t,this.props.complete(e)},e=>{this.props.error(e)}):ke.getRoomInfo(e.room.channel_id,o).then(t=>{e.students=t.students,e.channel_token=t.channel_token,e.rtm_signaling_token=t.rtm_signaling_token,e.features=t.features,e.star_switch=t.star_switch,e.eye_switch=t.eye_switch,this.props.complete(e)},e=>{this.props.error(e)})}__do_update_bundle({pack:e,result:t,base_url:s=this.$base_url,checksum:o=!0}){return new Promise((i,r)=>{be.call({method:"startDownloadTask",args:{pack:e,url:`${s}/${t.url}`,md5:t.md5,version:t.version,key:t.lesson,autoUnzip:!0,checksum:o}}).then(e=>{let s=e.identity;this.$downloading=s,be.delegate={[`${s}/progress`]:({total:e,transferred:t,percent:s})=>{this.__setStatus("UPDATE.DOWNLOADING",{percent:s})},[`${s}/error`]:e=>{this.$downloading=null,this.__setStatus("UPDATE.ERROR",e.message),r(e)},[`${s}/success`]:()=>{this.$downloading=null,this.__setStatus("UPDATE.DOWNLOADED_UI"),i(t)}}}).catch(t=>{this.$downloading=null,Oe.error("下载文件出错",e,t),r(t)})})}__update_ffmpeg(){let e="http://mingxi-bundles-test.oss-cn-beijing.aliyuncs.com",t=this.$darwin?"ffmpeg-mac":"ffmpeg-win";return new Promise((s,o)=>{be.call({method:"isUpdateAvailable",args:{url:`${e}/${t}.json`,pack:t}}).then(i=>{this.__setStatus("UPDATE.BASEFRAME"),i.available?(this.__setStatus("UPDATE.DOWNLOADING_UI"),this.__do_update_bundle({pack:t,result:i.server,base_url:e}).then(e=>{s(e)}).catch(e=>{o(e)})):(this.__setStatus("UPDATE.LASTEST"),console.log("MINGXI_DEBUG_LOG>>>>>>>>>LASTEST",""),s(i.server))}).catch(e=>{o(e)})})}__update_base_frame(e){return new Promise((t,s)=>{be.call({method:"isUpdateAvailable",args:{url:`${e}/liveroom.json`,pack:"liveroom"}}).then(o=>{this.__setStatus("UPDATE.BASEFRAME"),o.available?(this.__setStatus("UPDATE.DOWNLOADING_UI"),this.__do_update_bundle({pack:"liveroom",result:o.server,base_url:e}).then(e=>{t(e)}).catch(e=>{s(e)})):(this.__setStatus("UPDATE.LASTEST"),t(o.server))}).catch(e=>{s(e)})})}__update_preview_bundle(e){return new Promise((t,s)=>{be.call({method:"getLocalInstalledVersion",args:{pack:"preview-ui"}}).then(o=>{let i=r=>{let n=Ee.availibleDomain("lessons",r);if(!n){let t=`no avalible domain for course-preview[${e}] retrying`;return Oe.log("[debug-domain] errorMessage",t),void s(new Error(t))}be.call({method:"getServerPackageVersion",args:{url:`${n}/${e}.json`}}).then(e=>{this.__setStatus("UPDATE.COURSE_BUNDLE"),e=e||{},o&&o.key==e.lesson&&o.md5==e.md5?(this.__setStatus("UPDATE.LASTEST"),t(e)):(this.__setStatus("UPDATE.DOWNLOADING_UI"),this.__do_update_bundle({pack:"preview-ui",result:e,base_url:n}).then(e=>{t(e)}).catch(e=>{s(e)}))}).catch(e=>{i(!0)})};i()}).catch(e=>{s(e)})})}__update_course_bundle(e){return new Promise((t,s)=>{be.call({method:"getLocalInstalledVersion",args:{pack:"course-ui"}}).then(o=>{let i=r=>{let n=Ee.availibleDomain("lessons",r);if(!n){let t=`no avalible domain for course ${e} retrying`;return Oe.log("[debug-domain] errorMessage",t),void s(new Error(t))}be.call({method:"getServerPackageVersion",args:{url:`${n}/${e}.json`}}).then(e=>{this.__setStatus("UPDATE.COURSE_BUNDLE"),e=e||{},o&&o.key==e.lesson&&o.md5==e.md5?(this.__setStatus("UPDATE.LASTEST"),t(e)):(this.__setStatus("UPDATE.DOWNLOADING_UI"),this.__do_update_bundle({pack:"course-ui",result:e,base_url:n}).then(e=>{t(e)}).catch(e=>{s(e)}))}).catch(e=>{i(!0)})};i()}).catch(e=>{s(e)})})}render(){return Ie("div",{className:"downloader"},void 0,Ie("div",{className:"info"},void 0,this.state.title),this.state.error?[Ie("div",{className:"info notice"},"notice",this.state.error),Ie("div",{className:"restart-btn",onClick:()=>{this.__restart()}},"restart")]:[Ie("div",{className:"progress"},"progress",Ie("div",{className:"bar"},void 0,Ie("div",{className:"bar-i",style:{width:`${100*this.state.percent}%`}})),Ie("div",{className:"percent"},void 0,100*this.state.percent>>0,"%")),Ie("div",{className:"info notice"},"notice",this.state.notice)])}};s(163);function Le(e,t,s,o){Ce||(Ce="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),t&&i)for(var n in i)void 0===t[n]&&(t[n]=i[n]);else t||(t=i||{});if(1===r)t.children=o;else if(r>1){for(var a=new Array(r),l=0;l<r;l++)a[l]=arguments[l+3];t.children=a}return{$$typeof:Ce,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}var Me=Le(ce,{}),Ae=Le("thead",{},void 0,Le("tr",{},void 0,Le("th",{width:"50%"},void 0,"文件"),Le("th",{width:"10%"},void 0,"压缩前"),Le("th",{width:"20%"},void 0,"当前进度"),Le("th",{width:"10%"},void 0,"压缩后"),Le("th",{},void 0,"减少"))),Ge=Le("div",{className:"progress-bar back"}),Re=Le("tr",{}),xe=Le("div",{className:"empty"},void 0,"未导入任何文件"),Pe=Le(z,{}),Fe=Le("div",{className:"title-icon"}),je=Le("h1",{className:"title"},void 0,"程序宝"),qe=Le("span",{className:"icon icon-cancel-squared close"}),Be=Le("span",{className:"icon icon-minus-squared minus"}),We=Le("h5",{className:"nav-group-title"},void 0,"开发必备"),He=Le("span",{className:"icon icon-picture"}),Ve=Le("span",{className:"icon icon-droplet"}),Xe=Le("span",{className:"icon icon-video"}),ze=Le("div",{className:"new"}),Ke=Le("span",{className:"icon icon-vcard"}),Ye=Le("div",{className:"new"});var Je,Qe=Object(I.b)((e,t)=>({showToastState:e.toast}),e=>({confirm:t=>e(q(t)),alert:t=>e((e=>({type:"SHOW_ALERT",configure:e}))(t)),hide:()=>e({type:"HIDE_DIALOG"}),hideLoading:()=>e((()=>e=>{j.hide()})()),showLoading:t=>e((e=>t=>{j.show(e)})(t)),onShowGlobalMsg:t=>e(H(t)),onShowTost:t=>e((e=>({type:"SHOW_TOAST",configure:e}))(t))}))(class extends D.a.Component{constructor(e){super(e),this.$home_major_cfg={page_pngquant:1,page_tinypng:2,localserver:3,connectAuth:4,matter:5,page_gif:6},this.state={selectedPage:0,working:!1,homeMajor:this.$home_major_cfg.page_pngquant,tinyFiles:[],tinyDone:0,outPutPath:"",outMode:1},this.$compress_total=0,this.$darwin=new RegExp("darwin","i").test(r.a.type()),this.$temp_compress_folder=g.a.join(d.remote.app.getPath("userData"),"PngquantTransport"),ue.a.ensureDirSync(this.$temp_compress_folder)}componentDidMount(){let e=localStorage.getItem("USER_ID");e||(e=Date.now(),localStorage.setItem("USER_ID",e)),b.sentryBrowser.bindUser(e,"-","-",window.ENV_CONF.version,"-"),b.mark(20001,window.ENV_CONF.systeminfo),this.$compress_total=(localStorage.getItem("COMPRESS_TOTAL")||"0")-0,this.__ffmpeg_exist_or_not()}componentWillUnmount(){}__home_major(){let e="";switch(this.state.homeMajor){case this.$home_major_cfg.page_pngquant:e=this.__home_major_pngquant();break;case this.$home_major_cfg.matter:e=this.__home_major_matter();break;case this.$home_major_cfg.page_gif:e=this.__home_major_gif();break;case this.$home_major_cfg.page_tinypng:e=this.__home_major_tinypng();break;case this.$home_major_cfg.localserver:e=this.__home_major_localserver();break;case this.$home_major_cfg.connectAuth:e=this.__home_major_connect_auth();break;default:e=this.__home_major_pngquant()}return e}__select_output_path(e){d.remote.dialog.showOpenDialog(d.remote.getCurrentWindow(),{properties:["openDirectory","createDirectory"]},t=>{t&&t.length&&t[0]&&(this.setState({outPutPath:t[0]}),e&&e())})}__open_output_path(){this.state.outPutPath&&d.remote.shell.openItem(this.state.outPutPath)}__import_files_from_folder(){d.ipcRenderer.send("open-directory-dialog","openFile"),d.remote.dialog.showOpenDialog(d.remote.getCurrentWindow(),{properties:["openDirectory"]},e=>{e&&e.length&&this.setState({tinyFiles:e.map(e=>({path:e,size:900}))})})}__import_files(){d.ipcRenderer.send("open-directory-dialog","openFile"),d.remote.dialog.showOpenDialog(d.remote.getCurrentWindow(),{properties:["openFile","multiSelections"],filters:[{name:"Images",extensions:["png","PNG"]}]},e=>{let t=[];if(e&&e.length&&this.__reset_tiny(),e&&e.length){let s=[...e],o=()=>{let e=s.shift();e?ue.a.stat(e,(s,i)=>{s?console.log("file size calc error",e):(t.push({path:e,size:Math.ceil(i.size/1024)}),this.setState({tinyFiles:t})),o()}):this.setState({working:!1})};this.setState({working:!0}),o(),o(),o()}})}__trans_size(e){return null==e||null==e?"-":(console.log("MINGXI_DEBUG_LOG>>>>>>>>>size",e,e>1024,e>1024?"M":"KB"),`${e>1024?(e/1024).toFixed(2):e}${e>1024?"M":"KB"}`)}__calc_reduce(e,t){return null!=e&&null!=e&&t?(-100*(1-t/e)|0)+"%":"-"}__reset_tiny(e){e?this.setState({tinyDone:0,tinyFiles:this.state.tinyFiles.map(e=>(e.done=!1,e.finalSize=null,e.fail=null,e))}):this.setState({tinyDone:0,tinyFiles:[]})}__home_major_tinypng(){return"开发中"}__home_major_matter(){return Me}__ffmpeg_exist_or_not(){let e=this.$darwin?"ffmpeg-mac":"ffmpeg-win",t=this.$darwin?"ffmpeg":"ffmpeg.exe",s=g.a.join(d.remote.app.getPath("userData"),"appassets",e,t);return ue.a.existsSync(s)?(localStorage.setItem("ffmpeg_ready","1"),b.ffmpeg=s,!0):(localStorage.removeItem("ffmpeg_ready"),!1)}__home_major_gif(){return Le(fe,{showLoading:e=>{this.props.showLoading(e)},hideLoading:()=>{this.props.hideLoading()},onDownloadFfmpeg:e=>{let t=()=>{this.props.hide(),this.props.alert({title:"依赖库更新检测",content:Le(Ue,{data:{},preview:!0,complete:e=>{setTimeout(()=>{this.props.hide(),this.__ffmpeg_exist_or_not()},1500)},error:e=>{},user:this.props.account}),nobutton:!0,noanim:!0,close_hidden:!0})};localStorage.getItem("ffmpeg_ready")||(e?t():this.props.alert({content:"首次使用此功能须安装相关依赖组件",sure:()=>{t()},close_hidden:!0}))}})}__home_major_pngquant(){let e=this.state.tinyDone==this.state.tinyFiles.length||this.state.working||2==this.state.outMode&&!this.state.outPutPath;return Le("div",{className:"pane"},void 0,Le("table",{className:"table-striped home-major"},void 0,Ae,Le("tbody",{},void 0,this.state.tinyFiles.length?this.state.tinyFiles.map((e={},t)=>{let s=!!e.done,o=e.fail;return Le("tr",{},t,Le("td",{width:"50%",className:"file-item"},void 0,Le("span",{className:"file-path",title:e.path},void 0,e.path),Le("span",{className:"icon icon-folder gray",onClick:t=>{d.remote.shell.showItemInFolder(e.path),t.preventDefault()}})),Le("td",{width:"10%"},void 0,this.__trans_size(e.size)),Le("td",{width:"20%",className:"progress"},void 0,Ge,Le("div",{className:`progress-bar ${s?"done":""} ${o?"fail":""}`},void 0,o?Le("span",{},void 0,o):""),Le("span",{className:"progress-num"},void 0,s?100:0,"%")),Le("td",{width:"10%"},void 0,this.__trans_size(e.finalSize)),Le("td",{},void 0,this.__calc_reduce(e.size,e.finalSize)))}):Re)),this.state.tinyFiles.length?"":xe,Le("footer",{className:"toolbar toolbar-footer fixed-bottom"},void 0,Le("div",{className:"toolbar-actions"},void 0,Le("button",{className:`btn btn-default ${this.state.working?"disabled":""}`,disabled:this.state.working,onClick:()=>{this.__import_files()}},void 0,"批量导入")),Le("div",{className:"radio",onClick:e=>{"INPUT"!==e.target.tagName&&(this.state.working||this.setState({outMode:1}))}},void 0,Le("label",{},void 0,Le("span",{className:`icon ${1==this.state.outMode?"icon-check":""} radio-icon`}),Le("input",{className:"radio-input",type:"radio",name:"radios",defaultChecked:`${1==this.state.outMode?"checked":""}`}),"覆盖原图")),Le("div",{className:"radio",disabled:this.state.working,onClick:e=>{console.log("MINGXI_DEBUG_LOG>>>>>>>>>e.target.tagName",e.target.tagName),"INPUT"!==e.target.tagName&&(this.state.working||this.setState({outMode:2}))}},void 0,Le("label",{},void 0,Le("span",{className:`icon ${2==this.state.outMode?"icon-check":""} radio-icon`}),Le("input",{className:"radio-input",type:"radio",name:"radios",disabled:this.state.working,defaultChecked:`${2==this.state.outMode?"checked":""}`}),"自定义输出路径")),Le("input",{className:`form-control ${2==this.state.outMode?"":"hidden"}`,type:"text",placeholder:"暂未选择输出目录",value:this.state.outPutPath,disabled:"disabled"}),Le("div",{className:`toolbar-actions ${2==this.state.outMode?"":"hidden"}`},void 0,Le("button",{className:`btn btn-default ${this.state.working?"disabled":""}`,disabled:this.state.working,onClick:()=>{this.__select_output_path()}},void 0,"选择"),Le("button",{className:`btn btn-default ${this.state.outPutPath?"":"disabled"}`,disabled:!this.state.outPutPath,onClick:()=>{this.__open_output_path()}},void 0,"查看")),Le("div",{className:"status"},void 0,Le("span",{},void 0,`已完成：${this.state.tinyDone}/${this.state.tinyFiles.length}`)),Le("div",{className:"toolbar-actions"},void 0,Le("button",{className:`btn btn-primary ${e?"disabled":""}`,disabled:e,onClick:()=>{this.__start()}},void 0,"开始"),Le("button",{className:`btn btn-default ${this.state.working?"disabled":""}`,disabled:this.state.working,onClick:()=>{this.__reset_tiny(!0)}},void 0,"重置"),Le("button",{className:`btn btn-default ${this.state.working?"disabled":""}`,disabled:this.state.working,onClick:()=>{this.__reset_tiny()}},void 0,"清空"))))}__home_major_localserver(){return"敬请期待"}__home_major_connect_auth(){return Le("div",{className:"auth-container"},void 0,Le("div",{className:"self-code"},void 0,Le("img",{src:"https://mingxi-bundles-test.oss-cn-beijing.aliyuncs.com/yaduobao/cocos-wechat.jpeg?t={Date.now()}",alt:""})))}__contain_chinese(e=""){return new RegExp("[\\u4E00-\\u9FFF]+","g").test(e)}__rmdir(e){try{let s=[e],o=null,i=0;for(;o=s[i++];)if(ue.a.statSync(o).isDirectory()){let e=ue.a.readdirSync(o);s=[...s,...e.map(e=>g.a.join(o,e))]}for(var t=s.length-1;t>=0;t--)ue.a.statSync(s[t]).isDirectory()?ue.a.rmdirSync(s[t]):ue.a.unlinkSync(s[t])}catch(e){}}__compress_over(){this.setState({working:!1}),localStorage.setItem("COMPRESS_TOTAL",this.$compress_total),b.mark(20004,{},{},":"+this.$compress_total)}__start(){this.setState({working:!0});let e,t=_e.a.exec,s=_e.a.execSync;this.$darwin?s(`chmod 777 '${e=g.a.join(window.ENV_CONF.__dirname,"app.asar.unpacked","dist","libs","pngquant","mac","pngquant")}'`):e=g.a.join(window.ENV_CONF.__dirname,"app.asar.unpacked","dist","libs","pngquant","win","pngquant.exe");let o=(s,o,i)=>{let r,n,a,l=s.replace(/[^\\\/]*[\\\/]+/g,"").replace(/ /g," "),c=this.$darwin?`${this.state.outPutPath}/${l}`:`${this.state.outPutPath}\\${l}`,d=1==this.state.outMode?s:c,u=(e,t)=>{!t&&a&&a(e),!t&&this.$compress_total++,o&&o(e)};if(!this.$darwin&&this.__contain_chinese(s))try{this.__rmdir(this.$temp_compress_folder),ue.a.ensureDirSync(this.$temp_compress_folder);let e=Date.now()+"_"+Math.floor(1e5*Math.random())+".png";r=g.a.join(this.$temp_compress_folder,"_raw_"+e),n=g.a.join(this.$temp_compress_folder,"_final_"+e),ue.a.copyFileSync(s,r),a=(()=>{try{ue.a.copyFileSync(n,d)}catch(e){}})}catch(e){r=n=a=null}let h=`${e} "${r||s}" --output "${n||d}" --force --verbose --skip-if-larger`;h=window._test_command||h,console.log("MINGXI_DEBUG_LOG>>>>>>>>>command is:",h),t(h,(e,t,s)=>{let o=/skipped/i.test(e||"");if(e&&!o){let t;return console.log("error: "+e),b.mark(20002,{error:e}),t=/cannot decode/.test(e)?"非合法png":/cannot open/.test(e)?"非法路径":"未知错误",console.log("failed reason:",t),void(i&&i(t))}console.log("stdout: "+t),console.log("stderr: "+s),u(d,o)})};this.state.tinyFiles.map(e=>{e.path});let i=[...this.state.tinyFiles],r=()=>{let e=(i.shift()||{}).path;e&&o(e,t=>{let s=this.state.tinyFiles;s.map(o=>{if(e==o.path){try{ue.a.existsSync(t)||(0,_e.a.execSync)(`${this.$darwin?"cp":"copy"} "${e}" "${t}"`)}catch(e){console.error("file copy error",t)}ue.a.stat(t,(e,i)=>{e?(console.error("file size calc error",t),o.fail="非法输出路径"):o.finalSize=Math.ceil(i.size/1024),o.done=!0;let n=this.state.tinyDone+1;n==this.state.tinyFiles.length&&this.__compress_over(),this.setState({tinyDone:n,tinyFiles:[...s]}),r()})}})},t=>{let s=this.state.tinyFiles;s.map(o=>{if(e==o.path){o.done=!0,o.fail=t;let e=this.state.tinyDone+1;e==this.state.tinyFiles.length&&this.__compress_over(),this.setState({tinyDone:e,tinyFiles:[...s]}),r()}})})};r()}render(){let e;this.props.globalMsg&&(e=Pe),this.state.selectedPage;let t=Le("div",{className:"window"},void 0,Le("header",{className:"toolbar toolbar-header normal"},void 0,Fe,je,Le("button",{className:"btn btn-default close",onClick:()=>{d.remote.app.quit()}},void 0,qe),Le("button",{className:"btn btn-default minus",onClick:()=>{d.remote.getCurrentWindow().minimize()}},void 0,Be),Le("div",{className:"toolbar-actions"},void 0,Le("div",{className:"btn-group"}))),Le("div",{className:"window-content"},void 0,Le("div",{className:"pane-group"},void 0,Le("div",{className:"pane pane-sm sidebar"},void 0,Le("nav",{className:"nav-group"},void 0,We,Le("span",{className:`nav-group-item ${this.state.homeMajor==this.$home_major_cfg.page_pngquant?"active":""}`,onClick:()=>{this.setState({homeMajor:this.$home_major_cfg.page_pngquant})}},void 0,He,"图片压缩"),Le("span",{className:`nav-group-item ${this.state.homeMajor==this.$home_major_cfg.matter?"active":""}`,onClick:()=>{this.setState({homeMajor:this.$home_major_cfg.matter})}},void 0,Ve,"免费素材"),Le("span",{className:`nav-group-item ${this.state.homeMajor==this.$home_major_cfg.page_gif?"active":""}`,onClick:()=>{this.setState({homeMajor:this.$home_major_cfg.page_gif})}},void 0,Xe,"视频转GIF",ze)),Le("nav",{className:"nav-group"},void 0,Le("h5",{className:"nav-group-title",onDoubleClick:()=>{this.$test_dev_num||(this.$test_dev_num=1),this.$test_dev_num++,this.$darwin&&this.$test_dev_num>=5&&d.remote.getCurrentWindow().webContents.openDevTools()}},void 0,"社区"),Le("span",{className:`nav-group-item ${this.state.homeMajor==this.$home_major_cfg.connectAuth?"active":""}`,onClick:()=>{this.setState({homeMajor:this.$home_major_cfg.connectAuth})}},void 0,Ke,"Cocos研习社",Ye))),this.__home_major())));return Le("div",{className:"full-h",onDragStart:e=>{e.preventDefault()}},void 0,t,e)}}),Ze=s(88),et=s.n(Ze).a;s(164);function tt(e,t,s,o){Je||(Je="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),t&&i)for(var n in i)void 0===t[n]&&(t[n]=i[n]);else t||(t=i||{});if(1===r)t.children=o;else if(r>1){for(var a=new Array(r),l=0;l<r;l++)a[l]=arguments[l+3];t.children=a}return{$$typeof:Je,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}var st,ot=Object(I.b)((e,t)=>({showing:e.dialog.showing}),(e,t)=>({dispatchHide:()=>{e({type:"HIDE_DIALOG"})}}))(class extends D.a.Component{constructor(e){super(e),d.ipcRenderer.on("hotkey",(e,t)=>{this.onHotKey&&"function"==typeof this.onHotKey&&this.onHotKey(t)})}hide(){this.props.dispatchHide(),this.props.data.configure.cancel&&this.props.data.configure.cancel()}sure(){this.props.dispatchHide(),this.props.data.configure.sure&&this.props.data.configure.sure()}render(){this.props.data.configure.hidden;let e=[];const{type:t,configure:s}=this.props.data;let o=s.style||_.EBTN_STYLE_CONFIG.kNormal,i=`ok-btn ${o[0]}`,r=`cancel-btn ${o[1]}`,n=`${(s.linestyle||_.LINE_CONFIRM_TITLE.lineTitle)[0]}`;return"confirm"==t&&e.push(tt("button",{className:r,onClick:this.hide.bind(this)},"cancel-btn")),e.push(tt("button",{className:i,onClick:this.sure.bind(this)},"ok-btn")),tt("div",{className:`mask dialog-layer ${this.props.data.configure.hidden?" hide":" show"}`},void 0,tt("div",{className:`${"dialog "+(s.classname||"")}${s.large_mod?" large":""}`,style:s.styles},void 0,tt("div",{className:s.title_hidden?"title clear":"title"},void 0,"个人信息"==s.title?tt("div",{className:n},void 0,s.title_hidden?"":`${s.title||"提示"}`):s.title_hidden?"":`${s.title||"提示"}`,this.props.data.configure.close_hidden?"":tt("div",{className:"close-btn",onClick:this.hide.bind(this)})),tt("div",{className:s.nobutton?"content nobtn":"content"},void 0,tt("div",{className:s.large_mod?"texts large":"texts"},void 0,s.content),s.nobutton?"":tt("div",{className:"btns"},void 0,e))))}onHotKey(e){if(this.props.showing)switch(et[e]){case et.KEY_ENTER:this.sure();break;case et.KEY_ESC:this.hide()}}componentWillUnmount(){this.onHotKey=null}});function it(e,t,s,o){st||(st="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),t&&i)for(var n in i)void 0===t[n]&&(t[n]=i[n]);else t||(t=i||{});if(1===r)t.children=o;else if(r>1){for(var a=new Array(r),l=0;l<r;l++)a[l]=arguments[l+3];t.children=a}return{$$typeof:st,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}const rt=u.a.remote;var nt=it(Qe,{});var at,lt=Object(I.b)((e,t)=>({account:e.login.account,dialog:e.dialog}),(e,t)=>({confirm:t=>e(q(t)),onNetStatusBad:()=>e({type:"NET_STATUS_BAD"}),onNetStatusGood:()=>e({type:"NET_STATUS_GOOD"})}))(class extends D.a.Component{constructor(e){super(e)}render(){const{dialog:e}=this.props;return it(R.a,{},void 0,it("div",{className:"full-h",onClick:e=>{},onContextMenu:e=>!1},void 0,it("div",{className:"slave",onDoubleClick:()=>{rt.getCurrentWindow().webContents.openDevTools()}}),it("div",{className:"slave-l",onDoubleClick:()=>{}}),it(x.a,{exact:!0,path:"/",render:()=>nt}),e.showing?it(ot,{data:e}):""))}}),ct=s(90);function dt(e,t,s,o){at||(at="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),t&&i)for(var n in i)void 0===t[n]&&(t[n]=i[n]);else t||(t=i||{});if(1===r)t.children=o;else if(r>1){for(var a=new Array(r),l=0;l<r;l++)a[l]=arguments[l+3];t.children=a}return{$$typeof:at,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}b.sentryBrowser=S;let ut=!1,ht=!1;d.ipcRenderer.on("configure",(e,t)=>{window.ENV_CONF||(window.ENV_CONF={});for(let e in t)window.ENV_CONF[e]=t[e];let s;!function(){switch(process.platform){case"win32":return"win";case"darwin":;}}();s=t.__apppath+"/dist",console.log("app configure",t),t.data&&t.data.usingBackupUrl&&(b.usingBackupUrl=!0),b.distPath=s,(ut=!0)&&ht&&function(){S.init();const e=[ct.a],t=Object(O.d)(G,Object(O.a)(...e));t.dispatch(B()),Object(T.render)(dt(I.a,{store:t},void 0,_t),document.getElementById("app"))}()}),d.ipcRenderer.on("systeminfo",(e,t)=>{console.log("systeminfo",t),window.ENV_CONF||(window.ENV_CONF={});for(let e in t)window.ENV_CONF[e]=t[e];ht=!0});var _t=dt(lt,{})},28:function(e,t){e.exports=require("child_process")},30:function(e,t){e.exports={SENTRY_DSN:"http://b60c18f7cca84085a184bc77582cabaf@121.36.22.201:9000/2",MAIN_WINDOW_SIZE:{width:1070,height:590},UPDATE:{AVAILABLE:"update available",LASTEST:"the lastest version",CHECKING:"checking for update",ERROR:"update error",DOWNLOADING:"update downloading",DOWNLOADED:"update downloaded",DOWNLOADING_UI:"downloading ui",DOWNLOADED_UI:"downloaded ui"},ILLEGAL_AUDIOS:["cyberlink webcam splitter","manycam virtual webcam","BBlivePreview","CamTwist","17GuaGua Cam","PixelMaster Video HDR","PG splitter","Built-in iSight","6room"],DOMAIN_URL:"https://mingxicn-test.oss-cn-beijing.aliyuncs.com/domain-yaduobao.json",DOMAIN_LIST_DEFAULT:{frame:["https://bundlesyuntest.mx0a.com","https://mingxi-bundles-test.oss-cn-beijing.aliyuncs.com"],bundles:["https://bundlesyuntest.mx0a.com","https://mingxi-bundles-test.oss-cn-beijing.aliyuncs.com"]},EBTN_STYLE_CONFIG:{kNormal:["ok","cancel"],kDeviceTest:["check-again","check-jump"],kChangePwd:["changepwd","none"],kClassExit:["leave-class","end-class"]},LINE_CONFIRM_TITLE:{lineTitle:["title-text"]}}},36:function(e,t){const s={MESSAGE:{10001:["进入大厅",1],10003:["关闭大厅窗口",1]},EVENT:{20001:["设备详情",0],20002:["压缩出错",-3],20003:["系统弹窗",-3],20004:["完成，历史累计有效压缩数量",0]},LEVEL:{1:"log",0:"info",[-1]:"warning",[-2]:"error",[-3]:"fatal"}};e.exports=s},4:function(e,t){e.exports=require("path")},71:function(e,t){e.exports=require("util")},72:function(e,t){e.exports=require("assert")},79:function(e,t){e.exports=require("string_decoder")},88:function(e,t){const s={KEY_C:{code:"C",windowFocusNeeded:!0},KEY_M:{code:"M",windowFocusNeeded:!0},KEY_G:{code:"G",windowFocusNeeded:!0},KEY_LEFT:{code:"Left",windowFocusNeeded:!0},KEY_RIGHT:{code:"Right",windowFocusNeeded:!0},KEY_ENTER:{code:"Return",windowFocusNeeded:!0},KEY_ESC:{code:"Escape",windowFocusNeeded:!0}};for(const e in s)s[e].toString=(()=>s[e].code);e.exports=s}});